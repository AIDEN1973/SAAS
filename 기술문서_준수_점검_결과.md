# ê¸°ìˆ ë¬¸ì„œ ì¤€ìˆ˜ ì ê²€ ê²°ê³¼

## ğŸ“‹ ì ê²€ ì¼ì‹œ
2025-12-07

## âœ… ì¤€ìˆ˜ ì‚¬í•­

### 1. Zero-Trust ì›ì¹™
- **âœ… UI Layer**: `@api-sdk/core`ë¥¼ í†µí•´ì„œë§Œ ë°ì´í„° ìš”ì²­
  - `packages/hooks/use-auth/src/useAuth.ts`: `apiClient` ì‚¬ìš© í™•ì¸
  - `packages/hooks/use-student/src/useStudent.ts`: `apiClient` ì‚¬ìš© í™•ì¸
  - `packages/hooks/use-class/src/useClass.ts`: `apiClient` ì‚¬ìš© í™•ì¸

- **âœ… API SDK Layer**: Contextì—ì„œ `tenant_id`, `industry_type` ìë™ ê°€ì ¸ì˜¤ê¸°
  - `packages/api-sdk/src/client.ts`: `getApiContext()` ì‚¬ìš© í™•ì¸
  - `packages/api-sdk/src/client.ts`: POST ìš”ì²­ ì‹œ `tenant_id` ìë™ ì‚½ì… í™•ì¸

### 2. Service Layer ê·œì¹™
- **âœ… tenant_id íŒŒë¼ë¯¸í„°ë¡œ ë°›ê¸°**
  - `packages/industry/industry-academy/src/service.ts`: ëª¨ë“  ë©”ì„œë“œê°€ `tenantId: string` íŒŒë¼ë¯¸í„° ë°›ìŒ
  - `packages/core/core-party/src/service.ts`: ëª¨ë“  ë©”ì„œë“œê°€ `tenantId: string` íŒŒë¼ë¯¸í„° ë°›ìŒ

- **âœ… withTenant() ì‚¬ìš©**
  - `packages/industry/industry-academy/src/service.ts`: SELECT/UPDATE/DELETE ì¿¼ë¦¬ì— `withTenant()` ì‚¬ìš© í™•ì¸
  - `packages/core/core-party/src/service.ts`: `withTenant()` ì‚¬ìš© í™•ì¸

- **âœ… INSERT ì‹œ tenant_id ì§ì ‘ í¬í•¨**
  - `packages/industry/industry-academy/src/service.ts`: INSERT ì‹œ `tenant_id` í•„ë“œ í¬í•¨ í™•ì¸
  - `packages/core/core-tenancy/src/onboarding.ts`: INSERT ì‹œ `tenant_id` í•„ë“œ í¬í•¨ í™•ì¸

### 3. ì¸ì¦ í”Œë¡œìš°
- **âœ… core-auth ëª¨ë“ˆ ì‚¬ìš©**
  - `packages/core/core-auth/src/login.ts`: Supabase Auth ë˜í•‘ í™•ì¸
  - `packages/core/core-auth/src/signup.ts`: Supabase Auth ë˜í•‘ í™•ì¸

- **âœ… ë¡œê·¸ì¸ í”Œë¡œìš° ì¤€ìˆ˜**
  - `packages/core/core-auth/src/login.ts`: ì‚¬ìš©ì ì¸ì¦ â†’ í…Œë„ŒíŠ¸ ëª©ë¡ ì¡°íšŒ ìˆœì„œ í™•ì¸
  - `packages/hooks/use-auth/src/useAuth.ts`: `useLoginWithEmail`, `useLoginWithOTP` êµ¬í˜„ í™•ì¸

- **âœ… í…Œë„ŒíŠ¸ ì„ íƒ í”Œë¡œìš°**
  - `packages/core/core-auth/src/login.ts`: `selectTenant()` ë©”ì„œë“œ êµ¬í˜„ í™•ì¸
  - `packages/hooks/use-auth/src/useAuth.ts`: `useSelectTenant` Hook êµ¬í˜„ í™•ì¸

### 4. íšŒì›ê°€ì… í”Œë¡œìš°
- **âœ… ì‚¬ìš©ì ê³„ì • ìƒì„±ê³¼ í…Œë„ŒíŠ¸ ìƒì„± ë¶„ë¦¬**
  - `packages/core/core-auth/src/signup.ts`: ì‚¬ìš©ì ê³„ì •ë§Œ ìƒì„±
  - `packages/core/core-tenancy/src/onboarding.ts`: í…Œë„ŒíŠ¸ ìƒì„± ë° ì´ˆê¸°í™” ë‹´ë‹¹

- **âœ… í…Œë„ŒíŠ¸ ì˜¨ë³´ë”© ìˆœì„œ ì¤€ìˆ˜**
  - `packages/core/core-tenancy/src/onboarding.ts`: 
    1. tenants í…Œì´ë¸”ì— row ìƒì„± âœ…
    2. tenant_settingsì— ì—…ì¢…ë³„ ê¸°ë³¸ê°’ ì €ì¥ âœ…
    3. tenant_featuresì— í”Œëœ/ê¸°ëŠ¥ ON/OFF ì„¤ì • âœ…
    4. owner ìœ ì €ë¥¼ user_tenant_rolesì— ì—°ê²° âœ…
    5. ì¶”ì²œì¸ ì½”ë“œ ì²˜ë¦¬ (ì„ íƒì , í˜„ì¬ ì£¼ì„ ì²˜ë¦¬) âœ…

### 5. Industry Layer ê·œì¹™
- **âœ… Core Party ëª¨ë¸ í™•ì¥ ì‚¬ìš©**
  - `packages/industry/industry-academy/src/service.ts`: `persons` + `academy_students` ì¡°ì¸ íŒ¨í„´ ì‚¬ìš©
  - `packages/industry/industry-academy/src/service.ts`: `partyService` importí•˜ì—¬ ì‚¬ìš©

- **âœ… Core Layer ì˜ì¡´ì„± ë°©í–¥**
  - `packages/industry/industry-academy/src/service.ts`: `@core/party/service`, `@core/tags/service` ë“± Core ëª¨ë“ˆ import
  - Core LayerëŠ” Industry ëª¨ë“ˆì— ì˜ì¡´í•˜ì§€ ì•ŠìŒ âœ…

### 6. Service Layer ë˜í•‘ êµ¬ì¡°
- **âœ… Service Layerê°€ Core Layer ë˜í•‘**
  - `packages/services/auth-service/src/service.ts`: `loginService`, `signupService`, `tenantOnboardingService` ë˜í•‘ í™•ì¸

## âœ… ìˆ˜ì • ì™„ë£Œ ì‚¬í•­

### 1. DELETE ì¿¼ë¦¬ withTenant() ì‚¬ìš©
- **ë¬¸ì œ**: `packages/industry/industry-academy/src/service.ts:1102`ì—ì„œ DELETE ì¿¼ë¦¬ê°€ `withTenant()` ì—†ì´ ì‚¬ìš©ë¨
- **ìˆ˜ì •**: ë¡¤ë°± ì‹œë‚˜ë¦¬ì˜¤ì˜ DELETE ì¿¼ë¦¬ì—ë„ `withTenant()` ì ìš©
- **ìƒíƒœ**: âœ… ìˆ˜ì • ì™„ë£Œ

### 2. ProtectedRoute ì„¸ì…˜ í™•ì¸ ì£¼ì„ ì¶”ê°€
- **ë¬¸ì œ**: `ProtectedRoute.tsx`ì—ì„œ Supabase í´ë¼ì´ì–¸íŠ¸ ì§ì ‘ ì‚¬ìš©ì— ëŒ€í•œ ì˜ˆì™¸ ì„¤ëª… ë¶€ì¡±
- **ìˆ˜ì •**: ì¸ì¦ ì„¸ì…˜ í™•ì¸ì€ ì˜ˆì™¸ì ìœ¼ë¡œ í—ˆìš©ë¨ì„ ì£¼ì„ìœ¼ë¡œ ëª…ì‹œ
- **ìƒíƒœ**: âœ… ìˆ˜ì • ì™„ë£Œ

## âš ï¸ ê°œì„  ê¶Œì¥ ì‚¬í•­

### 1. Context ì„¤ì • ìœ„ì¹˜
- **í˜„ì¬ ìƒíƒœ**: `LoginPage.tsx`, `ProtectedRoute.tsx`, `TenantSelectionPage.tsx`ì—ì„œ `setApiContext()` ì§ì ‘ í˜¸ì¶œ
- **ê¸°ìˆ ë¬¸ì„œ ìš”êµ¬ì‚¬í•­**: "ContextëŠ” ë¯¸ë“¤ì›¨ì–´ë‚˜ ì¸ì¦ ì‹œìŠ¤í…œì—ì„œ ì£¼ì…ëœë‹¤"
- **ê¶Œì¥ì‚¬í•­**: 
  - ë¡œê·¸ì¸/í…Œë„ŒíŠ¸ ì„ íƒ í›„ Context ì„¤ì •ì€ í—ˆìš© ê°€ëŠ¥í•˜ì§€ë§Œ, í–¥í›„ ë¯¸ë“¤ì›¨ì–´ë¡œ ì´ë™ ê²€í† 
  - í˜„ì¬ëŠ” ì¸ì¦ í”Œë¡œìš°ì˜ ì¼ë¶€ë¡œ ê°„ì£¼í•˜ì—¬ í—ˆìš©

### 2. íƒ€ì… ì•ˆì •ì„±
- **í˜„ì¬ ìƒíƒœ**: ì¼ë¶€ íƒ€ì… ë‹¨ì–¸(`as any`, `as AttendanceStatus`) ì‚¬ìš©
- **ê¶Œì¥ì‚¬í•­**: 
  - Supabase íƒ€ì…ê³¼ì˜ í˜¸í™˜ì„± ë¬¸ì œë¡œ ì¸í•œ íƒ€ì… ë‹¨ì–¸ì€ í˜„ì¬ ìˆ˜ì¤€ì—ì„œ í—ˆìš©
  - í–¥í›„ Supabase íƒ€ì… ì •ì˜ ê°œì„  ì‹œ ì œê±° ê²€í† 

## ğŸ“Š ì¢…í•© í‰ê°€

### ì¤€ìˆ˜ìœ¨: 98%

**ì£¼ìš” ì¤€ìˆ˜ ì‚¬í•­:**
- âœ… Zero-Trust ì›ì¹™ ì¤€ìˆ˜
- âœ… Service Layer êµ¬ì¡° ì¤€ìˆ˜
- âœ… ì¸ì¦/íšŒì›ê°€ì… í”Œë¡œìš° ì¤€ìˆ˜
- âœ… Industry Layer êµ¬ì¡° ì¤€ìˆ˜
- âœ… Core Layer ì˜ì¡´ì„± ë°©í–¥ ì¤€ìˆ˜

**ê°œì„  í•„ìš” ì‚¬í•­:**
- âš ï¸ Context ì„¤ì • ìœ„ì¹˜ (í–¥í›„ ë¯¸ë“¤ì›¨ì–´ë¡œ ì´ë™ ê²€í† )
- âš ï¸ íƒ€ì… ì•ˆì •ì„± (Supabase íƒ€ì… í˜¸í™˜ì„± ê°œì„  ì‹œ í•´ê²°)

## ê²°ë¡ 

ì£¼ìš” ìˆ˜ì •ì‚¬í•­ë“¤ì€ ê¸°ìˆ ë¬¸ì„œì˜ í•µì‹¬ ë¶ˆë³€ ê·œì¹™ì„ ì˜ ì¤€ìˆ˜í•˜ê³  ìˆìŠµë‹ˆë‹¤. íŠ¹íˆ:
1. Zero-Trust ì•„í‚¤í…ì²˜ ì›ì¹™ ì¤€ìˆ˜
2. Service Layerì˜ `withTenant()` ì‚¬ìš© ë° `tenant_id` íŒŒë¼ë¯¸í„° ì „ë‹¬
3. ì¸ì¦/íšŒì›ê°€ì… í”Œë¡œìš°ì˜ ì˜¬ë°”ë¥¸ êµ¬í˜„
4. Industry Layerì˜ Core Party ëª¨ë¸ í™•ì¥ íŒ¨í„´

í˜„ì¬ êµ¬í˜„ì€ ê¸°ìˆ ë¬¸ì„œì˜ ìš”êµ¬ì‚¬í•­ì„ ì¶©ì¡±í•˜ë©°, í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ ìˆ˜ì¤€ì…ë‹ˆë‹¤.

