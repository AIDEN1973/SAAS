디어쌤 Schema Editor Technical Specification v1.2 (Complete Edition)

Schema Engine v2.1 · SDUI Enterprise Edition · Multi-Industry · Zero-Trust
2025-12 Final Revision

0. 문서 개요 (Document Overview)

Schema Editor는 디어쌤 SDUI(Schema-Driven UI) 플랫폼의 핵심 구성요소로서,
Super Admin이 직접 Form/Table/Detail/Filter/Widget UI를 생성·편집·버전 관리할 수 있는 엔터프라이즈급 No-Code UI Builder이다.

이 문서는 Schema Editor의:

목적

아키텍처 구조

보안 및 Zero-Trust 모델

스키마 구조 정의

버전 관리 정책

Preview Renderer

Custom Widget Sandbox

Migration Script

API 명세

운영·모니터링 체계

Anti-Pattern 강제 규칙

을 완전히 통합한 최종 기술문서이다.

1. 목적 (Purpose)

Schema Editor의 목표는 다음과 같다:

목표	설명
UI 자동화	모든 Form/Table/Widget 화면을 SDUI 스키마로 자동 구성
No-Code	Super Admin이 코딩 없이 UI 변경 가능
Multi-Industry	학원/미용/부동산 등 업종별 독립 스키마 운영
Version-Safe	스키마 안전 업그레이드
Zero-Trust	UI는 권한/테넌트/비즈니스 로직을 절대 신뢰하지 않음
확장성	테넌트 30,000+, 업종 100개 이상의 대규모 구조 대응
2. 전체 아키텍처 (System Architecture)
┌──────────────────────────────────────────────┐
│              Super Admin Console             │
│        (Schema Editor Application UI)        │
└──────────────────────┬───────────────────────┘
                       │
        Schema Editor UI Components
                       │
┌──────────────────────┴──────────────────────┐
│              Schema Engine (Core)           │
│  - Meta-Schema Validator                    │
│  - Dual Validation Pipeline                 │
│  - Schema Parser & Normalizer               │
│  - Preview Renderer                         │
│  - Condition Rule Engine                    │
│  - Custom Widget Sandbox                    │
│  - Schema Migrator                          │
└──────────────────────┬──────────────────────┘
                       │
                 Schema Registry
             (Supabase Meta Database)

3. 보안 모델 (Security Model)
3.1 Zero-Trust UI Layer

Schema Editor UI는:

절대 tenant_id를 생성·조작하지 않음

권한을 직접 판단하지 않음

fetch/axios 직접 호출 금지

모든 요청은 @api-sdk/core를 통해 전송

모든 권한 판정은:

Supabase RLS

Gateway Access Control

Server-Side Validator

에서 이루어진다.

3.2 Super Admin 인증 흐름 (JWT Lifecycle)
JWT Issue

로그인 성공 → 서버에서 Super Admin 권한 포함 JWT 발급

JWT Refresh

refresh-token은 httpOnly + secure cookie

refresh 시 revocation list 확인

JWT Revocation (취소 전략)

다음 발생 시 즉시 무효화:

비밀번호 변경

관리자 권한 변경

강제 로그아웃

의심스러운 접근(IP mismatch 등)

보안 경고 이벤트 발생

Revocation 리스트는 Redis/Edge KV에 저장하여
각 API 호출 시 반드시 검증한다.

4. Schema Registry 모델
4.1 Registry 테이블 구조
필드	설명
id	PK
entity	student/class/...
industry	academy/salon/...
version	1.0.0
status	draft/active/deprecated
schema_json	전체 UI 정의 JSON
min_supported_client	최소 앱 버전
created_at / updated_at	시간 기록
created_by	Super Admin ID
updated_by	Super Admin ID
5. 스키마 구조 (SDUI Meta-Schema)

스키마는 JSON으로 정의되며 다음 요소를 포함한다:

form

table

detail

filter

widget

layout

validation

condition

meta

예시:

{
  "entity": "student",
  "industry": "academy",
  "version": "2.1.0",
  "status": "draft",
  "form": {
    "layout": { "columns": 2, "gap": "md" },
    "fields": [
      {
        "id": "name",
        "label": "이름",
        "type": "text",
        "required": true
      }
    ]
  }
}

6. Meta-Schema Validation — Dual Validation 구조
✔ 6.1 Client-Side Validation

목적:

실시간 오류 방지

Preview 렌더 오류 사전 차단

검증 항목:

필드 구조

타입

condition rule

layout rule

✔ 6.2 Server-Side Validation

모든 저장 요청에서 반드시 재검증하여:

스키마 위조 방지

보안 공격 방지(XSS, Injection)

Anti-Pattern 방지

active/deprecated 수정 시도 차단

저장 실패 시:

HTTP 422 Unprocessable Entity

7. Anti-Pattern Enforcement (기술적 강제)
금지 요소	이유	Enforcement
Tailwind class 삽입	Styling 분리 원칙 위반	Validator 차단
script 삽입	XSS 위험	Sanitizer + Validator 차단
onclick 등 이벤트 삽입	Sandbox 탈출 위험	Parser에서 삭제
비즈니스 로직 삽입	UI 구조만 표현해야 함	Validator 차단
active/deprecated 직접 수정	Version-Safe 정책 위반	RLS + API 차단
8. Condition Rule Engine

구조:

{
  "if": { "field": "is_minor", "equals": true },
  "then": { "visible": true }
}


AND/OR 지원

순환 참조 자동 제거

무효 조건 자동 경고

Preview에서도 동일하게 동작

9. Validation Rule

지원되는 검증:

required

minLength / maxLength

min / max

regex pattern

allowed values

10. Custom Widget Sandbox
10.1 기술 스택

sandboxed iframe

Shadow DOM v1

CSP: script-src 'none'

postMessage 기반 통신

10.2 제한사항

API SDK 호출 불가

window global 접근 불가

DOM 탈출 방지

부모 문서 접근 차단

11. Preview Renderer

Preview는 다음 방식으로 작동:

Schema JSON 파싱

Mock Data 자동 생성

Condition Rule 적용

Layout 계산

Renderer로 UI 렌더링

Mock Data 예시:

타입	mock 값
text	"예시 텍스트"
date	오늘 날짜
select	첫 번째 옵션
12. Schema 버전 관리(Versioning)
상태	설명
draft	수정 가능
active	실제 앱에서 사용
deprecated	유지되지만 참조만 가능
규칙:

active → 수정 불가

수정 필요 → draft 새 버전 생성

activate 시:

기존 active → deprecated

draft → active

13. Migration Script

Migration Script는 스키마 버전 업 시 구조 변환을 처리한다.

기술:

TypeScript 기반

Registry 서버에서 실행

형식:

export default function migrate(prev, next) {
  // 변환 로직
  return next;
}


atomic transaction

실패 시 전체 rollback

14. Schema Editor 기능 (UX)
14.1 기능 목록

스키마 목록 조회

새 스키마 생성

필드 추가/삭제/수정

Condition Rule 설정

Validation 설정

Layout 설정

Draft 저장

Activate → Active 버전 배포

삭제 (draft만 삭제 가능)

Clone

Diff 비교 (JSON + Semantic Diff)

Import/Export(JSON/YAML)

Preview

15. Diff & History

두 버전 간 차이를 아래 2가지 방식으로 제공.

1) JSON Diff

차이를 key 기반으로 표시.

2) Semantic Diff

예:

필드 'grade'
  - required: false → true
  - label: "학년" → "현재 학년"

16. Schema Locking (Optimistic Locking)

draft 스키마를 저장할 때:

updated_at 비교 후 충돌 감지

충돌 시 사용자에게 경고:

다른 관리자가 먼저 수정했습니다.
변경 내용을 다시 확인해주세요.

17. API 명세 (Overview)
CRUD 엔드포인트
Method	Endpoint	설명	권한
GET	/schema	목록 조회	Super Admin + SDUI 엔진
GET	/schema/:id	단일 조회	Super Admin
POST	/schema/draft	draft 생성	Super Admin
PATCH	/schema/draft/:id	draft 수정	Super Admin
POST	/schema/:id/activate	버전 활성화	Super Admin
DELETE	/schema/draft/:id	draft 삭제	Super Admin
DELETE	/schema/:id	❌ 금지	없음
18. Cache Invalidation Strategy
Cache Key:
schema:{industry}:{entity}:{version}

activate 시:

active version 업데이트

ETag 변경

CDN cache purge

클라이언트는 다음 요청에서 새로운 active 스키마 fetch

옵션:

Supabase Realtime/PubSub로 즉시 무효화 이벤트 전파

19. Observability & Monitoring
19.1 필수 모니터링 지표
Metric	목표
Registry API P95 Latency	≤ 200ms
Cache Hit Ratio	≥ 90%
Renderer Error Rate	0%
Validation Failure Rate	≤ 0.5%
19.2 Logging

모든 스키마 변경은 다음을 기록:

super_admin_id

action(create/update/activate/delete)

before/after diff

request latency

client version

19.3 Alerting
상황	알림 기준
API 지연 증가	P95 > 500ms (5분 지속)
Renderer 오류	즉시 Critical Alert
JWT Revocation 사용 감지	즉시 Critical Alert
Validation 실패 급증	실패율 > 5%
20. Disaster Recovery (DR)

Rollback 가능함:

이전 active 버전 보존

rollback 실행 → 해당 버전을 다시 activate

모든 캐시 무효화

Audit Trail 기반으로 수행.

21. 성능 요구사항
항목	목표
Schema Editor 초기 로드	≤ 300KB
Preview 렌더링	≤ 50ms
Registry 저장	≤ 200ms
Schema fetch	≤ 100ms
22. 파일 구조
apps/super-admin/pages/SchemaEditorPage.tsx
components/schema-editor/
  SchemaListPanel.tsx
  SchemaEditorForm.tsx
  SchemaFieldEditor.tsx
  ValidationEditor.tsx
  ConditionEditor.tsx
  LayoutEditor.tsx
  SchemaPreview.tsx
  SemanticDiffViewer.tsx
  ImportExportPanel.tsx
packages/schema-engine/
  validator/
  renderer/
  registry-service/
  migrator/
  sandbox/
