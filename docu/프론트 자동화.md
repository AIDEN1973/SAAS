# í”„ë¡ íŠ¸ì—”ë“œ ìƒí™© ì‹ í˜¸ ìˆ˜ì§‘ ë° UI ì¡°ì • ë¬¸ì„œ
## Architecture v3.3 Strict-Compliant Edition

**âš ï¸ ì¤‘ìš”: ì‹¤ì œ íŒ¨í‚¤ì§€ ê²½ë¡œëŠ” R1.1(rules.md)ë§Œ ì •ë³¸**

ë³¸ ë¬¸ì„œì—ì„œ ì–¸ê¸‰í•˜ëŠ” ê°œë…ì  ë ˆì´ì–´ í‘œê¸°(ì˜ˆ: `/core-platform`, `/ui-core`, `/industry-*`)ëŠ” ê°œë…ì  ì„¤ëª…ì´ë©°,
ì‹¤ì œ Monorepo ë””ë ‰í„°ë¦¬ êµ¬ì¡°ì™€ ë„¤ì´ë° ê·œì¹™ì€ **R1.1(rules.md)ì„ ì •ë³¸ìœ¼ë¡œ ë”°ë¦…ë‹ˆë‹¤**.

êµ¬í˜„ ì‹œì—ëŠ” ì•„í‚¤í…ì²˜ ë¬¸ì„œì˜ ë§¤í•‘ ê·œì¹™ì„ ì°¸ì¡°í•˜ì„¸ìš”:
- `/core-platform` (ê°œë…) â†’ `packages/core/*` (ì‹¤ì œ)
- `/ui-core` (ê°œë…) â†’ `packages/ui-core` (ì‹¤ì œ)
- `/industry-*` (ê°œë…) â†’ `packages/industry/industry-*` (ì‹¤ì œ)

## âš ï¸ Automation Config First (ë¶ˆë³€ ì›ì¹™)

**ë³¸ ì‹œìŠ¤í…œì—ì„œ ì–´ë– í•œ ìë™í™”ë„ í•˜ë“œì½”ë”©ëœ ì¡°ê±´ìœ¼ë¡œ ì‹¤í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤.**
**ëª¨ë“  ìë™í™”ëŠ” ì‚¬ìš©ì ì„¤ì •ê°’(Policy / Threshold / Toggle)ì„ í†µí•´ í™œì„±Â·ë¹„í™œì„± ë° ê°•ë„ê°€ ê²°ì •ë˜ë©°,**
**ì‹¤í–‰ ì—¬ë¶€ëŠ” ì„œë²„/Edge Functionì´ í•´ë‹¹ ì„¤ì •ì„ í•´ì„í•˜ì—¬ íŒë‹¨í•œë‹¤.**

**âš ï¸ ì‹¤í–‰ ê²°ì •(Enabled Gate) vs ì‹¤í–‰ íŒŒë¼ë¯¸í„°(Channel/Provider Gate) êµ¬ë¶„:**

**1ë‹¨ê³„: ì‹¤í–‰ ê²°ì • (Enabled Gate)**
- `auto_notification.<event_type>.enabled` ì—†ìœ¼ë©´ ì‹¤í–‰ ì•ˆ í•¨ (FAIL CLOSED)
- ì •ìƒ í…Œë„ŒíŠ¸ëŠ” Default Policyê°€ ë°˜ë“œì‹œ ì¡´ì¬í•œë‹¤. 'ì—†ìœ¼ë©´ ì‹¤í–‰ ì•ˆ í•¨'ì€ ë§ˆì´ê·¸ë ˆì´ì…˜/í”„ë¡œë¹„ì €ë‹ ëˆ„ë½ ë˜ëŠ” ë ˆê±°ì‹œ í…Œë„ŒíŠ¸ë¥¼ Fail-Closedë¡œ ë§‰ëŠ” ì•ˆì „ì¥ì¹˜ë‹¤.

**2ë‹¨ê³„: ì‹¤í–‰ íŒŒë¼ë¯¸í„° (Channel/Provider Gate)**
- ì‹¤í–‰ì´ ì´ë¯¸ ê²°ì •ëœ í›„ ì±„ë„/ì¸í”„ë¼ íŒŒë¼ë¯¸í„°: `notification.*`ì„ ê¸°ë³¸ìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥ (ì¸í”„ë¼ ë ˆì´ì–´ì˜ default)
- ì¦‰, `enabled`ëŠ” `notification.*`ë¡œ fallback ë˜ì§€ ì•Šìœ¼ë©°, ì‹¤í–‰ ì—¬ë¶€ ê²°ì •ê³¼ ì¸í”„ë¼ íŒŒë¼ë¯¸í„°ëŠ” ë³„ê°œ ë ˆì´ì–´

âš ï¸ í‘œí˜„Â·ë‹¨ì–´Â·ìˆœì„œ ë³€ê²½ ê¸ˆì§€

### ê¸°ë³¸ê°’(Default)ì˜ ì •ë³¸ ì •ì˜

**ê¸°ë³¸ê°’(Default)ì´ë€ ì½”ë“œ ìƒìˆ˜ê°€ ì•„ë‹ˆë¼ Default Policyì´ë‹¤.**
**ëª¨ë“  ìë™í™” ê¸°ëŠ¥ì€ ê¸°ë³¸ ì •ì±…(Default Policy)ì„ ê°€ì§€ë©°,**
**ì´ ê¸°ë³¸ ì •ì±…ì€ í…Œë„ŒíŠ¸ ìƒì„± ì‹œ ì„¤ì •ê°’ìœ¼ë¡œ ì €ì¥ëœë‹¤.**
**ì½”ë“œì— í•˜ë“œì½”ë”©ëœ ê¸°ë³¸ ì„ê³„ê°’ì´ë‚˜ ì¡°ê±´ì€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤.**

**ê¸ˆì§€ íŒ¨í„´:**
- âŒ "ê°’ì´ ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ ì‚¬ìš©"
- âŒ "undefinedë©´ 3ìœ¼ë¡œ ì²˜ë¦¬"
- âŒ ì½”ë“œ ë‚´ë¶€ ìƒìˆ˜ ê¸°ë°˜ ì¡°ê±´

**ì •ë³¸ íŒ¨í„´:**
- âœ… ì„¤ì •ì´ ì¡´ì¬ â†’ ì‚¬ìš©
- âœ… ì„¤ì •ì´ ì—†ìŒ â†’ ì‹¤í–‰í•˜ì§€ ì•ŠìŒ (Fail Closed)

### ìë™í™”ì˜ ì •ë³¸ êµ¬ì¡°

ìë™í™”ëŠ” ë°˜ë“œì‹œ ì•„ë˜ 3ìš”ì†Œ ì¡°í•©ìœ¼ë¡œë§Œ ì„¤ëª…í•œë‹¤:

1. **Trigger**: ìƒí™© ì‹ í˜¸ ë˜ëŠ” ì´ë²¤íŠ¸
2. **Policy**: ì‚¬ìš©ì ì„¤ì •ê°’ (ON/OFF, ì„ê³„ê°’, ìŠ¹ì¸ ë ˆë²¨)
3. **Executor**: Server / Edge Function (ì •ì±… í•´ì„ + ì‹¤í–‰)

âŒ í”„ë¡ íŠ¸ì—”ë“œëŠ” íŒë‹¨Â·ì‹¤í–‰ ì£¼ì²´ê°€ ì•„ë‹ˆë‹¤.

---

## âœ… ì„¤ì • ì €ì¥ SSOT (Single Source of Truth)

**âš ï¸ ëª¨ë“  ìë™í™” ì„¤ì •ì€ ì•„ë˜ ê·œê²©ì„ ì¤€ìˆ˜í•©ë‹ˆë‹¤.**

### ì €ì¥ì†Œ ë° ê²½ë¡œ ê·œê²©
- **ì €ì¥ì†Œ**: `tenant_settings` KV êµ¬ì¡° (key='config' rowì˜ value JSONB)
  - `tenant_settings` í…Œì´ë¸”ì€ (tenant_id, key, value JSONB) KV êµ¬ì¡°ì…ë‹ˆë‹¤.
  - âš ï¸ ì¤‘ìš”: `config`ëŠ” ì»¬ëŸ¼ì´ ì•„ë‹ˆë¼ key='config'ì¸ rowì˜ value(JSONB)ì…ë‹ˆë‹¤. `tenant_settings.auto_notification.*` ê°™ì€ top-level ì»¬ëŸ¼ í‘œê¸° ê¸ˆì§€
- **ìë™í™” ì •ì±… ê²½ë¡œ**: `auto_notification.<event_type>.(enabled|channel|template_key|throttle|...)`
- **ì½”ë“œì—ì„œ ì„¤ì • ì½ê¸°**:
  - **ì„œë²„/Edge Function**: `getTenantSettingByPath(supabase, tenantId, path, legacyPath?)` í˜•ì‹ ì‚¬ìš©
    - ì˜ˆ: `await getTenantSettingByPath(supabase, tenantId, "auto_notification.overdue_outstanding_over_limit.enabled")`
    - ì‹œê·¸ë‹ˆì²˜: `(supabase: SupabaseClient, tenantId: string, path: string, legacyPath?: string) => Promise<T | null>`
    - ë°˜í™˜ íƒ€ì…: `T | null` (Policyê°€ ì—†ìœ¼ë©´ `null`, ìˆìœ¼ë©´ ì§ì ‘ ê°’ `T` ë°˜í™˜, `.value` ì ‘ê·¼ ë¶ˆí•„ìš”)
    - **í”„ë¡ íŠ¸ì—”ë“œ Hook `useTenantSettingByPath`**: `UseQueryResult<unknown, Error>` ë°˜í™˜ (React Queryì˜ `useQuery` ë°˜í™˜ ê°ì²´)
      - ì‚¬ìš© ì˜ˆì‹œ: `const { data: enabledValue } = useTenantSettingByPath("auto_notification.overdue.enabled");`
      - `data` ì†ì„±: `T | null` (Policyê°€ ì—†ìœ¼ë©´ `null`, ìˆìœ¼ë©´ ì§ì ‘ ê°’ `T`, `.value` ì ‘ê·¼ ë¶ˆí•„ìš”)
      - ì½”ë“œ ìœ„ì¹˜: `packages/hooks/use-config/src/useConfig.ts`
    - ì½”ë“œ ìœ„ì¹˜: `infra/supabase/functions/_shared/policy-utils.ts`
    - âš ï¸ **ìë™ ê²€ì¦ (êµ¬í˜„ ìƒíƒœ)**: `getTenantSettingByPath()` í•¨ìˆ˜ëŠ” `auto_notification.<event_type>.*` í˜•ì‹ì˜ ê²½ë¡œë¥¼ ë°›ì„ ë•Œ ìë™ìœ¼ë¡œ event_typeì„ ì¶”ì¶œí•˜ì—¬ ì¹´íƒˆë¡œê·¸ì— ë“±ë¡ëœ ê°’ì¸ì§€ ê²€ì¦í•©ë‹ˆë‹¤ (Fail-Closed, êµ¬í˜„ í™•ì¸: `infra/supabase/functions/_shared/policy-utils.ts:82`ì—ì„œ `assertAutomationEventType` í˜¸ì¶œ).
  - **í”„ë¡ íŠ¸ì—”ë“œ**: í”„ë¡ íŠ¸ì—”ë“œ ë˜í¼ í•¨ìˆ˜ ì‚¬ìš© (êµ¬í˜„ í•„ìš” ì‹œ `packages/hooks/use-config` ë˜ëŠ” ìœ ì‚¬ íŒ¨í‚¤ì§€ì—ì„œ ì œê³µ)
    - âš ï¸ í”„ë¡ íŠ¸ì—”ë“œì—ì„œëŠ” ì§ì ‘ `getTenantSettingByPath`ë¥¼ í˜¸ì¶œí•˜ì§€ ì•Šìœ¼ë©°, React Hook ë˜ëŠ” API í´ë¼ì´ì–¸íŠ¸ë¥¼ í†µí•´ ì ‘ê·¼
  - ë‚´ë¶€ ë™ì‘: 1) tenant_settingsì—ì„œ tenant_id + key='config' rowì˜ value(JSONB) íšë“, 2) value(JSONB)ì—ì„œ ê²½ë¡œ ì¶”ì¶œ

### âœ… ê¸ˆì§€ ì‚¬í•­
- âŒ `tenant_settings.auto_notification.*` ì²˜ëŸ¼ **config ì—†ì´ top-level ì»¬ëŸ¼ì²˜ëŸ¼ ë³´ì´ëŠ” í‘œê¸° ê¸ˆì§€**
- âŒ v1/v2 í‚¤ë¥¼ ì´ì¤‘ ì €ì¥ ê¸ˆì§€ (legacy v1ì€ alias-only, ì €ì¥ ê²½ë¡œë¡œ ì‚¬ìš© ê¸ˆì§€)
- âŒ ì±„ë„ ì½”ë“œ 'kakao' ì €ì¥ ê¸ˆì§€ (SSOT-3: ì €ì¥/ì‹¤í–‰ìš©ì€ 'sms' | 'kakao_at'ë§Œ í—ˆìš©)

### ì±…ì„ ê²½ê³„ (Responsibility Boundary)

**1) `tenant_settings` KV: key='config' rowì˜ value(JSONB) ë‚´ë¶€ ê²½ë¡œ `notification.*` (ë©”ì‹œì§€/ì•Œë¦¼ ì¸í”„ë¼ ê¸°ë³¸ ì •ì±…)**
- âš ï¸ ì¤‘ìš”: `notification.*` ê²½ë¡œëŠ” `tenant_settings` í…Œì´ë¸”ì˜ key='config' rowì˜ value(JSONB) ë‚´ë¶€ ê²½ë¡œì…ë‹ˆë‹¤. ì €ì¥ ìœ„ì¹˜ëŠ” tenant_settings(key='config').value(JSONB)ì…ë‹ˆë‹¤.
- ê¸°ë³¸ ì±„ë„, ë°œì†¡ ì œí•œ, fallback, provider ë“± "ì¸í”„ë¼ ë ˆë²¨" ì •ì±…
- ìë™í™”ë³„ ì˜¤ë²„ë ˆì´ê°€ ì—†ì„ ë•Œ ì‚¬ìš©ë˜ëŠ” ê¸°ë³¸ê°’
- âš ï¸ **Fail Closed ì›ì¹™ ì ìš© ë²”ìœ„ ëª…í™•í™”:**
  - **ìë™í™” ì‹¤í–‰ ì—¬ë¶€**: `auto_notification.<event_type>.enabled` ì—†ìœ¼ë©´ ì‹¤í–‰ ì•ˆ í•¨ (FAIL CLOSED)
  - **ì‹¤í–‰ì´ ì´ë¯¸ ê²°ì •ëœ í›„ ì±„ë„/ì¸í”„ë¼ íŒŒë¼ë¯¸í„°**: `notification.*`ì„ ê¸°ë³¸ìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥ (ì¸í”„ë¼ ë ˆì´ì–´ì˜ default)
  - ì¦‰, `enabled`ëŠ” `notification.*`ë¡œ fallback ë˜ì§€ ì•Šìœ¼ë©°, ì‹¤í–‰ ì—¬ë¶€ ê²°ì •ê³¼ ì¸í”„ë¼ íŒŒë¼ë¯¸í„°ëŠ” ë³„ê°œ ë ˆì´ì–´

**2) `tenant_settings` KV: key='config' rowì˜ value(JSONB) ë‚´ë¶€ ê²½ë¡œ `auto_notification.<event_type>.*` (ìë™í™”ë³„ ì •ì±… ì˜¤ë²„ë ˆì´)**
- ìë™í™” enable/channel/template_key ë“± "event_type ë‹¨ìœ„ ì •ì±…"
- ê° ìë™í™” ì‹œë‚˜ë¦¬ì˜¤ë³„ ì„¸ë¶€ ì„¤ì •

**3) `tenant_features['ai'].enabled` (+ PLATFORM_AI_ENABLED)**
- AI ì‹¤í–‰/ë¹„ìš©ì´ ê±¸ë¦¬ëŠ” ê¸°ëŠ¥ì˜ ìµœì¢… ìŠ¤ìœ„ì¹˜ (Fail-Closed)
- í”„ë¡ íŠ¸ëŠ” ìˆ¨ê¹€ì´ ì•„ë‹ˆë¼ "í‘œì‹œí•˜ë˜ ì‹¤í–‰ì„ ë§‰ëŠ” ë°©ì‹"ì´ ì›ì¹™

---

## âš ï¸ ë¬¸ì„œ ì—­í•  ì¬ì •ì˜ (Critical)

**ì´ ë¬¸ì„œëŠ” "í”„ë¡ íŠ¸ ìë™í™”"ê°€ ì•„ë‹™ë‹ˆë‹¤.**

í”„ë¡ íŠ¸ì—”ë“œëŠ” ë‹¤ìŒ ì—­í• ë§Œ ìˆ˜í–‰í•©ë‹ˆë‹¤:
- âœ… **ìƒí™© ì‹ í˜¸ ìˆ˜ì§‘** (Context Signal Collection)
- âœ… **UI ì¡°ì •** (Priority ê°€ì¤‘ì¹˜, ë°°ë„ˆ í‘œì‹œ)
- âœ… **ìŠ¹ì¸ ìš”ì²­** (Approval Request)
- âŒ **íŒë‹¨** (Judgment) - ì„œë²„/Edge Function ì „ë‹´
- âŒ **ì‹¤í–‰** (Execution) - ì„œë²„/Edge Function ì „ë‹´

**ì •ë³¸ ê³„ì¸µ êµ¬ì¡°:**
```
[AI / Rule Engine / Edge Functions]
        â†“ (íŒë‹¨ + ì‹¤í–‰)
[TaskCard / AI_Briefing ìƒì„±]
        â†“ (ë°ì´í„° ì œê³µ)
[UI = ìŠ¹ì¸Â·ê±°ë¶€Â·ê´€ì°° ë ˆì´ì–´]
```

---

## ğŸ“‹ ê³µí†µ ì‹¤í–‰ ì£¼ì²´ ì„ ì–¸ (ëª¨ë“  ë¬¸ì„œ ê³µí†µ)

**âš ï¸ Architecture v3.3 ì •ë³¸ ê·œì¹™ (ë¶ˆë³€):**

ì´ ì„ ì–¸ì€ ëª¨ë“  ë¬¸ì„œ(ì•„í‚¤í…ì²˜, ê¸°ìˆ ë¬¸ì„œ, UI/UX ë¬¸ì„œ, í†µê³„/AI ë¬¸ì„œ)ì—ì„œ ê³µí†µìœ¼ë¡œ ì ìš©ë©ë‹ˆë‹¤.

### ì‹¤í–‰ ì£¼ì²´ ë¶„ë¦¬ (ë¶ˆë³€)

| ë ˆì´ì–´ | ì—­í•  | ê¸ˆì§€ ì‚¬í•­ |
|--------|------|----------|
| **í”„ë¡ íŠ¸ì—”ë“œ** | ìƒí™© ì‹ í˜¸ ìˆ˜ì§‘, UI ì¡°ì •, ìŠ¹ì¸ ìš”ì²­ | âŒ ì‹¤í–‰, âŒ íŒë‹¨, âŒ ê¶Œí•œ ê²€ì¦ |
| **ì„œë²„/Edge Function** | íŒë‹¨, ì‹¤í–‰, Role ê²€ì¦, ë¡œê·¸ ê¸°ë¡ | âŒ UI ì§ì ‘ ì¡°ì‘ |
| **AI/Rule Engine** | ë¶„ì„, ì¶”ì²œ ìƒì„±, íŒ¨í„´ ê°ì§€ | âŒ ì§ì ‘ ì‹¤í–‰ |

### ìš©ì–´ í†µì¼ ê·œì¹™ (í•„ìˆ˜)

| ê¸ˆì§€ ìš©ì–´ | ì •ë³¸ ìš©ì–´ | ì„¤ëª… |
|----------|----------|------|
| ~~AI Suggestion~~ (v2.x ì‚­ì œ) | TaskCard (task_type: 'ai_suggested', entity_type='student') | ì •ë³¸ (StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­) |
| ìë™ ì‹¤í–‰ | ì„œë²„ê°€ ì •ì±…ì— ë”°ë¼ ì‹¤í–‰ | í”„ë¡ íŠ¸ì—”ë“œëŠ” ì‹¤í–‰í•˜ì§€ ì•ŠìŒ |
| AIê°€ ì²˜ë¦¬ | ì„œë²„ê°€ AI ì¶”ì²œ ìƒì„± | AIëŠ” ê²°ì •í•˜ì§€ ì•ŠìŒ |
| í”„ë¡ íŠ¸ ìë™í™” | í”„ë¡ íŠ¸ ìƒí™© ì‹ í˜¸ í‘œì‹œ | í”„ë¡ íŠ¸ì—”ë“œëŠ” í‘œì‹œë§Œ |
| ìë™ íŒë‹¨ | ì •ì±… í•´ì„ ê²°ê³¼ | íŒë‹¨ì€ ì„œë²„/Edge Function |
| ê¸°ë³¸ê°’ | Default Policy | ì½”ë“œ ìƒìˆ˜ê°€ ì•„ë‹Œ ì„¤ì •ê°’ |
| í”„ë¡ íŠ¸ ìŠ¹ì¸ | ìŠ¹ì¸ ìš”ì²­ | í”„ë¡ íŠ¸ì—”ë“œëŠ” ìš”ì²­ë§Œ ë³´ëƒ„ |
| ìë™ í™”ë©´ ì „í™˜ | ì¶”ì²œ ë°°ë„ˆ í‘œì‹œ | ì‚¬ìš©ì í´ë¦­ í•„ìš” |
| AIê°€ ì‹¤í–‰í•œë‹¤ | ì„œë²„ê°€ AI ì¶”ì²œ ìƒì„± â†’ Edge Functionì´ ì •ì±… í•´ì„ í›„ ì‹¤í–‰ | ì£¼ì–´ ëª…í™•í™” |

### TaskCard (task_type: 'ai_suggested', entity_type='student') ì²˜ë¦¬ íë¦„ (ì •ë³¸)

```
1. Trigger: ìƒí™© ì‹ í˜¸ ë˜ëŠ” ì´ë²¤íŠ¸ ë°œìƒ
2. Policy: Edge Functionì´ ì‚¬ìš©ì ì„¤ì •ê°’ ì¡°íšŒ (tenant_features, tenant_settings)
3. AI/Rule Engine â†’ ì¶”ì²œ ìƒì„± (ì„œë²„, ì‹¤í–‰ ì•„ë‹˜)
4. Edge Function â†’ ì •ì±… í•´ì„ â†’ TaskCard ìƒì„± (task_type: 'ai_suggested', entity_type='student')
5. í”„ë¡ íŠ¸ì—”ë“œ â†’ ìŠ¹ì¸ ìš”ì²­
   - Teacher: `apiClient.invokeFunction('execute-student-task', { action: 'request-approval', task_id: id })` (ìš”ì²­ë§Œ ê¸°ë¡, ì •ë³¸)
   - Admin: `apiClient.invokeFunction('execute-student-task', { action: 'approve-and-execute', task_id: id })` (ì‹¤í–‰ íŠ¸ë¦¬ê±°, SSOT, ì •ë³¸)
6. Edge Function â†’ ì •ì±… ì¬í™•ì¸ â†’ Role ê²€ì¦ + ì‹¤í–‰ + ë¡œê·¸ ê¸°ë¡
```

**âš ï¸ ì¤‘ìš”:**
- ëª¨ë“  ë‹¨ê³„ì—ì„œ Policy ì¡°íšŒ ë° í•´ì„ì´ í•„ìˆ˜
- ì„¤ì •ê°’ì´ ì—†ê±°ë‚˜ enabled=falseì´ë©´ ìë™í™”ëŠ” ì‹¤í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤(Fail-Closed).
- AIëŠ” ê²°ì •Â·ì‹¤í–‰ ì£¼ì²´ê°€ ì•„ë‹˜

**âš ï¸ ì¤‘ìš”:**
- í”„ë¡ íŠ¸ì—”ë“œëŠ” ì ˆëŒ€ ì‹¤í–‰í•˜ì§€ ì•ŠëŠ”ë‹¤
- ëª¨ë“  ìë™í™” ì‹¤í–‰ì€ ì„œë²„ ì‚¬ì´ë“œ(Edge Function/DB Trigger/Scheduler)ì—ì„œë§Œ ìˆ˜í–‰ëœë‹¤
- TaskCard (task_type: 'ai_suggested', entity_type='student')ë¡œë§Œ í‘œí˜„ëœë‹¤ (StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)

---

## âš ï¸ Policy Key v2 (Purpose-Based) â€” SSOT (ì •ë³¸)

âš ï¸ ì¤‘ìš”: ì •ë³¸ì€ Policy Key v2 6ê°œë§Œ ì‚¬ìš©, legacy_policy_keyëŠ” UI í•„í„°/ê²€ìƒ‰ìš© alias

ë³¸ ì‹œìŠ¤í…œì˜ ìë™í™”ëŠ” Policy Key(v2) 6ê°œë¥¼ ì •ë³¸(SSOT)ìœ¼ë¡œ ì‚¬ìš©í•œë‹¤.
- ì •ì±… ì €ì¥/ê¶Œí•œ/ë¼ìš°íŒ…/ì„¤ì • UI ê·¸ë£¹í•‘ì€ policy_key_v2ë§Œ ì‚¬ìš©í•œë‹¤.
- ê¸°ì¡´ 5ê°œ Policy KeyëŠ” legacy_policy_key(alias)ë¡œë§Œ ìœ ì§€í•œë‹¤. (ëŸ°íƒ€ì„ SSOT ì•„ë‹˜)
- ì‹ ê·œ ìë™í™” ì¶”ê°€ëŠ” Policy Keyë¥¼ ëŠ˜ë¦¬ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ event_type(ì‹œë‚˜ë¦¬ì˜¤) ì¹´íƒˆë¡œê·¸ì— ì¶”ê°€ë¡œë§Œ ìˆ˜í–‰í•œë‹¤. (ì¹´íƒˆë¡œê·¸ì— ì¶”ê°€ = ì½”ë“œ ìƒìˆ˜ `AUTOMATION_EVENT_CATALOG`ì— event_type ì¶”ê°€, êµ¬í˜„ ìœ„ì¹˜: `packages/core/core-automation/src/automation-event-catalog.ts`, `infra/supabase/functions/_shared/automation-event-catalog.ts`)
- ì„¤ì •ê°’ì´ ì—†ê±°ë‚˜ enabled=falseì´ë©´ ìë™í™”ëŠ” ì‹¤í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤(Fail-Closed).

### Policy Key v2 (6)
1) financial_health: ì¬ë¬´/í˜„ê¸ˆíë¦„/ìˆ˜ë‚©/ë§¤ì¶œ KPI
2) capacity_optimization: ì •ì›/ì‹œê°„í‘œ/ë°˜ ìš´ì˜ ìµœì í™”
3) customer_retention: ì¶œê²° ìœ ì§€/ì´íƒˆ ì˜ˆë°©/ë¦¬ìŠ¤í¬ ì¼€ì–´
4) growth_marketing: ì‹ ê·œ/ì„±ì¥/ì „í™˜/ì§€ì—­ ê²½ìŸ(ë²¤ì¹˜ë§ˆí‚¹)
5) safety_compliance: ì•ˆì „/ê³µì§€/ë™ì˜/ë¯¼ê°ì •ë³´/ë¶„ìŸ ë¦¬ìŠ¤í¬
6) workforce_ops: ê°•ì‚¬/ì§ì› ìš´ì˜(ì—…ë¬´ëŸ‰/ê²°ê·¼/ëŒ€ì²´)

### Legacy Policy Key(v1, ê¸°ì¡´ 5ê°œ) â€” Alias Only
- attendance_anomaly / payment_overdue / ai_suggestion / report_generation / dashboard_priority(ë¯¸ì‚¬ìš©)
- legacy_policy_keyëŠ” í‘œì‹œ/ê²€ìƒ‰/í˜¸í™˜ì„ ìœ„í•œ ë©”íƒ€ë°ì´í„°ì´ë©°, ì •ì±… ì €ì¥ ê²½ë¡œì˜ SSOTê°€ ì•„ë‹ˆë‹¤.
- ë™ì¼ event_typeì— ëŒ€í•´ v2 ì •ì±…ê³¼ v1 ì •ì±…ì„ ì´ì¤‘ ì €ì¥í•˜ì§€ ì•ŠëŠ”ë‹¤(ì„¤ì • ì¤‘ë³µ ê¸ˆì§€).

### í™•ì¥ ê·œì¹™
- ìƒìœ„ Policy Key(v2 6ê°œ)ëŠ” ê³ ì •(SSOT).
- ì‹ ê·œ ìë™í™”ëŠ” event_type ì¹´íƒˆë¡œê·¸ì— ì¶”ê°€í•˜ê³ , policy_key_v2 / legacy_policy_key / level / trigger / executor / policy_pathë¥¼ ì •ì˜í•œë‹¤.
- ë¬¸ì„œ/ì½”ë“œì—ì„œ "í‘œì— ì—†ëŠ” ìë™í™” ì‹ ê·œ ì¶”ê°€ ë¶ˆê°€"ëŠ” "ì¹´íƒˆë¡œê·¸ì— ì—†ëŠ” event_typeì€ ì‹¤í–‰/ì¶”ê°€ ë¶ˆê°€"ë¡œ í•´ì„í•œë‹¤.

### ì½”ë“œ SSOT ìœ„ì¹˜
- âš ï¸ ì¤‘ìš”: ì •ë³¸(SSOT)ì€ ì½”ë“œ ìƒìˆ˜ `AUTOMATION_EVENT_CATALOG`, ë¬¸ì„œì˜ í‘œëŠ” ê·¸ ì¶œë ¥ë¬¼
- event_type ì¹´íƒˆë¡œê·¸ ì •ë³¸(SSOT)ì€ ì½”ë“œ ìƒìˆ˜ `AUTOMATION_EVENT_CATALOG`ì´ë©°, ë¬¸ì„œì˜ í‘œëŠ” ê·¸ ì¹´íƒˆë¡œê·¸ë¥¼ ë°˜ì˜í•œ ì¶œë ¥ë¬¼ì´ë‹¤.
  - **êµ¬í˜„ ìƒíƒœ**: âœ… `AUTOMATION_EVENT_CATALOG` ì½”ë“œ ìƒìˆ˜ êµ¬í˜„ ì™„ë£Œ (2024ë…„ êµ¬í˜„, íŒŒì¼ ê²½ë¡œ: `packages/core/core-automation/src/automation-event-catalog.ts`, `infra/supabase/functions/_shared/automation-event-catalog.ts`)
  - **ì½”ë“œ ìœ„ì¹˜**: `packages/core/core-automation/src/automation-event-catalog.ts`, `infra/supabase/functions/_shared/automation-event-catalog.ts`
- legacy_policy_keyëŠ” UI í•„í„°/ê²€ìƒ‰/í˜¸í™˜ í‘œê¸°ìš©ì´ë©°, ëŸ°íƒ€ì„ ì €ì¥/ì‹¤í–‰/ê¶Œí•œ ë¶„ê¸°ì—ëŠ” ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.
- ì„¤ì • ì €ì¥ì€ `tenant_settings` KV êµ¬ì¡°ì—ì„œ key='config' rowì˜ value(JSONB) ê²½ë¡œ ê¸°ë°˜ì´ë©°, ì‹ ê·œ í•­ëª©ì€ `auto_notification.<event_type>.<field>` í˜•ì‹ìœ¼ë¡œ ì¶”ê°€í•œë‹¤.
  - **ì„œë²„/Edge Function ì½”ë“œ ì˜ˆì‹œ**: `await getTenantSettingByPath(supabase, tenantId, "auto_notification.overdue_outstanding_over_limit.enabled")`
  - ë‚´ë¶€ ë™ì‘: 1) tenant_settingsì—ì„œ key='config' rowì˜ value(JSONB) íšë“, 2) value(JSONB)ì—ì„œ ê²½ë¡œ ì¶”ì¶œ

### í”„ë¡ íŠ¸ì—”ë“œì˜ ì—­í•  (ê³ ì •)
- í”„ë¡ íŠ¸ëŠ” ì‹¤í–‰/íŒë‹¨ ì£¼ì²´ê°€ ì•„ë‹ˆê³ , í‘œì‹œ/ìŠ¹ì¸ìš”ì²­/ì„¤ì • UIë§Œ ë‹´ë‹¹.
- í”„ë¡ íŠ¸ëŠ” event_type â†’ policy_key_v2 ë§¤í•‘ì„ "ì¹´íƒˆë¡œê·¸"ë¡œ ë°›ì•„ ê·¸ë£¹í™”í•œë‹¤(í•˜ë“œì½”ë”© ê¸ˆì§€).
- ë ˆê±°ì‹œ í‚¤ëŠ” í™”ë©´ì—ì„œ ì„ íƒì  í•„í„°ë¡œë§Œ ì‚¬ìš©.

---

## ê¸€ë¡œë²Œ í—¤ë” AI í† ê¸€ â€” UX/ì •ì±… SSOT (ë¶ˆë³€)

### 1) ëª©ì  (Purpose)

AI ê¸°ëŠ¥ì€ ë¹„ìš©/ë¦¬ìŠ¤í¬/ìš´ì˜ ì •ì±…ì— ë”°ë¼ í…Œë„ŒíŠ¸ ë‹¨ìœ„ë¡œ ì¦‰ì‹œ On/Off ê°€ëŠ¥í•´ì•¼ í•œë‹¤.
ë‹¨, UIë¥¼ ìˆ¨ê¸°ê±°ë‚˜ í˜ì´ì§€ êµ¬ì¡°ë¥¼ ë³€ê²½í•˜ëŠ” ë°©ì‹ì´ ì•„ë‹ˆë¼,
"ì‹¤í–‰(LLM í˜¸ì¶œ)ë§Œ ì•ˆì „í•˜ê²Œ ì°¨ë‹¨"í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì¼ê´€ë˜ê²Œ ì œì–´í•œë‹¤.

---

### 2) SSOT ìŠ¤ìœ„ì¹˜ ì •ì˜ (Single Source of Truth)

- **í”Œë«í¼(ì‹œìŠ¤í…œ) ìŠ¤ìœ„ì¹˜**: `PLATFORM_AI_ENABLED` (env-registry/serverì—ì„œë§Œ ì½ìŒ)
- **í…Œë„ŒíŠ¸ ìŠ¤ìœ„ì¹˜(SSOT)**: `tenant_features(feature_key='ai').enabled`
- **ìµœì¢… ìœ íš¨ê°’**:
  - `effective_ai_enabled = PLATFORM_AI_ENABLED && tenant_features['ai'].enabled`

---

### 3) ê¸€ë¡œë²Œ í—¤ë” í† ê¸€ì˜ ì±…ì„ (Header Toggle Contract)

- ê¸€ë¡œë²Œ í—¤ë”ì˜ AI í† ê¸€ì€ "í…Œë„ŒíŠ¸ ìŠ¤ìœ„ì¹˜(SSOT)"ë§Œ ë³€ê²½í•œë‹¤.
  - í† ê¸€ ON/OFF â†’ `tenant_features('ai').enabled` ì—…ë°ì´íŠ¸
- í”Œë«í¼ì´ ê°•ì œ ì°¨ë‹¨(`PLATFORM_AI_ENABLED=false`)ì¸ ê²½ìš°:
  - í† ê¸€ì€ ë¹„í™œì„±(disabled) ìƒíƒœì´ë©°, UIì— "ì‹œìŠ¤í…œ ì •ì±…ìœ¼ë¡œ ë¹„í™œì„±í™”ë¨"ì„ ëª…ì‹œí•œë‹¤.
- í† ê¸€ ë³€ê²½ ê¶Œí•œ:
  - ê¸°ë³¸: `owner/admin`ë§Œ í—ˆìš© (ì •ì±…ì— ë”°ë¼ ì¡°ì • ê°€ëŠ¥)
- í† ê¸€ ë³€ê²½ì€ ë°˜ë“œì‹œ ê°ì‚¬ ë¡œê·¸(audit) ëŒ€ìƒì´ë‹¤.
  - (who/when/tenant_id/previous/next/reason(optional)) ê¸°ë¡

---

### 4) "ìˆ¨ê¹€ ê¸ˆì§€" ê·œì¹™ (Critical - UI Consistency)

- `effective_ai_enabled=false`ì¼ ë•Œë„:
  - âŒ AI ê´€ë ¨ í˜ì´ì§€/ì„¹ì…˜/ë²„íŠ¼/ë©”ë‰´ë¥¼ ìˆ¨ê¸°ì§€ ì•ŠëŠ”ë‹¤ (Hide ê¸ˆì§€)
  - âœ… UIëŠ” ë…¸ì¶œ ìœ ì§€
  - âœ… ë‹¨, AI ì‹¤í–‰ í–‰ìœ„(LLM í˜¸ì¶œ/AI ìƒì„±/ì¬ìƒì„±/ê°±ì‹ )ë§Œ í†µì¼ëœ ë°©ì‹ìœ¼ë¡œ ì°¨ë‹¨í•œë‹¤

---

### 5) ì‹¤í–‰ ì°¨ë‹¨ ê·œì¹™ (Server/Edge Function MUST)

AIëŠ” í”„ë¡ íŠ¸ê°€ ì‹¤í–‰ ì£¼ì²´ê°€ ì•„ë‹ˆë‹¤. ëª¨ë“  AI í˜¸ì¶œì€ ì„œë²„/Edge Functionì—ì„œë§Œ ìˆ˜í–‰í•œë‹¤.

- ëª¨ë“  AI í˜¸ì¶œ Edge Function/ì„œë²„ ì—”ë“œí¬ì¸íŠ¸ëŠ” "ëª¨ë¸ í˜¸ì¶œ ì§ì „" ë°˜ë“œì‹œ
  `effective_ai_enabled`ë¥¼ í™•ì¸í•´ì•¼ í•œë‹¤. (í•„ìˆ˜ ê°€ë“œ)
- OFFì¼ ë•Œ ë™ì‘:
  - ëª¨ë¸ í˜¸ì¶œ ê¸ˆì§€ (0 tokens)
  - ê²°ê³¼ ì‹ ê·œ ìƒì„±/ì¬ìƒì„±/ê°±ì‹  ê¸ˆì§€:
    - `ai_insights` ì‹ ê·œ insert/update ê¸ˆì§€ (ì½ê¸° ì¡°íšŒëŠ” í—ˆìš©)
    - TaskCard ì‹ ê·œ ìƒì„± ì¤‘ `task_type='ai_suggested'` ê¸ˆì§€
  - `ai_decision_logs`(ë˜ëŠ” ë™ë“± ë¡œê·¸)ì— `skipped_by_flag` ì‚¬ìœ ë¡œ ê¸°ë¡

---

### 6) UI ë™ì‘ ê·œì¹™ (Front-End MUST)

- AI ì‹¤í–‰ ë²„íŠ¼/ì•¡ì…˜ì€ ë…¸ì¶œ ìœ ì§€í•˜ë˜, OFFì¼ ë•ŒëŠ” disabled ì²˜ë¦¬í•œë‹¤.
- disabled ìƒíƒœì—ì„œëŠ” ì‚¬ìš©ìì—ê²Œ ì¦‰ì‹œ ì´ìœ ë¥¼ ì œê³µí•œë‹¤:
  - "AI ê¸°ëŠ¥ì´ êº¼ì ¸ ìˆì–´ ì‹¤í–‰í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ìƒë‹¨ AI í† ê¸€ì—ì„œ ì¼œì„¸ìš”."
- ê¸°ì¡´ì— ì €ì¥ëœ AI ê²°ê³¼(`ai_insights`)ëŠ” í‘œì‹œ(ì½ê¸° ì „ìš©) ê°€ëŠ¥í•˜ë‹¤.
- ê²°ê³¼ê°€ ì—†ëŠ” ê²½ìš°(ë¯¸ìƒì„± ìƒíƒœ)ì—ëŠ”:
  - "AI ê¸°ëŠ¥ì´ êº¼ì ¸ ìˆì–´ ì„œë²„ê°€ ìƒì„±í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤" ì•ˆë‚´ë¥¼ í‘œì‹œí•œë‹¤.
- ìµœì¢… ì•ˆì „ì¥ì¹˜ëŠ” UIê°€ ì•„ë‹ˆë¼ ì„œë²„/Edge Function ê°€ë“œì´ë‹¤.

---

### 7) ìºì‹œ/ë™ê¸°í™” (Cache Invalidation)

- í† ê¸€ ë³€ê²½ ì‹œ ì¦‰ì‹œ ìºì‹œ purge:
  - `tenant::<id>::features`
- í”„ë¡ íŠ¸ëŠ” ìƒíƒœë¥¼ ì£¼ê¸°ì ìœ¼ë¡œ ì¬ì¡°íšŒí•˜ê±°ë‚˜, í† ê¸€ ì„±ê³µ ì‹œ ì¦‰ì‹œ stateë¥¼ ê°±ì‹ í•œë‹¤.
- ìºì‹œê°€ ì§€ì—°ë˜ë”ë¼ë„ ì„œë²„/Edge Function ê°€ë“œê°€ ìµœì¢… ì°¨ë‹¨ì„ ë³´ì¥í•œë‹¤.

---

### AI ì˜¨ì˜¤í”„ ì œì–´ (ê¸€ë¡œë²Œ í—¤ë” í† ê¸€) - ë ˆê±°ì‹œ ì„¹ì…˜

**âš ï¸ ì¤‘ìš”: ì´ ì„¹ì…˜ì€ ë ˆê±°ì‹œì…ë‹ˆë‹¤. SSOTëŠ” ìœ„ "ê¸€ë¡œë²Œ í—¤ë” AI í† ê¸€ â€” UX/ì •ì±… SSOT" ì„¹ì…˜ì„ ì°¸ì¡°í•˜ì„¸ìš”.**

**êµ¬í˜„ ìœ„ì¹˜:**
- ê¸€ë¡œë²Œ í—¤ë”: `packages/ui-core/src/components/Header.tsx`
- ì„¤ì • ì €ì¥: `tenant_features(feature_key='ai').enabled` (SSOT, ìœ„ ì„¹ì…˜ ì°¸ì¡°)

**âš ï¸ SSOT í†µì¼:**
- ì •ë³¸: `tenant_features(feature_key='ai').enabled` (ìœ„ SSOT ì„¹ì…˜ ì°¸ì¡°)
- ë ˆê±°ì‹œ: `tenant_settings.ai.enabled`ëŠ” ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ

**ë™ì‘ ë°©ì‹:**

1. **í† ê¸€ ìœ„ì¹˜**: ê¸€ë¡œë²Œ í—¤ë” ìš°ì¸¡ ìƒë‹¨ (ì‚¬ìš©ì í”„ë¡œí•„/ì„¤ì • ë©”ë‰´ ê·¼ì²˜)
2. **í‘œì‹œ ë°©ì‹**: Toggle Switch ì»´í¬ë„ŒíŠ¸
3. **ì¦‰ì‹œ ë°˜ì˜**: í† ê¸€ ë³€ê²½ ì‹œ ì¦‰ì‹œ `tenant_features` ì—…ë°ì´íŠ¸ ë° Edge Functionì— ì „ë‹¬
4. **UI ìˆ¨ê¹€ ì—†ìŒ**: ì„¸ë¶€ í˜ì´ì§€ì˜ AI ê´€ë ¨ ê¸°ëŠ¥ì€ ìˆ¨ê¸°ì§€ ì•Šê³ , AI ê¸°ëŠ¥ë§Œ ë¹„í™œì„±í™”

**Edge Functionì—ì„œ AI í˜¸ì¶œ ì „ ì²´í¬ (SSOT ê¸°ì¤€):**

```typescript
// ëª¨ë“  Edge Functionì—ì„œ AI í˜¸ì¶œ ì „ ì²´í¬ (SSOT ê¸°ì¤€)
import { getPlatformAIEnabled } from '@env-registry/server';
import { getTenantFeature } from '@core-tenancy/features';

async function shouldUseAI(tenantId: string): Promise<boolean> {
  // í”Œë«í¼ ìŠ¤ìœ„ì¹˜ í™•ì¸
  const platformEnabled = getPlatformAIEnabled(); // env-registry/serverì—ì„œë§Œ ì½ìŒ
  if (!platformEnabled) return false;

  // í…Œë„ŒíŠ¸ ìŠ¤ìœ„ì¹˜ í™•ì¸ (SSOT)
  const aiFeature = await getTenantFeature(tenantId, 'ai');
  // âš ï¸ ì¤‘ìš”: ê¸°ë³¸ê°’ í•˜ë“œì½”ë”© ê¸ˆì§€
  // ì„¤ì •ì´ ì—†ìœ¼ë©´ ì‹¤í–‰í•˜ì§€ ì•ŠìŒ (Fail Closed)
  if (!aiFeature) {
    // Policyê°€ ì—†ìœ¼ë©´ ì‹¤í–‰ ì¤‘ì§€
    return false;
  }
  const tenantEnabled = aiFeature.enabled; // Policyì—ì„œ ì¡°íšŒí•œ ê°’ë§Œ ì‚¬ìš©

  // ìµœì¢… ìœ íš¨ê°’
  return platformEnabled && tenantEnabled;
}

// ì‚¬ìš© ì˜ˆì‹œ
async function generateStudentTaskCard(tenantId: string, studentId: string) {
  // TaskCard (task_type: 'ai_suggested', entity_type='student') ìƒì„± ì „ ì²´í¬
  if (await shouldUseAI(tenantId)) {
    // AI ê¸°ë°˜ ì œì•ˆ ìƒì„±
    const aiSuggestion = await callAIAPI(...);
    // TaskCard ìƒì„± (task_type: 'ai_suggested', entity_type='student')
  } else {
    // Rule Engine ê¸°ë°˜ ì œì•ˆë§Œ ìƒì„± (AI ì—†ì´)
    const ruleBasedSuggestion = await generateRuleBasedSuggestion(...);
    // TaskCard ìƒì„± (task_type: 'risk' ë“±, AI ì—†ìŒ)
  }
}
```

**AI ë¹„í™œì„±í™” ì‹œ ë™ì‘:**

â€» ì•„ë˜ ì˜ˆì‹œëŠ” Academy ì—…ì¢… ê¸°ì¤€ ì„¤ëª… ì˜ˆì‹œì´ë©°,
ì‹¤ì œ ìë™í™” ë¡œì§ì€ ì—…ì¢…ê³¼ ë¬´ê´€í•œ Core ì—”ì§„ì—ì„œ ë™ì¼í•˜ê²Œ ë™ì‘í•œë‹¤.

- âœ… **AI ë¸Œë¦¬í•‘ ì¹´ë“œ**: "AI ê¸°ëŠ¥ì´ ë¹„í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤" ë©”ì‹œì§€ í‘œì‹œ (ì¹´ë“œ ìì²´ëŠ” ìˆ¨ê¸°ì§€ ì•ŠìŒ)
- âœ… **TaskCard (task_type: 'ai_suggested', entity_type='student')**: ìƒì„±ë˜ì§€ ì•ŠìŒ (Edge Functionì—ì„œ ì²´í¬, StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)
- âœ… **ìƒë‹´ ìš”ì•½**: Rule Engine ê¸°ë°˜ ìš”ì•½ìœ¼ë¡œ í´ë°± (AI ì—†ì´ ì²˜ë¦¬)
- âœ… **ì¶œê²° ì´ìƒ ê°ì§€**: Rule Engine ê¸°ë°˜ ê°ì§€ë§Œ ìˆ˜í–‰ (AI ë¶„ì„ ì—†ìŒ)
- âœ… **ë©”ì‹œì§€ ì´ˆì•ˆ ìƒì„±**: Rule Engine ê¸°ë°˜ í…œí”Œë¦¿ë§Œ ì‚¬ìš© (AI ê°œì¸í™” ì—†ìŒ)

ì˜ˆ) Salon/Nail:
- ë°©ë¬¸ ê¸°ë¡ ì €ì¥ í›„ AI ìš”ì•½ ë¹„í™œì„±í™” ì‹œ â†’ ë‹¨ìˆœ ë¡œê·¸ ì €ì¥ë§Œ ìˆ˜í–‰

**âš ï¸ ì¤‘ìš” ê·œì¹™:**

- âŒ **ì„¸ë¶€ í˜ì´ì§€ ê¸°ëŠ¥ ìˆ¨ê¹€ ê¸ˆì§€**: AI ê´€ë ¨ í˜ì´ì§€/ë©”ë‰´ëŠ” ê·¸ëŒ€ë¡œ í‘œì‹œ
- âœ… **AI ê¸°ëŠ¥ë§Œ ë¹„í™œì„±í™”**: Edge Functionì—ì„œ AI í˜¸ì¶œ ì „ `effective_ai_enabled` ì²´í¬ (ìœ„ SSOT ì„¹ì…˜ ì°¸ì¡°)
- âœ… **ì¦‰ì‹œ ë°˜ì˜**: í† ê¸€ ë³€ê²½ ì‹œ ì¦‰ì‹œ ì„œë²„ì— ë°˜ì˜ (WebSocket ë˜ëŠ” ì¦‰ì‹œ API í˜¸ì¶œ)

**âš ï¸ ì°¸ê³ :**
- SSOT ìŠ¤ìœ„ì¹˜ ì •ì˜ ë° `effective_ai_enabled` ê³„ì‚° ë¡œì§ì€ ìœ„ "ê¸€ë¡œë²Œ í—¤ë” AI í† ê¸€ â€” UX/ì •ì±… SSOT" ì„¹ì…˜ì„ ì •ë³¸ìœ¼ë¡œ ë”°ë¦…ë‹ˆë‹¤.

â†’ ìƒì„¸ êµ¬í˜„ì€ ì „ì²´ ìœ ì•„ì´ë¬¸ì„œ 6-4 ì„¹ì…˜ ì°¸ì¡°

### ì •ì±… ê¸°ë°˜ ì‹¤í–‰ ë ˆë²¨ ë° ìŠ¹ì¸ ê¸°ì¤€í‘œ (ë¶ˆë³€)

**âš ï¸ Architecture v3.3 ì •ë³¸ ê·œì¹™: ëª¨ë“  ìë™í™” ì•¡ì…˜ì€ ì•„ë˜ ê¸°ì¤€í‘œë¥¼ ë”°ë¼ì•¼ í•©ë‹ˆë‹¤.**

| Action Type | Execution Level | ì´ìœ  | ìŠ¹ì¸ í•„ìš” |
|------------|----------------|------|----------|
| ì¶œê²° ì§‘ê³„ | Auto (L0) | ì˜í–¥ ì—†ìŒ, ë‚´ë¶€ ê¸°ë¡ | âŒ |
| ìƒë‹´ ìš”ì•½ | Auto (L0) | ë‚´ë¶€ ê¸°ë¡, ì •ë³´ ìš”ì•½ | âŒ |
| ë¯¸ë‚© ì•Œë¦¼ | Auto + Notice (L1) | ê¸ˆì „ ì˜í–¥ ìˆìœ¼ë‚˜ í‘œì¤€í™” | âŒ |
| í•™ë¶€ëª¨ ë©”ì‹œì§€ | Approval (L2) | ê´€ê³„ ë¦¬ìŠ¤í¬, ê°œì¸í™” í•„ìš” | âœ… |
| ë¶„ì„ ë¦¬í¬íŠ¸ ì‹¤í–‰ | Approval (L2) | ë¹„ìš©/í•´ì„ ë¦¬ìŠ¤í¬ | âœ… |
| ì²­êµ¬ì„œ ìƒì„± | Auto (L0) | í‘œì¤€í™”ëœ í”„ë¡œì„¸ìŠ¤ | âŒ |
| ì¶œê²° ì´ìƒ ê°ì§€ | Auto + Task (L1) | TaskCard ìƒì„± | âŒ (ê°ì§€/ì¹´ë“œ ìƒì„±ì€ ìŠ¹ì¸ ë¶ˆí•„ìš”) |
| ì¶œê²° ì´ìƒ í›„ì† ì‹¤í–‰ | Approval (L2) | ë©”ì‹œì§€ ë°œì†¡/ë¶„ì„ ì‹¤í–‰ | âœ… (í›„ì† ì‹¤í–‰ì€ ìŠ¹ì¸ í•„ìš”) |
| í‘œì¤€ ìš´ì˜ ì•Œë¦¼(ì¶œê²°/ê²°ì œ/ìˆ˜ì—…ë³€ê²½/ì•ˆì „í™•ì¸) | Auto (L0) ë˜ëŠ” Auto+Notice (L1) | í‘œì¤€í™”/ì •í˜• í…œí”Œë¦¿/ë¶„ìŸ ë¦¬ìŠ¤í¬ ë‚®ìŒ | âŒ |
| ê°œì¸í™”/ë¯¼ê° ë©”ì‹œì§€(ìƒë‹´ ìš”ì•½/AI ìƒì„± ë©”ì‹œì§€/ì •ì„œ ê°œì…) | Approval (L2) | ê´€ê³„/ë²•ì /ë¶„ìŸ ë¦¬ìŠ¤í¬ | âœ… |

**âš ï¸ ì¤‘ìš”:**
- ì´ ê¸°ì¤€í‘œ ì—†ìœ¼ë©´ Zero-Managementê°€ ì‚¬ëŒë§ˆë‹¤ ë‹¤ë¥´ê²Œ í•´ì„ë©ë‹ˆë‹¤
- ìƒˆë¡œìš´ ì•¡ì…˜ íƒ€ì… ì¶”ê°€ ì‹œ ë°˜ë“œì‹œ ì´ í‘œì— ëª…ì‹œí•´ì•¼ í•©ë‹ˆë‹¤
- L0 â†’ L1 â†’ L2 ìŠ¹ê²©ì€ ì‹ ë¢° ì ìˆ˜ ê¸°ë°˜ìœ¼ë¡œë§Œ ê°€ëŠ¥ (ìƒìš©í™” ë‹¨ê³„)
- "í•™ë¶€ëª¨ ë©”ì‹œì§€"ëŠ” ê°œì¸í™”/ë¯¼ê° ë©”ì‹œì§€ë¥¼ ì˜ë¯¸í•˜ë©°, í‘œì¤€ ìš´ì˜ ì•Œë¦¼ì€ L0/L1ë¡œ ìë™ ë°œì†¡ ê°€ëŠ¥(Policy ê¸°ë°˜)í•¨.

### "ìë™" ìš©ì–´ í•´ì„ ê·œì¹™

**âš ï¸ ì¤‘ìš”: ëª¨ë“  "ìë™" í‘œí˜„ì€ ì£¼ì–´ë¥¼ ëª…ì‹œí•´ì•¼ í•©ë‹ˆë‹¤.**

**ìš©ì–´ 3ë‹¨ ë¶„ë¦¬:**
| ë‹¨ê³„ | ì£¼ì²´ | ìš©ì–´ | ì˜ˆì‹œ |
|------|------|------|------|
| 1. ì¶”ì²œ | AI/Rule Engine | "AIê°€ ì¶”ì²œí•œë‹¤" | AIê°€ ë©”ì‹œì§€ ì´ˆì•ˆì„ ì¶”ì²œí•œë‹¤ |
| 2. ìƒì„± | Edge Function | "ì„œë²„ê°€ ìƒì„±í•œë‹¤" | ì„œë²„ê°€ TaskCardë¥¼ ìƒì„±í•œë‹¤ (StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­) |
| 3. ìŠ¹ì¸ | í”„ë¡ íŠ¸ì—”ë“œ | "UIê°€ ìŠ¹ì¸ ìš”ì²­í•œë‹¤" | UIê°€ ìŠ¹ì¸ ìš”ì²­ì„ ë³´ë‚¸ë‹¤ |

**UX ë¬¸ì„œì—ì„œ "ìë™"ì´ë¼ëŠ” ë‹¨ì–´ëŠ”:**
- âŒ ì‹¤í–‰ì„ ì˜ë¯¸í•˜ì§€ ì•ŠìŒ
- âœ… ì‹œê°ì  ê°•ì¡°/ë°°ë„ˆ/ìš°ì„ ìˆœìœ„ ì¡°ì • ì˜ë¯¸
- âœ… ì‚¬ìš©ì í´ë¦­ì´ í•„ìš”í•œ ì¶”ì²œ í‘œí˜„
- âœ… **ë°˜ë“œì‹œ ì£¼ì–´ ëª…ì‹œ í•„ìš”**

**ì˜ˆì‹œ:**
- âŒ "ìë™ í™”ë©´ ì „í™˜" (ì˜¤í•´ í‘œí˜„, ì£¼ì–´ ì—†ìŒ)
- âŒ "AIê°€ ìë™ ì‹¤í–‰" (ì˜¤í•´ í‘œí˜„, AIëŠ” ì¶”ì²œë§Œ, ì‹¤í–‰ì€ Edge Functionì´ ì •ì±… í•´ì„ í›„)
- âœ… "ì„œë²„ê°€ TaskCardë¥¼ ìë™ ìƒì„±" (ì •ë³¸ í‘œí˜„, ì£¼ì–´ ëª…ì‹œ, StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)
- âœ… "UIê°€ ì¶”ì²œ ë°°ë„ˆë¥¼ í‘œì‹œ, ì‚¬ìš©ì í´ë¦­ ì‹œ ì´ë™" (ì •ë³¸ í‘œí˜„, ì£¼ì–´ ëª…ì‹œ)

---

## ë¬¸ì„œ ê°œìš”

ë³¸ ë¬¸ì„œëŠ” ë””ì–´ìŒ¤ ì•„í‚¤í…ì²˜ v3.3ì˜ **Zero-Management Platform** ì² í•™ì„ í”„ë¡ íŠ¸ì—”ë“œì—ì„œ êµ¬í˜„í•˜ê¸° ìœ„í•œ ìƒì„¸ ê¸°ëŠ¥ ì„¤ê³„ ë¬¸ì„œì…ë‹ˆë‹¤.

**í•µì‹¬ ì² í•™ (ì•„í‚¤í…ì²˜ ë¬¸ì„œ 0.3):**
- "ë¡œê·¸ì¸í•˜ì§€ ì•Šì•„ë„ ìš´ì˜ì´ ëŒì•„ê°„ë‹¤" = **ì„œë²„ì—ì„œ ì •ì±… í•´ì„ í›„ ì‹¤í–‰**
- UIëŠ” **ê´€ì°°ì + ìŠ¹ì¸ì** ì—­í• ë§Œ ìˆ˜í–‰
- í”„ë¡ íŠ¸ì—”ë“œëŠ” **ìƒí™© ì‹ í˜¸ë¥¼ ìˆ˜ì§‘í•˜ì—¬ ì„œë²„ì— ì „ë‹¬**í•˜ëŠ” ì—­í• 

**âš ï¸ ì •ë³¸ ê·œì¹™ ì¤€ìˆ˜:**
ì´ ë¬¸ì„œì˜ ëª¨ë“  ì„¤ê³„ëŠ” ì•„ë˜ ì •ë³¸ ê·œì¹™ì„ ë³€ê²½Â·ìš°íšŒÂ·ì™„í™”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

### 0. ì ˆëŒ€ ì „ì œ (ì •ë³¸ ê·œì¹™ ìš”ì•½)

#### 0.1 í™ˆ ëŒ€ì‹œë³´ë“œ ì¹´ë“œ ìš°ì„ ìˆœìœ„ (ë¶ˆë³€)
1. EMERGENCY
2. AI_BRIEFING
3. STUDENT_TASKS
4. CLASSES
5. BILLING
6. STATS

**âŒ ê¸ˆì§€ ì‚¬í•­:**
- ì›”ë§ì´ë¼ê³  BILLINGì„ 1ë²ˆìœ¼ë¡œ ì˜¬ë¦´ ìˆ˜ ì—†ìŒ
- TaskCard (task_type: 'ai_suggested', entity_type='student')ë¥¼ ë³„ë„ ê·¸ë£¹ìœ¼ë¡œ ë§Œë“¤ ìˆ˜ ì—†ìŒ (TaskCardì— í¬í•¨, StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)
- ê·¸ë£¹ ìˆœì„œ ë³€ê²½ ë¶ˆê°€

**âœ… í—ˆìš© ì‚¬í•­:**
- ê·¸ë£¹ ë‚´ë¶€ priority ê°€ì¤‘ì¹˜ ì¡°ì •ë§Œ í—ˆìš©

#### 0.2 ì¹´ë“œ ê²½ê³„ ì •ì˜ (í˜¼í•© ê¸ˆì§€)
| êµ¬ë¶„ | ì„±ê²© | ì‚¬ìš©ì í–‰ë™ |
|------|------|------------|
| AI_BRIEFING | ì •ë³´ ìš”ì•½ | âŒ ì‹¤í–‰ ì—†ìŒ |
| STUDENT_TASK | í–‰ë™ í•„ìš” | âœ… ì‹¤í–‰/ìŠ¹ì¸ |
| EMERGENCY | ì¦‰ì‹œ ëŒ€ì‘ | âœ… ê°•ì œ ë…¸ì¶œ |

**âš ï¸ TaskCard (task_type: 'ai_suggested', entity_type='student')ëŠ” TaskCardì˜ í•œ íƒ€ì…** (StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)
- `task_type: 'ai_suggested'`ë¡œ task_cardsì— ì €ì¥ (StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)
- ë…ë¦½ ì‹œìŠ¤í…œ/í…Œì´ë¸”/ì•± âŒ (TaskCardëŠ” task_cards í…Œì´ë¸”ì— ì €ì¥ë˜ëŠ” í•˜ë‚˜ì˜ íƒ€ì…)
- Hookì€ "ì¡°íšŒ/í‘œì‹œìš© Shared Hook"ë¡œ í—ˆìš© (ë‹¨, ì‹¤í–‰/íŒë‹¨/ìë™ navigate ê¸ˆì§€)

#### 0.3 TTL Â· Dedup (ë‹¨ì¼ ì •ë³¸)
- ë™ì¼ íŠ¸ë¦¬ê±° â†’ ì¹´ë“œ 1ê°œë§Œ
- TTL ë§Œë£Œ ì‹œ ìë™ ì œê±°
- ìƒˆ ì¹´ë“œ ìƒì„± ì‹œ ê¸°ì¡´ ì¹´ë“œ update/merge

#### 0.4 Zero-Trust ì‹¤í–‰ ì›ì¹™
- í”„ë¡ íŠ¸ì—”ë“œëŠ” ì ˆëŒ€ ì‹¤í–‰í•˜ì§€ ì•ŠëŠ”ë‹¤
- í”„ë¡ íŠ¸ = ìŠ¹ì¸/ê±°ë¶€ ìš”ì²­ë§Œ
- ì‹¤í–‰ì€ Edge Function + Role ê²€ì¦

#### 0.5 Role ë¶„ë¦¬ (ë¶ˆë³€)
| Role | ê°€ëŠ¥ |
|------|------|
| Admin | ìŠ¹ì¸ + ì‹¤í–‰ |
| Teacher | ìŠ¹ì¸ ìš”ì²­ |
| Assistant | ë³´ê¸° |

**ë¬¸ì„œ ëª©ì :**
- í–¥í›„ ê¸°ëŠ¥ ê°œë°œ ì‹œ ì°¸ì¡°í•  ìˆ˜ ìˆëŠ” ìƒì„¸ ì„¤ê³„ ë¬¸ì„œ
- êµ¬í˜„ ìš°ì„ ìˆœìœ„ ë° ë‹¨ê³„ë³„ ê°œë°œ ê°€ì´ë“œ
- UI/UX íŒ¨í„´ ë° ì»´í¬ë„ŒíŠ¸ ì„¤ê³„ ê¸°ì¤€
- **ì •ë³¸ ê·œì¹™ ì¤€ìˆ˜ ê²€ì¦ ê¸°ì¤€**

---

## 1. Context-Aware UI (ìƒí™© ì¸ì‹ UI ì¡°ì •)

### 1.1 ê°œìš”

**ì •ë³¸ ê·œì¹™: í”„ë¡ íŠ¸ì—”ë“œëŠ” "ìë™ í™”ë©´ ì „í™˜"ì„ í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.**

í”„ë¡ íŠ¸ì—”ë“œëŠ” ë‹¤ìŒë§Œ ìˆ˜í–‰í•©ë‹ˆë‹¤:
- âœ… ìƒí™© ì‹ í˜¸ ìˆ˜ì§‘ (ì‹œê°„, ë‚ ì”¨, ì´ë²¤íŠ¸ ë“±)
- âœ… UI ìš°ì„ ìˆœìœ„ ì¡°ì • (Priority ê°€ì¤‘ì¹˜)
- âœ… ì¶”ì²œ ë°°ë„ˆ í‘œì‹œ (ì‚¬ìš©ì í´ë¦­ í•„ìš”)
- âŒ ìë™ í™”ë©´ ì´ë™ (`navigate()` í˜¸ì¶œ ê¸ˆì§€)
- âŒ ìë™ ì‹¤í–‰ (í”„ë¡ íŠ¸ì—”ë“œ ì‹¤í–‰ ê¸ˆì§€, ì„œë²„ê°€ ì •ì±… í•´ì„ í›„ ì‹¤í–‰)

**ìš©ì–´ í†µì¼ ê·œì¹™:**
| ê¸ˆì§€ ìš©ì–´ | ì •ë³¸ ìš©ì–´ |
|----------|----------|
| ìë™ ì‹¤í–‰ | ì„œë²„ê°€ ì •ì±…ì— ë”°ë¼ ì‹¤í–‰ |
| ìë™ ì²˜ë¦¬ | ì„œë²„ê°€ ì •ì±… í•´ì„ í›„ ì‹¤í–‰ |
| í”„ë¡ íŠ¸ ìë™í™” | í”„ë¡ íŠ¸ ìƒí™© ì‹ í˜¸ ìˆ˜ì§‘ |
| ìë™ í™”ë©´ ì „í™˜ | ì¶”ì²œ ë°°ë„ˆ í‘œì‹œ |

UIëŠ” ì‚¬ìš©ìì˜ ì—­í• , ì‹œê°„ëŒ€, ìƒí™©, ì—…ë¬´ íë¦„ì— ë”°ë¼ **ìš°ì„ ìˆœìœ„ì™€ ë°°ë„ˆë§Œ ì¡°ì •**í•©ë‹ˆë‹¤.

**ì•„í‚¤í…ì²˜ ë¬¸ì„œ ìš”êµ¬ì‚¬í•­ (1.8):**
- ìˆ˜ì—… ì‹œì‘ 10ë¶„ ì „ â†’ ì¶œì„ë¶€ ì¹´ë“œ ìš°ì„ ìˆœìœ„ ìƒìŠ¹ + ì¶”ì²œ ë°°ë„ˆ í‘œì‹œ
- ìˆ˜ì—… ì¢…ë£Œ í›„ â†’ ìƒë‹´ì¼ì§€ ì‘ì„± TaskCard ìƒì„± (StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)
- ì›”ë§ â†’ ì²­êµ¬ ì¹´ë“œ priority +2 (ê·¸ë£¹ ìˆœì„œëŠ” ë¶ˆë³€)
- ë¹„ê°€ ë§ì´ ì˜¤ëŠ” ë‚  â†’ ì„œë²„ê°€ í•˜ì› ì•ˆì „ ì•ˆë‚´ë¬¸ TaskCard ìƒì„± (AI í˜¸ì¶œ, StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)

**âŒ ì •ë³¸ ê·œì¹™ ìœ„ë°˜ ê¸ˆì§€:**
- ìë™ í™”ë©´ ì´ë™ (`navigate()` í˜¸ì¶œ) ê¸ˆì§€
- ê·¸ë£¹ ìˆœì„œ ë³€ê²½ ê¸ˆì§€
- í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì§ì ‘ ì‹¤í–‰ ê¸ˆì§€

### 1.2 êµ¬í˜„ ì„¤ê³„

#### 1.2.1 ì‹œê°„ ê¸°ë°˜ ìƒí™© ì‹ í˜¸ ìˆ˜ì§‘

**ê¸°ëŠ¥ëª…:** `useContextSignals` (ê¶Œì¥)

**âš ï¸ Hook ì´ë¦„ ì¬ì •ì˜:**
- âŒ `useAdaptiveNavigation` (ì˜ë¯¸ ê³¼ì‰, ìë™ ì´ë™ ì•”ì‹œ)
- âœ… `useContextSignals` (ì—­í•  ëª…í™•: ìƒí™© ì‹ í˜¸ ìˆ˜ì§‘ë§Œ)

**ìœ„ì¹˜:** `packages/hooks/use-context-signals/src/index.ts` (ê¶Œì¥)

**ë ˆê±°ì‹œ í˜¸í™˜:** ê¸°ì¡´ `use-adaptive-navigation` íŒ¨í‚¤ì§€ëŠ” ìœ ì§€í•˜ë˜, ë‚´ë¶€ êµ¬í˜„ì€ Context Signal ìˆ˜ì§‘ë§Œ ìˆ˜í–‰

**ì—­í•  ì¬ì •ì˜:**
- âŒ "ìë™ í™”ë©´ ì „í™˜" ê¸°ëŠ¥ ì•„ë‹˜
- âœ… **ìƒí™© ì‹ í˜¸ ìˆ˜ì§‘ ë° UI ì¡°ì •** ê¸°ëŠ¥
- âœ… í˜„ì¬ ì‹œê°„ê³¼ ìˆ˜ì—… ìŠ¤ì¼€ì¤„ì„ ë¹„êµí•˜ì—¬ **ìƒí™© ì‹ í˜¸ ìƒì„±**
- âœ… ìˆ˜ì—… ì‹œì‘ 10ë¶„ ì „ ê°ì§€ ì‹œ ì¶œì„ë¶€ ì¹´ë“œ priority ê°€ì¤‘ì¹˜ + ì¶”ì²œ ë°°ë„ˆ í‘œì‹œ
- âœ… ìˆ˜ì—… ì¢…ë£Œ í›„ â†’ **ì„œë²„ê°€ TaskCard ìƒì„±** (í”„ë¡ íŠ¸ì—”ë“œëŠ” ìƒì„±í•˜ì§€ ì•ŠìŒ, StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)

**ì •ë³¸ ê·œì¹™:**
- `navigate()` í˜¸ì¶œ ì—†ìŒ
- ìë™ ë¼ìš°íŒ… ì—†ìŒ
- âœ… **ìƒí™© ì‹ í˜¸(Context Signals)ë§Œ ì œê³µ**
- âœ… **Priority ê°€ì¤‘ì¹˜ ê³„ì‚°ìš© ì…ë ¥ë§Œ ì œê³µ**

**API ì„¤ê³„:**

```typescript
interface ContextRecommendation {
  id: string;
  trigger_type: 'time_based' | 'event_based' | 'pattern_based';
  condition: {
    time_range?: { start: string; end: string }; // HH:mm í˜•ì‹
    day_of_week?: DayOfWeek[];
    class_id?: string;
    minutes_before?: number; // ìˆ˜ì—… ì‹œì‘ Në¶„ ì „
    minutes_after?: number; // ìˆ˜ì—… ì¢…ë£Œ Në¶„ í›„
  };
  action: {
    type: 'show_banner' | 'highlight_card' | 'adjust_priority'; // ì •ë³¸: navigate ì œê±°
    target: string; // ê²½ë¡œ ë˜ëŠ” ì»´í¬ë„ŒíŠ¸ ID (ì‚¬ìš©ìê°€ í´ë¦­ ì‹œ ì´ë™)
    priority: number; // 0-100, ë†’ì„ìˆ˜ë¡ ìš°ì„ ìˆœìœ„ ë†’ìŒ (ì •ë³¸: 0-100 ìŠ¤ì¼€ì¼)
    require_confirmation?: boolean; // ìŠ¹ì¸ í•„ìš” ì—¬ë¶€
    // auto_execute ì œê±°: ì •ë³¸ ê·œì¹™ì— ë”°ë¼ í”„ë¡ íŠ¸ì—”ë“œ ìë™ ì‹¤í–‰ ê¸ˆì§€ (ì„œë²„ê°€ ì •ì±… í•´ì„ í›„ ì‹¤í–‰)
  };
  enabled: boolean;
}

interface UseContextSignalsReturn {
  currentRecommendation: ContextRecommendation | null;
  contextSignals: ContextSignals; // ì •ë³¸: ìƒí™© ì‹ í˜¸ë§Œ ì œê³µ
  goToRecommendation: () => void; // ì •ë³¸: ì‚¬ìš©ì í´ë¦­ ì‹œ ì´ë™ (ì‹¤í–‰ ì•„ë‹˜, executeRecommendation â†’ goToRecommendation)
  dismissRecommendation: () => void;
  // shouldAutoNavigate ì œê±°: ì •ë³¸ ê·œì¹™ì— ë”°ë¼ ìë™ ì´ë™ ê¸ˆì§€
}

// ë ˆê±°ì‹œ í˜¸í™˜: UseAdaptiveNavigationReturn = UseContextSignalsReturn

interface ContextSignals {
  time_of_day: 'morning' | 'afternoon' | 'evening';
  is_month_end: boolean;
  has_upcoming_class: boolean;
  has_finished_class: boolean;
  device_mode: 'desktop' | 'tablet' | 'mobile';
}
```

**êµ¬í˜„ ë¡œì§:**

```typescript
// ì •ë³¸ ê¶Œì¥ ì´ë¦„
export function useContextSignals(): UseContextSignalsReturn {
  // âš ï¸ ì •ë³¸: useNavigate() ì œê±° - ì´ë™ì€ ì¹´ë“œ/ë°°ë„ˆ onClickì—ì„œë§Œ ì²˜ë¦¬
  const { data: todayClasses } = useClasses({ day_of_week: getTodayDayOfWeek() });
  const currentTime = toKST();

  // 1. ìˆ˜ì—… ì‹œì‘ 10ë¶„ ì „ ê°ì§€
  const upcomingClass = useMemo(() => {
    return todayClasses?.find(cls => {
      const [hour, minute] = cls.start_time.split(':').map(Number);
      const classStartTime = currentTime.hour(hour).minute(minute);
      const diffMinutes = classStartTime.diff(currentTime, 'minute');
      return diffMinutes > 0 && diffMinutes <= 10;
    });
  }, [todayClasses, currentTime]);

  // 2. ìˆ˜ì—… ì¢…ë£Œ í›„ ê°ì§€
  const finishedClass = useMemo(() => {
    return todayClasses?.find(cls => {
      const [hour, minute] = cls.start_time.split(':').map(Number);
      const classEndTime = currentTime.hour(hour).minute(minute).add(cls.duration_minutes || 60, 'minute');
      const diffMinutes = currentTime.diff(classEndTime, 'minute');
      return diffMinutes > 0 && diffMinutes <= 30; // ìˆ˜ì—… ì¢…ë£Œ í›„ 30ë¶„ ì´ë‚´
    });
  }, [todayClasses, currentTime]);

  // 3. ìƒí™© ì‹ í˜¸ ìƒì„± (ì •ë³¸: ì¶”ì²œ ê·œì¹™ì´ ì•„ë‹Œ ì‹ í˜¸ë§Œ)
  // âš ï¸ ì¤‘ìš”: is_month_endëŠ” Policyì—ì„œ ì¡°íšŒí•´ì•¼ í•˜ë©°, í•˜ë“œì½”ë”©ëœ ìƒìˆ˜(25)ëŠ” ì •ì±… ê¸°ë°˜ ì›ì¹™ê³¼ ì¶©ëŒí•©ë‹ˆë‹¤.
  // ì •ë³¸ êµ¬í˜„: Policyì—ì„œ `billing.month_end_threshold_day` ì¡°íšŒ (Default Policy: í…Œë„ŒíŠ¸ ìƒì„± ì‹œ 25ì¼ë¡œ ì„¤ì •ê°’ ì €ì¥, ì €ì¥ ìœ„ì¹˜ëŠ” tenant_settings(key='config').value(JSONB))
  const { tenantId } = useTenant();
  // âœ… ì •ë³¸: Policyì—ì„œ ì¡°íšŒ (í•˜ë“œì½”ë”©ëœ ê¸°ë³¸ê°’ ì‚¬ìš© ê¸ˆì§€)
  const { data: monthEndThreshold } = useTenantSettingByPath('billing.month_end_threshold_day');
  // ë˜ëŠ”: const threshold = await apiClient.getTenantSetting(tenantId, 'billing.month_end_threshold_day');
  // ì„œë²„/Edge Functionì—ì„œëŠ”: await getTenantSettingByPath(supabase, tenantId, 'billing.month_end_threshold_day')

  const contextSignals = useMemo<ContextSignals>(() => {
    if (!monthEndThreshold) {
      // âš ï¸ ì¤‘ìš”: Policy ê°’ì´ ì—†ìœ¼ë©´ ì‹¤í–‰ ì•ˆ í•¨ (Default PolicyëŠ” í…Œë„ŒíŠ¸ ìƒì„± ì‹œ ì„¤ì •ê°’ìœ¼ë¡œ ì €ì¥ë¨)
      return {
        time_of_day: getTimeOfDay(currentTime),
        is_month_end: false,
        has_upcoming_class: !!upcomingClass,
        has_finished_class: !!finishedClass,
        device_mode: getDeviceMode(),
      };
    }
    return {
      time_of_day: getTimeOfDay(currentTime),
      is_month_end: currentTime.date() >= monthEndThreshold, // âœ… ì •ë³¸: Policyì—ì„œ ì¡°íšŒí•œ ê°’ ì‚¬ìš© (ì§ì ‘ ê°’ ì‚¬ìš©, .value ì ‘ê·¼ ë¶ˆí•„ìš”)
      has_upcoming_class: !!upcomingClass,
      has_finished_class: !!finishedClass,
      device_mode: getDeviceMode(),
    };
  }, [currentTime, upcomingClass, finishedClass, monthEndThreshold]);

  // 4. ì¶”ì²œ ë°°ë„ˆ ì •ë³´ ìƒì„± (ì •ë³¸: í”„ë¡ íŠ¸ì—”ë“œ ìë™ ì‹¤í–‰ ì—†ìŒ, ì„œë²„ê°€ ì •ì±… í•´ì„ í›„ ì‹¤í–‰)
  const recommendation = useMemo<ContextRecommendation | null>(() => {
    if (upcomingClass) {
      return {
        id: `class-start-${upcomingClass.id}`,
        trigger_type: 'time_based',
        condition: {
          class_id: upcomingClass.id,
          minutes_before: 10,
        },
        action: {
          type: 'show_banner', // ì •ë³¸: navigate ì œê±°
          target: `/attendance?class_id=${upcomingClass.id}`, // ì‚¬ìš©ì í´ë¦­ ì‹œ ì´ë™
          priority: 90, // ì •ë³¸: 0-100 ìŠ¤ì¼€ì¼
          require_confirmation: false,
        },
        enabled: true,
      };
    }

    if (finishedClass) {
      // ì •ë³¸: ìˆ˜ì—… ì¢…ë£Œ í›„ TaskCardëŠ” ì„œë²„ê°€ ìƒì„± (StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)
      // í”„ë¡ íŠ¸ì—”ë“œëŠ” ë°°ë„ˆë§Œ í‘œì‹œ
      return {
        id: `class-end-${finishedClass.id}`,
        trigger_type: 'time_based',
        condition: {
          class_id: finishedClass.id,
          minutes_after: 0,
        },
        action: {
          type: 'show_banner', // ì •ë³¸: show_modal ì œê±°
          target: '/students/consultations', // ì‚¬ìš©ì í´ë¦­ ì‹œ ì´ë™
          priority: priorityPolicy ?? null, // âš ï¸ Policy ì¡°íšŒ í•„ìˆ˜, ì—†ìœ¼ë©´ ìƒì„± ì•ˆ í•¨ (Fail-Closed) - ì„œë²„/Edge Functionì€ T | null ì§ì ‘ ë°˜í™˜, .value ì ‘ê·¼ ë¶ˆí•„ìš”
          require_confirmation: false,
        },
        enabled: true,
      };
    }

    return null;
  }, [upcomingClass, finishedClass]);

  // ì •ë³¸ ê·œì¹™: ìë™ navigate() í˜¸ì¶œ ê¸ˆì§€
  // í”„ë¡ íŠ¸ì—”ë“œëŠ” ì¶”ì²œ ë°°ë„ˆë§Œ ì œê³µí•˜ê³ , ì‚¬ìš©ìê°€ ì§ì ‘ í´ë¦­í•´ì•¼ í•¨
  // ì´ë™ì€ ì¹´ë“œ/ë°°ë„ˆ ì»´í¬ë„ŒíŠ¸ì˜ onClick í•¸ë“¤ëŸ¬ì—ì„œë§Œ ì²˜ë¦¬
  // Hook ë‚´ë¶€ì—ì„œëŠ” navigate()ë¥¼ ì§ì ‘ í˜¸ì¶œí•˜ì§€ ì•ŠìŒ

  return {
    currentRecommendation: recommendation,
    contextSignals, // ì •ë³¸: ìƒí™© ì‹ í˜¸ ì œê³µ
    goToRecommendation: recommendation ? () => {
      // ì •ë³¸: ì´ í•¨ìˆ˜ëŠ” ì¹´ë“œ/ë°°ë„ˆ ì»´í¬ë„ŒíŠ¸ì˜ onClickì—ì„œ í˜¸ì¶œë¨
      // ì‹¤ì œ ì´ë™ì€ ì»´í¬ë„ŒíŠ¸ ë ˆë²¨ì—ì„œ ë¼ìš°í„°ì˜ navigate() ë˜ëŠ” window.location ì‚¬ìš©
      // Hook ë‚´ë¶€ì—ì„œëŠ” navigate()ë¥¼ ì§ì ‘ í˜¸ì¶œí•˜ì§€ ì•ŠìŒ
      // ì˜ˆì‹œ: <ContextRecommendationBanner onClick={() => navigate(recommendation.action.target)} />
    } : () => {}, // ì •ë³¸: executeRecommendation â†’ goToRecommendation (ì‹¤í–‰ ì•”ì‹œ ì œê±°)
    dismissRecommendation: () => {
      // ì¶”ì²œ ë¬´ì‹œ ë¡œì§
    },
  };
}

// ë ˆê±°ì‹œ í˜¸í™˜: alias (í•¨ìˆ˜ ë°–ì—ì„œ)
export const useAdaptiveNavigation = useContextSignals;
```

#### 1.2.2 ì›”ë§ ìƒí™© ì‹ í˜¸ ìˆ˜ì§‘

**ê¸°ëŠ¥ëª…:** `useMonthEndAdaptation`

**ìœ„ì¹˜:** `packages/hooks/use-month-end-adaptation/src/index.ts`

**ì—­í•  ì¬ì •ì˜:**
- âœ… ì›”ë§ ê°ì§€ (ìƒí™© ì‹ í˜¸ ìˆ˜ì§‘)
- âœ… ì²­êµ¬ ì¹´ë“œ priority ê°€ì¤‘ì¹˜ +2 ê³„ì‚°
- âŒ "ìë™ ì¹´ë“œ ìƒë‹¨ ë…¸ì¶œ" ì•„ë‹˜ (ê·¸ë£¹ ìˆœì„œ ë¶ˆë³€)
- **ì •ë³¸ ê·œì¹™: ê·¸ë£¹ ìˆœì„œëŠ” ë¶ˆë³€, ë‚´ë¶€ ì •ë ¬ë§Œ ë³€ë™**

**êµ¬í˜„ ë¡œì§:**

```typescript
export function useMonthEndAdaptation() {
  const currentDate = toKST();
  // âš ï¸ ì¤‘ìš”: ì›”ë§ íŒë‹¨ ê¸°ì¤€ì€ Policyì—ì„œ ì¡°íšŒí•´ì•¼ í•˜ë©°, í•˜ë“œì½”ë”©ëœ ìƒìˆ˜(25)ëŠ” ì •ì±… ê¸°ë°˜ ì›ì¹™ê³¼ ì¶©ëŒí•©ë‹ˆë‹¤.
  // ì •ë³¸ êµ¬í˜„: Policyì—ì„œ `billing.month_end_threshold_day` ì¡°íšŒ (Default Policy: í…Œë„ŒíŠ¸ ìƒì„± ì‹œ 25ì¼ë¡œ ì„¤ì •ê°’ ì €ì¥, ì €ì¥ ìœ„ì¹˜ëŠ” tenant_settings(key='config').value(JSONB))
  // âœ… ì •ë³¸: Policyì—ì„œ ì¡°íšŒ (í•˜ë“œì½”ë”©ëœ ê¸°ë³¸ê°’ ì‚¬ìš© ê¸ˆì§€)
  const { data: monthEndThresholdPolicy } = useTenantSettingByPath('billing.month_end_threshold_day');
  if (!monthEndThresholdPolicy) {
    // âš ï¸ ì¤‘ìš”: Policy ê°’ì´ ì—†ìœ¼ë©´ ì‹¤í–‰ ì•ˆ í•¨ (Default PolicyëŠ” í…Œë„ŒíŠ¸ ìƒì„± ì‹œ ì„¤ì •ê°’ìœ¼ë¡œ ì €ì¥ë¨)
    return { isMonthEnd: false, shouldPrioritizeBilling: false };
  }
  const monthEndThresholdDay = typeof monthEndThresholdPolicy === 'number' ? monthEndThresholdPolicy : undefined; // âœ… Policyì—ì„œ ì¡°íšŒí•œ ê°’ ì‚¬ìš© (ì§ì ‘ ê°’ ì‚¬ìš©, .value ì ‘ê·¼ ë¶ˆí•„ìš”)
  if (monthEndThresholdDay === undefined) {
    return { isMonthEnd: false, shouldPrioritizeBilling: false };
  }
  const isMonthEnd = currentDate.date() >= monthEndThresholdDay;

  return {
    isMonthEnd,
    shouldPrioritizeBilling: isMonthEnd,
  };
}
```

**HomePage.tsx ì ìš©:**

```typescript
const { shouldPrioritizeBilling } = useMonthEndAdaptation();

// ì •ë³¸ ê·œì¹™: ê·¸ë£¹ ìˆœì„œëŠ” ë¶ˆë³€, ì›”ë§ì—ëŠ” priorityë§Œ +2
const sortedCards = useMemo(() => {
  const cards: DashboardCard[] = [];

  // 1. Emergency Cards (í•­ìƒ ìµœìƒë‹¨)
  if (emergencyCards) cards.push(...emergencyCards);

  // 2. AI Briefing Cards
  if (aiBriefingCards) cards.push(...aiBriefingCards);

  // 3. Student Task Cards
  if (studentTaskCards) cards.push(...studentTaskCards);

  // 4. Classes
  if (todayClasses) cards.push(...todayClasses);

  // 5. Billing Summary (ì •ë³¸: ê·¸ë£¹ ìˆœì„œ ë¶ˆë³€, ì›”ë§ì—ëŠ” priorityë§Œ +2)
  if (billingSummary) {
    // ì›”ë§ì—ëŠ” priority ê°€ì¤‘ì¹˜ë§Œ ì¡°ì •
    const adjustedBilling = {
      ...billingSummary,
      priority: (billingSummary.priority || 50) + (shouldPrioritizeBilling ? 2 : 0), // ì •ë³¸: 0-100 ìŠ¤ì¼€ì¼, ì›”ë§ ê°€ì¤‘ì¹˜ +2
    };
    cards.push(adjustedBilling);
  }

  // 6. Stats Cards
  if (statsCards) cards.push(...statsCards);

  // ì •ë³¸: ê·¸ë£¹ ë‚´ë¶€ priority ê°€ì¤‘ì¹˜ ì ìš© (ì›”ë§ ë“±)
  // Billing ì¹´ë“œì˜ priorityê°€ ì¡°ì •ë˜ì—ˆìœ¼ë¯€ë¡œ, Billing ê·¸ë£¹ ë‚´ë¶€ ì •ë ¬ë§Œ ë³€ë™
  // ì „ì²´ ê·¸ë£¹ ìˆœì„œëŠ” ë¶ˆë³€: EMERGENCY > AI_BRIEFING > STUDENT_TASKS > CLASSES > BILLING > STATS

  return cards;
}, [emergencyCards, aiBriefingCards, studentTaskCards, todayClasses, billingSummary, statsCards, shouldPrioritizeBilling]);
```

#### 1.2.3 ë‚ ì”¨ ê¸°ë°˜ ìƒí™© ì‹ í˜¸ ìˆ˜ì§‘

**ê¸°ëŠ¥ëª…:** `useWeatherSignals` (ê¶Œì¥)

**ìœ„ì¹˜:** `packages/hooks/use-weather-signals/src/index.ts`

**âš ï¸ ì •ë³¸ ê·œì¹™:**
- í”„ë¡ íŠ¸ëŠ” ë‚ ì”¨ ìƒí™© ì‹ í˜¸ë§Œ ìˆ˜ì§‘
- ì•ˆë‚´ë¬¸ ìƒì„±/ë°œì†¡ì€ ì„œë²„(TaskCard ìƒì„±)ì—ì„œ ì²˜ë¦¬ (StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)
- í”„ë¡ íŠ¸ëŠ” ì•Œë¦¼ ìƒì„±/ì‹¤í–‰ì„ ì£¼ë„í•˜ì§€ ì•ŠìŒ

**ê¸°ëŠ¥:**
- ë‚ ì”¨ API ì—°ë™í•˜ì—¬ ë¹„/ëˆˆ ë“± ì•…ì²œí›„ ê°ì§€
- ìƒí™© ì‹ í˜¸ ìƒì„± ë° ë°°ë„ˆ íŒíŠ¸ ì œê³µ

**êµ¬í˜„ ë¡œì§:**

```typescript
interface WeatherCondition {
  condition: 'rain' | 'snow' | 'storm' | 'normal';
  intensity: 'light' | 'moderate' | 'heavy';
}

export function useWeatherSignals() {
  const { data: weather } = useQuery({
    queryKey: ['weather'],
    queryFn: async () => {
      // âœ… ì •ë³¸: ë‚ ì”¨ ì‹ í˜¸ëŠ” ì„œë²„ ì—”ë“œí¬ì¸íŠ¸ë¥¼ í†µí•´ ì¡°íšŒ (í´ë¼ì´ì–¸íŠ¸ ì§ì ‘ ì™¸ë¶€ API í˜¸ì¶œ ê¸ˆì§€)
      // ì„œë²„/Edge Functionì—ì„œ ë‚ ì”¨ API í‚¤/ì¿¼í„°/ê°œì¸ì •ë³´(ìœ„ì¹˜) ê´€ë¦¬
      // âš ï¸ ì£¼ì˜: apiClient.getWeatherSignals()ëŠ” ì˜ˆì‹œ ì½”ë“œì´ë©°, ì‹¤ì œ êµ¬í˜„ì€ ì„œë²„ ì—”ë“œí¬ì¸íŠ¸ í™•ì¸ í•„ìš”
      const response = await apiClient.getWeatherSignals(); // ë˜ëŠ” apiClient.get('weather_signals')
      return response.json();
    },
    refetchInterval: 30 * 60 * 1000, // 30ë¶„ë§ˆë‹¤ ê°±ì‹ 
  });

  // ì •ë³¸: í”„ë¡ íŠ¸ëŠ” weather signalë§Œ ìƒì„±
  const weatherSignals = useMemo(() => {
    if (weather?.condition === 'rain' && weather.intensity === 'heavy') {
      return {
        condition: 'heavy_rain',
        intensity: weather.intensity,
        bannerHint: 'ì˜¤ëŠ˜ì€ ë¹„ê°€ ë§ì´ ì˜µë‹ˆë‹¤. í•˜ì› ì‹œ ì•ˆì „ì— ì£¼ì˜í•˜ì„¸ìš”.',
      };
    }
    return null;
  }, [weather]);

  return { weatherSignals };
}
```

**âš ï¸ ì •ë³¸ ê·œì¹™:**
- í”„ë¡ íŠ¸ëŠ” weather signalë§Œ ìƒì„±
- ì„œë²„ ë°°ì¹˜/íŠ¸ë¦¬ê±°ê°€ heavy rainì„ ê·¼ê±°ë¡œ TaskCard ìƒì„± (StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)
- í”„ë¡ íŠ¸ëŠ” ì•Œë¦¼ ìƒì„±/ì‹¤í–‰ì„ ì£¼ë„í•˜ì§€ ì•ŠìŒ

**ì„œë²„ ì¸¡ êµ¬í˜„ (Edge Function):**

```typescript
// Edge Function: student-task-card-generation
// ë‚ ì”¨ ê¸°ë°˜ TaskCard ìƒì„± (StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)

if (weatherSignals?.condition === 'heavy_rain') {
  // âš ï¸ ì¤‘ìš”: Priority, TTL ëª¨ë‘ Policyì—ì„œ ì¡°íšŒ (í•˜ë“œì½”ë”© ê¸ˆì§€, SSOT ê²½ë¡œ ì‚¬ìš©)
  const priorityPolicy = await getTenantSettingByPath(supabase, tenantId, 'auto_notification.weather_alert.priority');
  if (!priorityPolicy) {
    // Policyê°€ ì—†ìœ¼ë©´ ì‹¤í–‰í•˜ì§€ ì•ŠìŒ (Fail Closed)
    return;
  }
  const ttlPolicy = await getTenantSettingByPath(supabase, tenantId, 'auto_notification.weather_alert.ttl_days');
  if (!ttlPolicy) {
    // Policyê°€ ì—†ìœ¼ë©´ ì‹¤í–‰í•˜ì§€ ì•ŠìŒ (Fail Closed)
    return;
  }

  // âš ï¸ ì¤‘ìš”: ë©±ë“±ì„±/ì¤‘ë³µë°©ì§€ - ë°˜ë“œì‹œ UPSERT ì‚¬ìš© (DB ì œì•½ìœ¼ë¡œ Race condition ë°©ì§€)
  await supabase.from('task_cards').upsert({
    tenant_id: tenantId,
    entity_id: tenantId,  // entity_id = tenantId (entity_type='tenant')
    entity_type: 'tenant', // entity_type
    task_type: 'ai_suggested',
    source: 'weather',
    priority: priorityPolicy ?? null, // âš ï¸ Policy ì¡°íšŒ í•„ìˆ˜, ì—†ìœ¼ë©´ ìƒì„± ì•ˆ í•¨ (Fail-Closed) - ì„œë²„/Edge Functionì€ T | null ì§ì ‘ ë°˜í™˜, .value ì ‘ê·¼ ë¶ˆí•„ìš”
    title: 'í•˜ì› ì•ˆì „ ì•ˆë‚´',
    description: 'ì˜¤ëŠ˜ì€ ë¹„ê°€ ë§ì´ ì˜µë‹ˆë‹¤. í•˜ì› ì‹œ ì•ˆì „ì— ì£¼ì˜í•˜ì„¸ìš”.',
    suggested_action: {
      type: 'send_notification',
      template: 'weather_safety',
    },
    dedup_key: `${tenantId}:weather_alert:tenant:global:${toKST().format('YYYY-MM-DD')}`, // ì •ë³¸ í¬ë§·: {tenantId}:{trigger}:{entityType}:{entityId}:{window} (entityType='tenant'ì¼ ë•Œ entityIdëŠ” ê³ ì • í† í° 'global' ì‚¬ìš©)
    expires_at: ttlPolicy ? new Date(Date.now() + (typeof ttlPolicy === 'number' ? ttlPolicy : 0) * 24 * 60 * 60 * 1000) : null, // âš ï¸ Policy ì¡°íšŒ í•„ìˆ˜, ì—†ìœ¼ë©´ ìƒì„± ì•ˆ í•¨ (Fail-Closed) - ì„œë²„/Edge Functionì€ T | null ì§ì ‘ ë°˜í™˜, .value ì ‘ê·¼ ë¶ˆí•„ìš”
  }, {
    onConflict: 'tenant_id,dedup_key',
    ignoreDuplicates: false, // ê¸°ì¡´ ì¹´ë“œê°€ ìˆìœ¼ë©´ ì—…ë°ì´íŠ¸
  });
}
```

### 1.3 UI ì»´í¬ë„ŒíŠ¸

#### 1.3.1 Context Recommendation Banner

**ìœ„ì¹˜:** `packages/ui-core/src/components/ContextRecommendationBanner.tsx`

**âš ï¸ ì •ë³¸: "Adaptive Navigation Banner" â†’ "Context Recommendation Banner"ë¡œ ë³€ê²½**

**ê¸°ëŠ¥:**
- ìƒí™© ê¸°ë°˜ ì¶”ì²œì„ ìƒë‹¨ ë°°ë„ˆë¡œ í‘œì‹œ
- ì‚¬ìš©ì í´ë¦­ ì‹œ ì´ë™ (ì¶”ì²œë§Œ, í”„ë¡ íŠ¸ì—”ë“œ ìë™ ì‹¤í–‰ ì—†ìŒ)

**âš ï¸ ì •ë³¸ ê·œì¹™:**
- ë°°ë„ˆëŠ” (1) ì¶”ì²œ í‘œì‹œ + (2) ì‚¬ìš©ì í´ë¦­ ì‹œ ì´ë™ë§Œ
- ì¹´ìš´íŠ¸ë‹¤ìš´/í”„ë¡ íŠ¸ì—”ë“œ ìë™ ì‹¤í–‰/ìë™ ìŠ¹ì¸ í‘œí˜„ì€ ì „ë¶€ ì‚­ì œ
- **ë°°ë„ˆëŠ” ì‚¬ìš©ì í´ë¦­ ì‹œì—ë§Œ ì´ë™í•œë‹¤. í”„ë¡ íŠ¸ì—”ë“œ ìë™ ì´ë™/ìë™ ì‹¤í–‰ì€ ì—†ë‹¤.**

**Props:**

```typescript
interface ContextRecommendationBannerProps {
  recommendation: ContextRecommendation;
  onNavigate: () => void; // ì •ë³¸: onExecute â†’ onNavigate (ì‹¤í–‰ ì•”ì‹œ ì œê±°)
  onDismiss: () => void;
}
```

**UI ë””ìì¸:**
- ìƒë‹¨ ê³ ì • ë°°ë„ˆ (sticky)
- ë°°ê²½ìƒ‰: `var(--color-info-light)`
- ì•„ì´ì½˜ + ë©”ì‹œì§€ + ì•¡ì…˜ ë²„íŠ¼
- ì‚¬ìš©ì í´ë¦­ ì‹œì—ë§Œ ì´ë™ (ìë™ ì´ë™ ì—†ìŒ)

---

## 2. TaskCard (task_type: 'ai_suggested' í¬í•¨, StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)

### 2.1 âŒ ì‚­ì œëœ ê°œë… (v2.x ë ˆê±°ì‹œ)

**âš ï¸ ì¤‘ìš”: "AI Suggestion" ìš©ì–´ëŠ” ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ. "TaskCard (task_type: 'ai_suggested', entity_type='student')"ë¡œ í†µì¼. "AI Suggestion"ì´ë¼ëŠ” ë…ë¦½ ê°œë…ì€ v3.3ì—ì„œ ì™„ì „íˆ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤. (StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)**

**ì‚­ì œëœ ê°œë…:**
- âŒ `ai_suggestions` ë…ë¦½ í…Œì´ë¸” (v2.x)
- âŒ "AI Suggestion" ë…ë¦½ ì„¹ì…˜ (v2.x)
- âŒ Suggestion ì „ìš© í™ˆ ì˜ì—­ (v2.x)
- âŒ ë…ë¦½ Hook `use-ai-suggestion` (v2.x)
- âŒ í”„ë¡ íŠ¸ì—”ë“œì—ì„œ TaskCard (task_type: 'ai_suggested', entity_type='student') ìƒì„± (v2.x)
- âŒ í”„ë¡ íŠ¸ì—”ë“œì—ì„œ TaskCard (task_type: 'ai_suggested', entity_type='student') ì‹¤í–‰ (v2.x)

**ì •ë³¸ ê·œì¹™ (v3.3):**
- âœ… TaskCard (task_type: 'ai_suggested', entity_type='student')ëŠ” **ì„œë²„/Edge Function**ì—ì„œ ìƒì„± (StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)
- âœ… `task_type: 'ai_suggested'`ë¡œ `task_cards`ì— ì €ì¥ (ì •ë³¸)
- âœ… í”„ë¡ íŠ¸ì—”ë“œëŠ” **ìŠ¹ì¸ ìš”ì²­ë§Œ** ì²˜ë¦¬
- âœ… ì‹¤í–‰ì€ **Edge Function**ì—ì„œ Role ê²€ì¦ í›„ ì²˜ë¦¬

**ìš©ì–´ í†µì¼:**
- âŒ "AI Suggestion" (v2.x ìš©ì–´, ì‚­ì œë¨)
- âœ… "TaskCard (task_type: 'ai_suggested', entity_type='student')" (ì •ë³¸)
- âœ… "StudentTaskCard"ëŠ” í•™ìƒìš© ë³„ì¹­ (= TaskCard where entity_type='student')

### 2.2 í†µí•© êµ¬ì¡° (ì •ë³¸)

**AI Suggestionì€ TaskCardì˜ í•œ íƒ€ì…ìœ¼ë¡œë§Œ ì¡´ì¬:**

```typescript
TaskCard {
  id
  tenant_id
  entity_id      // ì—…ì¢… ì¤‘ë¦½ ì—”í‹°í‹° ID (ì •ë³¸)
  entity_type    // ì—…ì¢… ì¤‘ë¦½ ì—”í‹°í‹° íƒ€ì… (ì •ë³¸, ì˜ˆ: 'student', 'client', 'customer')
  student_id     // ë ˆê±°ì‹œ í•„ë“œ (í•˜ìœ„ í˜¸í™˜ì„±, entity_type='student'ì¸ ê²½ìš° entity_idì™€ ë™ì¼)
  task_type: 'ai_suggested' | 'risk' | 'absence' | 'counseling' | 'new_signup'
  source?: 'attendance' | 'billing' | 'behavior' | 'weather' | 'proactive_analysis' // TaskCard (task_type: 'ai_suggested') ê·¼ê±° (ì„ íƒì )
  title
  description
  action_url
  suggested_action?: jsonb // ì•¡ì…˜ ì •ì˜ (ë©”ì‹œì§€ ì´ˆì•ˆ, ë¶„ì„ ìš”ì²­ ë“±, ì„ íƒì )
  priority: integer (0-100) // ì •ë³¸: 0-100 ìŠ¤ì¼€ì¼
  expires_at: timestamptz // TTL ë§Œë£Œ ì‹œì 
  dedup_key?: string // ì •ë³¸ í¬ë§·: "{tenantId}:{trigger}:{entityType}:{entityId}:{window}" (2.3 ì„¹ì…˜ ì°¸ì¡°, ì„ íƒì )
  status?: 'pending' | 'approved' | 'executed' | 'expired' // ìŠ¹ì¸ ìƒíƒœ (ì„ íƒì , ê¸°ë³¸ê°’: 'pending')
  metadata?: jsonb // TaskCard (task_type: 'ai_suggested') ê´€ë ¨ ì¶”ê°€ ë°ì´í„° (ì„ íƒì )
  created_at
  created_by
}

// í•™ìƒìš© ë³„ì¹­ (í•˜ìœ„ í˜¸í™˜ì„±)
StudentTaskCard = TaskCard where entity_type='student'
```

**âš ï¸ ì¤‘ìš”: ìŠ¤í‚¤ë§ˆ ìš”êµ¬ì‚¬í•­**

`task_cards` í…Œì´ë¸”ì— ë‹¤ìŒ ì»¬ëŸ¼ë“¤ì´ ì¶”ê°€ë¡œ í•„ìš”í•©ë‹ˆë‹¤ (ìŠ¤í‚¤ë§ˆ.txtì— ì—†ëŠ” ê²½ìš°):

**ì •ë³¸ ìŠ¤í‚¤ë§ˆ í™•ì¥ (í•„ìˆ˜):**

```sql
-- entity_id, entity_type ì»¬ëŸ¼ (ì—…ì¢… ì¤‘ë¦½, ì •ë³¸)
-- âš ï¸ ì¤‘ìš”: ë§ˆì´ê·¸ë ˆì´ì…˜ ìˆœì„œ (ê¸°ì¡´ ë°ì´í„°ê°€ ìˆìœ¼ë©´ NOT NULL ì¶”ê°€ ì‹œ ì‹¤íŒ¨)
-- 1. nullable ì»¬ëŸ¼ ì¶”ê°€
ALTER TABLE task_cards
ADD COLUMN IF NOT EXISTS entity_id UUID;
ALTER TABLE task_cards
ADD COLUMN IF NOT EXISTS entity_type TEXT DEFAULT 'student';

-- 2. ê¸°ì¡´ row backfill (entity_id = student_id ë“±)
UPDATE task_cards
SET entity_id = student_id, entity_type = 'student'
WHERE entity_id IS NULL;

-- 3. NOT NULL ì œì•½ ì¶”ê°€
ALTER TABLE task_cards
ALTER COLUMN entity_id SET NOT NULL;
ALTER TABLE task_cards
ALTER COLUMN entity_type SET NOT NULL;

-- source ì»¬ëŸ¼ (ì„ íƒì , TaskCard (task_type: 'ai_suggested') ê·¼ê±°)
ALTER TABLE task_cards
ADD COLUMN IF NOT EXISTS source TEXT;

-- suggested_action ì»¬ëŸ¼ (ì„ íƒì , ì•¡ì…˜ ì •ì˜)
ALTER TABLE task_cards
ADD COLUMN IF NOT EXISTS suggested_action JSONB;

-- status ì»¬ëŸ¼ (ì„ íƒì , ìŠ¹ì¸ ìƒíƒœ, ê¸°ë³¸ê°’: 'pending')
ALTER TABLE task_cards
ADD COLUMN IF NOT EXISTS status TEXT DEFAULT 'pending';
ALTER TABLE task_cards
ADD CONSTRAINT task_cards_status_check
CHECK (status IN ('pending', 'approved', 'executed', 'expired'));

-- dedup_key ì»¬ëŸ¼ (ì„ íƒì , ì¤‘ë³µ ë°©ì§€)
ALTER TABLE task_cards
ADD COLUMN IF NOT EXISTS dedup_key TEXT;

-- ì¶”ê°€ ê¶Œì¥ ì»¬ëŸ¼ (ê°ì‚¬/ì¶”ì ìš©)
ALTER TABLE task_cards
ADD COLUMN IF NOT EXISTS approved_by UUID REFERENCES auth.users(id);
ALTER TABLE task_cards
ADD COLUMN IF NOT EXISTS approved_at TIMESTAMPTZ;
ALTER TABLE task_cards
ADD COLUMN IF NOT EXISTS executed_at TIMESTAMPTZ;
ALTER TABLE task_cards
ADD COLUMN IF NOT EXISTS updated_at TIMESTAMPTZ DEFAULT now();
ALTER TABLE task_cards
ADD COLUMN IF NOT EXISTS rejected_reason TEXT;
ALTER TABLE task_cards
ADD COLUMN IF NOT EXISTS severity TEXT; -- 'low', 'medium', 'high', 'critical'
ALTER TABLE task_cards
ADD COLUMN IF NOT EXISTS confidence NUMERIC; -- AI ì‹ ë¢°ë„ (0-100)
```

**âš ï¸ ì¤‘ìš”: ìŠ¤í‚¤ë§ˆ.txtì— ìœ„ ì»¬ëŸ¼ë“¤ì´ ëˆ„ë½ë˜ì–´ ìˆìœ¼ë©´ ë°˜ë“œì‹œ ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤.**

**ğŸ’¡ AIì¸ì§€, ìˆ˜ë™ì¸ì§€ êµ¬ë¶„ë§Œ ìˆì„ ë¿**
**UXÂ·ì •ë ¬Â·ìˆ˜ëª… ê·œì¹™ì€ ì™„ì „íˆ ë™ì¼**

### 2.3 Dedup ê·œì¹™ (í•„ìˆ˜)

**âš ï¸ ì¤‘ìš”: ìŠ¤í‚¤ë§ˆ ìš”êµ¬ì‚¬í•­**

`task_cards` í…Œì´ë¸”ì— ë°˜ë“œì‹œ `dedup_key` ì»¬ëŸ¼ì´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤:

```sql
ALTER TABLE task_cards
ADD COLUMN IF NOT EXISTS dedup_key TEXT;

CREATE INDEX IF NOT EXISTS idx_task_cards_dedup_key
ON task_cards(tenant_id, dedup_key)
WHERE dedup_key IS NOT NULL;

-- ìœ ë‹ˆí¬ ì œì•½ì¡°ê±´ (í•„ìˆ˜, DB ë ˆë²¨ ì¤‘ë³µ ë°©ì§€)
-- âš ï¸ ì¤‘ìš”: ì´ ì œì•½ì¡°ê±´ì€ í”„ë¡ íŠ¸ ê·œì¹™ì´ ì•„ë‹Œ DB ê°•ì œ ê·œì¹™ìœ¼ë¡œ, ì¤‘ë³µ ì¹´ë“œ/ë ˆì´ìŠ¤ ì»¨ë””ì…˜ì„ ì›ì²œ ì°¨ë‹¨í•©ë‹ˆë‹¤.
-- âš ï¸ **SSOT: ìœ ë‹ˆí¬ ì¸ë±ìŠ¤ëŠ” (tenant_id, dedup_key)ë¡œ ê³ ì •**
-- âš ï¸ ì£¼ì˜: WHERE dedup_key IS NOT NULLì€ NULL ê°’ì€ ìœ ë‹ˆí¬ ì œì•½ì—ì„œ ì œì™¸í•˜ê¸° ìœ„í•œ ë¶€ë¶„ ì¸ë±ìŠ¤ ì¡°ê±´ì´ë©°, ìœ ë‹ˆí¬ ì¸ë±ìŠ¤ ìì²´ëŠ” (tenant_id, dedup_key)ë¡œ ê³ ì •
-- ì¬ìƒì„± í—ˆìš©ì´ í•„ìš”í•˜ë©´ dedup_keyì˜ windowë¥¼ ë°”ê¾¸ëŠ” ë°©ì‹ìœ¼ë¡œ í•´ê²° (ì˜ˆ: YYYY-MM-DD â†’ YYYY-MM-DD-HH)
CREATE UNIQUE INDEX IF NOT EXISTS ux_task_cards_dedup_key
ON task_cards(tenant_id, dedup_key)
WHERE dedup_key IS NOT NULL;

**âš ï¸ ì¤‘ìš”: ë©±ë“±ì„±/ì¤‘ë³µë°©ì§€ ê·œê²© (DB ì œì•½ ìŠ¹ê²©)**

TaskCard ìƒì„±ì€ ë°˜ë“œì‹œ UPSERTë¡œë§Œ ìˆ˜í–‰í•©ë‹ˆë‹¤.

**ì •ë³¸ ê·œì¹™:**
- âŒ INSERTë§Œ ì‚¬ìš© ê¸ˆì§€ (Race condition ë°œìƒ ê°€ëŠ¥)
- âœ… UPSERT (ON CONFLICT) í•„ìˆ˜ ì‚¬ìš©
- âœ… Supabase í´ë¼ì´ì–¸íŠ¸ `upsert({ onConflict: 'tenant_id,dedup_key' })` ì§ì ‘ ì‚¬ìš© ê°€ëŠ¥
- âœ… ê¸°ì¡´ ì¹´ë“œ ì¡´ì¬ ì‹œ UPDATEëŠ” ì½”ë“œ ê´€ë¡€ê°€ ì•„ë‹Œ DB ì œì•½ìœ¼ë¡œ ê°•ì œ
- âœ… ë™ì‹œì— ë‘ ê°œ ìƒì„± ì‹œë„í•´ë„ êµ¬ì¡°ì ìœ¼ë¡œ í•˜ë‚˜ë§Œ ìƒì„±ë¨
- âœ… ì¬ìƒì„± í—ˆìš©ì´ í•„ìš”í•˜ë©´ `dedup_key`ì˜ `window`ë¥¼ ë³€ê²½ (ì˜ˆ: `YYYY-MM-DD` â†’ `YYYY-MM-DD-HH`)

-- TTL ë§Œë£Œ ì •ì˜ (ì •ë³¸)
-- âš ï¸ ì¤‘ìš”: TTL ë§Œë£ŒëŠ” ë°°ì¹˜/Edge Functionì´ ì²˜ë¦¬í•˜ë˜, ë§Œë£Œ ê¸°ì¤€ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:
-- - ì‹œê°„ ê¸°ì¤€: expires_at < NOW()
-- - ìƒíƒœ ê¸°ì¤€: status = 'pending' (ë§Œë£Œëœ ì¹´ë“œëŠ” ìë™ìœ¼ë¡œ 'expired' ìƒíƒœë¡œ ë³€ê²½ ë˜ëŠ” ì‚­ì œ)
```

**ì •ë³¸ í¬ë§· (í†µì¼):**

```typescript
dedup_key = "{tenantId}:{trigger}:{entityType}:{entityId}:{window}"
```

**êµ¬ì„± ìš”ì†Œ:**
- `tenantId`: í…Œë„ŒíŠ¸ ID
- `trigger`: íŠ¸ë¦¬ê±° íƒ€ì… (ì˜ˆ: 'ai_suggested', 'absence', 'weather')
- `entityType`: ì—”í‹°í‹° íƒ€ì… (ì—…ì¢… ì¤‘ë¦½, ì˜ˆ: 'student', 'client', 'customer')
- `entityId`: ì—”í‹°í‹° ID (ì—…ì¢… ì¤‘ë¦½, ì˜ˆ: student_id, client_id)
- `window`: ì‹œê°„ ìœˆë„ìš° (ì˜ˆ: 'YYYY-MM-DD' í˜•ì‹ ë‚ ì§œ)

**ì˜ˆì‹œ:**
- ê²°ì„ 3ì¼: `${tenantId}:absence:student:${student_id}:${toKST().format('YYYY-MM-DD')}`
- ë‚ ì”¨ ê¸°ë°˜ (tenant ì „ì²´ ì ìš©): `${tenantId}:weather_alert:tenant:global:${toKST().format('YYYY-MM-DD')}` (entityType='tenant'ì¼ ë•Œ entityIdëŠ” ê³ ì • í† í° 'global' ì‚¬ìš©)
- ê²°ì„ 3ì¼ â†’ í•™ìƒë‹¹ 1ê°œ (ë™ì¼ ë‚ ì§œ)
- ê¸°ì¡´ ì¹´ë“œ ì¡´ì¬ ì‹œ â†’ UPDATE
- TTL ê¸°ë³¸: 7ì¼ (expires_at ê¸°ì¤€)
- ë§Œë£Œ ì²˜ë¦¬: ë°°ì¹˜/Edge Functionì´ ë§¤ì¼ ì‹¤í–‰í•˜ì—¬ expires_at < NOW()ì¸ ì¹´ë“œë¥¼ 'expired' ìƒíƒœë¡œ ë³€ê²½ ë˜ëŠ” ì‚­ì œ

### 2.4 ìŠ¹ì¸ â†’ ì‹¤í–‰ íë¦„ (Zero-Trust)

#### 2.4.1 í”„ë¡ íŠ¸ì—”ë“œ (ì •ë³¸ ì—­í• )

**í”„ë¡ íŠ¸ì—”ë“œëŠ” ë‹¤ìŒë§Œ ìˆ˜í–‰:**

**âš ï¸ ì¤‘ìš”: Roleë³„ API ë¶„ë¦¬ (ì •ë³¸)**

| Role | Edge Function í˜¸ì¶œ | ì˜ë¯¸ |
|------|-------------------|------|
| **Teacher** | `apiClient.invokeFunction('execute-student-task', { action: 'request-approval', task_id: id })` (ì •ë³¸) | ìŠ¹ì¸ ìš”ì²­ë§Œ (ì‹¤í–‰ ì•ˆ í•¨, ìš”ì²­ë§Œ ê¸°ë¡) |
| **Admin** | `apiClient.invokeFunction('execute-student-task', { action: 'approve-and-execute', task_id: id })` (SSOT, ì •ë³¸) | ìŠ¹ì¸(=ì‹¤í–‰ íŠ¸ë¦¬ê±°), Role ê²€ì¦ í›„ ì‹¤í–‰ |
| **Admin** | `apiClient.invokeFunction('execute-student-task', { action: 'approve', task_id: id })` (âš ï¸ ë ˆê±°ì‹œ alias, ì¼ëª° ì˜ˆì •) | approve-and-executeì˜ ë ˆê±°ì‹œ í˜¸í™˜ ì—”ë“œí¬ì¸íŠ¸ |

âš ï¸ ì¤‘ìš”: ìŠ¹ì¸/ì‹¤í–‰ ê¶Œí•œ íŒë‹¨ì€ DB ê¸°ë°˜(RBAC í…Œì´ë¸”: user_tenant_roles, user_platform_roles) + RLSë¥¼ ë‹¨ì¼ ì§„ì‹¤ ì›ì²œ(SSOT)ìœ¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.
JWTì˜ role claimì€ í‘œì‹œ/ìºì‹œ ëª©ì ìœ¼ë¡œë§Œ ì‚¬ìš©í•˜ê±°ë‚˜ ì™„ì „ ì œê±°í•©ë‹ˆë‹¤.

**ì •ë³¸ ê·œì¹™:**
- âŒ ì‹¤í–‰ ê¸ˆì§€
- âŒ ê¶Œí•œ íŒë‹¨ ê¸ˆì§€
- âŒ ì•¡ì…˜ ì‹¤í–‰ ê¸ˆì§€
- âœ… ìŠ¹ì¸ ìš”ì²­ë§Œ í—ˆìš© (Teacher)
- âœ… ìŠ¹ì¸(=ì‹¤í–‰ íŠ¸ë¦¬ê±°) í—ˆìš© (Admin)

**ìš©ì–´ ì •ì •:**
- âŒ "í”„ë¡ íŠ¸ì—”ë“œê°€ ìŠ¹ì¸í•œë‹¤" (ì˜¤í•´ í‘œí˜„)
- âœ… "í”„ë¡ íŠ¸ì—”ë“œê°€ ìŠ¹ì¸ ìš”ì²­ì„ ë³´ë‚¸ë‹¤" (Teacher)
- âœ… "í”„ë¡ íŠ¸ì—”ë“œê°€ ìŠ¹ì¸(=ì‹¤í–‰ íŠ¸ë¦¬ê±°)ì„ ë³´ë‚¸ë‹¤" (Admin)

**âš ï¸ ì—”ë“œí¬ì¸íŠ¸ SSOT:**
- `approve-and-execute`ê°€ ì •ë³¸(SSOT) ì—”ë“œí¬ì¸íŠ¸ì…ë‹ˆë‹¤.
- `approve`ëŠ” ë ˆê±°ì‹œ aliasì´ë©°, ì¼ëª° ì˜ˆì •ì…ë‹ˆë‹¤. ì‹ ê·œ ì½”ë“œëŠ” ë°˜ë“œì‹œ `approve-and-execute`ë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.
- Edge Functionì—ì„œëŠ” ë ˆê±°ì‹œ í˜¸í™˜ì„ ìœ„í•´ `approve`ë„ ì²˜ë¦¬í•˜ë˜, ë‚´ë¶€ì ìœ¼ë¡œëŠ” `approve-and-execute`ì™€ ë™ì¼í•˜ê²Œ ë™ì‘í•©ë‹ˆë‹¤.

#### 2.4.2 Edge Function (ì •ë³¸ ì‹¤í–‰ ì£¼ì²´)

**ì‹¤í–‰ì€ Edge Functionì—ì„œë§Œ:**

**âš ï¸ ì¤‘ìš”: Roleë³„ ì²˜ë¦¬ ë¶„ë¦¬**

```typescript
// Edge Function: /functions/execute-student-task

// Teacherì˜ request-approval: ìš”ì²­ë§Œ ê¸°ë¡, ì‹¤í–‰ ì•ˆ í•¨
if (action === 'request-approval') {
  await logApprovalRequest(taskId, userId);
  return { status: 'requested', message: 'ìŠ¹ì¸ ìš”ì²­ì´ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.' };
}

// Adminì˜ approve-and-execute: Role ê²€ì¦ í›„ ì‹¤í–‰ (SSOT)
if (action === 'approve-and-execute' || action === 'approve') { // âš ï¸ approveëŠ” ë ˆê±°ì‹œ alias (ì¼ëª° ì˜ˆì •), approve-and-executeê°€ SSOT
  if (!hasRole(user, 'admin')) {
    throw new Forbidden('Admin ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.');
  }
  executeAction(task);
  logAutomationAction();
  return { status: 'executed' };
}
```

**ì •ë³¸ ê·œì¹™:**
- âœ… Role ê²€ì¦ í•„ìˆ˜ (ì„œë²„ì—ì„œë§Œ)
- âœ… TeacherëŠ” ìš”ì²­ë§Œ ê¸°ë¡, ì‹¤í–‰ ì•ˆ í•¨
- âœ… Adminë§Œ ì‹¤í–‰ ê°€ëŠ¥
- âœ… ì‹¤í–‰ ë¡œê·¸ í•„ìˆ˜ (automation_actions í…Œì´ë¸”)
- âœ… í”„ë¡ íŠ¸ì—”ë“œëŠ” ì‹¤í–‰í•˜ì§€ ì•ŠìŒ

### 2.5 ìë™í™” ë¡œê·¸ ë° ì•ˆì „ì„± ë©”ì»¤ë‹ˆì¦˜ (í•„ìˆ˜)

#### 2.5.1 ìë™í™” ì‹¤í–‰ ë¡œê·¸ (í•„ìˆ˜)

**âš ï¸ ì¤‘ìš”: ìŠ¤í‚¤ë§ˆ ìš”êµ¬ì‚¬í•­**

ë‹¤ìŒ í…Œì´ë¸”ë“¤ì´ ë°˜ë“œì‹œ ìƒì„±ë˜ì–´ì•¼ í•©ë‹ˆë‹¤ (ìŠ¤í‚¤ë§ˆ.txtì— ì—†ëŠ” ê²½ìš°):

âš ï¸ ì°¸ê³ : ê³µì‹ ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ì€ `infra/supabase/migrations/` ë””ë ‰í† ë¦¬ì— ìƒì„±ë˜ì–´ì•¼ í•˜ë©°, ê¸°ìˆ ë¬¸ì„œ PART 1ì˜ 3-1 ì„¹ì…˜ì„ ì°¸ì¡°í•˜ì„¸ìš”. ìŠ¤í‚¤ë§ˆ.txtëŠ” DDL ìŠ¤ëƒ…ìƒ·ì´ë©°, ì‹¤ì œ ìš´ì˜ì€ ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ì„ í†µí•´ ê´€ë¦¬ë©ë‹ˆë‹¤.

```sql
-- ìë™í™” ì‹¤í–‰ ë¡œê·¸ í…Œì´ë¸”
CREATE TABLE IF NOT EXISTS automation_actions (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  task_id uuid REFERENCES task_cards(id),
  action_type text NOT NULL,
  executed_by uuid,
  executed_at timestamptz DEFAULT now(),
  result jsonb,
  tenant_id uuid NOT NULL REFERENCES tenants(id) ON DELETE CASCADE,
  -- âš ï¸ ê°ì‚¬/ì¶”ì  í•„ìˆ˜ í•„ë“œ (í‘œì¤€í™”, 14.2 ì„¹ì…˜ ì°¸ì¡°)
  trace_id text,              -- ìš”ì²­ ì¶”ì  ID (ë¶„ì‚° ì¶”ì ìš©)
  request_id text,            -- ìš”ì²­ ID (ë©±ë“±ì„±/ì¬ì‹œë„ ì¶”ì ìš©)
  policy_version text,        -- RLS ì •ì±… ë²„ì „ (ë³´ì•ˆ ê°ì‚¬ìš©)
  rule_id text,               -- ì‹¤í–‰ëœ ê·œì¹™ ID (ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì¶”ì ìš©)
  dedup_key text,             -- ì¤‘ë³µ ë°©ì§€ í‚¤ (ë©±ë“±ì„± ê²€ì¦ìš©)
  approved_by uuid,           -- ìŠ¹ì¸ì ID (Teacherì˜ request-approvalì¸ ê²½ìš°)
  approved_at timestamptz,    -- ìŠ¹ì¸ ì‹œê°
  executor_role text,         -- ì‹¤í–‰ì ì—­í•  (SSOT: 'owner'|'admin'|'teacher'|'assistant', ê°ì‚¬ìš©)
  -- âš ï¸ ì¤‘ìš”: executor_role ì €ì¥ê°’ SSOTëŠ” 'owner'|'admin'|'teacher'|'assistant'ë¡œ ê³ ì •
  -- UI í‘œê¸°(ë¼ë²¨)ì™€ DB role key(ì €ì¥ê°’)ëŠ” ë¶„ë¦¬: UIëŠ” "ê°•ì‚¬"ë¡œ í‘œì‹œí•˜ë”ë¼ë„ DBì—ëŠ” 'teacher' ì €ì¥
  execution_context jsonb     -- ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ (ì¶”ê°€ ë©”íƒ€ë°ì´í„°)
);

-- AI íŒë‹¨ ë¡œê·¸ í…Œì´ë¸”
CREATE TABLE IF NOT EXISTS ai_decision_logs (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  model text NOT NULL,
  features jsonb,
  score numeric,
  reason text,
  created_at timestamptz DEFAULT now(),
  tenant_id uuid NOT NULL REFERENCES tenants(id) ON DELETE CASCADE,
  skipped_by_flag boolean DEFAULT false -- AI ê¸°ëŠ¥ì´ êº¼ì ¸ ìˆì–´ ìŠ¤í‚µëœ ê²½ìš° (ìŠ¤í‚¤ë§ˆ.txt SSOT ì°¸ì¡°)
);

CREATE INDEX IF NOT EXISTS idx_automation_actions_tenant_date
ON automation_actions(tenant_id, executed_at DESC);
CREATE INDEX IF NOT EXISTS idx_ai_decision_logs_tenant_date
ON ai_decision_logs(tenant_id, created_at DESC);
```

**âš ï¸ ì´ ë¡œê·¸ ì—†ìœ¼ë©´ Zero-Management ì•„í‚¤í…ì²˜ ìœ„ë°˜**

**âš ï¸ ì¤‘ìš”: ê°ì‚¬/ì¶”ì  í•„ìˆ˜ í•„ë“œ í‘œì¤€í™”**

automation_actions í…Œì´ë¸”ì—ëŠ” ë‹¤ìŒ í•„ë“œë“¤ì´ í•„ìˆ˜ë¡œ í¬í•¨ë˜ì–´ì•¼ í•©ë‹ˆë‹¤ (ì‚¬ê±´ ì¬í˜„ ë° ë¶„ìŸ ëŒ€ì‘ìš©):

```sql
CREATE TABLE IF NOT EXISTS automation_actions (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  task_id uuid REFERENCES task_cards(id),
  action_type text NOT NULL,
  executed_by uuid,
  executed_at timestamptz DEFAULT now(),
  result jsonb,
  tenant_id uuid NOT NULL REFERENCES tenants(id) ON DELETE CASCADE,
  -- âš ï¸ ê°ì‚¬/ì¶”ì  í•„ìˆ˜ í•„ë“œ (í‘œì¤€í™”)
  trace_id text,              -- ìš”ì²­ ì¶”ì  ID (ë¶„ì‚° ì¶”ì ìš©)
  request_id text,            -- ìš”ì²­ ID (ë©±ë“±ì„±/ì¬ì‹œë„ ì¶”ì ìš©)
  policy_version text,        -- RLS ì •ì±… ë²„ì „ (ë³´ì•ˆ ê°ì‚¬ìš©)
  rule_id text,               -- ì‹¤í–‰ëœ ê·œì¹™ ID (ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì¶”ì ìš©)
  dedup_key text,             -- ì¤‘ë³µ ë°©ì§€ í‚¤ (ë©±ë“±ì„± ê²€ì¦ìš©)
  approved_by uuid,           -- ìŠ¹ì¸ì ID (Teacherì˜ request-approvalì¸ ê²½ìš°)
  approved_at timestamptz,    -- ìŠ¹ì¸ ì‹œê°
  executor_role text,         -- ì‹¤í–‰ì ì—­í•  (SSOT: 'owner'|'admin'|'teacher'|'assistant', ê°ì‚¬ìš©)
  -- âš ï¸ ì¤‘ìš”: executor_role ì €ì¥ê°’ SSOTëŠ” 'owner'|'admin'|'teacher'|'assistant'ë¡œ ê³ ì •
  -- UI í‘œê¸°(ë¼ë²¨)ì™€ DB role key(ì €ì¥ê°’)ëŠ” ë¶„ë¦¬: UIëŠ” "ê°•ì‚¬"ë¡œ í‘œì‹œí•˜ë”ë¼ë„ DBì—ëŠ” 'teacher' ì €ì¥
  execution_context jsonb     -- ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ (ì¶”ê°€ ë©”íƒ€ë°ì´í„°)
);
```

âš ï¸ ì°¸ê³ : ì´ í•„ë“œë“¤ì€ ë‚˜ì¤‘ì— ì‚¬ê±´ ì¬í˜„ ë° ë¶„ìŸ ëŒ€ì‘ ì‹œ í•„ìˆ˜ì ì…ë‹ˆë‹¤. ìµœì†Œí•œ trace_id, request_id, approved_by, executor_roleì€ ë°˜ë“œì‹œ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.

**âš ï¸ ì¤‘ìš”: ìŠ¤í‚¤ë§ˆ ìš”êµ¬ì‚¬í•­ - Audit/Rollback í…Œì´ë¸”**

ë‹¤ìŒ í…Œì´ë¸”ë“¤ì´ ë°˜ë“œì‹œ ìƒì„±ë˜ì–´ì•¼ í•©ë‹ˆë‹¤ (ìŠ¤í‚¤ë§ˆ.txtì— ì—†ëŠ” ê²½ìš°):

```sql
-- ìë™í™” Undo ë¡œê·¸ í…Œì´ë¸” (ê°ì‚¬/ë¡¤ë°±ìš©)
CREATE TABLE IF NOT EXISTS automation_undo_logs (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  action_id uuid NOT NULL REFERENCES automation_actions(id),
  user_id uuid NOT NULL REFERENCES auth.users(id),
  tenant_id uuid NOT NULL REFERENCES tenants(id) ON DELETE CASCADE,
  reason text NOT NULL,
  before_state jsonb NOT NULL,  -- ë³€ê²½ ì „ ì „ì²´ ìƒíƒœ (snapshot)
  after_state jsonb NOT NULL,   -- ë³€ê²½ í›„ ì „ì²´ ìƒíƒœ (snapshot)
  reversible boolean NOT NULL DEFAULT true,  -- Undo ê°€ëŠ¥ ì—¬ë¶€ í”Œë˜ê·¸
  original_action_type text NOT NULL,  -- ì›ë³¸ ì•¡ì…˜ íƒ€ì…
  original_entity_type text NOT NULL,  -- ì›ë³¸ ì—”í‹°í‹° íƒ€ì…
  original_entity_id uuid NOT NULL,    -- ì›ë³¸ ì—”í‹°í‹° ID
  undo_status text NOT NULL,
  comment text,
  created_at timestamptz NOT NULL DEFAULT now()
);

CREATE INDEX IF NOT EXISTS idx_automation_undo_logs_tenant_date
ON automation_undo_logs(tenant_id, created_at DESC);
CREATE INDEX IF NOT EXISTS idx_automation_undo_logs_action
ON automation_undo_logs(action_id);
```

**âš ï¸ ì¤‘ìš”: ìŠ¤í‚¤ë§ˆ ì •ë³¸(SSOT) ê·œì¹™:**

ìë™í™” ê´€ë ¨ í•„ìˆ˜ í…Œì´ë¸”(automation_actions, automation_undo_logs, automation_safety_state, ai_decision_logs)ì€ ë‹¤ìŒ ì¤‘ í•˜ë‚˜ì˜ ë°©ì‹ìœ¼ë¡œ ê´€ë¦¬ë©ë‹ˆë‹¤:

1. **ìŠ¤í‚¤ë§ˆ.txtì— í¬í•¨**: DDL ìŠ¤ëƒ…ìƒ·ì— í¬í•¨ë˜ì–´ ìˆìœ¼ë©´ í•´ë‹¹ ì •ì˜ë¥¼ SSOTë¡œ ì‚¬ìš©
2. **ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ì°¸ì¡°**: ìŠ¤í‚¤ë§ˆ.txtì— ì—†ìœ¼ë©´ `infra/supabase/migrations/` ë””ë ‰í† ë¦¬ì˜ ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ì„ SSOTë¡œ ì‚¬ìš©
3. **í”„ë¡ íŠ¸ ìƒí™© ì‹ í˜¸ ìˆ˜ì§‘ ë¬¸ì„œ DDL**: ìœ„ ë‘ ê³³ì— ëª¨ë‘ ì—†ìœ¼ë©´ ë³¸ ë¬¸ì„œì˜ DDLì„ SSOTë¡œ ì‚¬ìš©

âš ï¸ ì°¸ê³ : ìŠ¤í‚¤ë§ˆ.txtëŠ” DDL ìŠ¤ëƒ…ìƒ·ì´ë©°, ì‹¤ì œ ìš´ì˜ì€ ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ì„ í†µí•´ ê´€ë¦¬ë©ë‹ˆë‹¤. ìŠ¤í‚¤ë§ˆ.txtì— ì—†ì–´ë„ ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ì— ìˆìœ¼ë©´ ì •ìƒì…ë‹ˆë‹¤.

**TTL/ì•„ì¹´ì´ë¸Œ ì •ì±…:**

automation_actions, automation_safety_state, ai_decision_logsëŠ” ë‹¤ìŒ TTL ì •ì±…ì„ ë”°ë¦…ë‹ˆë‹¤:

- **ë³´ê´€ ê¸°ê°„**: 90ì¼ (executed_at/created_at ê¸°ì¤€)
- **ì•„ì¹´ì´ë¸Œ**: 90ì¼ ê²½ê³¼ í›„ ìë™ ì•„ì¹´ì´ë¸Œ í…Œì´ë¸”ë¡œ ì´ë™ ë˜ëŠ” ì‚­ì œ
- **ì¸ë±ìŠ¤**: (tenant_id, executed_at DESC, action_type, status) ë³µí•© ì¸ë±ìŠ¤ í•„ìˆ˜
- **ì°¸ê³ **: ì „ì²´ ê¸°ìˆ ë¬¸ì„œ PARTì˜ TTL í‘œì— í¬í•¨ë¨ (37. í…Œì´ë¸”ë³„ TTL ì •ì±… ì„¹ì…˜)

#### 2.5.2 ì •ì±… ê¸°ë°˜ ìë™í™” ì•ˆì „ì„± ë©”ì»¤ë‹ˆì¦˜ (Self-Regulation) - í•„ìˆ˜

**âš ï¸ ì¤‘ìš”: ìë™í™”ê°€ ê³¼ë„í•´ì§ˆ ë•Œ ìŠ¤ìŠ¤ë¡œ ë©ˆì¶”ëŠ” ì¥ì¹˜ê°€ ì—†ìœ¼ë©´ Zero-Managementê°€ "í­ì£¼ ìë™í™”"ë¡œ ì˜¤í•´ë°›ìŠµë‹ˆë‹¤.**

**ëª©ì :**
- ìë™í™” ê³¼ë„ ì‹¤í–‰ ë°©ì§€
- í…Œë„ŒíŠ¸ë³„ ìë™í™” ì•ˆì „ì„± ë³´ì¥
- ìš´ì˜ ì•ˆì •ì„± í•„ìˆ˜ ì¥ì¹˜

**âš ï¸ ì¤‘ìš”: ìŠ¤í‚¤ë§ˆ ìš”êµ¬ì‚¬í•­**

ë‹¤ìŒ í…Œì´ë¸”ì´ ë°˜ë“œì‹œ ìƒì„±ë˜ì–´ì•¼ í•©ë‹ˆë‹¤ (ìŠ¤í‚¤ë§ˆ.txtì— ì—†ëŠ” ê²½ìš°):

**ìŠ¤í‚¤ë§ˆ:**

```sql
CREATE TABLE IF NOT EXISTS automation_safety_state (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL REFERENCES tenants(id) ON DELETE CASCADE,
  action_type text NOT NULL, -- 'send_message', 'create_task', 'generate_billing' ë“±
  window_start timestamptz NOT NULL, -- ì‹œê°„ ìœˆë„ìš° ì‹œì‘ (ì˜ˆ: ì˜¤ëŠ˜ 00:00 KST)
  window_end timestamptz NOT NULL, -- ì‹œê°„ ìœˆë„ìš° ì¢…ë£Œ (ì˜ˆ: ì˜¤ëŠ˜ 23:59 KST)
  executed_count integer DEFAULT 0, -- í˜„ì¬ ìœˆë„ìš°ì—ì„œ ì‹¤í–‰ëœ íšŸìˆ˜
  max_allowed integer NOT NULL, -- ìµœëŒ€ í—ˆìš© íšŸìˆ˜
  state text NOT NULL DEFAULT 'normal', -- 'normal' | 'throttled' | 'paused'
  last_reset_at timestamptz DEFAULT now(),
  created_at timestamptz DEFAULT now(),
  updated_at timestamptz DEFAULT now(),
  CONSTRAINT automation_safety_state_state_check CHECK (state IN ('normal', 'throttled', 'paused'))
);

CREATE INDEX idx_automation_safety_tenant_action ON automation_safety_state(tenant_id, action_type, window_start);
```

**ì‚¬ìš© ì˜ˆì‹œ:**

```typescript
// Edge Functionì—ì„œ ì •ì±… ì¡°íšŒ ë° ì•ˆì „ì„± ì²´í¬ (Policy ê¸°ë°˜)
async function checkAutomationSafety(tenantId: string, actionType: string): Promise<boolean> {
  const todayStart = toKST().startOf('day').toISOString();
  const todayEnd = toKST().endOf('day').toISOString();

  const safetyState = await supabase
    .from('automation_safety_state')
    .select('*')
    .eq('tenant_id', tenantId)
    .eq('action_type', actionType)
    .gte('window_start', todayStart)
    .lte('window_end', todayEnd)
    .single();

  if (!safetyState.data) {
    // ì´ˆê¸° ìƒíƒœ ìƒì„±
    await supabase.from('automation_safety_state').insert({
      tenant_id: tenantId,
      action_type: actionType,
      window_start: todayStart,
      window_end: todayEnd,
      max_allowed: getMaxAllowedForAction(actionType), // ì˜ˆ: ë©”ì‹œì§€ 20ê±´, Task 50ê±´
      state: 'normal',
    });
    return true;
  }

  // ìƒíƒœ ì²´í¬
  if (safetyState.data.state === 'paused') {
    return false; // ì‹¤í–‰ ì¤‘ì§€
  }

  if (safetyState.data.executed_count >= safetyState.data.max_allowed) {
    // ìƒíƒœë¥¼ pausedë¡œ ë³€ê²½
    await supabase
      .from('automation_safety_state')
      .update({ state: 'paused' })
      .eq('id', safetyState.data.id);
    return false;
  }

  // ì‹¤í–‰ ì¹´ìš´íŠ¸ ì¦ê°€
  await supabase
    .from('automation_safety_state')
    .update({
      executed_count: safetyState.data.executed_count + 1,
      updated_at: new Date().toISOString()
    })
    .eq('id', safetyState.data.id);

  return true;
}
```

**Default Policy ì œí•œê°’ (ì„¤ì •ê°’ìœ¼ë¡œ ì €ì¥):**
- í•˜ë£¨ í•™ë¶€ëª¨ ë©”ì‹œì§€ ìë™ ë°œì†¡: `auto_notification.attendance_pattern_anomaly.throttle.daily_limit` (SSOT ê²½ë¡œ, Default Policy: í…Œë„ŒíŠ¸ ìƒì„± ì‹œ 20ê±´ìœ¼ë¡œ ì„¤ì •ê°’ ì €ì¥ (ì—†ìœ¼ë©´ ì‹¤í–‰ ì•ˆ í•¨))
  - **ë ˆê±°ì‹œ fallback**: ì‹ ê·œ ê²½ë¡œê°€ ì—†ê³  ê¸°ì¡´ ê°’ì´ ìˆì„ ë•Œë§Œ `auto_message_suggestion.daily_limit` ê²½ë¡œë¡œ ì œí•œì  fallback (ì½ê¸°ë§Œ í—ˆìš©, ì“°ê¸° ê¸ˆì§€, ì €ì¥ ìœ„ì¹˜ëŠ” tenant_settings(key='config').value(JSONB))
- ë™ì¼ í•™ìƒ ê´€ë ¨ Task ì—°ì† ìƒì„±: `auto_notification.attendance_pattern_anomaly.throttle.student_limit` (SSOT ê²½ë¡œ, Default Policy: í…Œë„ŒíŠ¸ ìƒì„± ì‹œ 5íšŒë¡œ ì„¤ì •ê°’ ì €ì¥ (ì—†ìœ¼ë©´ ì‹¤í–‰ ì•ˆ í•¨))
  - **ë ˆê±°ì‹œ fallback**: ì‹ ê·œ ê²½ë¡œê°€ ì—†ê³  ê¸°ì¡´ ê°’ì´ ìˆì„ ë•Œë§Œ `auto_task_generation.student_limit` ê²½ë¡œë¡œ ì œí•œì  fallback (ì½ê¸°ë§Œ í—ˆìš©, ì“°ê¸° ê¸ˆì§€, ì €ì¥ ìœ„ì¹˜ëŠ” tenant_settings(key='config').value(JSONB))
- ì¼ì¼ ì²­êµ¬ì„œ ìƒì„±: `billing.auto_generation.throttle.daily_limit` (SSOT ê²½ë¡œ, Default Policy: í…Œë„ŒíŠ¸ ìƒì„± ì‹œ 1ê±´ìœ¼ë¡œ ì„¤ì •ê°’ ì €ì¥ (ì—†ìœ¼ë©´ ì‹¤í–‰ ì•ˆ í•¨), ì›” 1íšŒ ë°°ì¹˜, ì €ì¥ ìœ„ì¹˜ëŠ” tenant_settings(key='config').value(JSONB))
  - **ë ˆê±°ì‹œ fallback**: ì‹ ê·œ ê²½ë¡œê°€ ì—†ê³  ê¸°ì¡´ ê°’ì´ ìˆì„ ë•Œë§Œ `auto_billing.daily_limit` ê²½ë¡œë¡œ ì œí•œì  fallback (ì½ê¸°ë§Œ í—ˆìš©, ì“°ê¸° ê¸ˆì§€, ì €ì¥ ìœ„ì¹˜ëŠ” tenant_settings(key='config').value(JSONB))

**âš ï¸ ì¤‘ìš”:**
- ëª¨ë“  ì œí•œê°’ì€ Policyë¡œ ê´€ë¦¬ë˜ë©°, ì½”ë“œì— í•˜ë“œì½”ë”©ë˜ì§€ ì•ŠìŒ
- í…Œë„ŒíŠ¸ ìƒì„± ì‹œ Default Policyê°€ ì„¤ì •ê°’ìœ¼ë¡œ ì €ì¥ë¨

**âš ï¸ ì¤‘ìš”:**
- ì´ ë©”ì»¤ë‹ˆì¦˜ ì—†ìœ¼ë©´ Zero-Managementê°€ "í­ì£¼ ìë™í™”"ë¡œ ì˜¤í•´ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤
- ëª¨ë“  Edge Functionì€ ì •ì±… ì¡°íšŒ ë° í•´ì„ í›„ ì‹¤í–‰ ì „ ë°˜ë“œì‹œ ì´ ì²´í¬ë¥¼ ìˆ˜í–‰í•´ì•¼ í•©ë‹ˆë‹¤

---

### 2.6 TaskCard ìƒì„± ë¡œì§ (task_type: 'ai_suggested' í¬í•¨, StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)

#### 2.6.1 Edge Function: TaskCard ìƒì„± (task_type: 'ai_suggested' í¬í•¨, StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)

**ìœ„ì¹˜:** `infra/supabase/functions/student-task-card-generation/index.ts` (ê¸°ì¡´ í•¨ìˆ˜ í™•ì¥)

**ê¸°ëŠ¥:**
- í•™ìƒ ì¶œê²° íŒ¨í„´ ë¶„ì„
- ì„œë²„ê°€ ë©”ì‹œì§€ ì´ˆì•ˆ ìƒì„± (AI í˜¸ì¶œ í¬í•¨)
- TaskCard ìƒì„± (`task_type: 'ai_suggested'`, entity_type='student', StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)

**ì •ë³¸ êµ¬í˜„:**

```typescript
serve(async (req) => {
  // 1. Policy ì¡°íšŒ ë° í•´ì„
  const absenceThresholdPolicy = await getTenantSettingByPath(supabase, tenantId, 'attendance.absence_threshold_days');
  if (!absenceThresholdPolicy) {
    // Policyê°€ ì—†ìœ¼ë©´ ì‹¤í–‰í•˜ì§€ ì•ŠìŒ (Fail Closed)
    return;
  }
  const thresholdDays = typeof absenceThresholdPolicy === 'number' ? absenceThresholdPolicy : 0; // Default Policy: 3ì¼ (í…Œë„ŒíŠ¸ ìƒì„± ì‹œ ì„¤ì •ê°’ìœ¼ë¡œ ì €ì¥) - ì„œë²„/Edge Functionì€ T | null ì§ì ‘ ë°˜í™˜, .value ì ‘ê·¼ ë¶ˆí•„ìš”

  // 2. ê²°ì„ ì„ê³„ê°’ ì´ìƒ í•™ìƒ ê°ì§€ (Trigger)
  // âš ï¸ ì£¼ì˜: .group(), .having()ì€ Supabase JS SDKì—ì„œ ì§ì ‘ ì§€ì›í•˜ì§€ ì•ŠìŒ
  // RPC í•¨ìˆ˜ ë˜ëŠ” SQL Viewë¡œ ì§‘ê³„ í•„ìš”

  // âš ï¸ ì¤‘ìš”: RPC í•¨ìˆ˜ê°€ ì—†ìœ¼ë©´ ë¨¼ì € ìƒì„±í•´ì•¼ í•¨
  // CREATE OR REPLACE FUNCTION find_absent_students_3days(p_tenant_id uuid, p_days_ago integer)
  // RETURNS TABLE(student_id uuid, absent_count bigint) AS $$
  // BEGIN
  //   RETURN QUERY
  //   SELECT al.student_id, COUNT(*)::bigint as absent_count
  //   FROM attendance_logs al
  //   WHERE al.tenant_id = p_tenant_id
  //     AND al.status = 'absent'
  //     AND al.occurred_at >= NOW() - (p_days_ago || ' days')::interval
  //   GROUP BY al.student_id
  //   HAVING COUNT(*) >= p_days_ago;
  // END;
  // $$ LANGUAGE plpgsql SECURITY DEFINER;

  const absentStudents = await supabase.rpc('find_absent_students_3days', {
    p_tenant_id: tenantId,
    p_days_ago: thresholdDays, // Policyì—ì„œ ì¡°íšŒí•œ ê°’ ì‚¬ìš© (í•˜ë“œì½”ë”© ê¸ˆì§€)
  });

  // ë˜ëŠ” SQL View ì‚¬ìš© (ëŒ€ì•ˆ):
  // âš ï¸ ì¤‘ìš”: Viewì—ì„œë„ Policyì—ì„œ ì¡°íšŒí•œ thresholdDays ê°’ì„ ì‚¬ìš©í•´ì•¼ í•¨ (í•˜ë“œì½”ë”© ê¸ˆì§€)
  // CREATE VIEW v_absent_students_3days AS
  // SELECT student_id, tenant_id, COUNT(*) as absent_count
  // FROM attendance_logs
  // WHERE status = 'absent' AND occurred_at >= NOW() - INTERVAL (Policyì—ì„œ ì¡°íšŒí•œ ê°’) || ' days'
  // GROUP BY student_id, tenant_id
  // HAVING COUNT(*) >= 3;
  //
  // const absentStudents = await supabase
  //   .from('v_absent_students_3days')
  //   .select('student_id, absent_count')
  //   .eq('tenant_id', tenantId);

  // 2. ê° í•™ìƒì— ëŒ€í•´ ë©”ì‹œì§€ ì´ˆì•ˆ ìƒì„±
  // âš ï¸ ì£¼ì˜: RPC ì‘ë‹µì€ { data, error } í˜•íƒœì´ë¯€ë¡œ .data ì ‘ê·¼ í•„ìš”
  if (absentStudents.error) {
    throw new Error(`Failed to fetch absent students: ${absentStudents.error.message}`);
  }

  for (const student of absentStudents.data || []) {
    // âš ï¸ ì£¼ì˜: RPC í•¨ìˆ˜ ë°˜í™˜ ìŠ¤í™: { student_id, absent_count } (entity_id í•„ë“œëŠ” ì—†ìŒ)
    // student_idëŠ” ì‹¤ì œë¡œ person_idë¥¼ ì˜ë¯¸ (academy_students.person_id = persons.id)

    // âš ï¸ ì¤‘ìš”: ì—”í‹°í‹° ëª¨ë¸ ì •ë³¸í™” (SSOT)
    // - ì •ë³¸ ì—”í‹°í‹°: persons í…Œì´ë¸” (Core Party ëª¨ë¸)
    // - ì—…ì¢…ë³„ í™•ì¥: academy_students í…Œì´ë¸” (PKëŠ” person_id, persons.idë¥¼ ì°¸ì¡°)
    // - RPC í•¨ìˆ˜ê°€ ë°˜í™˜í•˜ëŠ” student_idëŠ” ì‹¤ì œë¡œ person_idë¥¼ ì˜ë¯¸ (academy_students.person_id = persons.id)
    // - academy_studentsì—ëŠ” name ì»¬ëŸ¼ì´ ì—†ìœ¼ë¯€ë¡œ persons í…Œì´ë¸”ì—ì„œ ì¡°íšŒ í•„ìš”
    // - âš ï¸ ë ˆê±°ì‹œ: students í…Œì´ë¸”ì€ ë ˆê±°ì‹œì´ë©°, ì‹ ê·œ ì½”ë“œì—ì„œëŠ” ì‚¬ìš© ê¸ˆì§€. persons + academy_students ì¡°í•©ë§Œ ì‚¬ìš©
    // âš ï¸ ì£¼ì˜: withTenant() ì‚¬ìš© (SELECT ì¿¼ë¦¬)
    const studentInfo = await withTenant(
      supabase
        .from('persons')
        .select('id, name')
        .eq('id', student.student_id) // student_id = person_id = persons.id (RPC í•¨ìˆ˜ì˜ student_idëŠ” person_id)
        .single(),
      tenantId
    );

    const guardianInfo = await withTenant(
      supabase
        .from('guardians')
        .select('id')
        .eq('student_id', student.student_id)
        .eq('is_primary', true)
        .single(),
      tenantId
    );

    // 3. Policy í™•ì¸: ë©”ì‹œì§€ ì´ˆì•ˆ ìƒì„± í™œì„±í™” ì—¬ë¶€ (SSOT ê²½ë¡œ ì‚¬ìš©)
    const messageSuggestionPolicy = await getTenantSettingByPath(supabase, tenantId, 'auto_notification.attendance_pattern_anomaly.enabled');
    // âš ï¸ ë ˆê±°ì‹œ fallback: ì‹ ê·œ ê²½ë¡œê°€ ì—†ê³  ê¸°ì¡´ ê°’ì´ ìˆì„ ë•Œë§Œ ì œí•œì  fallback (ì½ê¸°ë§Œ í—ˆìš©, ì“°ê¸° ê¸ˆì§€)
    // const messageSuggestionPolicyLegacy = await getTenantSetting(tenantId, 'auto_message_suggestion.enabled');
    if (!messageSuggestionPolicy || messageSuggestionPolicy !== true) {
      // Policyê°€ ì—†ê±°ë‚˜ ë¹„í™œì„±í™”ë˜ì–´ ìˆìœ¼ë©´ ì‹¤í–‰í•˜ì§€ ì•ŠìŒ (Fail Closed) - ì„œë²„/Edge Functionì€ T | null ì§ì ‘ ë°˜í™˜, .value ì ‘ê·¼ ë¶ˆí•„ìš”
      continue;
    }

    // 4. Dedup í‚¤ ìƒì„± (ì •ë³¸ í¬ë§·: {tenantId}:{trigger}:{entityType}:{entityId}:{window})
    // âš ï¸ ì£¼ì˜: RPC í•¨ìˆ˜ ë°˜í™˜ ìŠ¤í™: { student_id, absent_count } (entity_id í•„ë“œëŠ” ì—†ìŒ)
    const dedupKey = `${tenantId}:ai_suggested:student:${student.student_id}:${toKST().format('YYYY-MM-DD')}`; // ì •ë³¸ í¬ë§·: {tenantId}:{trigger}:{entityType}:{entityId}:{window}

    // 6. TaskCard ìƒì„± (ë©±ë“±ì„±/ì¤‘ë³µë°©ì§€ - UPSERT í•„ìˆ˜, StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)
    // âš ï¸ ì¤‘ìš”: INSERT ëŒ€ì‹  UPSERT ì‚¬ìš© (DB ì œì•½ìœ¼ë¡œ Race condition ë°©ì§€)
    // âš ï¸ ì¤‘ìš”: Priority, TTL ëª¨ë‘ Policyì—ì„œ ì¡°íšŒ (í•˜ë“œì½”ë”© ê¸ˆì§€, SSOT ê²½ë¡œ ì‚¬ìš©)
    // Priority Policy ì¡°íšŒ ë° í•´ì„
    const priorityPolicy = await getTenantSettingByPath(supabase, tenantId, 'auto_notification.attendance_pattern_anomaly.priority');
    // âš ï¸ ë ˆê±°ì‹œ fallback: ì‹ ê·œ ê²½ë¡œê°€ ì—†ê³  ê¸°ì¡´ ê°’ì´ ìˆì„ ë•Œë§Œ ì œí•œì  fallback (ì½ê¸°ë§Œ í—ˆìš©, ì“°ê¸° ê¸ˆì§€)
    if (!priorityPolicy) {
      // Policyê°€ ì—†ìœ¼ë©´ ì‹¤í–‰í•˜ì§€ ì•ŠìŒ (Fail Closed)
      continue;
    }
    // TTL Policy ì¡°íšŒ ë° í•´ì„
    const ttlPolicy = await getTenantSettingByPath(supabase, tenantId, 'auto_notification.attendance_pattern_anomaly.ttl_days');
    // âš ï¸ ë ˆê±°ì‹œ fallback: ì‹ ê·œ ê²½ë¡œê°€ ì—†ê³  ê¸°ì¡´ ê°’ì´ ìˆì„ ë•Œë§Œ ì œí•œì  fallback (ì½ê¸°ë§Œ í—ˆìš©, ì“°ê¸° ê¸ˆì§€)
    if (!ttlPolicy) {
      // Policyê°€ ì—†ìœ¼ë©´ ì‹¤í–‰í•˜ì§€ ì•ŠìŒ (Fail Closed)
      continue;
    }
    await supabase.from('task_cards').upsert({
        tenant_id: tenantId,
        student_id: student.student_id,
        entity_id: student.student_id,  // entity_id = student_id = person_id (entity_type='student', RPC í•¨ìˆ˜ ë°˜í™˜ ìŠ¤í™: { student_id, absent_count })
        entity_type: 'student', // entity_type
        task_type: 'ai_suggested', // ì •ë³¸: TaskCardì˜ í•œ íƒ€ì… (StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)
        source: 'attendance',
        priority: typeof priorityPolicy === 'number' ? priorityPolicy : null, // Policyì—ì„œ ì¡°íšŒí•œ ê°’ë§Œ ì‚¬ìš© (Default Policy: 80, í…Œë„ŒíŠ¸ ìƒì„± ì‹œ ì„¤ì •ê°’ìœ¼ë¡œ ì €ì¥) - ì„œë²„/Edge Functionì€ T | null ì§ì ‘ ë°˜í™˜, .value ì ‘ê·¼ ë¶ˆí•„ìš”
        title: `${studentInfo.data?.name || 'í•™ìƒ'} ê²°ì„ ${thresholdDays}ì¼ ì´ìƒ`,
        description: `ìµœê·¼ ${thresholdDays}ì¼ê°„ ê²°ì„ì´ ì§€ì†ë˜ê³  ìˆìŠµë‹ˆë‹¤. í•™ë¶€ëª¨ì—ê²Œ ì—°ë½ì„ ì¶”ì²œí•©ë‹ˆë‹¤.`,
        suggested_action: {
          type: 'send_message',
          payload: {
            recipient_ids: guardianInfo.data ? [guardianInfo.data.id] : [],
            message: messageDraft,
            template_id: 'attendance_followup',
          },
        },
        dedup_key: dedupKey,
        expires_at: new Date(Date.now() + (typeof ttlPolicy === 'number' ? ttlPolicy : 0) * 24 * 60 * 60 * 1000), // Policyì—ì„œ ì¡°íšŒí•œ ê°’ë§Œ ì‚¬ìš© (Default Policy: 7ì¼, í…Œë„ŒíŠ¸ ìƒì„± ì‹œ ì„¤ì •ê°’ìœ¼ë¡œ ì €ì¥) - ì„œë²„/Edge Functionì€ T | null ì§ì ‘ ë°˜í™˜, .value ì ‘ê·¼ ë¶ˆí•„ìš”
        metadata: {
          reason: 'ê²°ì„ 3ì¼ ì´ìƒ',
          ai_generated: true,
        },
      }, {
        onConflict: 'tenant_id,dedup_key',
        ignoreDuplicates: false, // ê¸°ì¡´ ì¹´ë“œê°€ ìˆìœ¼ë©´ ì—…ë°ì´íŠ¸
      });
  }
});
```

---

## 3. ì •ì±… ê¸°ë°˜ ìë™í™” ê²°ê³¼ ê°€ì‹œì„± (User Awareness Layer)

### 3.1 Daily Automation Digest (ì½ê¸° ì „ìš©)

**âš ï¸ ì¤‘ìš”: ë¡œê·¸ì¸ ì•ˆ í•´ë„ ëŒì•„ê°€ì§€ë§Œ, ë‚˜ì¤‘ì— ë´¤ì„ ë•Œ 'ë¬´ìŠ¨ ì¼ì´ ìˆì—ˆëŠ”ì§€'ëŠ” ë³´ì—¬ì•¼ í•©ë‹ˆë‹¤.**

**ëª©ì :**
- ìë™í™” ì‹¤í–‰ ê²°ê³¼ì˜ ì‚¬ìš©ì ì¸ì§€
- Zero-Managementì˜ íˆ¬ëª…ì„± ë³´ì¥
- AI_BRIEFINGì˜ í™•ì¥ (ìƒˆ ê°œë… ì•„ë‹˜)

**êµ¬í˜„:**

```typescript
// Edge Function: daily-automation-digest
// ìŠ¤ì¼€ì¤„: ë§¤ì¼ 23:00 KST

interface DailyAutomationDigest {
  date: string; // KST ê¸°ì¤€ ë‚ ì§œ
  tenant_id: string;
  summary: {
    consultation_summaries: number; // ìƒë‹´ ìš”ì•½ ìƒì„± ê±´ìˆ˜
    overdue_notifications: number; // ë¯¸ë‚© ì•Œë¦¼ ë°œì†¡ ê±´ìˆ˜
    risk_detections: number; // ì¶œê²° ì´ìƒ í•™ìƒ ê°ì§€ ê±´ìˆ˜
    auto_billing: number; // ìë™ ì²­êµ¬ ìƒì„± ê±´ìˆ˜
    message_drafts: number; // ë©”ì‹œì§€ ì´ˆì•ˆ ìƒì„± ê±´ìˆ˜
  };
  details: AutomationAction[]; // automation_actions í…Œì´ë¸”ì—ì„œ ì¡°íšŒ
  created_at: timestamptz;
}

// âš ï¸ ì¤‘ìš”: AI ì¸ì‚¬ì´íŠ¸ ì—”í‹°í‹° ë‹¨ì¼í™”
// - UI í‘œê¸°: "AI_BRIEFING" (ì‚¬ìš©ìì—ê²Œ ë³´ì´ëŠ” ë¼ë²¨)
// - DB ì—”í‹°í‹°: ai_insights í…Œì´ë¸” (ì •ë³¸, ë‹¨ì¼ ì§„ì‹¤ ì›ì²œ)
// - insight_type ì»¬ëŸ¼ìœ¼ë¡œ êµ¬ë¶„ (daily_automation_digest, proactive_recommendation ë“±)
// AI_BRIEFINGìœ¼ë¡œ ì €ì¥ (ai_insights í…Œì´ë¸” ì‚¬ìš©, insight_typeìœ¼ë¡œ êµ¬ë¶„)
await supabase.from('ai_insights').insert({
  tenant_id: tenantId,
  student_id: null, // í…Œë„ŒíŠ¸ ë ˆë²¨ ìš”ì•½ì´ë¯€ë¡œ student_idëŠ” null
  insight_type: 'daily_automation_digest',
  title: `${toKST().format('YYYY-MM-DD')} ì •ì±… ê¸°ë°˜ ìë™í™” ì²˜ë¦¬ ìš”ì•½`,
  summary: `ì˜¤ëŠ˜ ìë™ ì²˜ë¦¬ ìš”ì•½:
- ìƒë‹´ ìš”ì•½ ${summary.consultation_summaries}ê±´ ìƒì„±
- ë¯¸ë‚© ì•Œë¦¼ ${summary.overdue_notifications}ê±´ ë°œì†¡
- ì¶œê²° ì´ìƒ í•™ìƒ ${summary.risk_detections}ëª… ê°ì§€
- ì„œë²„ê°€ ì²­êµ¬ ${summary.auto_billing}ê±´ ìƒì„±`,
  details: details, // JSON.stringify ì—†ì´ jsonbë¡œ ì§ì ‘ ì €ì¥
  related_entity_type: 'automation_digest',
  related_entity_id: null,
  status: 'active',
  created_at: toKST().toISOString(),
});
```

**UI í‘œì‹œ:**

```typescript
// HomePageì—ì„œ AI_BRIEFINGìœ¼ë¡œ í‘œì‹œ
// âŒ ë²„íŠ¼ ì—†ìŒ
// âŒ ì‹¤í–‰ ì—†ìŒ
// âœ… ì •ë³´ë§Œ í‘œì‹œ

<AIBriefingCard
  briefing={{
    type: 'daily_automation_digest',
    title: 'ì˜¤ëŠ˜ ì •ì±… ê¸°ë°˜ ìë™í™” ì²˜ë¦¬ ìš”ì•½',
    summary: '...',
  }}
/>
```

**âš ï¸ ì¤‘ìš”:**
- ì´ê±´ AI_BRIEFINGì˜ í™•ì¥ì´ì§€ ìƒˆ ê°œë…ì´ ì•„ë‹™ë‹ˆë‹¤
- ì½ê¸° ì „ìš©ì´ë©°, ë²„íŠ¼ì´ë‚˜ ì‹¤í–‰ ê¸°ëŠ¥ì´ ì—†ìŠµë‹ˆë‹¤
- ì‚¬ìš©ìê°€ "ë¬´ìŠ¨ ì¼ì´ ìˆì—ˆëŠ”ì§€" ì¸ì§€í•  ìˆ˜ ìˆê²Œ í•˜ëŠ” ê²ƒì´ ëª©ì ì…ë‹ˆë‹¤

---

## 4. AI_BRIEFING vs STUDENT_TASK (ê²½ê³„ ëª…í™•í™”)

### 4.1 AI_BRIEFING (ì •ë³´ ìš”ì•½, ì‹¤í–‰ ê¸ˆì§€)

âš ï¸ ì¤‘ìš”: AI ì¸ì‚¬ì´íŠ¸ ì—”í‹°í‹° ë‹¨ì¼í™” (SSOT)
- **UI í‘œê¸°**: "AI_BRIEFING" (ì‚¬ìš©ìì—ê²Œ ë³´ì´ëŠ” ë¼ë²¨)
- **DB ì—”í‹°í‹°**: `ai_insights` í…Œì´ë¸” (ì •ë³¸, ë‹¨ì¼ ì§„ì‹¤ ì›ì²œ)
- **êµ¬ë¶„ ë°©ë²•**: `insight_type` ì»¬ëŸ¼ìœ¼ë¡œ êµ¬ë¶„ (daily_automation_digest, proactive_recommendation ë“±)
- **íŒŒìƒ MV**: ì„±ëŠ¥ì´ í•„ìš”í•œ ê²½ìš° `ai_insights_mv` ê°™ì€ Materialized Viewë¥¼ ìƒì„±í•  ìˆ˜ ìˆìœ¼ë‚˜, ì •ë³¸ í…Œì´ë¸”ì€ `ai_insights`ì…ë‹ˆë‹¤.

```typescript
{
  type: 'ai_briefing',
  content: 'ì˜¤ëŠ˜ ê²°ì„ìƒ 3ëª… ì¤‘ 2ëª…ì€ ìœ„í—˜êµ°ì…ë‹ˆë‹¤',
  ttl: 24h
}
```

**ì •ë³¸ ê·œì¹™:**
- ë²„íŠ¼ âŒ
- ìŠ¹ì¸ âŒ
- ì‹¤í–‰ âŒ
- **ì •ë³´ ìš”ì•½ë§Œ ì œê³µ** (ì„œë²„ê°€ ìƒì„±, í”„ë¡ íŠ¸ì—”ë“œëŠ” í‘œì‹œë§Œ)

**ìš©ì–´ ì •ì •:**
- âŒ "AIê°€ ìë™ìœ¼ë¡œ ë¸Œë¦¬í•‘ì„ ìƒì„±í•œë‹¤" (ì˜¤í•´ í‘œí˜„)
- âœ… "ì„œë²„/Edge Functionì´ AI ë¸Œë¦¬í•‘ì„ ìƒì„±í•˜ê³ , í”„ë¡ íŠ¸ì—”ë“œëŠ” í‘œì‹œë§Œ í•œë‹¤" (ì •ë³¸ í‘œí˜„)

### 4.2 STUDENT_TASK (í–‰ë™ í•„ìš”, ì„œë²„ ì‹¤í–‰)

```typescript
{
  type: 'student_task',
  task_type: 'ai_suggested', // TaskCardì˜ í•œ íƒ€ì… (StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)
  action: 'send_message',
  requires_approval: true
}
```

**ì •ë³¸ ê·œì¹™:**
- ìŠ¹ì¸ ë²„íŠ¼ âœ… (í”„ë¡ íŠ¸ì—”ë“œ)
- ìŠ¹ì¸ ìš”ì²­ âœ… (í”„ë¡ íŠ¸ì—”ë“œ â†’ ì„œë²„)
- ì‹¤í–‰ì€ ì„œë²„ë§Œ âœ… (Edge Function)
- í”„ë¡ íŠ¸ì—”ë“œëŠ” ìŠ¹ì¸ ìš”ì²­ë§Œ

**ìš©ì–´ ì •ì •:**
- âŒ "í”„ë¡ íŠ¸ì—”ë“œê°€ ìŠ¹ì¸í•˜ê³  ì‹¤í–‰í•œë‹¤" (ì˜¤í•´ í‘œí˜„)
- âœ… "í”„ë¡ íŠ¸ì—”ë“œê°€ ìŠ¹ì¸ ìš”ì²­ì„ ë³´ë‚´ê³ , ì„œë²„ê°€ Role ê²€ì¦ í›„ ì‹¤í–‰í•œë‹¤" (ì •ë³¸ í‘œí˜„)

---

**Edge Function:** `student-task-card-generation` (ì •ë³¸)

**âš ï¸ v3.3 ì •ë³¸ ê·œì¹™:**
- Proactive ì œì•ˆì€ **TaskCard**ë¡œ ìƒì„± (`task_type: 'ai_suggested'`, StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)
- ë…ë¦½ `insight_type: 'proactive_recommendation'` ì‚¬ìš© âŒ
- AI_BRIEFINGê³¼ STUDENT_TASK ê²½ê³„ ëª…í™•í™”

**ì •ë³¸ êµ¬í˜„:**

```typescript
// student-task-card-generation/index.ts

// 1. ê²°ì„ìƒ íŒ¨í„´ ë¶„ì„
const absentStudents = await analyzeAbsentPatterns(tenantId);
if (absentStudents.length > 0) {
  const atRiskCount = absentStudents.filter(s => s.risk_score >= 70).length;

  // âš ï¸ ì¤‘ìš”: Priority, TTL ëª¨ë‘ Policyì—ì„œ ì¡°íšŒ (í•˜ë“œì½”ë”© ê¸ˆì§€, SSOT ê²½ë¡œ ì‚¬ìš©)
  const priorityPolicy = await getTenantSettingByPath(supabase, tenantId, 'auto_notification.proactive_analysis.priority');
  if (!priorityPolicy) {
    // Policyê°€ ì—†ìœ¼ë©´ ì‹¤í–‰í•˜ì§€ ì•ŠìŒ (Fail Closed)
    return;
  }
  const ttlPolicy = await getTenantSettingByPath(supabase, tenantId, 'auto_notification.proactive_analysis.ttl_days');
  if (!ttlPolicy) {
    // Policyê°€ ì—†ìœ¼ë©´ ì‹¤í–‰í•˜ì§€ ì•ŠìŒ (Fail Closed)
    return;
  }

  // ì •ë³¸: TaskCardë¡œ ìƒì„± (task_type: 'ai_suggested', entity_type='student')
  // âš ï¸ ì¤‘ìš”: ë©±ë“±ì„±/ì¤‘ë³µë°©ì§€ - ë°˜ë“œì‹œ UPSERT ì‚¬ìš© (DB ì œì•½ìœ¼ë¡œ Race condition ë°©ì§€)
  await supabase.from('task_cards').upsert({
    tenant_id: tenantId,
    entity_id: absentStudents[0].id,  // entity_id = student_id (entity_type='student')
    entity_type: 'student', // entity_type
    task_type: 'ai_suggested', // ì •ë³¸: Proactive ì œì•ˆë„ TaskCard (StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)
    source: 'proactive_analysis',
    priority: priorityPolicy ?? null, // âš ï¸ Policy ì¡°íšŒ í•„ìˆ˜, ì—†ìœ¼ë©´ ìƒì„± ì•ˆ í•¨ (Fail-Closed) - ì„œë²„/Edge Functionì€ T | null ì§ì ‘ ë°˜í™˜, .value ì ‘ê·¼ ë¶ˆí•„ìš”
    title: 'ê²°ì„ìƒ ê´€ë¦¬ í•„ìš”',
    description: `ì˜¤ëŠ˜ ê²°ì„ìƒ ${absentStudents.length}ëª… ì¤‘ ${atRiskCount}ëª…ì€ ìµœê·¼ 1ì£¼ê°„ ìƒíƒœê°€ ì¢‹ì§€ ì•ŠìŠµë‹ˆë‹¤.`,
    suggested_action: {
      type: 'contact_parents',
      student_ids: absentStudents.map(s => s.id),
    },
    action_url: '/students/tasks?filter=absent',
    dedup_key: `${tenantId}:proactive_analysis:student:${absentStudents[0].id}:${toKST().format('YYYY-MM-DD')}`, // ì •ë³¸ í¬ë§·: {tenantId}:{trigger}:{entityType}:{entityId}:{window}
    expires_at: ttlPolicy ? new Date(Date.now() + (typeof ttlPolicy === 'number' ? ttlPolicy : 0) * 24 * 60 * 60 * 1000) : null, // âš ï¸ Policy ì¡°íšŒ í•„ìˆ˜, ì—†ìœ¼ë©´ ìƒì„± ì•ˆ í•¨ (Fail-Closed) - ì„œë²„/Edge Functionì€ T | null ì§ì ‘ ë°˜í™˜, .value ì ‘ê·¼ ë¶ˆí•„ìš”
  }, {
    onConflict: 'tenant_id,dedup_key',
    ignoreDuplicates: false, // ê¸°ì¡´ ì¹´ë“œê°€ ìˆìœ¼ë©´ ì—…ë°ì´íŠ¸
  });
}

// 2. ë°˜ë³„ ì¶œê²°ë¥  ë¶„ì„
const classAttendanceAnalysis = await analyzeClassAttendance(tenantId);
const lowAttendanceClasses = classAttendanceAnalysis.filter(c =>
  c.attendance_rate < c.regional_average - 10
);

if (lowAttendanceClasses.length > 0) {
  for (const cls of lowAttendanceClasses) {
    // ì •ë³¸: TaskCardë¡œ ìƒì„± (entity_type='student')
    // âš ï¸ ì¤‘ìš”: ë©±ë“±ì„±/ì¤‘ë³µë°©ì§€ - ë°˜ë“œì‹œ UPSERT ì‚¬ìš© (DB ì œì•½ìœ¼ë¡œ Race condition ë°©ì§€)
    await supabase.from('task_cards').upsert({
      tenant_id: tenantId,
      entity_id: cls.id,  // entity_id = class_id (entity_type='class')
      entity_type: 'class', // entity_type
      task_type: 'ai_suggested', // ì •ë³¸: Proactive ì œì•ˆë„ TaskCard (StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)
      source: 'proactive_analysis',
      priority: priorityPolicy ?? null, // âš ï¸ Policy ì¡°íšŒ í•„ìˆ˜, ì—†ìœ¼ë©´ ìƒì„± ì•ˆ í•¨ (Fail-Closed) - ì„œë²„/Edge Functionì€ T | null ì§ì ‘ ë°˜í™˜, .value ì ‘ê·¼ ë¶ˆí•„ìš”
      title: `${cls.name} ì¶œê²°ë¥  ì €ì¡°`,
      description: `ì´ë²ˆ ì£¼ ìˆ˜ì—… ì¤‘ ${cls.name} ì¶œê²°ë¥ ì´ ì§€ì—­ í‰ê·  ëŒ€ë¹„ ${Math.round(cls.attendance_rate - cls.regional_average)}% ë‚®ìŠµë‹ˆë‹¤.`,
      suggested_action: {
        type: 'run_analysis',
        class_id: cls.id,
        analysis_type: 'attendance_decline',
      },
      action_url: `/ai?tab=attendance&class_id=${cls.id}`,
      dedup_key: `${tenantId}:proactive_analysis:class:${cls.id}:${toKST().format('YYYY-MM-DD')}`, // ì •ë³¸ í¬ë§·: {tenantId}:{trigger}:{entityType}:{entityId}:{window}
      expires_at: ttlPolicy ? new Date(Date.now() + (typeof ttlPolicy === 'number' ? ttlPolicy : 0) * 24 * 60 * 60 * 1000) : null, // âš ï¸ Policy ì¡°íšŒ í•„ìˆ˜, ì—†ìœ¼ë©´ ìƒì„± ì•ˆ í•¨ (Fail-Closed) - ì„œë²„/Edge Functionì€ T | null ì§ì ‘ ë°˜í™˜, .value ì ‘ê·¼ ë¶ˆí•„ìš”
    }, {
      onConflict: 'tenant_id,dedup_key',
      ignoreDuplicates: false, // ê¸°ì¡´ ì¹´ë“œê°€ ìˆìœ¼ë©´ ì—…ë°ì´íŠ¸
    });
  }
}
```

**âš ï¸ ì¤‘ìš”:**
- Proactive ì œì•ˆì€ `insight_type: 'proactive_recommendation'`ìœ¼ë¡œ AI_BRIEFINGì— ì €ì¥í•˜ì§€ ì•ŠìŒ
- ëª¨ë“  Proactive ì œì•ˆì€ **TaskCard**ë¡œ ìƒì„± (StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)
- í”„ë¡ íŠ¸ì—”ë“œëŠ” TaskCardë¡œ í†µí•© í‘œì‹œ (StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­, = TaskCard where entity_type='student')

#### 3.2.2 âŒ Proactive Recommendation Card [ì‚­ì œë¨]

**âš ï¸ v3.3 ì •ë³¸ ê·œì¹™: ProactiveRecommendationCardëŠ” ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.**

**ì‚­ì œ ì´ìœ :**
- âŒ "ì‹¤í–‰í•˜ê¸°" ë²„íŠ¼ â†’ ì˜¤í•´ ìœ ë°œ (í”„ë¡ íŠ¸ì—”ë“œëŠ” ì‹¤í–‰í•˜ì§€ ì•ŠìŒ)
- âŒ `onExecute` ë„¤ì´ë° â†’ ì‹¤í–‰ ì•”ì‹œ (ì •ë³¸ ìœ„ë°˜)
- âŒ ë…ë¦½ ì»´í¬ë„ŒíŠ¸ â†’ TaskCardë¡œ ì™„ì „ í¡ìˆ˜ í•„ìš” (StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)

**ì •ë³¸ ëŒ€ì²´:**
- âœ… Proactive ì œì•ˆì€ **TaskCard**ë¡œ ìƒì„± (`task_type: 'ai_suggested'`, StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)
- âœ… ë²„íŠ¼ ëª…ì¹­: **"ìŠ¹ì¸ ìš”ì²­"** (ì‹¤í–‰ ì•„ë‹˜)
- âœ… Props: `onApprove` (ì‹¤í–‰ ì•”ì‹œ ì œê±°)

**ì •ë³¸ êµ¬í˜„ (TaskCard ì‚¬ìš©):**

```typescript
// Proactive ì œì•ˆë„ TaskCardë¡œ í‘œì‹œ (StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)
<StudentTaskCard
  task={{
    id: insight.id,
    task_type: 'ai_suggested',
    title: insight.title,
    description: insight.summary,
    suggested_action: insight.suggested_action,
    action_url: insight.action_url,
  }}
  onApprove={() => {
    // ì •ë³¸: ìŠ¹ì¸ ìš”ì²­ë§Œ (ì‹¤í–‰ì€ ì„œë²„)
    // TeacherëŠ” request-approval, Adminì€ approve-and-execute ì‚¬ìš© (SSOT)
    // âš ï¸ ì£¼ì˜: getCurrentUserRole()ì€ ì„œë¹„ìŠ¤ ë ˆì´ì–´ í•¨ìˆ˜ë¡œ êµ¬í˜„ í•„ìš”
    // ì˜ˆ: import { getCurrentUserRole } from '@lib/auth';
    const userRole = getCurrentUserRole(); // ì˜ˆì‹œ: í˜„ì¬ ì‚¬ìš©ì Role í™•ì¸
    if (userRole === 'teacher') {
      apiClient.invokeFunction('execute-student-task', { action: 'request-approval', task_id: insight.id }); // ì •ë³¸
    } else if (userRole === 'admin') {
      apiClient.invokeFunction('execute-student-task', { action: 'approve-and-execute', task_id: insight.id }); // SSOT: ì •ë³¸ ì—”ë“œí¬ì¸íŠ¸
    }
  }}
/>

// TaskCard ë‚´ë¶€ ë²„íŠ¼ (StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)
<Button
  variant="primary"
  size="sm"
  onClick={onApprove}
>
  ìŠ¹ì¸ ìš”ì²­  {/* ì •ë³¸: "ì‹¤í–‰í•˜ê¸°" âŒ */}
</Button>
```

**âš ï¸ ì¤‘ìš”:**
- ProactiveRecommendationCard ì»´í¬ë„ŒíŠ¸ëŠ” ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
- ëª¨ë“  Proactive ì œì•ˆì€ TaskCardë¡œ í†µí•© (StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)
- ë²„íŠ¼ì€ "ìŠ¹ì¸ ìš”ì²­"ë§Œ ì‚¬ìš© (ì‹¤í–‰ ì•”ì‹œ ì œê±°)

#### 4.1.1 StudentTaskCard onAction í•¸ë“¤ëŸ¬ ê³µí†µí™”

**âš ï¸ ì¤‘ìš”: HomePage, AllCardsPage, StudentsHomePage, StudentTasksPageì—ì„œ `handleCardAction` ë¡œì§ ì¤‘ë³µ ì œê±°**

**ë¬¸ì œì :**
- 4ê°œ í˜ì´ì§€ì—ì„œ ë™ì¼í•œ `handleCardAction` ë¡œì§ì´ ì¤‘ë³µë¨
- `action_url`ì— `cardId` ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¥¼ ì¶”ê°€í•˜ëŠ” ë¡œì§ì´ ë°˜ë³µë¨
- ì½”ë“œ ë³€ê²½ ì‹œ 4ê³³ ëª¨ë‘ ìˆ˜ì •í•´ì•¼ í•˜ëŠ” ìœ ì§€ë³´ìˆ˜ ë¬¸ì œ

**í•´ê²° ë°©ì•ˆ: Shared Hook ì¶”ì¶œ**

**ìœ„ì¹˜:** `packages/hooks/use-student/src/useStudentTaskCardAction.ts`

**êµ¬í˜„ ë°©ì‹:**

```typescript
import { useCallback } from 'react';
import type { StudentTaskCard } from './useStudentTaskCard';

/**
 * StudentTaskCard action URL ìƒì„± Hook
 *
 * action_urlì— cardIdë¥¼ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¡œ ì¶”ê°€í•˜ì—¬ ì¶”ì  ê°€ëŠ¥í•˜ë„ë¡ í•¨
 *
 * [ë¶ˆë³€ ê·œì¹™] Hook ë‚´ë¶€ì—ì„œ navigate() í˜¸ì¶œ ê¸ˆì§€
 * [ë¶ˆë³€ ê·œì¹™] URLë§Œ ë°˜í™˜í•˜ê³ , ì»´í¬ë„ŒíŠ¸ì—ì„œ navigate() í˜¸ì¶œ
 */
export function useStudentTaskCardAction() {
  return useCallback((card: StudentTaskCard): string | null => {
    // ì•¡ì…˜ URLì— ì¹´ë“œ IDë¥¼ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¡œ ì¶”ê°€í•˜ì—¬ ì¶”ì  ê°€ëŠ¥í•˜ë„ë¡ í•¨
    if (card.action_url) {
      const actionUrlWithCardId = card.action_url.includes('?')
        ? `${card.action_url}&cardId=${card.id}`
        : `${card.action_url}?cardId=${card.id}`;
      return actionUrlWithCardId;
    }
    return null;
  }, []);
}
```

**ì‚¬ìš© ì˜ˆì‹œ:**

```typescript
// HomePage.tsx, AllCardsPage.tsx, StudentsHomePage.tsx, StudentTasksPage.tsxì—ì„œ ê³µí†µ ì‚¬ìš©
import { useStudentTaskCardAction } from '@hooks/use-student';
import { useNavigate } from 'react-router-dom';

export function StudentsHomePage() {
  const navigate = useNavigate();
  const getCardActionUrl = useStudentTaskCardAction();

  const handleCardAction = useCallback((card: StudentTaskCard) => {
    const url = getCardActionUrl(card);
    if (url) {
      navigate(url); // ì»´í¬ë„ŒíŠ¸ ë ˆë²¨ì—ì„œ navigate() í˜¸ì¶œ
    }
  }, [navigate, getCardActionUrl]);

  return (
    <Grid columns={{ xs: 1, sm: 2, md: 3 }} gap="md">
      {cards.slice(0, 3).map((card) => (
        <StudentTaskCard
          key={card.id}
          card={card}
          onAction={handleCardAction}
        />
      ))}
    </Grid>
  );
}
```

**ì¥ì :**
- SSOT ì›ì¹™ ì¤€ìˆ˜: í•¸ë“¤ëŸ¬ ë¡œì§ì´ í•œ ê³³ì—ë§Œ ì¡´ì¬
- ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ: ë¡œì§ ë³€ê²½ ì‹œ í•œ ê³³ë§Œ ìˆ˜ì •
- ì¼ê´€ì„± ë³´ì¥: ëª¨ë“  í˜ì´ì§€ì—ì„œ ë™ì¼í•œ ë™ì‘ ë³´ì¥
- íƒ€ì… ì•ˆì •ì„±: TypeScriptë¡œ íƒ€ì… ì²´í¬ ê°€ëŠ¥

---

## 5. Zero-Interaction UX êµ¬í˜„

### 5.1 ê°œìš”

ì‚¬ìš©ìê°€ í´ë¦­í•˜ì§€ ì•Šì•„ë„ ì‹œìŠ¤í…œì´ ë¨¼ì € ì¶”ì²œ/ë¶„ì„ì„ ìˆ˜í–‰í•˜ëŠ” UXì…ë‹ˆë‹¤. ì‹¤í–‰(ë°œì†¡/ì ìš©)ì€ ìŠ¹ì¸/ì •ì±… ê²Œì´íŠ¸ë¥¼ í†µí•´ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.

**ì•„í‚¤í…ì²˜ ë¬¸ì„œ ìš”êµ¬ì‚¬í•­ (4.2):**
- ì¶œê²° ìë™ ê°ì§€
- ì„œë²„ê°€ ì²­êµ¬ ìƒì„± (ì´ë¯¸ êµ¬í˜„ë¨)
- ìë™ ë¯¸ë‚© ì•Œë¦¼ (ì´ë¯¸ êµ¬í˜„ë¨)
- ì„œë²„ê°€ ìƒë‹´ AI ìš”ì•½ ìƒì„±
- ì„œë²„ê°€ í†µê³„ ë¶„ì„ (AI í˜¸ì¶œ í¬í•¨)
- ì„œë²„ê°€ ì¶”ì²œ ë©”ì‹œì§€ ìƒì„± (AI í˜¸ì¶œ í¬í•¨)

### 5.2 êµ¬í˜„ ì„¤ê³„

#### 5.2.1 ì„œë²„ê°€ ìƒë‹´ AI ìš”ì•½ ìƒì„±

**ìœ„ì¹˜:** `infra/supabase/functions/consultation-ai-summary/index.ts` (ì´ë¯¸ ì¡´ì¬)

**í™•ì¥ ê¸°ëŠ¥:**
- ìƒë‹´ì¼ì§€ ì €ì¥ ì‹œ ì„œë²„ê°€ AI ìš”ì•½ ìƒì„±
- ìš”ì•½ ê²°ê³¼ë¥¼ ìƒë‹´ì¼ì§€ì— ìë™ ì—°ê²°

**êµ¬í˜„:**

```typescript
// ìƒë‹´ì¼ì§€ ì €ì¥ í›„ ì„œë²„ê°€ AI ìš”ì•½ ìƒì„± íŠ¸ë¦¬ê±°
// Supabase Database Trigger ì‚¬ìš©

CREATE OR REPLACE FUNCTION trigger_consultation_ai_summary()
RETURNS TRIGGER AS $$
BEGIN
  -- âš ï¸ ì¤‘ìš”: DB Triggerì—ì„œ HTTP í˜¸ì¶œ ë° Service Role Key ì‚¬ìš©ì€ ë³´ì•ˆ ìœ„í—˜ì´ ìˆìŠµë‹ˆë‹¤.
  -- ëŒ€ì‹  í í…Œì´ë¸”ì— ì‘ì—…ì„ ì ì¬í•˜ê³ , Edge Function(Cron/Worker)ì´ ì„œë²„ í™˜ê²½ë³€ìˆ˜ë¡œ Service Role Keyë¥¼ ë“¤ê³  ì²˜ë¦¬í•©ë‹ˆë‹¤.

  -- í í…Œì´ë¸”ì— ì‘ì—… ì ì¬ (ì¬ì‹œë„/ë°±ì˜¤í”„/ë¡œê·¸ ì§€ì›)
  INSERT INTO consultation_summary_jobs (
    consultation_id,
    tenant_id,
    content,
    status,
    created_at
  ) VALUES (
    NEW.id,
    NEW.tenant_id,
    NEW.content,
    'pending',
    now()
  );

  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- âš ï¸ ì°¸ê³ : consultation_summary_jobs í…Œì´ë¸”ì€ ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ì—ì„œ ìƒì„±ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
-- Edge Function(Cron/Worker)ì´ ì´ íë¥¼ ì½ì–´ ì²˜ë¦¬í•˜ë©°, Service Role KeyëŠ” ì„œë²„ í™˜ê²½ë³€ìˆ˜ì—ì„œë§Œ ê°€ì ¸ì˜µë‹ˆë‹¤.
-- ìƒì„¸ ìŠ¤í‚¤ë§ˆ ì •ì˜ëŠ” í”„ë¡ íŠ¸ ìƒí™© ì‹ í˜¸ ìˆ˜ì§‘ ë¬¸ì„œ 2.5.3 ì„¹ì…˜ì„ ì°¸ì¡°í•˜ì„¸ìš”.

-- í í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ ì˜ˆì‹œ (ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ì— í¬í•¨):
-- CREATE TABLE IF NOT EXISTS consultation_summary_jobs (
--   id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
--   consultation_id uuid NOT NULL REFERENCES student_consultations(id),
--   tenant_id uuid NOT NULL REFERENCES tenants(id) ON DELETE CASCADE,
--   content text NOT NULL,
--   status text NOT NULL DEFAULT 'pending' CHECK (status IN ('pending', 'processing', 'completed', 'failed')),
--   retry_count integer NOT NULL DEFAULT 0,
--   error_message text,
--   created_at timestamptz NOT NULL DEFAULT now(),
--   processed_at timestamptz,
--   completed_at timestamptz
-- );
-- CREATE INDEX idx_consultation_summary_jobs_status ON consultation_summary_jobs(status, created_at) WHERE status = 'pending';

CREATE TRIGGER consultation_ai_summary_trigger
  AFTER INSERT ON student_consultations
  FOR EACH ROW
  WHEN (NEW.content IS NOT NULL AND length(NEW.content) > 50)
  EXECUTE FUNCTION trigger_consultation_ai_summary();
```

#### 5.2.2 ì„œë²„ê°€ ì¶”ì²œ ë©”ì‹œì§€ ìƒì„± (AI í˜¸ì¶œ í¬í•¨)

**ìœ„ì¹˜:** `infra/supabase/functions/auto-message-suggestion/index.ts`

**ê¸°ëŠ¥:**
- í•™ìƒ ì¶œê²° íŒ¨í„´ ë¶„ì„ (AI ì¶”ì²œ)
- ë©”ì‹œì§€ í…œí”Œë¦¿ ì •ì±… ê¸°ë°˜ ì„ íƒ (Policy í•´ì„)
- ì´ˆì•ˆ ì¶”ì²œ ìƒì„± (AI ì¶”ì²œ, ì„œë²„ê°€ ì •ì±… í•´ì„ í›„ TaskCard ìƒì„±, StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)

**êµ¬í˜„:**

```typescript
import { withTenant } from '@lib/supabase-client'; // âš ï¸ withTenant import í•„ìš”

serve(async (req) => {
  // 1. Policy ì¡°íšŒ ë° í•´ì„
  const absenceThresholdPolicy = await getTenantSettingByPath(supabase, tenantId, 'attendance.absence_threshold_days');
  if (!absenceThresholdPolicy) {
    // Policyê°€ ì—†ìœ¼ë©´ ì‹¤í–‰í•˜ì§€ ì•ŠìŒ (Fail Closed)
    return;
  }
  const thresholdDays = typeof absenceThresholdPolicy === 'number' ? absenceThresholdPolicy : 0; // Default Policy: 3ì¼ (í…Œë„ŒíŠ¸ ìƒì„± ì‹œ ì„¤ì •ê°’ìœ¼ë¡œ ì €ì¥) - ì„œë²„/Edge Functionì€ T | null ì§ì ‘ ë°˜í™˜, .value ì ‘ê·¼ ë¶ˆí•„ìš”

  // 2. ê²°ì„ ì„ê³„ê°’ ì´ìƒ í•™ìƒ ê°ì§€ (Trigger)
  // âš ï¸ ì£¼ì˜: RPC í•¨ìˆ˜ ì‚¬ìš© (2.6.1 ì„¹ì…˜ ì°¸ì¡°)
  const absentStudents = await supabase.rpc('find_absent_students_3days', {
    p_tenant_id: tenantId,
    p_days_ago: thresholdDays, // Policyì—ì„œ ì¡°íšŒí•œ ê°’ ì‚¬ìš© (í•˜ë“œì½”ë”© ê¸ˆì§€)
  });

  // âš ï¸ ì£¼ì˜: RPC ì‘ë‹µì€ { data, error } í˜•íƒœì´ë¯€ë¡œ ì—ëŸ¬ ì²˜ë¦¬ í•„ìš”
  if (absentStudents.error) {
    throw new Error(`Failed to fetch absent students: ${absentStudents.error.message}`);
  }

  for (const studentRow of absentStudents.data || []) {
    // âš ï¸ ì¤‘ìš”: ì—”í‹°í‹° ëª¨ë¸ ì •ë³¸í™” (SSOT)
    // - ì •ë³¸ ì—”í‹°í‹°: persons í…Œì´ë¸” (Core Party ëª¨ë¸)
    // - ì—…ì¢…ë³„ í™•ì¥: academy_students í…Œì´ë¸” (PKëŠ” person_id, persons.idë¥¼ ì°¸ì¡°)
    // - RPC í•¨ìˆ˜ê°€ ë°˜í™˜í•˜ëŠ” student_idëŠ” ì‹¤ì œë¡œ person_idë¥¼ ì˜ë¯¸ (academy_students.person_id = persons.id)
    // - academy_studentsì—ëŠ” name ì»¬ëŸ¼ì´ ì—†ìœ¼ë¯€ë¡œ persons í…Œì´ë¸”ì—ì„œ ì¡°íšŒ í•„ìš”
    // - âš ï¸ ë ˆê±°ì‹œ: students í…Œì´ë¸”ì€ ë ˆê±°ì‹œì´ë©°, ì‹ ê·œ ì½”ë“œì—ì„œëŠ” ì‚¬ìš© ê¸ˆì§€. persons + academy_students ì¡°í•©ë§Œ ì‚¬ìš©
    // âš ï¸ ì£¼ì˜: withTenant() ì‚¬ìš© (SELECT ì¿¼ë¦¬)
    const studentInfo = await withTenant(
      supabase
        .from('persons')
        .select('id, name')
        .eq('id', studentRow.student_id) // student_id = person_id = persons.id (RPC í•¨ìˆ˜ì˜ student_idëŠ” person_id)
        .single(),
      tenantId
    );

    const guardianInfo = await withTenant(
      supabase
        .from('guardians')
        .select('id')
        .eq('student_id', studentRow.student_id)
        .eq('is_primary', true)
        .single(),
      tenantId
    );

    // 2. ë©”ì‹œì§€ í…œí”Œë¦¿ ì„ íƒ
    // âš ï¸ ì£¼ì˜: selectMessageTemplate, generateMessageDraftëŠ” ì„œë¹„ìŠ¤ ë ˆì´ì–´ í•¨ìˆ˜ë¡œ êµ¬í˜„ í•„ìš”
    const template = await selectMessageTemplate({
      reason: 'absent_3days',
      student_history: null, // RPCì—ì„œ ì œê³µí•˜ì§€ ì•Šìœ¼ë©´ ë³„ë„ ì¡°íšŒ í•„ìš”
    });

    // 4. Policy í™•ì¸: ë©”ì‹œì§€ ì´ˆì•ˆ ìƒì„± í™œì„±í™” ì—¬ë¶€ (SSOT ê²½ë¡œ ì‚¬ìš©)
    const messageSuggestionPolicy = await getTenantSettingByPath(supabase, tenantId, 'auto_notification.attendance_pattern_anomaly.enabled');
    // âš ï¸ ë ˆê±°ì‹œ fallback: ì‹ ê·œ ê²½ë¡œê°€ ì—†ê³  ê¸°ì¡´ ê°’ì´ ìˆì„ ë•Œë§Œ ì œí•œì  fallback (ì½ê¸°ë§Œ í—ˆìš©, ì“°ê¸° ê¸ˆì§€)
    if (!messageSuggestionPolicy || messageSuggestionPolicy !== true) {
      // Policyê°€ ì—†ê±°ë‚˜ ë¹„í™œì„±í™”ë˜ì–´ ìˆìœ¼ë©´ ì‹¤í–‰í•˜ì§€ ì•ŠìŒ (Fail Closed) - ì„œë²„/Edge Functionì€ T | null ì§ì ‘ ë°˜í™˜, .value ì ‘ê·¼ ë¶ˆí•„ìš”
      continue;
    }

    // 5. ì´ˆì•ˆ ìƒì„± (AI ì¶”ì²œ)
    const draft = await generateMessageDraft({
      template_id: template.id,
      student_name: studentInfo.data?.name || 'í•™ìƒ',
      absent_days: studentRow.absent_count || thresholdDays, // Policyì—ì„œ ì¡°íšŒí•œ ê°’ ì‚¬ìš©
      custom_fields: {},
    });

    // 4. TaskCard ìƒì„± (task_type: 'ai_suggested', entity_type='student', StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)
    // âš ï¸ ì¤‘ìš”: ë©±ë“±ì„±/ì¤‘ë³µë°©ì§€ - ë°˜ë“œì‹œ UPSERT ì‚¬ìš© (DB ì œì•½ìœ¼ë¡œ Race condition ë°©ì§€)
    // âš ï¸ ì¤‘ìš”: Priority, TTL ëª¨ë‘ Policyì—ì„œ ì¡°íšŒ (í•˜ë“œì½”ë”© ê¸ˆì§€, SSOT ê²½ë¡œ ì‚¬ìš©)
    // Priority Policy ì¡°íšŒ ë° í•´ì„
    const priorityPolicy = await getTenantSettingByPath(supabase, tenantId, 'auto_notification.attendance_pattern_anomaly.priority');
    // âš ï¸ ë ˆê±°ì‹œ fallback: ì‹ ê·œ ê²½ë¡œê°€ ì—†ê³  ê¸°ì¡´ ê°’ì´ ìˆì„ ë•Œë§Œ ì œí•œì  fallback (ì½ê¸°ë§Œ í—ˆìš©, ì“°ê¸° ê¸ˆì§€)
    if (!priorityPolicy) {
      // Policyê°€ ì—†ìœ¼ë©´ ì‹¤í–‰í•˜ì§€ ì•ŠìŒ (Fail Closed)
      continue;
    }
    // TTL Policy ì¡°íšŒ ë° í•´ì„
    const ttlPolicy = await getTenantSettingByPath(supabase, tenantId, 'auto_notification.attendance_pattern_anomaly.ttl_days');
    // âš ï¸ ë ˆê±°ì‹œ fallback: ì‹ ê·œ ê²½ë¡œê°€ ì—†ê³  ê¸°ì¡´ ê°’ì´ ìˆì„ ë•Œë§Œ ì œí•œì  fallback (ì½ê¸°ë§Œ í—ˆìš©, ì“°ê¸° ê¸ˆì§€)
    if (!ttlPolicy) {
      // Policyê°€ ì—†ìœ¼ë©´ ì‹¤í–‰í•˜ì§€ ì•ŠìŒ (Fail Closed)
      continue;
    }
    await supabase.from('task_cards').upsert({
      tenant_id: tenantId,
      student_id: studentRow.student_id, // RPC í•¨ìˆ˜ ë°˜í™˜ ìŠ¤í™: { student_id, absent_count }
      entity_id: studentRow.student_id,  // entity_id = student_id = person_id (entity_type='student', RPC í•¨ìˆ˜ ë°˜í™˜ ìŠ¤í™: { student_id, absent_count })
      entity_type: 'student', // entity_type
      task_type: 'ai_suggested', // ì •ë³¸: v2.x suggestion_type ì œê±°
      source: 'attendance',
      title: `${studentInfo.data?.name || 'í•™ìƒ'} ê²°ì„ ì—°ë½`,
      description: 'ê²°ì„ 3ì¼ ì´ìƒìœ¼ë¡œ í•™ë¶€ëª¨ ì—°ë½ì„ ì¶”ì²œí•©ë‹ˆë‹¤.', // ì •ë³¸: v2.x summary â†’ description
      suggested_action: {
        type: 'send_message',
        payload: {
          recipient_ids: guardianInfo.data ? [guardianInfo.data.id] : [],
          message: draft,
          template_id: template.id,
        },
      },
      priority: typeof priorityPolicy === 'number' ? priorityPolicy : null, // Policyì—ì„œ ì¡°íšŒí•œ ê°’ë§Œ ì‚¬ìš© (Default Policy: 80, í…Œë„ŒíŠ¸ ìƒì„± ì‹œ ì„¤ì •ê°’ìœ¼ë¡œ ì €ì¥) - ì„œë²„/Edge Functionì€ T | null ì§ì ‘ ë°˜í™˜, .value ì ‘ê·¼ ë¶ˆí•„ìš”
      dedup_key: `${tenantId}:ai_suggested:student:${studentRow.student_id}:${toKST().format('YYYY-MM-DD')}`, // ì •ë³¸ í¬ë§·: {tenantId}:{trigger}:{entityType}:{entityId}:{window} (RPC í•¨ìˆ˜ ë°˜í™˜ ìŠ¤í™: { student_id, absent_count })
      expires_at: new Date(Date.now() + (typeof ttlPolicy === 'number' ? ttlPolicy : 0) * 24 * 60 * 60 * 1000), // Policyì—ì„œ ì¡°íšŒí•œ ê°’ë§Œ ì‚¬ìš© (Default Policy: 7ì¼, í…Œë„ŒíŠ¸ ìƒì„± ì‹œ ì„¤ì •ê°’ìœ¼ë¡œ ì €ì¥) - ì„œë²„/Edge Functionì€ T | null ì§ì ‘ ë°˜í™˜, .value ì ‘ê·¼ ë¶ˆí•„ìš”
    }, {
      onConflict: 'tenant_id,dedup_key',
      ignoreDuplicates: false, // ê¸°ì¡´ ì¹´ë“œê°€ ìˆìœ¼ë©´ ì—…ë°ì´íŠ¸
    });
  }
});
```

---

## 6. ìƒí™© ì¸ì‹ ëŒ€ì‹œë³´ë“œ

### 6.1 ê°œìš”

í˜„ì¬ ìƒí™©(ì‹œê°„, ë‚ ì§œ, ì´ë²¤íŠ¸)ì„ ì¸ì‹í•˜ì—¬ ëŒ€ì‹œë³´ë“œ ì¹´ë“œ ìš°ì„ ìˆœìœ„ë¥¼ ì¡°ì •í•˜ëŠ” ì‹œìŠ¤í…œì…ë‹ˆë‹¤.

**âš ï¸ ì •ë³¸ ê·œì¹™:**
- ëŒ€ì‹œë³´ë“œë¥¼ "ìë™ìœ¼ë¡œ ì¡°ì •"í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ **ì¹´ë“œ priority ê°€ì¤‘ì¹˜ë§Œ ì¡°ì •**
- ê·¸ë£¹ ìˆœì„œëŠ” ë¶ˆë³€
- ìƒˆ ì¹´ë“œ íƒ€ì… ìƒì„± ê¸ˆì§€

### 6.2 êµ¬í˜„ ì„¤ê³„

#### 6.2.1 ìƒí™© ì¸ì‹ Hook

**ìœ„ì¹˜:** `packages/hooks/use-context-aware-dashboard/src/index.ts`

**ê¸°ëŠ¥:**
- í˜„ì¬ ì‹œê°„, ìš”ì¼, ì›”ë§ ì—¬ë¶€ ë“± ìƒí™© ê°ì§€
- ëŒ€ì‹œë³´ë“œ ì¹´ë“œ ìš°ì„ ìˆœìœ„ ìë™ ì¡°ì •
- ìƒí™©ë³„ ì¶”ì²œ ì•¡ì…˜ ì œê³µ

**êµ¬í˜„:**

```typescript
interface ContextAwareState {
  timeOfDay: 'morning' | 'afternoon' | 'evening' | 'night';
  dayOfWeek: DayOfWeek;
  isMonthEnd: boolean;
  isWeekend: boolean;
  hasUpcomingClasses: boolean;
  hasFinishedClasses: boolean;
  recommendedActions: string[];
}

export function useContextAwareDashboard(): ContextAwareState {
  const currentTime = toKST();
  const hour = currentTime.hour();
  const day = currentTime.day();
  const date = currentTime.date();

  const timeOfDay = useMemo(() => {
    if (hour >= 6 && hour < 12) return 'morning';
    if (hour >= 12 && hour < 18) return 'afternoon';
    if (hour >= 18 && hour < 22) return 'evening';
    return 'night';
  }, [hour]);

  // âœ… ì •ë³¸: Policyì—ì„œ ì¡°íšŒ (í•˜ë“œì½”ë”©ëœ ê¸°ë³¸ê°’ ì‚¬ìš© ê¸ˆì§€)
  const { data: monthEndThresholdPolicy } = useTenantSettingByPath('billing.month_end_threshold_day');
  // ë˜ëŠ”: const threshold = await apiClient.getTenantSetting(tenantId, 'billing.month_end_threshold_day');
  // ì„œë²„/Edge Functionì—ì„œëŠ”: await getTenantSettingByPath(supabase, tenantId, 'billing.month_end_threshold_day')

  // âœ… ì •ë³¸: ëª¨ë“  ê°’ì€ return ì „ì— ì •ì˜
  const isWeekend = day === 0 || day === 6;

  if (!monthEndThresholdPolicy) {
    // âš ï¸ ì¤‘ìš”: Policy ê°’ì´ ì—†ìœ¼ë©´ ì‹¤í–‰ ì•ˆ í•¨ (Default PolicyëŠ” í…Œë„ŒíŠ¸ ìƒì„± ì‹œ ì„¤ì •ê°’ìœ¼ë¡œ ì €ì¥ë¨)
    // Fail-Closed: ì •ì±…ì´ ì—†ìœ¼ë©´ ì‹ í˜¸ëŠ” falseë¥¼ ë‹´ì€ ê°ì²´ ë°˜í™˜
    return {
      timeOfDay,
      dayOfWeek: getTodayDayOfWeek(),
      isMonthEnd: false,
      isWeekend,
      hasUpcomingClasses: false,
      hasFinishedClasses: false,
      recommendedActions: []
    };
  }
  // âœ… ì •ë³¸: Policyì—ì„œ ì¡°íšŒí•œ ê°’ ì‚¬ìš© (ì§ì ‘ ê°’ ì‚¬ìš©, .value ì ‘ê·¼ ë¶ˆí•„ìš”)
  const monthEndThresholdDay = typeof monthEndThresholdPolicy === 'number' ? monthEndThresholdPolicy : undefined;
  const isMonthEnd = monthEndThresholdDay !== undefined && date >= monthEndThresholdDay;

  const { data: todayClasses } = useClasses({ day_of_week: getTodayDayOfWeek() });
  const hasUpcomingClasses = useMemo(() => {
    return todayClasses?.some(cls => {
      const [h, m] = cls.start_time.split(':').map(Number);
      const classTime = currentTime.hour(h).minute(m);
      return classTime.isAfter(currentTime) && classTime.diff(currentTime, 'minute') <= 60;
    }) ?? false;
  }, [todayClasses, currentTime]);

  // ìˆ˜ì—… ì¢…ë£Œ í›„ ê°ì§€ (ìˆ˜ì—… ì¢…ë£Œ í›„ 30ë¶„ ì´ë‚´)
  const hasFinishedClasses = useMemo(() => {
    if (!todayClasses || todayClasses.length === 0) return false;

    return todayClasses.some((cls) => {
      if (!cls.start_time) return false;

      const [hour, minute] = cls.start_time.split(':').map(Number);
      const classStartTime = currentTime.hour(hour).minute(minute).second(0).millisecond(0);
      // ê¸°ë³¸ ìˆ˜ì—… ì‹œê°„ 60ë¶„ ê°€ì • (ì‹¤ì œë¡œëŠ” cls.duration_minutes ì‚¬ìš©)
      const durationMinutes = (cls as { duration_minutes?: number }).duration_minutes || 60;
      const classEndTime = classStartTime.add(durationMinutes, 'minute');
      const diffMinutes = currentTime.diff(classEndTime, 'minute');

      // ìˆ˜ì—… ì¢…ë£Œ í›„ 30ë¶„ ì´ë‚´
      return diffMinutes > 0 && diffMinutes <= 30;
    });
  }, [todayClasses, currentTime]);

  const recommendedActions = useMemo(() => {
    const actions: string[] = [];

    if (timeOfDay === 'morning' && hasUpcomingClasses) {
      actions.push('ì˜¤ëŠ˜ ìˆ˜ì—… ì¤€ë¹„');
    }

    if (isMonthEnd) {
      actions.push('ì´ë²ˆ ë‹¬ ì²­êµ¬ì„œ í™•ì¸');
    }

    if (hasFinishedClasses) {
      actions.push('ìƒë‹´ì¼ì§€ ì‘ì„±');
    }

    return actions;
  }, [timeOfDay, hasUpcomingClasses, isMonthEnd, hasFinishedClasses]);

  return {
    timeOfDay,
    dayOfWeek: getTodayDayOfWeek(),
    isMonthEnd,
    isWeekend,
    hasUpcomingClasses,
    hasFinishedClasses, // âœ… êµ¬í˜„ ì™„ë£Œ: ìˆ˜ì—… ì¢…ë£Œ í›„ 30ë¶„ ì´ë‚´ ê°ì§€
    recommendedActions,
  };
}
```

#### 6.2.2 HomePage í†µí•©

**HomePage.tsx ìˆ˜ì •:**

```typescript
import { useContextAwareDashboard } from '@hooks/use-context-aware-dashboard';

export function HomePage() {
  const contextAware = useContextAwareDashboard();

  // ìƒí™©ì— ë”°ë¥¸ ì¹´ë“œ ìš°ì„ ìˆœìœ„ ì¡°ì •
  const sortedCards = useMemo(() => {
    const cards: DashboardCard[] = [];

    // 1. Emergency Cards (í•­ìƒ ìµœìƒë‹¨)
    if (emergencyCards) cards.push(...emergencyCards);

    // 2. ì •ë³¸ ê·œì¹™: ê·¸ë£¹ ìˆœì„œ ë¶ˆë³€
    // ì›”ë§ì—ëŠ” Billing ì¹´ë“œ priorityë§Œ +2 (ë‚´ë¶€ ì •ë ¬ë§Œ ë³€ë™)

    // 3. AI Briefing Cards
    if (aiBriefingCards) cards.push(...aiBriefingCards);

    // ì •ë³¸: ìƒí™©ë³„ ì¶”ì²œ ì•¡ì…˜ì€ ì¹´ë“œê°€ ì•„ë‹ˆë¼ ìƒë‹¨ ë°°ë„ˆ/ì¸ë¼ì¸ íŒíŠ¸ë¡œë§Œ ë…¸ì¶œ
    // í–‰ë™ì´ í•„ìš”í•œ ê±´ ì„œë²„ê°€ TaskCardë¡œ ë§Œë“¤ì–´ì„œ STUDENT_TASKS ê·¸ë£¹ìœ¼ë¡œ ë“¤ì–´ì˜´ (StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)

    // ... ë‚˜ë¨¸ì§€ ì¹´ë“œ

    return cards;
  }, [emergencyCards, contextAware, billingSummary, aiBriefingCards]);

  return (
    <Container>
      {/* ìƒí™© ì¸ì‹ ë°°ë„ˆ */}
      {contextAware.recommendedActions.length > 0 && (
        <Card padding="sm" variant="info" style={{ marginBottom: 'var(--spacing-md)' }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: 'var(--spacing-sm)' }}>
            <span>ğŸ’¡</span>
            <span>ì˜¤ëŠ˜ ì¶”ì²œ: {contextAware.recommendedActions.join(', ')}</span>
          </div>
        </Card>
      )}

      {/* ì¹´ë“œ ê·¸ë¦¬ë“œ */}
      <Grid columns={{ xs: 1, sm: 2, md: 3 }} gap="md">
        {sortedCards.map(card => renderCard(card))}
      </Grid>
    </Container>
  );
}
```

#### 6.2.3 DashboardCard Renderer Registry íŒ¨í„´ (SSOT ì¹œí™”)

**âš ï¸ ì¤‘ìš”: HomePageì™€ AllCardsPageì—ì„œ `renderCard` í•¨ìˆ˜ ì¤‘ë³µ ì œê±°**

**ë¬¸ì œì :**
- `HomePage.tsx`ì™€ `AllCardsPage.tsx`ì—ì„œ ë™ì¼í•œ `renderCard` ë¡œì§ì´ ì¤‘ë³µë¨
- Emergency Card, AI Briefing Card, Class Card, Stats Card, Billing Summary Card ë Œë”ë§ ë¡œì§ì´ ë‘ íŒŒì¼ì— ì¤‘ë³µ ì¡´ì¬
- ì½”ë“œ ë³€ê²½ ì‹œ ë‘ ê³³ ëª¨ë‘ ìˆ˜ì •í•´ì•¼ í•˜ëŠ” ìœ ì§€ë³´ìˆ˜ ë¬¸ì œ

**í•´ê²° ë°©ì•ˆ: Renderer Registry íŒ¨í„´**

**ìœ„ì¹˜:** `apps/academy-admin/src/utils/dashboardCardRenderer.ts`

**êµ¬í˜„ ë°©ì‹:**

```typescript
import type { DashboardCard } from '../types/dashboardCard';
import { StudentTaskCard } from '../components/StudentTaskCard';
import { EmergencyCard } from '../components/dashboard-cards/EmergencyCard';
import { AIBriefingCard } from '../components/dashboard-cards/AIBriefingCard';
import { ClassCard } from '../components/dashboard-cards/ClassCard';
import { StatsCard } from '../components/dashboard-cards/StatsCard';
import { BillingSummaryCard } from '../components/dashboard-cards/BillingSummaryCard';
import { useStudentTaskCardAction } from '@hooks/use-student';
import { handleCardClick } from '../utils/handleCardClick';

// Renderer Registry: ì¹´ë“œ íƒ€ì…ë³„ ë Œë” í•¨ìˆ˜ ë§¤í•‘
// âš ï¸ ì¤‘ìš”: React Hook ê·œì¹™ ì¤€ìˆ˜ - Hookì€ ì»´í¬ë„ŒíŠ¸ ìµœìƒìœ„ì—ì„œë§Œ í˜¸ì¶œ ê°€ëŠ¥
// RendererëŠ” ì»´í¬ë„ŒíŠ¸ë¡œ ë§Œë“¤ê±°ë‚˜, ë°”ê¹¥ ì»´í¬ë„ŒíŠ¸ì—ì„œ Hookì„ í˜¸ì¶œí•œ ë’¤ ì£¼ì…í•´ì•¼ í•¨
function TaskCardRenderer({ card, navigate }: { card: DashboardCard; navigate: NavigateFunction }) {
    const handleAction = useStudentTaskCardAction();
    return (
      <StudentTaskCard
        key={card.id}
        card={card as StudentTaskCardType}
        onAction={handleAction}
      />
    );
}

const cardRenderers: Record<string, (card: DashboardCard, navigate: NavigateFunction) => React.ReactNode> = {
  'task_type': (card, navigate) => <TaskCardRenderer card={card} navigate={navigate} />,
  'emergency': (card, navigate) => <EmergencyCard key={card.id} card={card as EmergencyCard} onAction={handleCardClick(card, navigate)} />,
  'ai_briefing': (card, navigate) => <AIBriefingCard key={card.id} card={card as AIBriefingCard} onAction={handleCardClick(card, navigate)} />,
  'class': (card, navigate) => <ClassCard key={card.id} card={card as ClassCard} onAction={handleCardClick(card, navigate)} />,
  'stats': (card, navigate) => <StatsCard key={card.id} card={card as StatsCard} onAction={handleCardClick(card, navigate)} />,
  'billing_summary': (card, navigate) => <BillingSummaryCard key={card.id} card={card as BillingSummaryCard} onAction={handleCardClick(card, navigate)} />,
};

export function renderCard(card: DashboardCard, navigate: NavigateFunction): React.ReactNode {
  // Student Task Card ì²´í¬
  if ('task_type' in card) {
    return cardRenderers['task_type'](card, navigate);
  }

  // íƒ€ì…ë³„ ë Œë”ëŸ¬ í˜¸ì¶œ
  if ('type' in card && card.type in cardRenderers) {
    return cardRenderers[card.type](card, navigate);
  }

  return null;
}
```

**ì‚¬ìš© ì˜ˆì‹œ:**

```typescript
// HomePage.tsx, AllCardsPage.tsxì—ì„œ ê³µí†µ ì‚¬ìš©
import { renderCard } from '../utils/dashboardCardRenderer';

export function HomePage() {
  const navigate = useNavigate();
  // ... ì¹´ë“œ ë°ì´í„° ì¡°íšŒ

  return (
    <Grid columns={{ xs: 1, sm: 2, md: 3 }} gap="md">
      {sortedCards.map((card) => renderCard(card, navigate))}
    </Grid>
  );
}
```

**ì¥ì :**
- SSOT ì›ì¹™ ì¤€ìˆ˜: ë Œë”ë§ ë¡œì§ì´ í•œ ê³³ì—ë§Œ ì¡´ì¬
- ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ: ì¹´ë“œ ìŠ¤íƒ€ì¼ ë³€ê²½ ì‹œ í•œ ê³³ë§Œ ìˆ˜ì •
- íƒ€ì… ì•ˆì •ì„±: TypeScriptë¡œ íƒ€ì… ì²´í¬ ê°€ëŠ¥
- í™•ì¥ì„±: ìƒˆë¡œìš´ ì¹´ë“œ íƒ€ì… ì¶”ê°€ ì‹œ Registryì—ë§Œ ë“±ë¡

---

#### 6.2.4 ëŒ€ì‹œë³´ë“œ ì¹´ë“œ ê³µí†µí™” ì „ëµ (Phase 2 ì‹œê°ì  ê°œì„ )

**âš ï¸ ì¤‘ìš”: Phase 2 ì‹œê°ì  ìœ„ê³„ ê°œì„ ì„ ìœ„í•œ ê³µí†µí™” ì „ëµ**

**ëª©ì :**
- Phase 2 ì‹œê°ì  ìœ„ê³„ ê°œì„  ì‘ì—…ëŸ‰ ëŒ€í­ ê°ì†Œ
- ì¹´ë“œë³„ ê³µí†µ UI íŒ¨í„´ ì¼ê´€ì„± ë³´ì¥
- ë„¤íŠ¸ì›Œí¬ ì¤‘ë³µ ì œê±° ë° ë¡œë”© íƒ€ì´ë° ì•ˆì •í™”

**ê³µí†µí™” ìš°ì„ ìˆœìœ„:**

**Tier 1: ì¦‰ì‹œ ê³µí†µí™” (ì„±ëŠ¥/ì •í•©ì„±)**

1. **`useMonthlyInvoices` Hook**
   - **íŒŒì¼:** `apps/academy-admin/src/hooks/useMonthlyInvoices.ts` (ì‹ ê·œ)
   - **ì´ìœ :**
     - HomePage 3ê³³, AllCardsPage 2ê³³, ë‹¤ë¥¸ í˜ì´ì§€ ë‹¤ìˆ˜ì—ì„œ ì¤‘ë³µ
     - ë„¤íŠ¸ì›Œí¬ ì¤‘ë³µ ì œê±°, ë¡œë”© íƒ€ì´ë° ë™ê¸°í™”
   - **êµ¬í˜„:**
     ```typescript
     export function useMonthlyInvoices() {
       const context = getApiContext();
       const tenantId = context.tenantId;
       const currentMonth = toKST().format('YYYY-MM');

       return useQuery({
         queryKey: ['invoices', tenantId, currentMonth],
         queryFn: async () => {
           // invoices ì¡°íšŒ ë¡œì§
         },
         staleTime: 30000, // 30ì´ˆ ìºì‹±
       });
     }
     ```
   - **ë°˜í™˜:** `{ invoices, isLoading, isFetching, error, monthKey }`
   - **ìš°ì„ ìˆœìœ„:** ìµœìš°ì„ 

2. **`DashboardCardShell` ì»´í¬ë„ŒíŠ¸**
   - **íŒŒì¼:** `apps/academy-admin/src/components/dashboard/DashboardCardShell.tsx` (ì‹ ê·œ)
   - **ì´ìœ :**
     - ì¹´ë“œ ì™¸ê³½ UI íŒ¨í„´ì´ ê³µí†µë¨ (ì¢Œì¸¡ ìŠ¤íŠ¸ë¦½, ë°°ì§€, í—¤ë”, hover, í´ë¦­, ì—…ë°ì´íŠ¸ dot, fade-in)
     - ê° ì¹´ë“œì—ì„œ ê°œë³„ êµ¬í˜„ ì‹œ 31ê°œ ìœ„ì¹˜ê°€ 50ê°œ+ë¡œ ì¦ê°€
     - ì‹œê°ì  ì¼ê´€ì„± ìœ ì§€
   - **Props ì„¤ê³„:**
     ```typescript
     interface DashboardCardShellProps {
       // ì™¸ê³½ UI
       tone?: 'default' | 'info' | 'warning' | 'danger';
       leftAccent?: boolean; // ì¢Œì¸¡ ìƒ‰ ìŠ¤íŠ¸ë¦½
       icon?: React.ReactNode;
       title: string;
       badge?: React.ReactNode; // ìš°ìƒë‹¨ ë°°ì§€
       metaRight?: React.ReactNode; // ìš°ìƒë‹¨ ë©”íƒ€
       footer?: React.ReactNode;

       // ìƒí˜¸ì‘ìš©
       onClick?: () => void;
       animationDelayMs?: number;
       lastUpdatedAt?: Date;

       // ë‚´ë¶€ ì½˜í…ì¸ 
       children: React.ReactNode;
     }
     ```
   - **íš¨ê³¼:**
     - Phase 2 ì‹œê°ì  ìœ„ê³„ ê°œì„  ì‘ì—…ëŸ‰ ëŒ€í­ ê°ì†Œ
     - ì¹´ë“œë³„ ê³µí†µ UI ì¼ê´€ì„± ë³´ì¥
   - **ìš°ì„ ìˆœìœ„:** ìµœìš°ì„ 

**Tier 2: ì¦‰ì‹œ ê³µí†µí™” (ì‹œê°ì  ì¼ê´€ì„±)**

3. **`DashboardCardSkeleton` ì»´í¬ë„ŒíŠ¸**
   - **íŒŒì¼:** `apps/academy-admin/src/components/dashboard/DashboardCardSkeleton.tsx` (ì‹ ê·œ)
   - **ì´ìœ :** HomePage, AllCardsPageì—ì„œ ë™ì¼í•œ ë¡œë”© UX í•„ìš”
   - **ìš°ì„ ìˆœìœ„:** ë†’ìŒ

4. **`StaggeredGrid` ë˜í¼ ì»´í¬ë„ŒíŠ¸**
   - **íŒŒì¼:** `apps/academy-admin/src/components/dashboard/StaggeredGrid.tsx` (ì‹ ê·œ)
   - **ì´ìœ :**
     - `renderCard(..., { animationDelay })` ë°©ì‹ì€ íŒŒê¸‰ íš¨ê³¼ í¼
     - Grid ë˜í¼ì—ì„œ childrenì— `animationDelay` ì£¼ì…ì´ ë” ë‹¨ìˆœ
   - **êµ¬í˜„:**
     ```typescript
     interface StaggeredGridProps {
       children: React.ReactNode[];
       delayMs?: number; // ê¸°ë³¸ê°’: 50ms
       columns?: { xs?: number; sm?: number; md?: number };
       gap?: SpacingToken;
     }
     ```
   - **íš¨ê³¼:** `renderCard`, ì¹´ë“œ ì»´í¬ë„ŒíŠ¸, íƒ€ì… ìˆ˜ì • ìµœì†Œí™”
   - **ìš°ì„ ìˆœìœ„:** ë†’ìŒ

5. **`useLastUpdatedMap` ë˜ëŠ” `useTransientUpdatedFlag` Hook**
   - **íŒŒì¼:** `apps/academy-admin/src/hooks/useLastUpdatedMap.ts` (ì‹ ê·œ)
   - **ì´ìœ :**
     - ê° `useQuery`ì— `onSuccess` ì¶”ê°€ ì‹œ ì½”ë“œ ë³µì¡ë„ ì¦ê°€
     - í˜ì´ì§€ë³„ í¸ì°¨ ë°œìƒ
   - **êµ¬í˜„ ì˜µì…˜:**
     - Option A: `useLastUpdatedMap(keys: string[])` - ì—¬ëŸ¬ queryKey ì¶”ì 
     - Option B: `useTransientUpdatedFlag(trigger, 2000ms)` - ë‹¨ìˆœ í”Œë˜ê·¸
     - Option C: `react-query`ì˜ `dataUpdatedAt` í™œìš©
   - **`DashboardCardShell`ì´ `lastUpdatedAt`ì„ ë°›ì•„ ìš°ìƒë‹¨ dot í‘œì‹œ**
   - **ìš°ì„ ìˆœìœ„:** ë†’ìŒ

**Tier 3: ë‹¨ê¸° ê³µí†µí™” (ìœ ì§€ë³´ìˆ˜ì„±)**

6. **`useEmergencyCards` Hook**
   - **íŒŒì¼:** `packages/hooks/use-dashboard/src/useEmergencyCards.ts` (ì‹ ê·œ)
   - **ì´ìœ :**
     - HomePageì™€ AllCardsPageì—ì„œ ë¡œì§ ì¤‘ë³µ (ì•½ 85ì¤„ vs 27ì¤„)
     - AllCardsPage êµ¬í˜„ì´ ë¶ˆì™„ì „
     - Policy ê¸°ë°˜ ì„ê³„ê°’ ì²˜ë¦¬ í¬í•¨ í•„ìš”
   - **ìš°ì„ ìˆœìœ„:** ë†’ìŒ

7. **`useAIBriefingCards` Hook**
   - **íŒŒì¼:** `packages/hooks/use-dashboard/src/useAIBriefingCards.ts` (ì‹ ê·œ)
   - **ì´ìœ :**
     - HomePageì™€ AllCardsPageì—ì„œ ë¡œì§ ì¤‘ë³µ (ì•½ 158ì¤„ vs 51ì¤„)
     - AllCardsPage êµ¬í˜„ì´ ë¶ˆì™„ì „
     - `useMonthlyInvoices` ì‚¬ìš©
   - **ìš°ì„ ìˆœìœ„:** ë†’ìŒ

**Tier 4: ì„ íƒì  ê³µí†µí™” (ì¬ì‚¬ìš©ì„±)**

8. **`HeroSummaryStrip` ì»´í¬ë„ŒíŠ¸**
   - **íŒŒì¼:** `apps/academy-admin/src/components/dashboard/HeroSummaryStrip.tsx` (ì‹ ê·œ)
   - **ì´ìœ :**
     - HomePage ì „ìš©ì´ì§€ë§Œ AllCardsPageë‚˜ ë‹¤ë¥¸ ëŒ€ì‹œë³´ë“œì—ì„œë„ ì¬ì‚¬ìš© ê°€ëŠ¥
     - ì—…ì¢… í™•ì¥ ì‹œ ì¬ì‚¬ìš©ì„± ë†’ìŒ
   - **ì£¼ì˜:** ë¹„ì£¼ì–¼(ê·¸ë¼ë°ì´ì…˜/ë¸”ëŸ¬)ì€ ui-core í† í°/ë³€ìˆ˜ë¡œë§Œ ì²˜ë¦¬
   - **ìš°ì„ ìˆœìœ„:** ì¤‘ê°„

9. **`getAutomationPolicy` + `useAutomationPolicy` Hook**
   - **íŒŒì¼:**
     - `apps/academy-admin/src/utils/getAutomationPolicy.ts` (ì‹ ê·œ)
     - `apps/academy-admin/src/hooks/useAutomationPolicy.ts` (ì‹ ê·œ)
   - **ì´ìœ :**
     - Phase 3ì´ì§€ë§Œ ì¥ê¸°ì ìœ¼ë¡œ í•„ìˆ˜
     - Fail-closed ì›ì¹™ ì ìš© ìš©ì´
     - í•˜ë“œì½”ë”© ì„ê³„ê°’ ì œê±°
   - **ìš°ì„ ìˆœìœ„:** ì¤‘ê°„ (Phase 3)

**ê³µí†µí™” ë¹„ì¶”ì²œ:**

10. **ì¹´ë“œ ë‚´ë¶€ ì½˜í…ì¸  ê³µí†µí™”**
    - **ì´ìœ :**
      - BillingSummaryCard: ê²Œì´ì§€/ì¹©
      - ClassCard: ì‹œê°„ì¶•/ì¶œì„ë¥  í”„ë¡œê·¸ë ˆìŠ¤ ë°”
      - AIBriefingCard: ì¸ì‚¬ì´íŠ¸ í•˜ì´ë¼ì´íŠ¸
      - ê³µí†µí™” ì‹œ ì˜µì…˜ í­ë°œë¡œ ìœ ì§€ë³´ìˆ˜ ì–´ë ¤ì›€
    - **íŒë‹¨:** Shellë§Œ ê³µí†µí™”, ë‚´ë¶€ëŠ” ê°œë³„ ì¹´ë“œ ìœ ì§€

**ìµœì¢… ê³µí†µí™” ìš°ì„ ìˆœìœ„:**

**Phase 1 (ì¦‰ì‹œ):**
1. `useMonthlyInvoices` Hook
2. `DashboardCardShell` ì»´í¬ë„ŒíŠ¸

**Phase 2 (ë‹¨ê¸°):**
3. `DashboardCardSkeleton` ì»´í¬ë„ŒíŠ¸
4. `StaggeredGrid` ë˜í¼
5. `useLastUpdatedMap` Hook
6. `useEmergencyCards` Hook
7. `useAIBriefingCards` Hook

**Phase 3 (ì„ íƒ):**
8. `HeroSummaryStrip` ì»´í¬ë„ŒíŠ¸
9. `getAutomationPolicy` + `useAutomationPolicy` Hook

---

#### 6.2.5 Shared Hook ì „ì²´ ëª©ë¡ (ì—…ì¢… ë…ë¦½)

**ìœ„ì¹˜:** `packages/hooks/*`

**ëª©ì :** ëª¨ë“  ì—…ì¢…ì—ì„œ ê³µí†µìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” React Query ê¸°ë°˜ Hook ì œê³µ

**ë¶„ë¥˜:** Shared Hook (Featureë¥¼ UIì—ì„œ ì“°ê¸° ìœ„í•œ React Query/ìƒíƒœ ìº¡ìŠí™”. UI ë Œë”ë§ ê¸ˆì§€. Hook/Effectì—ì„œ ìë™ navigate() í˜¸ì¶œ ê¸ˆì§€, ë‹¨ ì‚¬ìš©ì ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬(onClick) ë‚´ ì´ë™ì€ í—ˆìš©)

**í˜„ì¬ Shared Catalogì— ë“±ë¡ëœ Hook (10ê°œ):**

| Hook íŒ¨í‚¤ì§€ | ê²½ë¡œ | ì£¼ìš” Hook | ìš©ë„ | ì—…ì¢… ë…ë¦½ì„± | ë“±ë¡ ìƒíƒœ |
|------------|------|----------|------|------------|----------|
| use-task-cards | `packages/hooks/use-task-card` | `useTaskCards` | TaskCard ì¡°íšŒ | âœ… | âœ… ë“±ë¡ë¨ |
| use-student-task-cards | `packages/hooks/use-student` | `useStudentTaskCards` | í•™ìƒìš© TaskCard ì¡°íšŒ | âš ï¸ Academy ì „ìš© | âœ… ë“±ë¡ë¨ |
| use-config | `packages/hooks/use-config` | `useConfig`, `useTenantSettingByPath` | ì„¤ì • ê´€ë¦¬ | âœ… | âœ… ë“±ë¡ë¨ |
| use-class | `packages/hooks/use-class` | `useClasses`, `useClass` | ìˆ˜ì—… ê´€ë¦¬ | âœ… | âœ… ë“±ë¡ë¨ |
| use-attendance | `packages/hooks/use-attendance` | `useAttendanceLogs`, `useCreateAttendanceLog` | ì¶œì„ ê´€ë¦¬ | âœ… | âœ… ë“±ë¡ë¨ |
| use-billing | `packages/hooks/use-billing` | `useBillingHistory`, `useInvoice` | ê³¼ê¸ˆ/ì²­êµ¬ | âœ… | âœ… ë“±ë¡ë¨ |
| use-adaptive-navigation | `packages/hooks/use-adaptive-navigation` | `useAdaptiveNavigation` | ì ì‘í˜• ë„¤ë¹„ê²Œì´ì…˜ | âœ… | âœ… ë“±ë¡ë¨ |
| use-context-signals | `packages/hooks/use-context-signals` | `useContextSignals` | ì»¨í…ìŠ¤íŠ¸ ì‹ í˜¸ | âœ… | âœ… ë“±ë¡ë¨ |
| use-month-end-adaptation | `packages/hooks/use-month-end-adaptation` | `useMonthEndAdaptation` | ì›”ë§ ì ì‘ | âœ… | âœ… ë“±ë¡ë¨ |
| use-context-aware-dashboard | `packages/hooks/use-context-aware-dashboard` | `useContextAwareDashboard` | ì»¨í…ìŠ¤íŠ¸ ì¸ì‹ ëŒ€ì‹œë³´ë“œ | âœ… | âœ… ë“±ë¡ë¨ |

**êµ¬í˜„ë˜ì—ˆìœ¼ë‚˜ Shared Catalogì— ë¯¸ë“±ë¡ëœ Hook (17ê°œ):**

| Hook íŒ¨í‚¤ì§€ | ê²½ë¡œ | ì£¼ìš” Hook | ìš©ë„ | ì—…ì¢… ë…ë¦½ì„± | ë“±ë¡ ìƒíƒœ |
|------------|------|----------|------|------------|----------|
| use-ai-suggestion | `packages/hooks/use-ai-suggestion` | `useAISuggestion` | AI ì œì•ˆ | âš ï¸ LEGACY | âš ï¸ ë“±ë¡ í•„ìš” (v2.x, ì‹ ê·œ ì‚¬ìš© ê¸ˆì§€, Phase2 ì •ë¦¬ ëŒ€ìƒ) |
| use-auth | `packages/hooks/use-auth` | `useSession`, `useLoginWithEmail` | ì¸ì¦ | âœ… | âš ï¸ ë“±ë¡ í•„ìš” |
| use-debounce | `packages/hooks/use-debounce` | `useDebounce` | ë””ë°”ìš´ìŠ¤ | âœ… | âš ï¸ ë“±ë¡ í•„ìš” |
| use-industry-translations | `packages/hooks/use-industry-translations` | `useIndustryTranslations` | ì—…ì¢…ë³„ ë²ˆì—­ | âœ… | âš ï¸ ë“±ë¡ í•„ìš” |
| use-parent | `packages/hooks/use-parent` | `useParents`, `useParent` | í•™ë¶€ëª¨ ê´€ë¦¬ | âœ… | âš ï¸ ë“±ë¡ í•„ìš” |
| use-schema | `packages/hooks/use-schema` | `useSchema` | ìŠ¤í‚¤ë§ˆ ê´€ë¦¬ | âœ… | âš ï¸ ë“±ë¡ í•„ìš” |
| use-schema-registry | `packages/hooks/use-schema-registry` | `useSchemaRegistry`, `useIsSuperAdmin` | ìŠ¤í‚¤ë§ˆ ë ˆì§€ìŠ¤íŠ¸ë¦¬ | âœ… | âš ï¸ ë“±ë¡ í•„ìš” |
| use-student | `packages/hooks/use-student` | `useStudents`, `useStudent` | í•™ìƒ ê´€ë¦¬ | âš ï¸ Academy ì „ìš© | âš ï¸ ë“±ë¡ í•„ìš” |
| use-tenant-feature | `packages/hooks/use-tenant-feature` | `useTenantFeature` | í…Œë„ŒíŠ¸ ê¸°ëŠ¥ | âœ… | âš ï¸ ë“±ë¡ í•„ìš” |
| use-weather-signals | `packages/hooks/use-weather-signals` | `useWeatherSignals` | ë‚ ì”¨ ì‹ í˜¸ | âœ… | âš ï¸ ë“±ë¡ í•„ìš” |

**ì¶”ê°€ ì˜ˆì • Hook (ì§ì ‘ êµ¬í˜„ íŒ¨í„´ ì¹˜í™˜ì„ ìœ„í•´ í•„ìš”):**

| í…Œì´ë¸”ëª… | ì˜ˆìƒ Hook íŒ¨í‚¤ì§€ | ì£¼ìš” Hook | ìš©ë„ | ìš°ì„ ìˆœìœ„ |
|---------|----------------|----------|------|---------|
| `student_consultations` | `use-consultation` | `useConsultations`, `useConsultation` | ìƒë‹´ì¼ì§€ ì¡°íšŒ | P1 |
| `ai_insights` | `use-ai-insights` | `useAIInsights`, `useAIInsight` | AI ì¸ì‚¬ì´íŠ¸ ì¡°íšŒ | P1 |
| `daily_region_metrics` | `use-regional-analytics` | `useRegionalMetrics`, `useRegionalStats` | ì§€ì—­ í†µê³„ ì¡°íšŒ | P1 |
| `payments` | `use-payment` | `usePayments`, `usePayment` | ê²°ì œ ë‚´ì—­ ì¡°íšŒ | P2 |
| `invoice_items` | `use-invoice-item` | `useInvoiceItems` | ì¸ë³´ì´ìŠ¤ í•­ëª© ì¡°íšŒ | P2 |
| `notification_templates` | `use-notification-template` | `useNotificationTemplates`, `useNotificationTemplate` | ì•Œë¦¼ í…œí”Œë¦¿ ì¡°íšŒ | P2 |
| `guardians` | `use-guardian` | `useGuardians`, `useGuardian` | ë³´í˜¸ì ì¡°íšŒ | P2 |
| `persons` | `use-student` (í™•ì¥) | `useStudents` (ì´ë¯¸ ì¡´ì¬, ë“±ë¡ í•„ìš”) | í•™ìƒ/ê³ ê° ì¡°íšŒ | P0 |

**Hook êµ¬ì¡° íŒ¨í„´:**
```
packages/hooks/{hook-name}/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts           # Hook export
â”‚   â””â”€â”€ {hook-name}.ts     # Hook êµ¬í˜„
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json
```

**Shared Hook vs ì—…ì¢…ë³„ Hook êµ¬ë¶„:**
- **Shared Hook:** ëª¨ë“  ì—…ì¢…ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ Hook (ì˜ˆ: `use-auth`, `use-billing`, `use-config`)
- **ì—…ì¢…ë³„ Hook:** íŠ¹ì • ì—…ì¢…ì—ì„œë§Œ ì‚¬ìš©í•˜ëŠ” Hook (ì˜ˆ: `use-student`ëŠ” Academy ì „ìš©, í–¥í›„ ë‹¤ë¥¸ ì—…ì¢…ì—ì„œëŠ” ë‹¤ë¥¸ ìš©ì–´ë¡œ ë³€í™˜)

**ë¶ˆë³€ ê·œì¹™:**
- ëª¨ë“  Hookì€ `@api-sdk/core`ë¥¼ í†µí•´ì„œë§Œ API ìš”ì²­ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
- Zero-Trust ì›ì¹™: UIëŠ” tenantIdë¥¼ ì§ì ‘ ì „ë‹¬í•˜ì§€ ì•Šìœ¼ë©°, Contextì—ì„œ ìë™ìœ¼ë¡œ ê°€ì ¸ì˜µë‹ˆë‹¤.
- React Query ê¸°ë°˜: `useQuery`, `useMutation`ì„ ì‚¬ìš©í•˜ì—¬ ë°ì´í„° í˜ì¹­ ë° ìºì‹±ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.
- tenant ë³€ê²½ ì‹œ `invalidateQueries()` ìë™ ë°œìƒí•˜ì—¬ ë°ì´í„° ì¼ê´€ì„±ì„ ë³´ì¥í•©ë‹ˆë‹¤.

**ì‚¬ìš©ë²•:**
```typescript
import { useStudents, useStudent } from '@hooks/use-student';
import { useBillingHistory } from '@hooks/use-billing';
import { useSession } from '@hooks/use-auth';
```

#### 6.2.6 ê³µí†µí™” ìš”ì†Œ ë°œê²¬ì„± ê°œì„  (ì‹œìŠ¤í…œì´ ê¸°ì–µí•˜ë„ë¡ ë§Œë“¤ê¸°)

**ëª©ì :** ê³µí†µí™” ìš”ì†Œ(Shared Hook/Feature/Adapter)ë¥¼ ìƒˆë¡œ ë§Œë“¤ì—ˆì„ ë•Œ, ê°œë°œìê°€ ê¸°ì–µí•˜ì§€ ì•Šì•„ë„ ì‹œìŠ¤í…œì´ ìë™ìœ¼ë¡œ ë°œê²¬ ê°€ëŠ¥í•˜ê³  ì¬ì‚¬ìš©ì„ ê°•ì œí•˜ë„ë¡ ë§Œë“œëŠ” ë©”ì»¤ë‹ˆì¦˜.

**í•µì‹¬ ì›ì¹™: "ë§‰ê¸°(Enforcement) + ì°¾ê¸°(Discoverability)"**

##### 6.2.6.1 Shared Catalog íŒŒì¼ ìƒì„± í•„ìš”ì„± ê²€ì¦

**ê²°ë¡ : Shared Catalog íŒŒì¼ ìƒì„± í•„ìš” (P0)**

**ê·¼ê±°:**
1. **ìœ ì‚¬ íŒ¨í„´ ì¡´ì¬:** `packages/core/core-automation/src/automation-event-catalog.ts`ê°€ SSOT íŒ¨í„´ìœ¼ë¡œ ì¡´ì¬í•˜ë©°, Shared Catalogë„ ë™ì¼í•œ íŒ¨í„´ìœ¼ë¡œ ì¼ê´€ì„± ìœ ì§€ í•„ìš”
2. **íŒŒì¼ ë¶€ì¬ ì‹œ ìë™í™” ì‹¤íŒ¨:** íŒŒì¼ì´ ì—†ìœ¼ë©´ Cursor ì§€ì‹œë¬¸ì´ "í•­ëª© ì¶”ê°€" ë‹¨ê³„ì—ì„œ ì‹¤íŒ¨
3. **ë¬¸ì„œ/í´ë”ë§Œìœ¼ë¡œëŠ” ë°œê²¬ì„± í•œê³„:** IDE ìë™ì™„ì„±/íƒ€ì… ì•ˆì •ì„±/ê²€ìƒ‰ì„± ë¶€ì¬ë¡œ ì¤‘ë³µ ì‘ì—… ë°œìƒ

**íŒŒì¼ ìœ„ì¹˜:**
- `packages/shared-catalog.ts` (ë‹¨ì¼ íŒŒì¼, ë¹Œë“œ ì„¤ì • ë¶ˆí•„ìš”)
- âš ï¸ **ì¤‘ìš”: ì´ íŒŒì¼ì€ ì£¼ë¡œ ì •ì  ê²€ì‚¬/ê°€ì´ë“œ SSOTì´ì§€ë§Œ, ëŸ°íƒ€ì„ ê²€ì¦ í•¨ìˆ˜(`assertRegisteredHook` ë“±)ë„ ì œê³µí•©ë‹ˆë‹¤.**
- ëŸ°íƒ€ì„ ê²€ì¦ í•¨ìˆ˜ëŠ” ê°œë°œ í™˜ê²½ì—ì„œë§Œ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤ (í”„ë¡œë•ì…˜ ì„±ëŠ¥ ì˜í–¥ ìµœì†Œí™”).
- `typecheck`ì— í¬í•¨ì‹œí‚¤ë ¤ë©´ `tsconfig.json`ì˜ `references` ë˜ëŠ” ë³„ë„ `scripts/check-shared-catalog.ts`ë¡œ ê°•ì œí•˜ëŠ” ìª½ì´ ì•ˆì •ì ì…ë‹ˆë‹¤.
- monorepo ì„¤ì •ì— ë”°ë¼ ë£¨íŠ¸ `packages/*.ts`ëŠ” ë¹Œë“œ/ë¦°íŠ¸/íƒ€ì…ì²´í¬ì— ì•ˆ ì¡í ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ê²€ì¦ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë³„ë„ë¡œ ì‹¤í–‰í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.

**íŒŒì¼ êµ¬ì¡°:**
```typescript
export interface CatalogItem {
  path: string;           // íŒ¨í‚¤ì§€ ê²½ë¡œ (ì˜ˆ: '@hooks/use-task-card')
  import: string;         // ë³µë¶™ ê°€ëŠ¥í•œ import ë¬¸ì¥
  useWhen: string;        // ì–¸ì œ ì‚¬ìš©í•˜ëŠ”ì§€
  input?: string;         // ì…ë ¥ íƒ€ì… (ì„ íƒ)
  output?: string;        // ì¶œë ¥ íƒ€ì… (ì„ íƒ)
  extensionPoints?: string[]; // í™•ì¥ í¬ì¸íŠ¸ (ì„ íƒ)
  doNot?: string[];        // ê¸ˆì§€ íŒ¨í„´ (ìµœì†Œ 1ê°œ ì´ìƒ)
  examples?: string[];     // ë³µë¶™ ê°€ëŠ¥í•œ ì½”ë“œ ì˜ˆì‹œ (2ê°œ ì´ìƒ)
  related?: {              // ê´€ë ¨ í•­ëª© (ì„ íƒ)
    feature?: string;
    adapter?: string;
  };
}

export interface SharedCatalog {
  hooks: Record<string, CatalogItem>;
  features: Record<string, CatalogItem>;
  adapters: Record<string, CatalogItem>;
}

export const sharedCatalog: SharedCatalog = {
  hooks: {
    'use-task-cards': {
      path: '@hooks/use-task-card',
      import: 'import { useTaskCards } from "@hooks/use-task-card"',
      useWhen: 'TaskCard ì¡°íšŒê°€ í•„ìš”í•œ ëª¨ë“  í˜ì´ì§€',
      input: '{ entityType: string; limit?: number }',
      output: 'TaskCard[]',
      extensionPoints: ['entityType', 'limit'],
      doNot: [
        'ì§ì ‘ useQueryë¡œ task_cards ì¡°íšŒ',
        'apiClient.get("task_cards") ì§ì ‘ í˜¸ì¶œ',
        'ë§Œë£Œ í•„í„°ë§ ë¡œì§ ì¤‘ë³µ êµ¬í˜„',
      ],
      examples: [
        'const { data } = useTaskCards({ entityType: "student" });',
        'const { data } = useTaskCards({ entityType: "client", limit: 50 });',
      ],
      related: {
        feature: 'task-card-item',
        adapter: 'industryAdapter.taskCards',
      },
    }
  },
  features: {},
  adapters: {}
};

export function searchCatalog(keyword: string): Array<{
  category: 'hooks' | 'features' | 'adapters';
  key: string;
  item: CatalogItem;
}> {
  // ê²€ìƒ‰ ë¡œì§ (í‚¤ì›Œë“œë¡œ hooks/features/adapters ê²€ìƒ‰)
}
```

##### 6.2.6.2 ìš´ì˜ ê·œì¹™ (ë¶ˆë³€)

**[Rule-1] ê³µí†µ ë¡œì§ ë“±ë¡ ì˜ë¬´**
- ê³µí†µ ë¡œì§(Shared Hook/Feature/Adapter)ì„ ìƒˆë¡œ ë§Œë“¤ë©´ `packages/shared-catalog.ts`ì— ì—”íŠ¸ë¦¬ë¥¼ ë°˜ë“œì‹œ ì¶”ê°€í•œë‹¤.
- ì¹´íƒˆë¡œê·¸ ì—”íŠ¸ë¦¬ê°€ ì—†ëŠ” ê³µí†µ ë¡œì§ì€ ë ˆê±°ì‹œë¡œ ê°„ì£¼í•˜ë©° ì‹ ê·œ ì‚¬ìš©ì„ ê¸ˆì§€í•œë‹¤ (ì˜ˆì™¸ëŠ” ì£¼ì„/í‹°ì¼“ ë§í¬ í•„ìˆ˜).

**[Rule-2] ì§ì ‘ êµ¬í˜„ íŒ¨í„´ ê¸ˆì§€**
- ê³µí†µ ë¡œì§ì„ ì‚¬ìš©í•˜ëŠ” í™”ë©´ì—ì„œëŠ” ì§ì ‘ êµ¬í˜„ íŒ¨í„´(apiClient ì§ì ‘ í˜¸ì¶œ ë“±)ì„ ê¸ˆì§€í•œë‹¤.
- ê°€ëŠ¥í•œ ë²”ìœ„ëŠ” ESLintë¡œ ì°¨ë‹¨í•œë‹¤.

**[Rule-3] ë„¤ì´ë°/ê²½ë¡œ ê³ ì •**
- `apiClient` ë³„ì¹­ ì‚¬ìš© ê¸ˆì§€ (í•„ìš” ì‹œ lint/ì£¼ì„ìœ¼ë¡œ ê·œì¹™í™”).
- ê³µí†µ hook/featureëŠ” ì •ë³¸ import ê²½ë¡œë¥¼ ì‚¬ìš©í•˜ë„ë¡ ì •ë¦¬í•œë‹¤.

##### 6.2.6.3 Cursor ì§€ì‹œë¬¸ (ë³µë¶™ ê°€ëŠ¥)

**ì„ í–‰ ì¡°ê±´:**
- `packages/shared-catalog.ts` ì¡´ì¬ ì—¬ë¶€ í™•ì¸
- ì—†ìœ¼ë©´ ìƒì„±: `CatalogItem`/`SharedCatalog`/`sharedCatalog`/`searchCatalog` í¬í•¨ (ë‹¨ì¼ íŒŒì¼)

**ìƒˆ ê³µí†µ ë¡œì§(ì˜ˆ: Hook/Feature/Adapter) ì¶”ê°€ ë˜ëŠ” ë³€ê²½ ì‹œ:**

1. **`packages/shared-catalog.ts`ì— ì—”íŠ¸ë¦¬ ì¶”ê°€/ê°±ì‹ **
   - `key`, `path`, `import`, `useWhen`, `doNot`, `examples`(2ê°œ ì´ìƒ) í•„ìˆ˜
   - `examples`ëŠ” ë³µë¶™ ê°€ëŠ¥í•œ ì½”ë“œ 2ê°œ ì´ìƒ

2. **ì§ì ‘ êµ¬í˜„ íŒ¨í„´ì´ ì¬ë°œ ê°€ëŠ¥í•œ ê²½ìš°**
   - ëª¨ë“  `apps/*/.eslintrc.cjs`ì— `no-restricted-syntax` ê·œì¹™ ì¶”ê°€/í™•ì¥
   - selectorëŠ” ê°ì²´ëª…(`apiClient` ë“±)ì„ ëª…ì‹œí•˜ê³ , messageì— ì •í™•í•œ import ë¬¸ì¥ì„ í¬í•¨
   - ì˜ˆì‹œ:
   ```javascript
   'no-restricted-syntax': [
     'error',
     {
       selector: "CallExpression[callee.object.name='apiClient'][callee.property.name='get'][arguments.0.value='task_cards']",
       message: "task_cards ì§ì ‘ ì¡°íšŒ ê¸ˆì§€. import { useTaskCards } from '@hooks/use-task-card'ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”."
     }
   ]
   ```

3. **ëŒ€í‘œ ì‚¬ìš©ì²˜ 1ê³³ ì´ìƒì„ ê³µí†µ ë¡œì§ìœ¼ë¡œ ì¹˜í™˜í•˜ê³  ì¤‘ë³µ êµ¬í˜„ì„ ì œê±°**

**ê²°ê³¼ë¬¼ ì¶œë ¥ í˜•ì‹:**
- ìˆ˜ì •/ìƒì„± íŒŒì¼ ëª©ë¡(ê²½ë¡œ + ë³€ê²½ ìœ í˜•)
- í•µì‹¬ ë³€ê²½ ìŠ¤ë‹ˆí«(íŒŒì¼ë³„)
- shared-catalogì— ì¶”ê°€ëœ ì—”íŠ¸ë¦¬ ì½”ë“œ ë¸”ë¡
- eslint selector/message ì½”ë“œ ë¸”ë¡

##### 6.2.6.4 ë“±ë¡ ëˆ„ë½ ë°©ì§€ ì¥ì¹˜ (ê°•ì œë ¥)

**A. ì²´í¬ ìŠ¤í¬ë¦½íŠ¸ (ê¶Œì¥ P0)**

**ìœ„ì¹˜:** `scripts/check-shared-catalog.ts`

**ìµœì†Œ ê²€ì¦:**
- `key` ì¤‘ë³µ ì—†ìŒ
- ëª¨ë“  `item`ì— `path`/`import`/`useWhen`/`examples`(>=2) ì¡´ì¬
- `examples`ì— `import { ... } from "..."` í¬í•¨ (ë³µë¶™ ê°€ëŠ¥ì„±)
- `doNot`ê°€ ìµœì†Œ 1ê°œ ì´ìƒ (ê¸ˆì§€ ê·œì¹™ì´ ìˆì–´ì•¼ ì°¨ë‹¨ì´ ë¨)

**í†µí•© ë°©ë²•:**
- `package.json`ì˜ `lint` ë˜ëŠ” `type-check` ìŠ¤í¬ë¦½íŠ¸ì— í¬í•¨
- ë˜ëŠ” `turbo.json`ì˜ pipelineì— ì¶”ê°€

**B. ìƒˆ ê³µí†µ ë¡œì§ ë¯¸ë“±ë¡ íƒì§€ (ì„ íƒ)**

- ê³µí†µ ë¡œì§ì˜ ìœ„ì¹˜ë¥¼ ê°•ì œ: `hooks â†’ packages/hooks/**/use-*.ts`, `features â†’ packages/features/**`
- ì²´í¬ ìŠ¤í¬ë¦½íŠ¸ê°€ "ìƒˆë¡œ ì¶”ê°€ëœ exports"ê°€ ìˆìœ¼ë©´ ì¹´íƒˆë¡œê·¸ì— `key`ê°€ ìˆëŠ”ì§€ í™•ì¸

**C. ëŸ°íƒ€ì„ ìë™ ê²€ì¦ (êµ¬í˜„ ì™„ë£Œ, Automation Event Catalog íŒ¨í„´ê³¼ ë™ì¼)**

**âš ï¸ ìë™ ê²€ì¦ (êµ¬í˜„ ìƒíƒœ):** `packages/shared-catalog.ts`ì— ë‹¤ìŒ ê²€ì¦ í•¨ìˆ˜ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤:
- `assertRegisteredHook(hookKey: string)`: Hookì´ ì¹´íƒˆë¡œê·¸ì— ë“±ë¡ë˜ì–´ ìˆëŠ”ì§€ ê²€ì¦ (Fail-Closed)
- `assertRegisteredFeature(featureKey: string)`: Featureê°€ ì¹´íƒˆë¡œê·¸ì— ë“±ë¡ë˜ì–´ ìˆëŠ”ì§€ ê²€ì¦ (Fail-Closed)
- `assertRegisteredAdapter(adapterKey: string)`: Adapterê°€ ì¹´íƒˆë¡œê·¸ì— ë“±ë¡ë˜ì–´ ìˆëŠ”ì§€ ê²€ì¦ (Fail-Closed)
- ê°€ë“œ í•¨ìˆ˜: `isRegisteredHook()`, `isRegisteredFeature()`, `isRegisteredAdapter()`

**ì‚¬ìš© ì˜ˆì‹œ:**
```typescript
// ê°œë°œ í™˜ê²½ì—ì„œë§Œ ê²€ì¦ (í”„ë¡œë•ì…˜ ì„±ëŠ¥ ì˜í–¥ ìµœì†Œí™”)
// âš ï¸ ì£¼ì˜: packages/shared-catalog.tsëŠ” ë£¨íŠ¸ ë‹¨ì¼ íŒŒì¼ì´ë¯€ë¡œ ìƒëŒ€ ê²½ë¡œë¡œ import
import { assertRegisteredHook } from '../../packages/shared-catalog';

if (process.env.NODE_ENV === 'development') {
  assertRegisteredHook('use-task-cards');
}
```

**âš ï¸ ì¤‘ìš”:** Automation Event Catalogì˜ `assertAutomationEventType()` íŒ¨í„´ê³¼ ë™ì¼í•œ ì›ì¹™ì„ ë”°ë¦…ë‹ˆë‹¤:
- ì¹´íƒˆë¡œê·¸ì— ì—†ëŠ” í•­ëª©ì€ ì‹¤í–‰ ë¶ˆê°€ (Fail-Closed)
- ê°œë°œ í™˜ê²½ì—ì„œë§Œ ê²€ì¦í•˜ëŠ” ê²ƒì„ ê¶Œì¥ (í”„ë¡œë•ì…˜ ì„±ëŠ¥ ì˜í–¥ ìµœì†Œí™”)

---

## 7. ì›”ë§ / ë‚ ì”¨ / íŒ¨í„´ ê¸°ë°˜ ê¸°ëŠ¥ (ì •ë³¸ ë°©ì‹)

| ê¸°ëŠ¥ | í”„ë¡ íŠ¸ì—”ë“œ ì—­í•  | ì„œë²„ ì—­í•  |
|------|----------------|----------|
| ì›”ë§ | BILLING ì¹´ë“œ priority +2 ê³„ì‚° | - |
| ë‚ ì”¨ | ìƒí™© ì‹ í˜¸ ìˆ˜ì§‘ | TaskCard ìƒì„± (`task_type: 'ai_suggested'`, entity_type='student', StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­) |
| ì¶œê²° íŒ¨í„´ | - | AI_BRIEFING + TASK ìƒì„± |

**ì •ë³¸ ê·œì¹™:**
- âŒ í”„ë¡ íŠ¸ì—”ë“œ ìë™ ë°œì†¡ ê¸ˆì§€
- âŒ í”„ë¡ íŠ¸ì—”ë“œ ìë™ ì´ë™ ê¸ˆì§€
- âŒ í”„ë¡ íŠ¸ì—”ë“œ ê·¸ë£¹ ì¬ë°°ì¹˜ ê¸ˆì§€
- âœ… í”„ë¡ íŠ¸ì—”ë“œëŠ” ìƒí™© ì‹ í˜¸ ìˆ˜ì§‘ + UI ì¡°ì •ë§Œ
- âœ… ì„œë²„ê°€ íŒë‹¨ + ì‹¤í–‰

---

## 8. êµ¬í˜„ ìš°ì„ ìˆœìœ„

### Phase 1 (ì™„ë£Œ)
1. âœ… Context Signals Hook (`useContextSignals`, ë ˆê±°ì‹œ: `useAdaptiveNavigation`) - ìë™ ì´ë™ ì œê±°ë¨
2. âœ… ì›”ë§ priority ê°€ì¤‘ì¹˜ ì¡°ì •
3. âœ… í”„ë¡ íŠ¸ì—”ë“œ ì‹¤í–‰ ì œê±°

### Phase 2 (í•„ìˆ˜ - ì •ë³¸ ê·œì¹™ ì™„ì „ ì¤€ìˆ˜)
1. âš ï¸ TaskCard (task_type: 'ai_suggested', entity_type='student') í†µí•© ì™„ë£Œ (v2.x ë ˆê±°ì‹œ ì œê±°) - ë¶€ë¶„ ì™„ë£Œ (ë ˆê±°ì‹œ ì½”ë“œ ì •ë¦¬ í•„ìš”)
   - í˜„ì¬: `ai_suggestions` í…Œì´ë¸” ë…ë¦½ ì¡´ì¬ (v2.x ë ˆê±°ì‹œ, ì •ë³¸ ìœ„ë°˜)
   - í˜„ì¬: `useAISuggestion` Hook, `AISuggestionCard` ì»´í¬ë„ŒíŠ¸ ì¡´ì¬ (ì‹¤ì œ ì‚¬ìš©ì€ `AISuggestionCard.tsx`ì—ì„œë§Œ importë¨)
   - í•„ìš”: `task_type: 'ai_suggested'`ë¡œ `task_cards`ì— í†µí•© (StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)
   - ìš©ì–´: "AI Suggestion" â†’ "TaskCard (task_type: 'ai_suggested', entity_type='student')"ë¡œ ì™„ì „ ì¹˜í™˜ (StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)
2. âœ… TTL/Dedup ê·œì¹™ ì¶”ê°€ (êµ¬í˜„ ì™„ë£Œ)
   - `dedup_key` í•„ë“œ ì¶”ê°€ (083_add_student_task_cards_v3_fields.sql)
   - ë™ì¼ íŠ¸ë¦¬ê±° â†’ ì¹´ë“œ 1ê°œë§Œ (ìœ ë‹ˆí¬ ì¸ë±ìŠ¤ ì ìš©)
3. âœ… automation_actions ë¡œê·¸ í…Œì´ë¸” ìƒì„± (êµ¬í˜„ ì™„ë£Œ)
   - Zero-Management ì•„í‚¤í…ì²˜ í•„ìˆ˜ (084_create_automation_tables.sql)

### Phase 3 (Out of Scope / ë¡œë“œë§µ)
âš ï¸ ì¤‘ìš”: ì•„ë˜ í•­ëª©ë“¤ì€ í˜„ì¬ 1ì¸ ìš´ì˜/ìƒìš©í™” ë²”ìœ„ë¥¼ ë²—ì–´ë‚˜ë©°, í–¥í›„ ë¡œë“œë§µìœ¼ë¡œ ê²€í† ë©ë‹ˆë‹¤.
1. ë‚ ì”¨ ê¸°ë°˜ TaskCard ìƒì„± (StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)
2. ì„œë²„ê°€ ì¶”ì²œ ë©”ì‹œì§€ ìƒì„± Edge Function (TaskCardë¡œ, AI í˜¸ì¶œ í¬í•¨, StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)
3. ìƒë‹´ì¼ì§€ AI ìš”ì•½ ìƒì„± íŠ¸ë¦¬ê±° (ì„œë²„ê°€ ìƒì„±)

---

## 9. í…ŒìŠ¤íŠ¸ ê³„íš

### 9.1 ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
- `useContextSignals` Hook í…ŒìŠ¤íŠ¸ (ë ˆê±°ì‹œ: `useAdaptiveNavigation`)
- `useStudentTaskCards` Hook í…ŒìŠ¤íŠ¸ (ë ˆê±°ì‹œ: `useAISuggestion` ì‚­ì œë¨, StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)
- ì»´í¬ë„ŒíŠ¸ ë Œë”ë§ í…ŒìŠ¤íŠ¸

### 9.2 í†µí•© í…ŒìŠ¤íŠ¸
- ì‹œê°„ ê¸°ë°˜ ì¶”ì²œ ë°°ë„ˆ í‘œì‹œ í…ŒìŠ¤íŠ¸ (ì •ë³¸: ìë™ í™”ë©´ ì „í™˜ âŒ)
- TaskCard ìŠ¹ì¸ ìš”ì²­ í”Œë¡œìš° í…ŒìŠ¤íŠ¸ (StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)
- ìƒí™© ì¸ì‹ ëŒ€ì‹œë³´ë“œ í…ŒìŠ¤íŠ¸

### 9.3 E2E í…ŒìŠ¤íŠ¸
- ìˆ˜ì—… ì‹œì‘ 10ë¶„ ì „ "ì¶œì„ë¶€ ë°”ë¡œê°€ê¸° ë°°ë„ˆ" ë…¸ì¶œ, í´ë¦­ ì‹œ ì¶œì„ë¶€ ì´ë™ (ì •ë³¸: ìë™ ì—´ê¸° âŒ)
- TaskCard ìŠ¹ì¸ ìš”ì²­ í›„ ì„œë²„ ì‹¤í–‰ (ì •ë³¸: í”„ë¡ íŠ¸ ì‹¤í–‰ âŒ, StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)
- ì›”ë§ ì²­êµ¬ ì¹´ë“œ priority ê°€ì¤‘ì¹˜ ì¡°ì • í…ŒìŠ¤íŠ¸ (ì •ë³¸: ê·¸ë£¹ ìˆœì„œ ë¶ˆë³€, ìë™ ìƒë‹¨ ë…¸ì¶œ âŒ)

### 9.4 CI í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸

**âš ï¸ SSOT: Hard Gate(í•„ìˆ˜)ì™€ ê¶Œì¥(ì˜µì…˜) ë¶„ë¦¬**

#### 9.4.1 Hard Gate (í•„ìˆ˜, í˜„ì¬ ë¦¬í¬ì— ì¡´ì¬í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ë§Œ)

```bash
# 1. TypeScript íƒ€ì… ì²´í¬
npm run typecheck
# ì‹¤íŒ¨ ì¡°ê±´: íƒ€ì… ì˜¤ë¥˜ ì¡´ì¬

# 2. Lint ê²€ì‚¬
npm run lint
# ì‹¤íŒ¨ ì¡°ê±´: lint ì˜¤ë¥˜ ì¡´ì¬

# 3. Shared Catalog ê²€ì¦ (scripts/check-shared-catalog.ts ì¡´ì¬ ì‹œ)
npm run check:shared-catalog
# ì‹¤íŒ¨ ì¡°ê±´: ë“±ë¡ë˜ì§€ ì•Šì€ Hook ë°œê²¬ ë˜ëŠ” ì§ì ‘ êµ¬í˜„ íŒ¨í„´ ë°œê²¬
```

#### 9.4.2 ê¶Œì¥ ìŠ¤í¬ë¦½íŠ¸ (ì˜µì…˜, package.jsonì— ì—†ìœ¼ë©´ ì¶”ê°€ í•„ìš”)

```bash
# 3. Unit Test (ì»¤ë²„ë¦¬ì§€ 80% ì´ìƒ)
npm run test:unit -- --coverage
# ì‹¤íŒ¨ ì¡°ê±´: ì»¤ë²„ë¦¬ì§€ < 80%

# 4. E2E Test (Playwright)
npm run test:e2e
# ì‹¤íŒ¨ ì¡°ê±´: E2E í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨
# ìµœì†Œ í…ŒìŠ¤íŠ¸ ì„¸íŠ¸: academy ì—…ì¢… + owner/admin/teacher ê¶Œí•œ ì¡°í•©

# 5. A11Y ê²€ì‚¬ (Axe-Core)
npm run test:a11y
# ì‹¤íŒ¨ ì¡°ê±´: Critical = 0 (Critical ì˜¤ë¥˜ ì¡´ì¬ ì‹œ ì‹¤íŒ¨)

# 6. Lighthouse ì„±ëŠ¥ ê²€ì‚¬
npm run test:lighthouse
# ì‹¤íŒ¨ ì¡°ê±´: FCP > 1.5s ë˜ëŠ” TTI > 800ms

# 7. Bundle Budget ê²€ì‚¬
npm run test:bundle
# ì‹¤íŒ¨ ì¡°ê±´: Initial Load Bundle > 500KB
```

**ìë™í™” ê´€ë ¨ E2E ìµœì†Œ í…ŒìŠ¤íŠ¸ ì„¸íŠ¸:**
- ì—…ì¢…: `academy` (í•„ìˆ˜)
- ê¶Œí•œ ë§¤íŠ¸ë¦­ìŠ¤: `owner`, `admin`, `teacher` (ìµœì†Œ ì¡°í•©)
- ì‹œë‚˜ë¦¬ì˜¤:
  - Teacher: `request-approval` ìš”ì²­ ì„±ê³µ
  - Admin: `approve-and-execute` ì‹¤í–‰ ì„±ê³µ
  - ê¶Œí•œ ì—†ëŠ” ì‚¬ìš©ì: 403 Forbidden

**ë ˆê±°ì‹œ í‚¤ì›Œë“œ ê²€ì¶œ (ìë™í™”):**

```bash
# 8. ë ˆê±°ì‹œ í‚¤ì›Œë“œ ê²€ì¶œ (PRì—ì„œ ì‹¤íŒ¨ ì‹œ ë¹Œë“œ ì‹¤íŒ¨)
npm run lint:legacy
# ê²€ì¶œ í‚¤ì›Œë“œ:
# - use-ai-suggestion (âš ï¸ ë ˆê±°ì‹œ: ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ)
# - AISuggestionCard (âš ï¸ ë ˆê±°ì‹œ: ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ)
# - ai_suggestions (í…Œì´ë¸”ëª…, âš ï¸ ë ˆê±°ì‹œ: ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ)
# - "AI Suggestion" (ë¬¸ìì—´, âš ï¸ ë ˆê±°ì‹œ: ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ, ë‹¨ TaskCard ì„¤ëª… ì œì™¸, StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)
# ì‹¤íŒ¨ ì¡°ê±´: ë ˆê±°ì‹œ í‚¤ì›Œë“œ ë°œê²¬
```

**ì°¸ê³ :** UI ë¬¸ì„œì˜ Performance Gates/Testing Hard Gateì™€ ë™ì¼í•œ ê·œì¹™ì„ ë”°ë¦…ë‹ˆë‹¤.

---

## 10. ì°¸ê³  ë¬¸ì„œ

- ì•„í‚¤í…ì²˜ ë¬¸ì„œ: `docu/ë””ì–´ìŒ¤ ì•„í‚¤í…ì²˜.md`
  - 0.3 í•µì‹¬ ì² í•™ â€” Zero-Management Platform
  - 1.7 AI-First Workflow ì •ì˜
  - 1.8 ë°˜ì‘í˜•Â·ê¸°ê¸°ë³„ ì ì‘í˜• UI ì•„í‚¤í…ì²˜
  - 4.2 Zero-Interaction UX
- ê¸°ìˆ  ë¬¸ì„œ: `docu/ì „ì²´ ê¸°ìˆ ë¬¸ì„œ.txt`
  - JWT claim ê¸°ë°˜ RLS ì •ì±…
  - Analytics íŒŒì´í”„ë¼ì¸ êµ¬ì¡°
- ê·œì¹™ ë¬¸ì„œ: `docu/rules.md`
  - ë©€í‹°í…Œë„ŒíŠ¸ ì¿¼ë¦¬ íŒ¨í„´ (withTenant)
  - í™˜ê²½ë³€ìˆ˜ ê´€ë¦¬ ê·œì¹™
- ìŠ¤í‚¤ë§ˆ ë¬¸ì„œ: `docu/ìŠ¤í‚¤ë§ˆ.txt` (ì •ë³¸: ìŠ¤í‚¤ë§ˆ ì—”ì§„/ì—ë””í„° í†µí•© ë¬¸ì„œ)
  - í…Œì´ë¸”/ì»¬ëŸ¼ ì •ì˜ ì°¸ì¡°

---

## 11. êµ¬í˜„ ì™„ë£Œ ë‚´ì—­

### Phase 1 (ì™„ë£Œ - ì •ë³¸ ê·œì¹™ ì¤€ìˆ˜)
- âœ… Context Signals Hook (`useContextSignals`, ë ˆê±°ì‹œ: `useAdaptiveNavigation`)
  - ìœ„ì¹˜: `packages/hooks/use-context-signals` (ê¶Œì¥) ë˜ëŠ” `use-adaptive-navigation` (ë ˆê±°ì‹œ í˜¸í™˜)
  - ê¸°ëŠ¥: ìƒí™© ì‹ í˜¸ ìˆ˜ì§‘, ìˆ˜ì—… ì‹œì‘ 10ë¶„ ì „ ì¶”ì²œ ë°°ë„ˆ, ìˆ˜ì—… ì¢…ë£Œ í›„ ìƒë‹´ì¼ì§€ ì¶”ì²œ
  - **ì •ë³¸ ì¤€ìˆ˜:** ìë™ `navigate()` ì œê±°ë¨, ì—­í•  ì¬ì •ì˜ (ì‹ í˜¸ ìˆ˜ì§‘ë§Œ)
- âœ… ì›”ë§ priority ê°€ì¤‘ì¹˜ ì¡°ì •
  - Hook: `packages/hooks/use-month-end-adaptation`
  - **ì •ë³¸ ì¤€ìˆ˜:** ê·¸ë£¹ ìˆœì„œ ë¶ˆë³€, priorityë§Œ +2
- âœ… í”„ë¡ íŠ¸ì—”ë“œ ì‹¤í–‰ ì œê±°
  - **ì •ë³¸ ì¤€ìˆ˜:** ìŠ¹ì¸ë§Œ ì²˜ë¦¬, ì‹¤í–‰ì€ Edge Function

### Phase 2 (í•„ìˆ˜ - ì •ë³¸ ê·œì¹™ ì™„ì „ ì¤€ìˆ˜ í•„ìš”)
- âš ï¸ TaskCard (task_type: 'ai_suggested', entity_type='student') í†µí•© ì™„ë£Œ (v2.x ë ˆê±°ì‹œ ì œê±°) - ë¶€ë¶„ ì™„ë£Œ (ë ˆê±°ì‹œ ì½”ë“œ ì •ë¦¬ í•„ìš”)
  - í˜„ì¬: `ai_suggestions` í…Œì´ë¸” ë…ë¦½ ì¡´ì¬ (v2.x ë ˆê±°ì‹œ, ì •ë³¸ ìœ„ë°˜)
  - í˜„ì¬: `useAISuggestion` Hook, `AISuggestionCard` ì»´í¬ë„ŒíŠ¸ ì¡´ì¬ (ì‹¤ì œ ì‚¬ìš©ì€ `AISuggestionCard.tsx`ì—ì„œë§Œ importë¨)
  - í•„ìš”: `task_type: 'ai_suggested'`ë¡œ `task_cards`ì— í†µí•© (StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)
  - ìš©ì–´: "AI Suggestion" â†’ "TaskCard (task_type: 'ai_suggested', entity_type='student')"ë¡œ ì™„ì „ ì¹˜í™˜
- âœ… TTL/Dedup ê·œì¹™ ì¶”ê°€ (êµ¬í˜„ ì™„ë£Œ)
  - `dedup_key` í•„ë“œ ì¶”ê°€ (083_add_student_task_cards_v3_fields.sql)
  - ë™ì¼ íŠ¸ë¦¬ê±° â†’ ì¹´ë“œ 1ê°œë§Œ (ìœ ë‹ˆí¬ ì¸ë±ìŠ¤ ì ìš©)
- âœ… automation_actions ë¡œê·¸ í…Œì´ë¸” ìƒì„± (êµ¬í˜„ ì™„ë£Œ)
  - Zero-Management ì•„í‚¤í…ì²˜ í•„ìˆ˜ (084_create_automation_tables.sql)

### Phase 3 (Out of Scope / ë¡œë“œë§µ)
âš ï¸ ì¤‘ìš”: ì•„ë˜ í•­ëª©ë“¤ì€ í˜„ì¬ 1ì¸ ìš´ì˜/ìƒìš©í™” ë²”ìœ„ë¥¼ ë²—ì–´ë‚˜ë©°, í–¥í›„ ë¡œë“œë§µìœ¼ë¡œ ê²€í† ë©ë‹ˆë‹¤.
- ë‚ ì”¨ ê¸°ë°˜ TaskCard ìƒì„± (StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)
- ì„œë²„ê°€ ì¶”ì²œ ë©”ì‹œì§€ ìƒì„± Edge Function (TaskCardë¡œ, AI í˜¸ì¶œ í¬í•¨, StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)
- ìƒë‹´ì¼ì§€ AI ìš”ì•½ ìƒì„± íŠ¸ë¦¬ê±° (ì„œë²„ê°€ ìƒì„±)

## 12. ìµœì¢… íŒì • (v3.3 ê¸°ì¤€)

| í•­ëª© | ê²°ê³¼ |
|------|------|
| í™ˆ ìš°ì„ ìˆœìœ„ | âœ… (ê·¸ë£¹ ìˆœì„œ ë¶ˆë³€) |
| ì¹´ë“œ ê²½ê³„ | âœ… (TaskCardë¡œ í†µí•© ì™„ë£Œ, StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­) |
| TTL / Dedup | âš ï¸ (êµ¬í˜„ í•„ìš”) |
| Zero-Trust | âœ… (í”„ë¡ íŠ¸ì—”ë“œ ì‹¤í–‰ ì œê±°) |
| Role ë¶„ë¦¬ | âœ… |
| Zero-Management ì² í•™ | âœ… |

## 13. í•µì‹¬ ìš”ì•½ (í•œ ì¤„)

**"AIê°€ ë” ë˜‘ë˜‘í•´ì§ˆìˆ˜ë¡, UIëŠ” ë” ë‹¨ìˆœí•´ì ¸ì•¼ í•œë‹¤."**
â†’ í–‰ë™ì€ StudentTask, ì •ë³´ëŠ” Briefing, ì‹¤í–‰ì€ ì„œë²„ë§Œ.

## 14. ì¶”ê°€ ê°œì„ ì‚¬í•­ (ìš´ì˜/í…ŒìŠ¤íŠ¸ ìë™í™” ê°•í™”)

### 14.1 ê³„ì•½(Contract) í…ŒìŠ¤íŠ¸ ì¶”ê°€

âš ï¸ ì¤‘ìš”: ìë™í™” ì—”ë“œí¬ì¸íŠ¸ì— ëŒ€í•œ ê³„ì•½ í…ŒìŠ¤íŠ¸ë¥¼ CIì— í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.

**í…ŒìŠ¤íŠ¸ ëŒ€ìƒ:**
- `apiClient.invokeFunction('execute-student-task', { action: 'request-approval', task_id: id })` (Teacher, ì •ë³¸)
- `apiClient.invokeFunction('execute-student-task', { action: 'approve-and-execute', task_id: id })` (Admin, SSOT, ì •ë³¸)
- `apiClient.invokeFunction('execute-student-task', { action: 'approve', task_id: id })` (Admin, ë ˆê±°ì‹œ alias, ì¼ëª° ì˜ˆì •)

**ê³„ì•½ í…ŒìŠ¤íŠ¸ í•­ëª©:**
1. **ìš”ì²­ ìŠ¤í‚¤ë§ˆ ê²€ì¦**: ìš”ì²­ ë³¸ë¬¸ì˜ í•„ìˆ˜ í•„ë“œ ë° íƒ€ì… ê²€ì¦
2. **ì‘ë‹µ ìŠ¤í‚¤ë§ˆ ê²€ì¦**: ì„±ê³µ/ì‹¤íŒ¨ ì‘ë‹µì˜ êµ¬ì¡° ë° íƒ€ì… ê²€ì¦
3. **ê¶Œí•œ ë§¤íŠ¸ë¦­ìŠ¤ ê²€ì¦**: Roleë³„ ì ‘ê·¼ ê¶Œí•œ ê²€ì¦ (TeacherëŠ” request-approvalë§Œ, Adminì€ approve-and-executeë§Œ)
4. **RLS ì •ì±… ê²€ì¦**: tenant_id ë¶ˆì¼ì¹˜ ì‹œ 403 ì‘ë‹µ ê²€ì¦

âš ï¸ ì°¸ê³ : ê¸°ìˆ ë¬¸ì„œ PART 10ì˜ "40. RLS í…ŒìŠ¤íŠ¸ ìë™í™”" ì„¹ì…˜ê³¼ ë™ì¼í•œ ê¸‰ìœ¼ë¡œ ìë™í™” ì—”ë“œí¬ì¸íŠ¸ë„ ê³„ì•½ í…ŒìŠ¤íŠ¸ë¥¼ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.

### 14.2 ê°ì‚¬/ì¶”ì  í•„ìˆ˜ í•„ë“œ í‘œì¤€í™”

âš ï¸ ì¤‘ìš”: automation_actions í…Œì´ë¸”ì—ëŠ” ì‚¬ê±´ ì¬í˜„ ë° ë¶„ìŸ ëŒ€ì‘ì„ ìœ„í•œ í•„ìˆ˜ í•„ë“œê°€ í¬í•¨ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.

**í•„ìˆ˜ í•„ë“œ:**
- `trace_id`: ìš”ì²­ ì¶”ì  ID (ë¶„ì‚° ì¶”ì ìš©)
- `request_id`: ìš”ì²­ ID (ë©±ë“±ì„±/ì¬ì‹œë„ ì¶”ì ìš©)
- `policy_version`: RLS ì •ì±… ë²„ì „ (ë³´ì•ˆ ê°ì‚¬ìš©)
- `rule_id`: ì‹¤í–‰ëœ ê·œì¹™ ID (ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì¶”ì ìš©)
- `dedup_key`: ì¤‘ë³µ ë°©ì§€ í‚¤ (ë©±ë“±ì„± ê²€ì¦ìš©)
- `approved_by`: ìŠ¹ì¸ì ID (Teacherì˜ request-approvalì¸ ê²½ìš°)
- `approved_at`: ìŠ¹ì¸ ì‹œê°
- `executor_role`: ì‹¤í–‰ì ì—­í•  (admin/instructor/teacher ë“±, ê°ì‚¬ìš©)  -- instructorëŠ” ì •ë³¸ í‚¤, teacherëŠ” backward compatibility
- `execution_context`: ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ (ì¶”ê°€ ë©”íƒ€ë°ì´í„°, JSONB)

âš ï¸ ì°¸ê³ : ìµœì†Œí•œ trace_id, request_id, approved_by, executor_roleì€ ë°˜ë“œì‹œ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤. ì´ í•„ë“œë“¤ì€ ë‚˜ì¤‘ì— ì‚¬ê±´ ì¬í˜„ ë° ë¶„ìŸ ëŒ€ì‘ ì‹œ í•„ìˆ˜ì ì…ë‹ˆë‹¤.

### 14.3 UI ìƒ 'ì‹¤í–‰ ì „ ë¯¸ë¦¬ë³´ê¸°(dry-run)' ë ˆë²¨ ì¶”ê°€

âš ï¸ ì¤‘ìš”: ìŠ¹ì¸ í•„ìš”(L2) ì•¡ì…˜ì€ ì‹¤í–‰ ì „ ë¯¸ë¦¬ë³´ê¸°ë¥¼ ì œê³µí•´ì•¼ í•©ë‹ˆë‹¤.

**ë¯¸ë¦¬ë³´ê¸° ì œê³µ ëŒ€ìƒ:**
- í•™ë¶€ëª¨ ë©”ì‹œì§€ ë°œì†¡ (L2)
- ë¶„ì„ ë¦¬í¬íŠ¸ ì‹¤í–‰ (L2)
- ê¸°íƒ€ ìŠ¹ì¸ í•„ìš” ì•¡ì…˜

**ë¯¸ë¦¬ë³´ê¸° UI êµ¬ì„±:**
- ë°œì†¡ ëŒ€ìƒ ëª©ë¡ (í•™ë¶€ëª¨ ì´ë¦„, ì—°ë½ì²˜)
- ë©”ì‹œì§€ ë³¸ë¬¸ ë¯¸ë¦¬ë³´ê¸°
- ì˜ˆìƒ ë¹„ìš© (SMS/ì•Œë¦¼ë±…í‚¹ ë¹„ìš©)
- ì˜í–¥ ë²”ìœ„ (ë°œì†¡ ëŒ€ìƒ ìˆ˜, ì˜ˆìƒ ë„ë‹¬ ì‹œê°„)
- ì‹¤í–‰ ì „ diff í‘œì‹œ (ë³€ê²½ ì „/í›„ ìƒíƒœ)

**êµ¬í˜„ ì˜ˆì‹œ:**
```typescript
// TaskCard ì»´í¬ë„ŒíŠ¸ì—ì„œ ë¯¸ë¦¬ë³´ê¸° ëª¨ë‹¬ ì œê³µ (StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)
<StudentTaskCard
  task={task}
  onPreview={() => {
    // ë¯¸ë¦¬ë³´ê¸° ëª¨ë‹¬ í‘œì‹œ
    showPreviewModal({
      action: task.suggested_action,
      targets: task.metadata?.targets,
      estimatedCost: task.metadata?.estimated_cost,
      impact: task.metadata?.impact,
    });
  }}
  onApprove={handleApprove}
/>
```

âš ï¸ ì°¸ê³ : ë¯¸ë¦¬ë³´ê¸° ê¸°ëŠ¥ì€ Zero-Management ì² í•™ê³¼ ì¶©ëŒí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì‚¬ìš©ìê°€ ìµœì¢… ìŠ¹ì¸í•˜ê¸° ì „ì— í™•ì¸í•  ìˆ˜ ìˆëŠ” ì„ íƒì  ê¸°ëŠ¥ì…ë‹ˆë‹¤.

### 14.4 ì„±ëŠ¥/í’ˆì§ˆ ê²Œì´íŠ¸ë¥¼ ìë™í™” ëª¨ë“ˆì—ë„ ë™ì¼ ì ìš©

âš ï¸ ì¤‘ìš”: UI ë¬¸ì„œì˜ Hard Gate(ìœ ë‹› ì»¤ë²„ë¦¬ì§€/ì ‘ê·¼ì„±/ë²ˆë“¤/ë¼ì´íŠ¸í•˜ìš°ìŠ¤)ë¥¼ ìë™í™” ê´€ë ¨ í˜ì´ì§€ì—ë„ ì ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

**ì ìš© ëŒ€ìƒ:**
- ìë™í™” ëŒ€ì‹œë³´ë“œ (HomePageì˜ TaskCard ì„¹ì…˜, StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)
- ìŠ¹ì¸í•¨ UI (TaskCard ëª©ë¡, StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)
- ìë™í™” ë¡œê·¸ ë·° (automation_actions ì¡°íšŒ UI)

**ê²Œì´íŠ¸ ê¸°ì¤€:**
- ìœ ë‹› í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€: 80% ì´ìƒ
- ì ‘ê·¼ì„± (Axe-Core): Critical = 0
- ë²ˆë“¤ í¬ê¸°: Initial Load â‰¤ 500KB
- Lighthouse CI: Performance â‰¥ 90

âš ï¸ ì°¸ê³ : ìë™í™” ê´€ë ¨ UIë„ "ì˜ˆì™¸ ì—†ëŠ” ê¸°ì¤€"ìœ¼ë¡œ ë™ì¼í•œ í’ˆì§ˆ ê²Œì´íŠ¸ë¥¼ ì ìš©í•´ì•¼ í•©ë‹ˆë‹¤. ì „ì²´ ìœ ì•„ì´ë¬¸ì„œ 7.1 "Performance Gates (CI/CD)" ì„¹ì…˜ì„ ì°¸ì¡°í•˜ì„¸ìš”.

## 15. ë¬¸ì„œ ì—­í•  ì¬ì •ì˜ ìš”ì•½

### 14.1 ì´ ë¬¸ì„œì˜ ì •í™•í•œ ì—­í• 

**ì´ ë¬¸ì„œëŠ” "í”„ë¡ íŠ¸ ìë™í™”"ê°€ ì•„ë‹™ë‹ˆë‹¤.**

| êµ¬ë¶„ | ì—­í•  |
|------|------|
| ë¬¸ì„œëª… (ê¶Œì¥) | í”„ë¡ íŠ¸ì—”ë“œ ìƒí™© ì‹ í˜¸ ìˆ˜ì§‘ ë° UI ì¡°ì • ë¬¸ì„œ |
| í”„ë¡ íŠ¸ì—”ë“œ ì—­í•  | ìƒí™© ì‹ í˜¸ ìˆ˜ì§‘, UI ì¡°ì •, ìŠ¹ì¸ ìš”ì²­ |
| ì„œë²„ ì—­í•  | íŒë‹¨, ì‹¤í–‰, Role ê²€ì¦ |
| Edge Function ì—­í•  | ìë™í™” ë°°ì¹˜ ì‘ì—…, TaskCard (task_type: 'ai_suggested', entity_type='student') ìƒì„±, ì‹¤í–‰ (StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­) |

### 14.2 ìš©ì–´ í†µì¼ ê·œì¹™ (í•„ìˆ˜)

| ê¸ˆì§€ ìš©ì–´ | ì •ë³¸ ìš©ì–´ | ì„¤ëª… |
|----------|----------|------|
| ìë™ ì‹¤í–‰ | ì„œë²„ê°€ ìƒì„± | í”„ë¡ íŠ¸ì—”ë“œëŠ” ì‹¤í–‰í•˜ì§€ ì•ŠìŒ |
| ìë™ ì²˜ë¦¬ | ìë™ íŒë‹¨ (ì„œë²„) | í”„ë¡ íŠ¸ì—”ë“œëŠ” íŒë‹¨í•˜ì§€ ì•ŠìŒ |
| í”„ë¡ íŠ¸ ìë™í™” | í”„ë¡ íŠ¸ ìƒí™© ì‹ í˜¸ ìˆ˜ì§‘ | í”„ë¡ íŠ¸ì—”ë“œëŠ” ì‹ í˜¸ ìˆ˜ì§‘ë§Œ |
| ìë™ í™”ë©´ ì „í™˜ | ì¶”ì²œ ë°°ë„ˆ í‘œì‹œ | ì‚¬ìš©ì í´ë¦­ í•„ìš” |
| AI ì œì•ˆ (ë ˆê±°ì‹œ) | TaskCard (task_type: 'ai_suggested', entity_type='student') | ë…ë¦½ ê°œë… ì•„ë‹˜ (StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­) |

### 14.3 ì •ë³¸ ê³„ì¸µ êµ¬ì¡° (ë¶ˆë³€)

```
[AI / Rule Engine / Edge Functions]
        â†“ (íŒë‹¨ + ì‹¤í–‰)
[TaskCard / AI_Briefing ìƒì„±]
        â†“ (ë°ì´í„° ì œê³µ)
[UI = ìŠ¹ì¸Â·ê±°ë¶€Â·ê´€ì°° ë ˆì´ì–´]
```

**í”„ë¡ íŠ¸ì—”ë“œëŠ”:**
- âœ… ìƒí™© ì‹ í˜¸ ìˆ˜ì§‘ (Context Signal Collection)
- âœ… UI ì¡°ì • (Priority ê°€ì¤‘ì¹˜, ë°°ë„ˆ í‘œì‹œ)
- âœ… ìŠ¹ì¸ ìš”ì²­ (Approval Request)

**í”„ë¡ íŠ¸ì—”ë“œëŠ” í•˜ì§€ ì•ŠìŒ:**
- âŒ íŒë‹¨ (Judgment) - ì„œë²„/Edge Function ì „ë‹´
- âŒ ì‹¤í–‰ (Execution) - ì„œë²„/Edge Function ì „ë‹´

---

## 16. ìë™í™” í™•ì¥ ê°€ì´ë“œë¼ì¸ (Critical)

### âš ï¸ Automation Config First (ë¶ˆë³€ ì›ì¹™)

**ë³¸ ì‹œìŠ¤í…œì—ì„œ ì–´ë– í•œ ìë™í™”ë„ í•˜ë“œì½”ë”©ëœ ì¡°ê±´ìœ¼ë¡œ ì‹¤í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤.**
**ëª¨ë“  ìë™í™”ëŠ” ì‚¬ìš©ì ì„¤ì •ê°’(Policy / Threshold / Toggle)ì„ í†µí•´ í™œì„±Â·ë¹„í™œì„± ë° ê°•ë„ê°€ ê²°ì •ë˜ë©°,**
**ì‹¤í–‰ ì—¬ë¶€ëŠ” ì„œë²„/Edge Functionì´ í•´ë‹¹ ì„¤ì •ì„ í•´ì„í•˜ì—¬ íŒë‹¨í•œë‹¤.**

âš ï¸ í‘œí˜„Â·ë‹¨ì–´Â·ìˆœì„œ ë³€ê²½ ê¸ˆì§€

### ìë™í™” í•­ëª©ë³„ Policy ì„¤ì • í‘œ (ê³µí†µ)

**âš ï¸ ëª¨ë“  ë¬¸ì„œì— ë™ì¼í•˜ê²Œ ì‚½ì… (í˜•íƒœÂ·ë‚´ìš© ë³€ê²½ ê¸ˆì§€)**

| ìë™í™” í•­ëª© | ì‚¬ìš©ì ì„¤ì • ê°€ëŠ¥ | í•˜ë“œì½”ë”© ê¸ˆì§€ |
|------------|----------------|--------------|
| ì¶œê²° ì´ìƒ ê°ì§€ | ê°ì§€ ê¸°ì¤€, ì¹´ë“œ ìƒì„± ì—¬ë¶€ | ê¸°ì¤€ê°’ |
| ë¯¸ë‚© ì•Œë¦¼ | ìë™ ë°œì†¡ ON/OFF, ì‹œì  | ë°œì†¡ ì¡°ê±´ |
| AI ì—…ë¬´ ì¹´ë“œ(TaskCard, task_type: 'ai_suggested', entity_type='student') | AI ON/OFF, ìŠ¹ì¸ í•„ìš” ì—¬ë¶€ | ì„œë²„ê°€ ì •ì±…ì— ë”°ë¼ ì‹¤í–‰ |
| ëŒ€ì‹œë³´ë“œ ìš°ì„ ìˆœìœ„ | ê°€ì¤‘ì¹˜ ì¡°ì • | ê·¸ë£¹ ìˆœì„œ |
| ë¦¬í¬íŠ¸ ìƒì„± | ìë™ ìƒì„± ì—¬ë¶€ | ìƒì„± ì£¼ê¸° |

â€» ìƒìœ„ Policy KeyëŠ” SSOT(v2 6ê°œ)ë¡œ ê³ ì •ëœë‹¤. ì‹ ê·œ ìë™í™”ëŠ” event_type ì¹´íƒˆë¡œê·¸ì— ì¶”ê°€ í›„ ê°€ëŠ¥í•˜ë©°, ì¹´íƒˆë¡œê·¸ì— ì—†ëŠ” event_typeì€ ì‹¤í–‰/ì¶”ê°€í•  ìˆ˜ ì—†ë‹¤. (ì¹´íƒˆë¡œê·¸ì— ì¶”ê°€ = ì½”ë“œ ìƒìˆ˜ `AUTOMATION_EVENT_CATALOG`ì— event_type ì¶”ê°€, êµ¬í˜„ ìœ„ì¹˜: `packages/core/core-automation/src/automation-event-catalog.ts`, `infra/supabase/functions/_shared/automation-event-catalog.ts`)

---

### 15.1 í˜„ì¬ ìƒíƒœ í‰ê°€

**âš ï¸ ì¤‘ìš”: ì§€ê¸ˆì€ ìë™í™”ë¥¼ "ë” ë§Œë“¤ ë‹¨ê³„"ê°€ ì•„ë‹ˆë¼ ìë™í™”ë¥¼ "ì˜ ë‹¤ìŠ¤ë¦¬ëŠ” ë‹¨ê³„"ì…ë‹ˆë‹¤.**

**í˜„ì¬ ì™„ì„±ëœ ìë™í™” ì¸í”„ë¼:**
- âœ… ì¶”ì²œ ìƒì„± (AI/Rule Engine)
- âœ… ì •ì±… í•´ì„ ë° ìƒì„± (Edge Function)
- âœ… ì •ì±… í•´ì„ í›„ ì‹¤í–‰ (Edge Function + Role ê²€ì¦)
- âœ… ì •ì±… ê¸°ë°˜ ìë™í™” ì•ˆì „ì„± ë©”ì»¤ë‹ˆì¦˜ (Self-Regulation)
- âœ… ì •ì±… ê¸°ë°˜ ìë™í™” ê²°ê³¼ ê°€ì‹œì„± (Daily Automation Digest)

**ì´ ì¡°í•©ì´ ì™„ì„±ë˜ë©´:**
- ìë™í™”ëŠ” 'ì•„ì´ë””ì–´ ë¶€ì¡±'ì´ ì•„ë‹ˆë¼ **'ì‹ ë¢° ê´€ë¦¬ ë¬¸ì œ'**ê°€ ë©ë‹ˆë‹¤
- ì§€ê¸ˆ êµ¬ì¡°ëŠ” ì•„ì´ë””ì–´ë¥¼ ë” ì–¹ëŠ” ìˆœê°„ í’ˆì§ˆì´ ë–¨ì–´ì§ˆ ìˆ˜ ìˆëŠ” ë‹¨ê³„ì…ë‹ˆë‹¤

### 15.1.1 ì¶”ê°€ ìë™í™” í•­ëª© (Policy Key v2 ê¸°ë°˜)

**âš ï¸ ì¤‘ìš”: ì•„ë˜ ìë™í™” í•­ëª©ë“¤ì€ Policy Key v2 ì¹´íƒˆë¡œê·¸ì— ì •ì˜ë˜ì–´ ìˆìœ¼ë©°, event_type ê¸°ë°˜ìœ¼ë¡œ í™•ì¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.**

#### financial_health (ì¬ë¬´/í˜„ê¸ˆíë¦„/ìˆ˜ë‚©/ë§¤ì¶œ KPI)
- **payment_due_reminder**: ê²°ì œ ì˜ˆì •ì¼ ë¦¬ë§ˆì¸ë” (D-3, D-1ì¼ ì „ ì•Œë¦¼)
- **invoice_partial_balance**: ë¶€ë¶„ê²°ì œ í›„ ì”ì•¡ ì•ˆë‚´ ìë™í™”
- **recurring_payment_failed**: ì •ê¸° ê²°ì œ ì‹¤íŒ¨ ì•Œë¦¼
- **revenue_target_under**: ì›” ë§¤ì¶œ ëª©í‘œ ë¯¸ë‹¬ ì•Œë¦¼
- **collection_rate_drop**: ìˆ˜ë‚©ë¥  ê¸‰ë½ ì•Œë¦¼
- **overdue_outstanding_over_limit**: ë¯¸ê²°ì œ ëˆ„ì  ê¸ˆì•¡ ì„ê³„ì¹˜ ì•Œë¦¼
- **revenue_required_per_day**: ì¼ì¼ ë§¤ì¶œ ìš”ì•½
- **top_overdue_customers_digest**: ìƒìœ„ ë¯¸ê²°ì œ ê³ ê° ìš”ì•½
- **refund_spike**: í™˜ë¶ˆ ê¸‰ì¦ ì•Œë¦¼
- **monthly_business_report**: ì„œë²„ê°€ ì›”ê°„ ê²½ì˜ ë¦¬í¬íŠ¸ ìƒì„± (AI í˜¸ì¶œ í¬í•¨)

#### capacity_optimization (ì •ì›/ì‹œê°„í‘œ/ë°˜ ìš´ì˜ ìµœì í™”)
- **class_fill_rate_low_persistent**: ë°˜ ì •ì› ë¯¸ë‹¬ ì•Œë¦¼ (ì •ì›ë¥  50% ë¯¸ë§Œ ì§€ì†)
- **ai_suggest_class_merge**: ë°˜ í†µí•© ì œì•ˆ (AI ê¸°ë°˜)
- **time_slot_fill_rate_low**: ì‹œê°„ëŒ€ë³„ ìˆ˜ì—… íš¨ìœ¨ ë¶„ì„ ì•Œë¦¼
- **high_fill_rate_expand_candidate**: ê³ ì •ì› ë°˜ í™•ì¥ ì œì•ˆ
- **unused_class_persistent**: ë¯¸í™œìš© ë°˜ ì•Œë¦¼
- **weekly_ops_summary**: ì„œë²„ê°€ ì£¼ê°„ ìš´ì˜ ìš”ì•½ ë¦¬í¬íŠ¸ ìƒì„± (AI í˜¸ì¶œ í¬í•¨)

#### customer_retention (ì¶œê²° ìœ ì§€/ì´íƒˆ ì˜ˆë°©/ë¦¬ìŠ¤í¬ ì¼€ì–´)
- **class_reminder_today**: ì˜¤ëŠ˜ ìˆ˜ì—… ë¦¬ë§ˆì¸ë”
- **class_schedule_tomorrow**: ë‚´ì¼ ìˆ˜ì—… ì¼ì • ì•ˆë‚´
- **consultation_reminder**: ìƒë‹´ ì¼ì • ë¦¬ë§ˆì¸ë” (24h/2h ì „)
- **absence_first_day**: ê²°ì„ ê²½ê³  ì•Œë¦¼ (1ì¼ì°¨)
- **churn_increase**: ì´íƒˆ ê³ ê° ì¦ê°€ ì•Œë¦¼
- **ai_suggest_churn_focus**: ì´íƒˆ ìœ„í—˜ ê³ ê° ì§‘ì¤‘ ê´€ë¦¬ ì œì•ˆ
- **attendance_rate_drop_weekly**: ì¶œê²°ë¥  í•˜ë½ ì£¼ê°„ ì•Œë¦¼
- **risk_students_weekly_kpi**: ìœ„í—˜ ëŒ€ìƒ ì£¼ê°„ KPI

#### growth_marketing (ì‹ ê·œ/ì„±ì¥/ì „í™˜/ì§€ì—­ ê²½ìŸ)
- **new_member_drop**: ì‹ ê·œ ê³ ê° ë“±ë¡ ê°ì†Œ ì•Œë¦¼
- **inquiry_conversion_drop**: ë¬¸ì˜ ì „í™˜ë¥  ê°ì†Œ ì•Œë¦¼ (active, êµ¬í˜„ ì™„ë£Œ)
- **birthday_greeting**: ìƒì¼ ì¶•í•˜ ì•Œë¦¼ (planned, ë°ì´í„° í™•ì • ì „)
- **enrollment_anniversary**: ë“±ë¡ ê¸°ë…ì¼ ì•Œë¦¼ (planned, ë°ì´í„° í™•ì • ì „)
- **regional_underperformance**: ì§€ì—­ í‰ê·  ëŒ€ë¹„ ì €í•˜ ì•Œë¦¼
- **regional_rank_drop**: ì§€ì—­ ìˆœìœ„ í•˜ë½ ì•Œë¦¼

#### safety_compliance (ì•ˆì „/ê³µì§€/ë™ì˜/ë¯¼ê°ì •ë³´/ë¶„ìŸ ë¦¬ìŠ¤í¬)
- **class_change_or_cancel**: ìˆ˜ì—… ë³€ê²½/ì·¨ì†Œ ì•Œë¦¼
- **checkin_reminder**: ìˆ˜ì—… ì‹œì‘ ì „ ì²´í¬ì¸ ë¦¬ë§ˆì¸ë”
- **checkout_missing_alert**: ìˆ˜ì—… ì¢…ë£Œ í›„ í•˜ì› í™•ì¸ ì•Œë¦¼
- **announcement_urgent**: ê¸´ê¸‰ ê³µì§€ì‚¬í•­ ì•Œë¦¼ (planned, ê³µì§€ í…Œì´ë¸” í™•ì • ì „)
- **announcement_digest**: ì •ê¸° ê³µì§€ì‚¬í•­ ìš”ì•½ (planned, ê³µì§€ í…Œì´ë¸” í™•ì • ì „)
- **consultation_summary_ready**: ì„œë²„ê°€ ìƒë‹´ ìš”ì•½ ë°œì†¡
- **attendance_pattern_anomaly**: ì¶œê²° íŒ¨í„´ ì´ìƒ ì•Œë¦¼

#### workforce_ops (ê°•ì‚¬/ì§ì› ìš´ì˜)
- **teacher_workload_imbalance**: ê°•ì‚¬ ë°°ì • ë¶ˆê· í˜• ì•Œë¦¼
- **staff_absence_schedule_risk**: ì§ì› ê²°ê·¼ ì¼ì • ë¦¬ìŠ¤í¬ ì•Œë¦¼ (ìƒìš©í™” ë‹¨ê³„, planned)

**âš ï¸ ì£¼ì˜:**
- status='planned' í•­ëª©ì€ UIì—ì„œ ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€ ì²˜ë¦¬ë˜ë©°, "ì¤€ë¹„ì¤‘ í¬í•¨" í† ê¸€ë¡œ í‘œì‹œ ê°€ëŠ¥ (ë‹¨, AI ê´€ë ¨ í˜ì´ì§€/ë©”ë‰´ëŠ” "ìˆ¨ê¹€ ê¸ˆì§€" ì›ì¹™ì— ë”°ë¼ í•­ìƒ í‘œì‹œë¨)
- ëª¨ë“  ìë™í™”ëŠ” Policy ê¸°ë°˜ìœ¼ë¡œë§Œ ë™ì‘í•˜ë©°, ì„¤ì •ì´ ì—†ìœ¼ë©´ ì‹¤í–‰í•˜ì§€ ì•ŠìŒ (Fail Closed)
- í”„ë¡ íŠ¸ì—”ë“œëŠ” ì‹¤í–‰/íŒë‹¨ ì£¼ì²´ê°€ ì•„ë‹ˆê³ , í‘œì‹œ/ìŠ¹ì¸ìš”ì²­/ì„¤ì • UIë§Œ ë‹´ë‹¹

### 15.2 ì§€ê¸ˆ ì¶”ê°€ ìë™í™”ê°€ "í•„ìš” ì—†ëŠ”" ì´ìœ 

**ì´ë¯¸ ì¶©ë¶„íˆ ê°–ì¶°ì§„ ê²ƒ:**
- ì¶”ì²œ ìƒì„± ìˆìŒ (AI/Rule Engine)
- ì •ì±… í•´ì„ ë° ìƒì„± ìˆìŒ (Edge Function)
- ì •ì±… í•´ì„ í›„ ì‹¤í–‰ ìˆìŒ (Edge Function)
- ì •ì±… ê¸°ë°˜ ìë™í™” ì•ˆì „ì„± ë©”ì»¤ë‹ˆì¦˜(Self-Regulation) ìˆìŒ
- ì •ì±… ê¸°ë°˜ ìë™í™” ê²°ê³¼ ê°€ì‹œì„±(Digest) ìˆìŒ

**âš ï¸ ê²½ê³ :**
- ì¶”ê°€ ìë™í™”ëŠ” ìœ„í—˜í•´ì§ˆ ìˆ˜ ìˆëŠ” ì§€ì ì…ë‹ˆë‹¤
- ì‹ ë¢°ë¥¼ ê°‰ì•„ë¨¹ëŠ” ìë™í™”ëŠ” ì ˆëŒ€ ì¶”ê°€í•˜ë©´ ì•ˆ ë©ë‹ˆë‹¤

### 15.3 ì¡°ê±´ë¶€ ê³ ë ¤ ê°€ëŠ¥í•œ ìë™í™” (ë¯¸ë˜ ì°¸ê³ ìš©)

**âš ï¸ ì¤‘ìš”: ì´ ì•„ì´ë””ì–´ë“¤ì€ ì§€ê¸ˆ ë‹¹ì¥ êµ¬í˜„í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.**
**ì¡°ê±´ ì¶©ì¡± ì‹œì—ë§Œ ê³ ë ¤í•  ìˆ˜ ìˆëŠ” ìœ ì¼í•˜ê²Œ ì˜ë¯¸ ìˆëŠ” ìë™í™” ì•„ì´ë””ì–´ì…ë‹ˆë‹¤.**

#### 15.3.1 ìë™í™” "ì¤‘ë‹¨ ì¶”ì²œ" (Stop Suggestion)

**ê°œë…:**
- ìë™í™”ë¥¼ ë” í•˜ìëŠ” ê²Œ ì•„ë‹ˆë¼, **ë©ˆì¶”ë¼ê³  ì¶”ì²œí•˜ëŠ” ìë™í™”**
- ì‹¤í–‰ âŒ, ê°•ì œ âŒ, ì¶”ì²œë§Œ

**ì˜ˆì‹œ:**
- ìµœê·¼ 7ì¼ê°„ ìŠ¹ì¸ ìš”ì²­ 90% ê±°ë¶€
- ë©”ì‹œì§€ ìë™í™” ì´í›„ ë¯¼ì› ë°œìƒ
- â†’ ì‹œìŠ¤í…œì´ ì´ë ‡ê²Œ ë§í•¨: "ì´ ìœ í˜•ì˜ ìë™í™”ëŠ” í˜„ì¬ íš¨ê³¼ê°€ ë‚®ìŠµë‹ˆë‹¤. ì ì‹œ ì¤‘ë‹¨ì„ ê¶Œì¥í•©ë‹ˆë‹¤."

**êµ¬í˜„:**
- AI_BRIEFINGìœ¼ë¡œ í‘œì‹œ
- TaskCardë¡œ ìƒì„± (`task_type: 'ai_suggested'`, `suggested_action.type: 'pause_automation'`, StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)
- í”„ë¡ íŠ¸ì—”ë“œëŠ” ìŠ¹ì¸ ìš”ì²­ë§Œ

**âš ï¸ ì¡°ê±´:**
- ê³ ê¸‰ SaaSì—ì„œë§Œ ë³´ì´ëŠ” íŒ¨í„´
- ì§€ê¸ˆ êµ¬ì¡°ì— ì™„ë²½íˆ ë¶€í•©
- ìƒìš©í™” ë‹¨ê³„ì—ì„œ ê²€í† 

#### 15.3.2 ìë™í™” íŒ¨í„´ ìš”ì•½ (Meta-Automation Insight)

**ê°œë…:**
- "ë¬´ì—‡ì„ í–ˆëŠ”ê°€"ê°€ ì•„ë‹ˆë¼ **"ìë™í™”ê°€ ì–´ë–¤ íŒ¨í„´ìœ¼ë¡œ ì‘ë™í•˜ê³  ìˆëŠ”ê°€"**
- ë²„íŠ¼ âŒ, ì‹¤í–‰ âŒ, ì •ë³´ë§Œ

**ì˜ˆì‹œ:**
- ì´ë²ˆ ë‹¬ ìë™í™”ì˜ 70%ëŠ” ì¶œê²° ê¸°ë°˜
- ìŠ¹ì¸ ìš”ì²­ ì¤‘ 60%ëŠ” ë©”ì‹œì§€ ìœ í˜•
- â†’ AI_BRIEFINGìœ¼ë¡œë§Œ í‘œì‹œ

**êµ¬í˜„:**
- Daily Automation Digestì˜ í™•ì¥
- AI_BRIEFINGìœ¼ë¡œ ì €ì¥ (`insight_type: 'meta_automation_pattern'`)
- ì½ê¸° ì „ìš©

**âš ï¸ ì¡°ê±´:**
- ìë™í™” ì–‘ì„ ëŠ˜ë¦¬ì§€ ì•Šê³  ìš´ì˜ ì´í•´ë„ë§Œ ìƒìŠ¹
- ìƒìš©í™” ë‹¨ê³„ì—ì„œ ê²€í† 

#### 15.3.3 ìë™í™” ì•„ì´ë””ì–´ 'ì œì•ˆ'ì´ ì•„ë‹ˆë¼ 'ì§ˆë¬¸' í˜•íƒœ

**ê°œë…:**
- âŒ "ì´ê±¸ ìë™í™”í• ê¹Œìš”?" (ê°•ìš”)
- âœ… "ì´ê±´ ìë™í™” ëŒ€ìƒì¼ê¹Œìš”?" (ë©”íƒ€ ì§ˆë¬¸)

**ì˜ˆì‹œ:**
- "ë§¤ì£¼ ë°˜ë³µë˜ëŠ” ìˆ˜ë™ ì‘ì—…ì´ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ ì‘ì—…ì„ ìë™í™” ëŒ€ìƒìœ¼ë¡œ ë¶„ë¥˜í• ê¹Œìš”?"
- ì‹¤í–‰ âŒ, ìƒì„± âŒ, ë©”íƒ€ ì§ˆë¬¸ë§Œ

**êµ¬í˜„:**
- TaskCardë¡œ ìƒì„± (`task_type: 'ai_suggested'`, `suggested_action.type: 'classify_automation_candidate'`, StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)
- í”„ë¡ íŠ¸ì—”ë“œëŠ” ìŠ¹ì¸ ìš”ì²­ë§Œ
- ìŠ¹ì¸ ì‹œ ìë™í™” í›„ë³´ë¡œ ë¶„ë¥˜ (ì‹¤í–‰ ì•„ë‹˜)

**âš ï¸ ì¡°ê±´:**
- ìë™í™”ë¥¼ ê°•ìš”í•˜ì§€ ì•ŠìŒ
- Zero-Management ì² í•™ê³¼ ì¶©ëŒ ì—†ìŒ
- ì„ íƒì  êµ¬í˜„ì—ì„œ ê²€í†  (ì‹¤ì œ í•„ìš” ì‹œ)

### 15.4 í•˜ì§€ ë§ì•„ì•¼ í•  ìë™í™” (ì ˆëŒ€ ê¸ˆì§€)

**âš ï¸ Critical: ì•„ë˜ëŠ” ì ˆëŒ€ ì¶”ê°€í•˜ë©´ ì•ˆ ë©ë‹ˆë‹¤. ì‹ ë¢°ë¥¼ ê°‰ì•„ë¨¹ìŠµë‹ˆë‹¤.**

| ê¸ˆì§€ í•­ëª© | ì´ìœ  |
|----------|------|
| âŒ "AIê°€ ëŒ€ì‹  ê²°ì •í•´ë“œë¦½ë‹ˆë‹¤" | ì‚¬ìš©ì ì‹ ë¢° ì €í•˜, ì±…ì„ ì†Œì¬ ëª¨í˜¸ |
| âŒ í”„ë¡ íŠ¸ì—ì„œ ë” ë§ì€ ìë™ í–‰ë™ | Zero-Trust ìœ„ë°˜, ì‹¤í–‰ ì£¼ì²´ í˜¼ë€ |
| âŒ ìë™ ìŠ¹ì¸ | Role ê²€ì¦ ìš°íšŒ, ë³´ì•ˆ ìœ„í—˜ |
| âŒ ìë™ ë©”ì‹œì§€ ê°œì¸í™” í™•ëŒ€ | ì˜¤í•´ ìœ ë°œ, ê´€ê³„ ë¦¬ìŠ¤í¬ ì¦ê°€ |
| âŒ ì¡°ê±´ì´ ë³µì¡í•œ ë£° ìë™í™” | ë””ë²„ê¹… ë¶ˆê°€, ì˜ˆì¸¡ ë¶ˆê°€ëŠ¥ì„± |

**âš ï¸ ì¤‘ìš”:**
- ì´ê±´ ì „ë¶€ ì‹ ë¢°ë¥¼ ê°‰ì•„ë¨¹ìŠµë‹ˆë‹¤
- ìë™í™” ì–‘ì„ ëŠ˜ë¦¬ëŠ” ê²ƒë³´ë‹¤ **ìë™í™” í’ˆì§ˆì„ ìœ ì§€í•˜ëŠ” ê²ƒ**ì´ ë” ì¤‘ìš”í•©ë‹ˆë‹¤

### 15.5 ìµœì¢… ì›ì¹™ (í•œ ë¬¸ì¥)

**"ì§€ê¸ˆì€ ìë™í™”ë¥¼ 'ë” ë§Œë“¤ ë‹¨ê³„'ê°€ ì•„ë‹ˆë¼ ìë™í™”ë¥¼ 'ì˜ ë‹¤ìŠ¤ë¦¬ëŠ” ë‹¨ê³„'ë‹¤."**

---

---

## ë¶€ë¡ A. v2.x ë ˆê±°ì‹œ ì°¸ê³  (ì‚­ì œëœ ê°œë…)

**âš ï¸ ì¤‘ìš”: ì´ ì„¹ì…˜ì€ v2.x ì‹œê¸°ì˜ ì‚­ì œëœ ê°œë…ì„ ì°¸ê³ ìš©ìœ¼ë¡œë§Œ ì œê³µí•©ë‹ˆë‹¤.**
**í˜„ì¬ v3.3 ì •ë³¸ì—ì„œëŠ” ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.**

### A.1 AI Suggestion (Level 2) ìŠ¹ì¸ ë©”ì»¤ë‹ˆì¦˜ [ì‚­ì œë¨]

> **âš ï¸ ë ˆê±°ì‹œ ì„¹ì…˜: v3.3ì—ì„œ ì‚­ì œë¨, TaskCardë¡œ í†µí•©ë¨. ì´ ì„¹ì…˜ì€ ì •ë³¸ ê·œì¹™ ìœ„ë°˜ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.**
> **AI Suggestionì€ TaskCardë¡œ í†µí•©ë˜ì—ˆìŠµë‹ˆë‹¤. (StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­, 2.2 ì°¸ì¡°)**

#### A.1.1 AI Suggestion ë°ì´í„° ëª¨ë¸ [ì‚­ì œë¨]

**âŒ ì‚­ì œëœ í…Œì´ë¸”:** `ai_suggestions`

```sql
CREATE TABLE ai_suggestions (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL REFERENCES tenants(id),
  suggestion_type text NOT NULL, -- 'message_draft', 'consultation_recommendation', 'analysis_request'
  title text NOT NULL,
  summary text NOT NULL,
  suggested_action jsonb NOT NULL,
  context_data jsonb,
  priority integer DEFAULT 50, -- 0-100 (ì •ë³¸: 0-100 ìŠ¤ì¼€ì¼ í†µì¼, ë ˆê±°ì‹œ ì°¸ê³ ìš©)
  status text DEFAULT 'pending',
  created_at timestamptz DEFAULT now(),
  executed_at timestamptz,
  user_feedback text,
  FOREIGN KEY (tenant_id) REFERENCES tenants(id)
);
```

#### A.1.2 AI Suggestion Hook [ì‚­ì œë¨]

**âŒ ì‚­ì œëœ Hook:** `packages/hooks/use-ai-suggestion`

**âœ… ëŒ€ì²´:** `packages/hooks/use-student`ì˜ `useStudentTaskCards` ì‚¬ìš© (StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)

#### A.1.3 AI Suggestion Card ì»´í¬ë„ŒíŠ¸ [ì‚­ì œë¨]

**âŒ ì‚­ì œëœ ì»´í¬ë„ŒíŠ¸:** `apps/academy-admin/src/components/AISuggestionCard.tsx`

**âœ… ëŒ€ì²´:** `apps/academy-admin/src/components/StudentTaskCard.tsx` ì‚¬ìš© (StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)

#### A.1.4 HomePage í†µí•© [ì‚­ì œë¨]

**âŒ ì‚­ì œëœ ì½”ë“œ:**
- AI Suggestions ë³„ë„ ì„¹ì…˜
- `useAISuggestion` Hook ì‚¬ìš©
- `AISuggestionCard` ì»´í¬ë„ŒíŠ¸ ì‚¬ìš©

**âœ… ì •ë³¸ êµ¬í˜„:** TaskCardë¡œ í†µí•© (StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­, 2.2 ì°¸ì¡°)

### A.2 Proactive TaskCard (task_type: 'ai_suggested', entity_type='student') ì‹œìŠ¤í…œ [ìˆ˜ì •ë¨]

**âš ï¸ v3.3 ì •ë³¸: Proactive ì œì•ˆì€ TaskCard (task_type: 'ai_suggested', entity_type='student')ë¡œ ìƒì„±ë©ë‹ˆë‹¤. (StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)**

**ì •ë³¸ êµ¬í˜„:** 2.6.1 ì„¹ì…˜ ì°¸ì¡°

---

## 17. ë³€ê²½ ì´ë ¥

- 2024-12-XX: ë¬¸ì„œ ì •í•©ì„± ê°œì„  ì™„ë£Œ
  - getTenantSettingByPath í•¨ìˆ˜ ì‹œê·¸ë‹ˆì²˜ SSOT í™•ì • ë° ë¬¸ì„œ í†µì¼
  - ì„œë²„/Edge Function ì‹œê·¸ë‹ˆì²˜: getTenantSettingByPath(supabase, tenantId, path, legacyPath?)
  - í”„ë¡ íŠ¸ì—”ë“œ ë˜í¼ í•¨ìˆ˜ ì‚¬ìš© ëª…ì‹œ
  - tenant_settings.* í‘œê¸° ê·œì¹™ í†µì¼ (KV êµ¬ì¡° ëª…í™•í™”)
- 2024-12-XX: ë¬¸ì„œ ì •í•©ì„± ê°œì„ 
  - industry_type CHECK ì œì•½ì¡°ê±´ ì˜ˆì‹œì— nail í¬í•¨ ì—¬ë¶€ ì£¼ì˜ì‚¬í•­ ì¶”ê°€
  - RLS ì˜ˆì‹œ ì˜¤ë¥˜ ìˆ˜ì • (super_adminì€ user_platform_roles)
  - ì—­í• ë³„ UI ìˆ¨ê¹€ vs AI í† ê¸€ ì •ì±… ìš°ì„ ìˆœìœ„ ëª…í™•í™”
  - Tailwind í´ë˜ìŠ¤ ì˜ˆì‹œ ì œê±° (CSS ë³€ìˆ˜ ì˜ˆì‹œë¡œ êµì²´)
  - Phase 3 í•­ëª©ì„ Out of Scope/ë¡œë“œë§µìœ¼ë¡œ ê²©ë¦¬
  - í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ì¡´ì¬ ì—¬ë¶€ í™•ì¸ ì£¼ì˜ì‚¬í•­ ì¶”ê°€
  - TODO ì£¼ì„ì„ ë¯¸êµ¬í˜„ ìŠ¤í™ í‘œê¸°ë¡œ ë³€ê²½
- YYYY-MM-DD: AI ì˜¨ì˜¤í”„ SSOT í†µì¼ ì‘ì—… ì™„ë£Œ
  - ê¸€ë¡œë²Œ í—¤ë” AI í† ê¸€ SSOT ì„¹ì…˜ ì¶”ê°€ (UX/ì •ì±… SSOT)
  - SSOT ìŠ¤ìœ„ì¹˜ ì •ì˜: `tenant_features(feature_key='ai').enabled` (ì •ë³¸), `tenant_settings.ai.enabled` (ë ˆê±°ì‹œ)
  - í”Œë«í¼ ìŠ¤ìœ„ì¹˜: `PLATFORM_AI_ENABLED` (env-registry/server)
  - ìµœì¢… ìœ íš¨ê°’: `effective_ai_enabled = PLATFORM_AI_ENABLED && tenant_features['ai'].enabled`
  - ë ˆê±°ì‹œ ì„¹ì…˜ì„ SSOT ê¸°ì¤€ìœ¼ë¡œ ìˆ˜ì •
- YYYY-MM-DD: P0 (ì¹˜ëª…) ì •í•©ì„± ì¶©ëŒ ìˆ˜ì • ì™„ë£Œ
  - RLS SSOT íŒ¨í„´ ì¶©ëŒ í•´ê²° (JWT claim ê¸°ë°˜ ì •ë³¸ í™•ì •, í˜„ì¬ RLS.txt í˜¼ì¬ ìƒíƒœ ëª…ì‹œ ë° ë§ˆì´ê·¸ë ˆì´ì…˜ ê³„íš ì¶”ê°€)
  - Schema Registry ì»¬ëŸ¼ ìŠ¤í™ ë‹¨ì¼í™” (registered_at/activated_at/deprecated_at ì •ë³¸ í™•ì •, ìŠ¤í‚¤ë§ˆì—ë””í„° ë¬¸ì„œ ì°¸ì¡° ëª…ì‹œ)
  - minSupportedClient ì •ê·œí™” ê·œì¹™ DB ë ˆë²¨ ê°•ì œ (íŠ¸ë¦¬ê±° ì˜ˆì‹œ ì¶”ê°€, ìš°ì„ ìˆœìœ„ ëª…ì‹œ)
  - Platform RBAC ì ìš© ë²”ìœ„ ë¬¸ì„œí™” (super_admin ìš°íšŒ í•„ìš” í…Œì´ë¸” ëª©ë¡ ëª…ì‹œ)
  - ê°œë… ë ˆì´ì–´ í‘œê¸° vs ì‹¤ì œ íŒ¨í‚¤ì§€ êµ¬ì¡° ê·œì¹™í™” (R1.1 ì •ë³¸ ì°¸ì¡° ëª…ì‹œ, ëª¨ë“  ë¬¸ì„œì— ì¶”ê°€)
- YYYY-MM-DD: P0-P2 ì´ìŠˆ ì¶”ê°€ ìˆ˜ì • ì™„ë£Œ
  - ì§€ì—­ ì½”ë“œ í‚¤ ë„¤ì´ë° ì¶©ëŒ í•´ê²° (region_code = location_code SSOT ë§¤í•‘ ëª…ì‹œ)
  - set_config ì˜ˆì‹œë¥¼ ë ˆê±°ì‹œ ì„¹ì…˜ìœ¼ë¡œ ë¶„ë¦¬ (ìƒìš©í™” ë‹¨ê³„ ì‚¬ìš© ê¸ˆì§€ ëª…ì‹œ)
  - ì§€ì—­ í…Œì´ë¸”ëª… SSOT ì°¸ì¡° ëª…í™•í™” (í†µê³„ë¬¸ì„œ ì°¸ì¡° ëª…ì‹œ)
  - Tailwind ìš©ì–´ ì •ì˜ ëª…í™•í™” (ë¸Œë ˆì´í¬í¬ì¸íŠ¸ ìˆ«ì ì²´ê³„ ê°œë…, í´ë˜ìŠ¤ ë¬¸ìì—´ ê¸ˆì§€)
  - Action Engine navigate í—ˆìš© ë²”ìœ„ ëª…ì‹œ (ì‚¬ìš©ì ëª…ì‹œì  ì•¡ì…˜ë§Œ í—ˆìš©, ìë™í™”/AI íë¦„ ê¸ˆì§€)
- YYYY-MM-DD: P0 (ì¹˜ëª…) ì´ìŠˆ ì¶”ê°€ ìˆ˜ì • ì™„ë£Œ
  - Schema Registry ë²„ì „ í•„ë“œ SSOT ì¬í™•ì¸ (minSupportedClient ì •ë³¸ í™•ì •, minClient/min_client ë ˆê±°ì‹œ ëª…ì‹œ)
  - RLS íŒ¨í„´ í˜¼ì¬ ë¬¸ì œ í™•ì • (ì•ˆ A: JWT claim ê¸°ë°˜ ì •ë³¸ í™•ì •, í…Œë„ŒíŠ¸ ì „í™˜ í”Œë¡œìš° SSOT ì¶”ê°€)
  - Platform RBAC ê³„ì•½ í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸ ì¶”ê°€ (8ê°œ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ëª…ì‹œ)
- YYYY-MM-DD: P0 (ì¹˜ëª…) ì´ìŠˆ ìˆ˜ì • ì™„ë£Œ
  - Schema Registry ë²„ì „ í•„ë“œ SSOT ì¶©ëŒ í•´ê²° (minSupportedClient ì •ë³¸ í™•ì •, minClient/min_clientëŠ” ë ˆê±°ì‹œ ì…ë ¥ í—ˆìš©)
  - RLS ì„¸ì…˜ ë³€ìˆ˜ ê´€ë ¨ ê·œì¹™ ëª¨ìˆœ í•´ê²° (JWT claim ê¸°ë°˜ ì •ë³¸, app.current_tenant_idëŠ” ë ˆê±°ì‹œ/ì˜ˆì•½ í‚¤ë¡œ ëª…ì‹œ)
  - dev_bypass ì •ì±… ì œê±° (tenant_isolationìœ¼ë¡œ êµì²´)
  - ìŠ¤í‚¤ë§ˆ.txt â†” RLS.txt ë¶ˆì¼ì¹˜ í•´ê²° (tags, tag_assignments, tenant_features RLS ì •ì±… ì¶”ê°€)
  - í•™ìƒ í‚¤ í˜¼ì¬ ë¬¸ì œ ë¬¸ì„œí™” (persons.id ì •ë³¸, student_idëŠ” person_id ì°¸ì¡°ë¡œ ëª…ì‹œ)
  - TTL í‘œ êµ¬ë¶„ ì¶”ê°€ (ìƒìš©í™” ë‹¨ê³„ í˜„ì¬ êµ¬í˜„, í–¥í›„ ì˜ˆì • í…Œì´ë¸” ë¶„ë¦¬)
  - RLS íŒ¨í„´ í˜¼ì¬ ë¬¸ì œ ë¬¸ì„œí™” (JWT claim vs user_tenant_roles í˜¼ì¬ í˜„í™© ëª…ì‹œ, í†µì¼ ê¶Œì¥)
  - students í…Œì´ë¸” ë ˆê±°ì‹œ ëª…ì‹œ (NOT NULL/ê¸°ë³¸ê°’/RLS ì •ì±… ëˆ„ë½ ìƒíƒœ ë¬¸ì„œí™”)
  - Platform RBAC vs Tenant RBAC ë¶„ë¦¬ ê·œì¹™ ê³µí†µ SSOT ë¸”ë¡ ìŠ¹ê²©
- YYYY-MM-DD: Critical/P0/P1/P2 ì´ìŠˆ ìˆ˜ì • ì™„ë£Œ
  - Analytics í…Œì´ë¸”ëª… ì¶©ëŒ í•´ê²° (regional_metrics_daily â†’ analytics.daily_region_metrics, SSOT í™•ì •, í†µê³„ë¬¸ì„œ ì°¸ì¡°)
  - ì•„í‚¤í…ì²˜ ë¬¸ì„œ ë‚´ë¶€ êµ¬ë²„ì „ ë„¤ì´ë° ì™„ì „ ì œê±° (analytics.daily_metrics, analytics.monthly_revenue)
  - DB Trigger ë³´ì•ˆ ìœ„í—˜ ì œê±° (service_role_key current_setting â†’ í í…Œì´ë¸” ë°©ì‹)
  - ìŠ¤í‚¤ë§ˆ ì •ë³¸ ê·œì¹™ ëª…í™•í™” (ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ì°¸ì¡° ì¶”ê°€)
  - ì—”í‹°í‹° ëª¨ë¸ ì •ë³¸í™” (persons ì •ë³¸, academy_students í™•ì¥, students ë ˆê±°ì‹œ)
  - AI ì¸ì‚¬ì´íŠ¸ ì—”í‹°í‹° ë‹¨ì¼í™” (ai_insights ì •ë³¸, AI_BRIEFINGì€ UI í‘œê¸°)
  - í í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ ì¶”ê°€ (consultation_summary_jobs)
  - ìë™í™” ê´€ë ¨ í…Œì´ë¸” RLS ì •ì±… í†µí•© (RLS.txtì— automation_actions, automation_undo_logs, automation_safety_state, ai_decision_logs ì¶”ê°€)
  - í”„ë¡ íŠ¸ ìƒí™© ì‹ í˜¸ ìˆ˜ì§‘ ë¬¸ì„œì˜ ì—­í•  ì¬ì •ì˜ê°€ ë‹¤ë¥¸ ë¬¸ì„œì— ë°˜ì˜ (ì „ì²´ ê¸°ìˆ ë¬¸ì„œ, ì „ì²´ ìœ ì•„ì´ë¬¸ì„œ)
  - ì—…ì¢… í‚¤ ë„¤ì´ë° í†µì¼ í™•ì¸ ì™„ë£Œ (real_estate ì •ë³¸, realestate ì‚¬ìš© ê¸ˆì§€)
  - í†µê³„ í…Œì´ë¸” ì •ë³¸í™” ë¬¸ì„œ ê°„ ì¼ê´€ì„± í™•ì¸ ì™„ë£Œ (analytics.daily_store_metrics, analytics.daily_region_metrics)
- YYYY-MM-DD: ë¬¸ì„œ ê°„ ì •í•©ì„± ìˆ˜ì • (P0-P2 ì´ìŠˆ í•´ê²°)
  - TTL ì •ì±… í‘œì— ìë™í™” ê´€ë ¨ í…Œì´ë¸” ì¶”ê°€ (automation_actions, automation_safety_state, ai_decision_logs, automation_undo_logs)
  - ìŠ¹ì¸/ì‹¤í–‰ ì—”ë“œí¬ì¸íŠ¸ ëª…ì¹­ í†µì¼ (approve-and-execute SSOT, approve ë ˆê±°ì‹œ aliasë¡œ ëª…ì‹œ)
  - ì—…ì¢… í‚¤ ë„¤ì´ë° í†µì¼ (realestate â†’ real_estate)
  - ìë™í™” ë¡œê·¸ í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ/ë§ˆì´ê·¸ë ˆì´ì…˜ ì—°ê²° ëª…ì‹œ
  - í•™ìƒ/ì¸ë¬¼ í‚¤ ê´€ê³„ ëª…í™•í™” (student_id = person_id = persons.id)
  - Tailwind ë¸Œë ˆì´í¬í¬ì¸íŠ¸ í‘œí˜„ ì •ë¦¬ (ìˆ«ì ê·œê²©ë§Œ ì°¸ì¡°, Tailwind í´ë˜ìŠ¤ ë¬¸ìì—´ ì‚¬ìš© ê¸ˆì§€ ëª…ì‹œ)
  - ì¶”ê°€ ê°œì„ ì‚¬í•­ ë°˜ì˜ (ê³„ì•½ í…ŒìŠ¤íŠ¸, ê°ì‚¬ í•„ë“œ í‘œì¤€í™”, dry-run UI, ì„±ëŠ¥ ê²Œì´íŠ¸)
- YYYY-MM-DD: ì´ˆì•ˆ ì‘ì„± ë° ìƒìš©í™” ë‹¨ê³„ êµ¬í˜„ ì™„ë£Œ
- YYYY-MM-DD: ì •ë³¸ ê·œì¹™ ì¤€ìˆ˜ ìˆ˜ì • (ìë™ ì´ë™ ì œê±°, ê·¸ë£¹ ìˆœì„œ ë¶ˆë³€, í”„ë¡ íŠ¸ì—”ë“œ ì‹¤í–‰ ì œê±°)
- YYYY-MM-DD: ë¬¸ì„œ ê°„ ì •í•©ì„± ë³µêµ¬ (ê³µí†µ ì„ ì–¸ ë¸”ë¡ ì¶”ê°€, ìš©ì–´ í†µì¼ ê·œì¹™ ëª…ì‹œ)
  - í”„ë¡ íŠ¸ ìƒí™© ì‹ í˜¸ ìˆ˜ì§‘ ë¬¸ì„œ: ê³µí†µ ì‹¤í–‰ ì£¼ì²´ ì„ ì–¸ ë¸”ë¡ ì¶”ê°€
  - ë””ì–´ìŒ¤ ì•„í‚¤í…ì²˜.md: ì‹¤í–‰ ì£¼ì²´ ë¶„ë¦¬ ê·œì¹™ ì¶”ê°€
  - ì „ì²´ ê¸°ìˆ ë¬¸ì„œ.txt: ì‹¤í–‰ ì£¼ì²´ ë¶„ë¦¬ ê·œì¹™ ì¶”ê°€
  - ì „ì²´ UI ë¬¸ì„œ.txt: "ìë™" ìš©ì–´ í•´ì„ ê·œì¹™ ì¶”ê°€
- YYYY-MM-DD: v2.x ë ˆê±°ì‹œ ìš©ì–´ ì™„ì „ ì œê±° (Level 1 ì •ë¦¬ ì™„ë£Œ)
  - "AI Suggestion" â†’ "TaskCard (task_type: 'ai_suggested', entity_type='student')" ì™„ì „ ì¹˜í™˜ (StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)
  - ëª¨ë“  "ìë™" í‘œí˜„ì— ì£¼ì–´ ëª…ì‹œ ì¶”ê°€
  - Hook ì´ë¦„ ì¬ì •ì˜: `useAdaptiveNavigation` â†’ `useContextSignals` (ê¶Œì¥)
  - ìš©ì–´ 3ë‹¨ ë¶„ë¦¬ ëª…ì‹œ: ì¶”ì²œ(AI) / ìƒì„±(ì„œë²„) / ìŠ¹ì¸(UI)
- YYYY-MM-DD: ìë™í™” ì±…ì„ì„± ì„¤ê³„ ì¶”ê°€ (í•„ìˆ˜ ë³´ì™„)
  - ìë™ ì‹¤í–‰ vs ìŠ¹ì¸ í•„ìš” ê¸°ì¤€í‘œ ì¶”ê°€ (ëª…ì‹œì  ê¸°ì¤€)
  - ìë™ ì‹¤í–‰ ìê¸° ì–µì œ ë©”ì»¤ë‹ˆì¦˜ ì¶”ê°€ (automation_safety_state)
  - Daily Automation Digest ì¶”ê°€ (ìë™í™” ê²°ê³¼ ê°€ì‹œì„±)
  - ProactiveRecommendationCard ì‚­ì œ ë° TaskCardë¡œ ì™„ì „ í¡ìˆ˜ (StudentTaskCardëŠ” í•™ìƒìš© ë³„ì¹­)
- YYYY-MM-DD: ìë™í™” í™•ì¥ ê°€ì´ë“œë¼ì¸ ì¶”ê°€ (Critical)
  - í˜„ì¬ ìƒíƒœ í‰ê°€: "ë” ë§Œë“¤ ë‹¨ê³„"ê°€ ì•„ë‹Œ "ì˜ ë‹¤ìŠ¤ë¦¬ëŠ” ë‹¨ê³„" ëª…ì‹œ
  - ì¡°ê±´ë¶€ ê³ ë ¤ ê°€ëŠ¥í•œ ìë™í™” 3ê°€ì§€ ì¶”ê°€ (ë¯¸ë˜ ì°¸ê³ ìš©)
  - í•˜ì§€ ë§ì•„ì•¼ í•  ìë™í™” ëª…ì‹œ (ì ˆëŒ€ ê¸ˆì§€)
  - ìµœì¢… ì›ì¹™: ìë™í™” í’ˆì§ˆ ìœ ì§€ê°€ ì–‘ ì¦ê°€ë³´ë‹¤ ì¤‘ìš”
- YYYY-MM-DD: Strict-Compliant ë¸”ë¡œì»¤ ìˆ˜ì • ì™„ë£Œ
  - ë°°ë„ˆ UI ì„¹ì…˜: "ìë™ ì‹¤í–‰" í‘œí˜„ ì‚­ì œ, ì‚¬ìš©ì í´ë¦­ ì‹œ ì´ë™ë§Œ ëª…ì‹œ
  - í…ŒìŠ¤íŠ¸ ê³„íš: "ìë™ í™”ë©´ ì „í™˜" â†’ "ì¶”ì²œ ë°°ë„ˆ í‘œì‹œ"ë¡œ êµì²´
  - useContextSignals ì½”ë“œ ìŠ¤ë‹ˆí«: ì»´íŒŒì¼ ê°€ëŠ¥ êµ¬ì¡°ë¡œ ì¬ì‘ì„±
  - Teacher ê¶Œí•œ ëª¨ë¸: request-approval / approve API ë¶„ë¦¬ ëª…ì‹œ
  - ë‚ ì”¨ ê¸°ë°˜ Hook: signal-onlyë¡œ ë³€ê²½ (ì•Œë¦¼ ìƒì„±/ì‹¤í–‰ ì•”ì‹œ ì œê±°)
  - context_action ì¹´ë“œ ì‚­ì œ: ìƒë‹¨ ë°°ë„ˆ/íŒíŠ¸ë¡œë§Œ ì²˜ë¦¬
  - Priority ìŠ¤ì¼€ì¼ í†µì¼: 0-100 ìŠ¤ì¼€ì¼ë¡œ í†µì¼
  - Dedup ê·œì¹™ ì •ì˜ í†µì¼: ì •ë³¸ í¬ë§· ëª…ì‹œ
  - OLD ì„¹ì…˜ ë¶€ë¡ìœ¼ë¡œ ì´ë™: v2.x ë ˆê±°ì‹œ ì°¸ê³ ìš©ìœ¼ë¡œ ê²©ë¦¬
  - ì„¹ì…˜ ë²ˆí˜¸ ì •ë¦¬: ì¼ê´€ëœ ë²ˆí˜¸ ì²´ê³„ë¡œ ì¬ì •ë ¬
  - ì¶œê²° ì´ìƒ ê°ì§€ ìŠ¹ì¸ í•„ìš” ì—¬ë¶€ ëª…í™•í™”
  - Supabase ì¿¼ë¦¬ ì˜ˆì‹œ: RPC ëª…ì‹œ ì¶”ê°€
  - v2.x í•„ë“œ ì œê±°: suggestion_type, summary â†’ task_type, description
- YYYY-MM-DD: êµ¬ë²„ì „ í‘œí˜„ ì™„ì „ ì œê±° (Critical)
  - AdaptiveNavigationRule â†’ ContextRecommendationìœ¼ë¡œ ë³€ê²½
  - executeRecommendation â†’ goToRecommendationìœ¼ë¡œ ë³€ê²½ (ì‹¤í–‰ ì•”ì‹œ ì œê±°)
  - Adaptive Navigation Banner â†’ Context Recommendation Bannerë¡œ ë³€ê²½
  - ë‚ ì”¨ ê¸°ë°˜ "ìë™ ì•ˆë‚´ë¬¸ ìƒì„±" â†’ "ìƒí™© ì‹ í˜¸ ìˆ˜ì§‘"ìœ¼ë¡œ ë³€ê²½
  - useWeatherBasedRecommendation â†’ useWeatherSignalsë¡œ ë³€ê²½
  - ëª¨ë“  "ìë™ ì´ë™/ìë™ ì—´ê¸°" í‘œí˜„ ì œê±°
- YYYY-MM-DD: ìµœì¢… ì •ë¦¬ ì™„ë£Œ (Strict-Compliant)
  - useNavigate() ì œê±°: Hook ë‚´ë¶€ì—ì„œ navigate í˜¸ì¶œ ê¸ˆì§€, ì»´í¬ë„ŒíŠ¸ ë ˆë²¨ì—ì„œë§Œ ì²˜ë¦¬
  - ì¤‘ë³µ ì„¹ì…˜ í†µí•©: ë ˆê±°ì‹œ ê³„íš ì •ë¦¬
  - Priority ìŠ¤ì¼€ì¼ í†µì¼: 0-100 ìŠ¤ì¼€
