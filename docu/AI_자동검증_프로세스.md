# 🤖 AI 자동 검증 프로세스 (AI용)

> **역할**: 이 문서는 AI가 코드 생성 시 자동으로 수행해야 하는 검증 프로세스의 전체 흐름을 설명합니다.
>
> **상세 체크리스트**: 실제 검증 항목은 `docu/코드생성_체크리스트.md`를 참고하세요.
>
> **사용자용 가이드**: 비기술자는 `docu/사용자_지시_가이드.md`를 참고하세요.

## 🎯 자동 검증 원칙

**코드 생성 시 반드시 자동으로 다음을 수행합니다:**

1. ✅ 코드 생성 전: `docu/코드생성_체크리스트.md` 확인
2. ✅ 코드 생성 중: 모든 규칙 적용
3. ✅ 코드 생성 후: 자동 검증 및 오류 수정
4. ✅ 타입 체크 실행: `npm run type-check` (가능한 경우)

**사용자가 별도로 "검증해줘"라고 요청하지 않아도 자동으로 수행합니다.**

---

## 📋 자동 검증 항목 (22개)

### 핵심 아키텍처 (Critical)
1. ✅ **아키텍처 레이어**: 클라이언트/서버 분리, 의존성 방향 (apps → hooks → services → DB)
2. ✅ **Zero-Trust 원칙**: tenantId 자동 처리, UI에서 하드코딩 금지
3. ✅ **Service Layer 규칙**: INSERT는 row object에 tenant_id 포함, SELECT/UPDATE/DELETE는 withTenant() 사용
4. ✅ **API SDK 규칙**: post() 메서드가 자동으로 tenant_id, industry_type 삽입
5. ✅ **Hook 규칙**: getApiContext()로 tenantId 가져오기, @api-sdk/core만 사용

### 보안 & 데이터 보호 (Critical)
6. ✅ **환경변수 규칙**: env-registry 사용, process.env 직접 접근 금지
7. ✅ **클라이언트-서버 분리**: 서버 코드 번들 제외, index.ts에서 서버 코드 export 금지
8. ✅ **RLS 정책**: JWT claim 기반 사용, 정책 이름은 tenant_isolation_<table> 형식
9. ✅ **PII 마스킹**: 로그/모니터링에서 maskPII() 사용 필수
10. ✅ **Service Role Key**: 클라이언트 코드에 절대 포함 금지

### 코드 품질
11. ✅ **타입 안전성**: any 타입 제거 (필터링 등 필수 경우 제외)
12. ✅ **의존성 경로**: file:../../packages/... 형식, 순환 의존성 방지
13. ✅ **패키지 구조**: exports 필드 올바른 설정, 서버 전용은 /server, /service 경로
14. ✅ **에러 처리**: AppError 표준 사용, PostgREST 에러 매핑

### UI/UX & 스타일
15. ✅ **UI/UX 규칙**: Atlaskit 컴포넌트 사용, Tailwind 직접 사용 금지, Schema Engine을 통해서만 UI 렌더링
16. ✅ **전역 스타일**: 앱별 index.css는 비어있거나 앱 전용만, Atlaskit Theme은 자동 적용
17. ✅ **모달 규칙**: window.alert/confirm 금지, Atlaskit ModalDialog 사용 필수, 모바일에서는 모달 우선

### 데이터 처리
17. ✅ **날짜/시간**: KST 기준 처리, CURRENT_DATE 직접 사용 금지
18. ✅ **SQL 인덱스**: 파티셔닝 테이블에 (tenant_id, occurred_at DESC) 인덱스 필수

### 운영 규칙
19. ✅ **더미 데이터**: 운영 코드에 더미 데이터 생성 금지
20. ✅ **이모지**: 코드/UI 텍스트에 이모지 사용 금지
21. ✅ **문서 파일 생성 금지**: *.md, *.txt 파일 자동 생성 금지 (사용자 명시 요청 제외)

---

## 🔄 검증 프로세스

### 1단계: 코드 생성 전
- [ ] `docu/코드생성_체크리스트.md` 확인
- [ ] `rules.md` 및 `docu/` 폴더의 관련 문서 확인
- [ ] 아키텍처 레이어 결정 (클라이언트/서버/Hook)

### 2단계: 코드 생성 중
- [ ] 모든 규칙 적용
- [ ] 의존성 경로 확인
- [ ] 타입 안전성 확보

### 3단계: 코드 생성 후 (자동)
- [ ] 체크리스트 전체 검증
- [ ] 오류 발견 시 자동 수정
- [ ] 타입 체크 실행 (`npm run type-check`)
- [ ] Linter 실행 (있는 경우)
- [ ] 빌드 테스트 (가능한 경우)

### 4단계: 최종 확인
- [ ] 모든 Critical 항목 통과
- [ ] 사용자에게 결과 보고

---

## 💡 효율성 개선

**사용자가 "문서 기준으로 만들어줘"라고 요청하면:**
- 더 철저한 검증 수행
- 모든 문서 확인
- 정합성 검증 강화

**사용자가 단순히 "기능 만들어줘"라고 요청하면:**
- 기본 검증 수행
- 필수 규칙만 확인

**결과적으로:**
- 별도 검증 요청 불필요
- 한 번의 요청으로 생성 + 검증 완료
- 비용 효율적

---

## 🚨 주의사항

1. **항상 자동 검증 수행**: 사용자가 요청하지 않아도 반드시 검증
2. **오류 발견 시 즉시 수정**: 보고만 하지 말고 수정까지 수행
3. **타입 체크 실행**: 가능한 경우 반드시 실행
4. **Critical 항목 우선**: 보안 및 아키텍처 규칙 우선 확인

