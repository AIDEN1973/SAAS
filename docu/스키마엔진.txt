ğŸ“˜ ë””ì–´ìŒ¤ Schema Engine v2.1 â€” SDUI ì—”í„°í”„ë¼ì´ì¦ˆ í™•ì¥íŒ

(Schema Registry 100% ì—°ë™ Â· Multi-SaaS/Industry ë¶„ë¦¬ Â· ë³µìˆ˜ ì¡°ê±´ AND/OR Â· Version-Safe SDUI Â· Zero-Trust UI ì¤€ìˆ˜ Â· SDUI v1.1 í™•ì¥)

âš ï¸ ì´ ë¬¸ì„œëŠ” Academy Â· Salon Â· Nail Â· Gym Â· Real-Estate ë“±
ì—¬ëŸ¬ ì—…ì¢… SaaSë¥¼ í•˜ë‚˜ì˜ Monorepo + í•˜ë‚˜ì˜ Supabase í”„ë¡œì íŠ¸ì—ì„œ ìš´ì˜í•˜ëŠ” ê²ƒì„ ê¸°ì¤€ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŒ.

ğŸ“Œ ë²„ì „ ì •ë³´
- Schema Engine v2.0: Form ì¤‘ì‹¬ ê¸°ë³¸ êµ¬í˜„
- Schema Engine v2.1: SDUI v1.1 ì—”í„°í”„ë¼ì´ì¦ˆ í™•ì¥íŒ (Form/Table/Detail/Filter/Widget, Action Engine, i18n, Custom Widget)

0. ëª©í‘œ & ë²”ìœ„

âœ” Form UI ì „ì²´ë¥¼ Schema Drivenìœ¼ë¡œ ì „í™˜
âœ” Table/Detail/Filter/Widgetë„ Schema Drivenìœ¼ë¡œ í™•ì¥ (SDUI v1.1)
âœ” ì—…ì¢…/í…Œë„ŒíŠ¸ë³„ UI êµ¬ì¡° ì™„ì „ ë¶„ë¦¬ (ë©€í‹° SaaS ìš´ì˜)
âœ” Meta-Schema(Zod) + React Hook Form + Controller
âœ” Schema Registry(RLS í¬í•¨) ì™„ì „ ì—°ë™
âœ” Condition Rule ê¸°ë°˜ ë™ì  UI (ë‹¨ì¼ + ë³µìˆ˜ ì¡°ê±´ AND/OR ëª¨ë‘ ì§€ì›, then/else êµ¬ì¡°)
âœ” Schema Registryë¥¼ í†µí•œ ë™ì  ìŠ¤í‚¤ë§ˆ ë¡œë“œ
âœ” ì—…ì¢…ë³„ ìŠ¤í‚¤ë§ˆ ë²„ì „ ê´€ë¦¬ ë° ë¡¤ë°±
âœ” Action Engine ì§€ì› (SDUI v1.1)
âœ” i18n í‚¤ ê¸°ë°˜ ë‹¤êµ­ì–´ ì§€ì› (SDUI v1.1)
âœ” Custom Widget ë™ì  ë¡œë”© (SDUI v1.1)

1. ì•„í‚¤í…ì²˜

ğŸ”¹ ë””ìì¸ ì‹œìŠ¤í…œ ì¢…ì†ì„± ë°©í–¥
schema-engine  â†’  @ui-core/react  â†’  (design-system/theme-engine í† í°)  â†’  CSS ë³€ìˆ˜(styles.css)

âš ï¸ ì¤‘ìš”: ê¸°ìˆ ë¬¸ì„œ PART 1 ë° UI ë¬¸ì„œì— ëª…ì‹œëœ ì˜ì¡´ì„± ë°©í–¥ì„ ì¤€ìˆ˜í•©ë‹ˆë‹¤.
- schema-engineì€ `@ui-core/react` ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚¬ìš©í•˜ë©°, Tailwind í´ë˜ìŠ¤ ë¬¸ìì—´ì„ ì§ì ‘ ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
- schema-engineì€ UI í† í°ì„ CSS ë³€ìˆ˜ë¡œ ì†Œë¹„í•˜ë©°(ì˜ˆ: `var(--spacing-md)`), í•˜ë“œì½”ë”©ëœ px ê°’ì„ ê¸ˆì§€í•©ë‹ˆë‹¤.
- ìŠ¤í‚¤ë§ˆëŠ” ë…¼ë¦¬ì  êµ¬ì¡°ë§Œ ì •ì˜í•˜ê³ , ì»´í¬ë„ŒíŠ¸ ì„ íƒê³¼ ìŠ¤íƒ€ì¼ì€ Schema Engineì´ ë‹´ë‹¹í•©ë‹ˆë‹¤.

ğŸ”¹ Condition Rule ì‹¤í–‰ ìœ„ì¹˜ ëª…í™•í™”

ì‹¤í–‰ì€ Renderer(SchemaField) ë ˆë²¨

ê´€ì°°ì€ useWatch(control) - ë³µìˆ˜ í•„ë“œ ë™ì‹œ ê°ì‹œ ì§€ì›

í‰ê°€ í•¨ìˆ˜ëŠ” schema-engine/core ìœ„ì¹˜

ğŸ”¹ ë©€í‹° SaaS ìš´ì˜ ì•„í‚¤í…ì²˜

ìŠ¤í‚¤ë§ˆëŠ” ì—…ì¢…ë³„ë¡œ ì™„ì „íˆ ë¶„ë¦¬ë©ë‹ˆë‹¤:
- `industry_type = 'academy'` â†’ í•™ì› ì—…ì¢… ì „ìš© ìŠ¤í‚¤ë§ˆ
- `industry_type = 'salon'` â†’ ë¯¸ìš©ì‹¤ ì—…ì¢… ì „ìš© ìŠ¤í‚¤ë§ˆ
- `industry_type = null` â†’ ëª¨ë“  ì—…ì¢… ê³µí†µ ìŠ¤í‚¤ë§ˆ

ìŠ¤í‚¤ë§ˆ ì¡°íšŒ ìš°ì„ ìˆœìœ„:
1. í…Œë„ŒíŠ¸ë³„ Version Pinning
2. ì—…ì¢…ë³„ í™œì„± ìŠ¤í‚¤ë§ˆ
3. ê³µí†µ í™œì„± ìŠ¤í‚¤ë§ˆ
4. Fallback ìŠ¤í‚¤ë§ˆ

âš ï¸ ì¤‘ìš”: RendererëŠ” industry_type ì •ë³´ë¥¼ ì ˆëŒ€ ì°¸ì¡°í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
- industry_type ê¸°ë°˜ ìŠ¤í‚¤ë§ˆ ì„ íƒì€ RegistryServiceì˜ ì±…ì„ì…ë‹ˆë‹¤.
- schema-engine/reactëŠ” ìŠ¤í‚¤ë§ˆì˜ ì¡´ì¬ ì—¬ë¶€ë§Œ í™•ì¸í•©ë‹ˆë‹¤.
- RendererëŠ” ì—…ì¢…ë³„ UI ì°¨ì´ë¥¼ í•´ì„í•  ìˆ˜ ì—†ìœ¼ë©°, ì˜¤ì§ JSON ìŠ¤í‚¤ë§ˆë§Œ í•´ì„í•©ë‹ˆë‹¤.

âš ï¸ ì¤‘ìš”: industry_type ê²°ì • ì£¼ì²´ (Zero-Trust ë³´ì•ˆ)
- industry_typeì€ ë°˜ë“œì‹œ Supabase auth metadata ë˜ëŠ” tenant_settings í…Œì´ë¸”ì—ì„œ ê°€ì ¸ì™€ì•¼ í•©ë‹ˆë‹¤.
- UI/í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì§ì ‘ ê²°ì •í•˜ê±°ë‚˜ ì¡°ì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
- @api-sdk/coreì˜ getApiContext()ëŠ” ë¯¸ë“¤ì›¨ì–´ë‚˜ ì¸ì¦ ì‹œìŠ¤í…œì—ì„œ ì£¼ì…ëœ industry_typeì„ ë°˜í™˜í•©ë‹ˆë‹¤.
- industry_type ê²°ì • ì†ŒìŠ¤:
  1. tenant_settings í…Œì´ë¸”: SELECT industry_type FROM tenant_settings WHERE tenant_id = current_tenant
  2. auth.users.raw_user_meta_data.industry_type (ëŒ€ì²´ ì†ŒìŠ¤)
- ì´ëŠ” Zero-Trust ì›ì¹™ì— ë”°ë¼ í”„ë¡ íŠ¸ì—”ë“œì—ì„œ industry_typeì„ ì¡°ì‘í•  ìˆ˜ ì—†ë„ë¡ ë³´ì¥í•©ë‹ˆë‹¤.

2~3. íƒ€ì… ì •ì˜

2.1 Condition Rule íƒ€ì…

ë‹¨ì¼ ì¡°ê±´:
```typescript
export interface ConditionRule {
  field: string;  // ì°¸ì¡°í•  í•„ë“œëª…
  op: 'eq' | 'ne' | 'in' | 'not_in' | 'exists' | 'not_exists' | 'gt' | 'gte' | 'lt' | 'lte' | '==' | '!=' | '>' | '>=' | '<' | '<=';  // ì—°ì‚°ì
  // SDUI v1.1: ==, !=, >, >=, <, <= ì—°ì‚°ì ì¶”ê°€ (eq/ne/gt/gte/lt/lteì™€ ë™ì¼í•˜ì§€ë§Œ ë” ì§ê´€ì )
  // not_exists ì—°ì‚°ì ì¶”ê°€ (existsì˜ ë°˜ëŒ€)
  value?: any;  // ë¹„êµ ê°’ (exists/not_existsì¼ ê²½ìš° ë¶ˆí•„ìš”)
  // âš ï¸ ì¤‘ìš”: valueê°€ undefinedì¸ ConditionRuleì€ Meta-Schema ë‹¨ê³„ì—ì„œ ê±°ë¶€ë©ë‹ˆë‹¤.
  // ë‹¨, exists/not_exists ì—°ì‚°ìëŠ” valueê°€ í•„ìš” ì—†ìœ¼ë¯€ë¡œ ì˜ˆì™¸ì…ë‹ˆë‹¤.
  // âš ï¸ ì¤‘ìš”: in/not_in ì—°ì‚°ìëŠ” valueë¡œ ìŠ¤ì¹¼ë¼ ë˜ëŠ” ë°°ì—´ ëª¨ë‘ í—ˆìš©
  // - valueê°€ ë°°ì—´ì¸ ê²½ìš°: fieldValueì™€ expected ë°°ì—´ ê°„ êµì§‘í•©/ì°¨ì§‘í•© íŒë‹¨
  //   - fieldValueê°€ ë°°ì—´: expected ë°°ì—´ì— í•˜ë‚˜ë¼ë„ í¬í•¨ë˜ë©´ true (êµì§‘í•©)
  //   - fieldValueê°€ ìŠ¤ì¹¼ë¼: expected ë°°ì—´ì— í¬í•¨ë˜ë©´ true
  // - valueê°€ ìŠ¤ì¹¼ë¼ì¸ ê²½ìš°: fieldValueê°€ expectedì™€ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸
  //   - fieldValueê°€ ë°°ì—´: ë°°ì—´ì— expectedê°€ í¬í•¨ë˜ë©´ true
  //   - fieldValueê°€ ìŠ¤ì¹¼ë¼: ë‹¨ìˆœ ë¹„êµ
  // (í–¥í›„ intersects/not_intersects ì—°ì‚°ìë¡œ ë” ëª…í™•í•˜ê²Œ ë¶„ë¦¬ ê°€ëŠ¥í•˜ë‚˜, í˜„ì¬ëŠ” ë°°ì—´ í—ˆìš©)
  // SDUI v1.1: then/else êµ¬ì¡° ì§€ì› (actionë³´ë‹¤ ìš°ì„ )
  then?: {
    hide?: boolean;
    disable?: boolean;
    require?: boolean;
    setValue?: any;  // í•„ë“œ ê°’ ì„¤ì •
    setOptions?: {  // ë™ì  ì˜µì…˜ ì„¤ì •
      type: 'static' | 'api';
      options?: Array<{ value: string; labelKey?: string; label?: string }>;
      endpoint?: string;
    };
    switchComponent?: {  // ì»´í¬ë„ŒíŠ¸ ì „í™˜
      to: string;  // 'CreditCardInput', 'BankTransferInput' ë“±
    };
  };
  else?: {
    hide?: boolean;
    disable?: boolean;
    require?: boolean;
    setValue?: any;
    setOptions?: {
      type: 'static' | 'api';
      options?: Array<{ value: string; labelKey?: string; label?: string }>;
      endpoint?: string;
    };
    switchComponent?: {
      to: string;
    };
  };
  // í•˜ìœ„ í˜¸í™˜ì„±: ê¸°ì¡´ action í•„ë“œ (then/elseê°€ ì—†ì„ ë•Œë§Œ ì‚¬ìš©)
  action?: 'show' | 'hide' | 'enable' | 'disable' | 'require';  // ì•¡ì…˜
}
```

ë³µìˆ˜ ì¡°ê±´ (AND/OR):
```typescript
export interface MultiConditionRule {
  conditions: ConditionRule[];  // ë³µìˆ˜ ì¡°ê±´ ë°°ì—´
  logic: 'and' | 'or';  // ì¡°ê±´ ê²°í•© ë°©ì‹
  // SDUI v1.1: then/else êµ¬ì¡° ì§€ì› (actionë³´ë‹¤ ìš°ì„ )
  // âš ï¸ ì¤‘ìš”: then/elseê°€ ìˆìœ¼ë©´ action í•„ë“œëŠ” ë¬´ì‹œë©ë‹ˆë‹¤.
  then?: {
    hide?: boolean;
    disable?: boolean;
    require?: boolean;
    setValue?: any;
    setOptions?: {
      type: 'static' | 'api';
      options?: Array<{ value: string; labelKey?: string; label?: string }>;
      endpoint?: string;
    };
    switchComponent?: {
      to: string;
    };
  };
  else?: {
    hide?: boolean;
    disable?: boolean;
    require?: boolean;
    setValue?: any;
    setOptions?: {
      type: 'static' | 'api';
      options?: Array<{ value: string; labelKey?: string; label?: string }>;
      endpoint?: string;
    };
    switchComponent?: {
      to: string;
    };
  };
  // í•˜ìœ„ í˜¸í™˜ì„±: ê¸°ì¡´ action í•„ë“œ (then/elseê°€ ì—†ì„ ë•Œë§Œ ì‚¬ìš©)
  action?: 'show' | 'hide' | 'enable' | 'disable' | 'require';  // ì•¡ì…˜
}
```

âš ï¸ ì¤‘ìš”: MultiConditionRule ë‚´ë¶€ì˜ conditionsì— í¬í•¨ëœ ConditionRuleë“¤ì€
- field / op / valueë§Œ ì‚¬ìš©í•˜ë©°
- action í•„ë“œëŠ” ë¬´ì‹œë©ë‹ˆë‹¤. (ì‹¤ì œ ì•¡ì…˜ì€ MultiConditionRule.action ë˜ëŠ” then/else ê¸°ì¤€)
- âš ï¸ SDUI v1.1: MultiConditionRule ë‚´ë¶€ì˜ ConditionRuleì— then/elseë¥¼ ì •ì˜í•´ë„ í˜„ì¬ëŠ” ë¬´ì‹œë©ë‹ˆë‹¤.
  - MultiConditionRuleì˜ then/elseë§Œ í‰ê°€ë˜ë©°, ë‚´ë¶€ ConditionRuleì˜ then/elseëŠ” í–¥í›„ SDUI v2.0ì—ì„œ í™•ì¥ ì˜ˆì •ì…ë‹ˆë‹¤.
  - í˜„ì¬ëŠ” MultiConditionRule ë ˆë²¨ì—ì„œë§Œ then/else + setValue/setOptions/switchComponentë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

2.2 FormFieldSchema íƒ€ì…

```typescript
export interface FormFieldSchema {
  name: string;
  kind: 'text' | 'email' | 'phone' | 'number' | 'password' | 'textarea' | 'select' | 'multiselect' | 'radio' | 'checkbox' | 'date' | 'datetime' | 'custom';  // SDUI v1.1: custom ì¶”ê°€
  ui?: {
    // SDUI v1.1: i18n í‚¤ ì§€ì› (Loader ë‹¨ê³„ì—ì„œ ë°”ì¸ë”©ë˜ê±°ë‚˜ Rendererì—ì„œ translationsë¡œ í•´ì„)
    labelKey?: string;  // i18n í‚¤
    label?: string;  // í•˜ìœ„ í˜¸í™˜ì„±: ì§ì ‘ ë¬¸ìì—´
    placeholderKey?: string;  // i18n í‚¤
    placeholder?: string;  // í•˜ìœ„ í˜¸í™˜ì„±
    descriptionKey?: string;  // i18n í‚¤
    description?: string;  // í•˜ìœ„ í˜¸í™˜ì„±
    tooltipKey?: string;  // i18n í‚¤
    tooltip?: string;  // í•˜ìœ„ í˜¸í™˜ì„±
    colSpan?: number;  // Grid column span (1-12)
  };
  // SDUI v1.1: optionsë„ i18n í‚¤ ì§€ì›
  options?: Array<{
    value: string;
    labelKey?: string;  // i18n í‚¤
    label?: string;  // í•˜ìœ„ í˜¸í™˜ì„±
  }>;  // select/multiselect/radioìš©
  defaultValue?: any;
  condition?: ConditionRule;  // ë‹¨ì¼ ì¡°ê±´ (í•˜ìœ„ í˜¸í™˜ì„±)
  conditions?: MultiConditionRule;  // ë³µìˆ˜ ì¡°ê±´ (AND/OR) - conditionë³´ë‹¤ ìš°ì„ 
  // âš ï¸ ì¤‘ìš”: conditionê³¼ conditionsëŠ” ë™ì‹œì— ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
  // conditionsê°€ ìˆìœ¼ë©´ conditionì€ ìë™ìœ¼ë¡œ ë¬´ì‹œë©ë‹ˆë‹¤.
  // SDUI v1.1: Custom Widget ì§€ì›
  customComponentType?: string;  // 'CreditCardInput', 'BankTransferInput' ë“±
  validation?: {
    // SDUI v1.1: messageKey ì§€ì›
    required?: boolean | string | { messageKey?: string; message?: string };
    min?: number;
    max?: number;
    minLength?: number;
    maxLength?: number;
    pattern?: {
      value: string;  // JSON serializable íŒ¨í„´ ë¬¸ìì—´ (ì˜ˆ: "^010[0-9]{8}$")
      messageKey?: string;  // SDUI v1.1: i18n í‚¤
      message?: string;  // í•˜ìœ„ í˜¸í™˜ì„±
    };
    // âš ï¸ ì¤‘ìš”: validation.pattern.valueëŠ” RegExp literalì´ ì•„ë‹ˆë¼ JSON serializable íŒ¨í„´ ë¬¸ìì—´ì´ì–´ì•¼ í•©ë‹ˆë‹¤.
    // Schema Registry ì €ì¥ ì‹œ JSONìœ¼ë¡œ ì§ë ¬í™”ë˜ë¯€ë¡œ ë¬¸ìì—´ í˜•íƒœë¡œ ì €ì¥ë©ë‹ˆë‹¤.
    // ì˜ˆì‹œ: { "pattern": { "value": "^010[0-9]{8}$", "message": "ì˜¬ë°”ë¥¸ ì „í™”ë²ˆí˜¸ê°€ ì•„ë‹™ë‹ˆë‹¤." } }
    validate?: (value: any) => boolean | string;
    // âš ï¸ ì¤‘ìš”: validate í•¨ìˆ˜ëŠ” Schema Registry(JSONB)ì— ì €ì¥ë  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ,
    // Registry ê¸°ë°˜ ìš´ì˜ ì‹œ validateëŠ” ì‚¬ìš©í•  ìˆ˜ ì—†ê³  pattern ë˜ëŠ” min/max ë“± ì •í˜• Validationë§Œ í—ˆìš©ë©ë‹ˆë‹¤.
    // validate í•¨ìˆ˜ëŠ” fallbackSchema(ë¡œì»¬ ìŠ¤í‚¤ë§ˆ) ì „ìš©ì…ë‹ˆë‹¤.
    //
    // ğŸ“Œ ëŸ°íƒ€ì„ ì²˜ë¦¬:
    // - Registryì—ì„œ ë¡œë“œëœ ìŠ¤í‚¤ë§ˆì—ì„œëŠ” validation.validateëŠ” í•­ìƒ undefinedì´ë©°,
    //   ëŸ°íƒ€ì„ì—ì„œ ì ˆëŒ€ ì‚¬ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤ (ì‚¬ìš©í•˜ë ¤ë©´ fallbackSchemaì—ë§Œ ì •ì˜).
    // - fallbackSchemaëŠ” ë¡œì»¬ TypeScript íŒŒì¼ì´ë¯€ë¡œ validate í•¨ìˆ˜ë¥¼ í¬í•¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    // - buildValidationRules() ë‚´ë¶€ì—ì„œ validate í•¨ìˆ˜ê°€ ì¡´ì¬í•˜ë©´ fallbackSchemaì—ì„œë§Œ ì‹¤í–‰ë¨ì„ ëª…ì‹œí•©ë‹ˆë‹¤.
    // - Registry ê¸°ë°˜ ìŠ¤í‚¤ë§ˆì—ì„œ validateê°€ ì¡´ì¬í•˜ë©´ console.warnìœ¼ë¡œ ê²½ê³ í•©ë‹ˆë‹¤.
  };
}
```

âš ï¸ ì¤‘ìš”: `condition`ê³¼ `conditions`ëŠ” ë™ì‹œì— ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. `conditions`ê°€ ìˆìœ¼ë©´ `condition`ì€ ë¬´ì‹œë©ë‹ˆë‹¤.

4. Schema Registry (DB + RLS)

âš ï¸ ì¤‘ìš”: ê¸°ìˆ ë¬¸ì„œ PART 1ì˜ 5. Schema Registry ìš´ì˜ ë¬¸ì„œë¥¼ ì¤€ìˆ˜í•©ë‹ˆë‹¤.

ì €ì¥ ìœ„ì¹˜: `meta.schema_registry` í…Œì´ë¸”

í…Œì´ë¸” êµ¬ì¡°:
```sql
CREATE SCHEMA IF NOT EXISTS meta;

CREATE TABLE meta.schema_registry (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  entity text NOT NULL,              -- 'student', 'invoice', 'schedule' ë“±
  industry_type text,                -- 'academy', 'salon' ë“± (nullable = ê³µí†µ)
  version text NOT NULL,             -- '2.0.1' (Semver)
  min_supported_client text,         -- '1.12.0' (í•˜ìœ„ í˜¸í™˜ì„±)
  min_client text,                   -- '1.12.0' (SDUI v1.1: minClientê°€ ìš°ì„ , min_supported_clientëŠ” í•˜ìœ„ í˜¸í™˜ì„±)
  schema_json jsonb NOT NULL,        -- ì‹¤ì œ ìŠ¤í‚¤ë§ˆ ì •ì˜
  migration_script text,             -- Migration Script (nullable)
  status text NOT NULL DEFAULT 'draft', -- 'draft', 'active', 'deprecated'
  registered_by uuid REFERENCES auth.users(id),
  registered_at timestamptz NOT NULL DEFAULT now(),
  activated_at timestamptz,          -- í™œì„±í™” ì‹œì 
  deprecated_at timestamptz,         -- íê¸° ì‹œì 
  UNIQUE(entity, industry_type, version)
);

CREATE INDEX idx_schema_registry_entity ON meta.schema_registry(entity, industry_type, status);
CREATE INDEX idx_schema_registry_version ON meta.schema_registry(entity, industry_type, version DESC);
```

RLS ì •ì±…:
âš ï¸ ì¤‘ìš”: `meta.schema_registry`ëŠ” ê³µí†µ ìŠ¤í‚¤ë§ˆ ì €ì¥ì†Œì´ë¯€ë¡œ `tenant_id` ì»¬ëŸ¼ì´ ì—†ìŠµë‹ˆë‹¤.

ğŸ”¥ Super Admin ì •ì˜ ëª…í™•í™”:
- `user_platform_roles.role = 'super_admin'`ì€ "SaaS í”Œë«í¼ ì „ì²´ ê´€ë¦¬ì"ì…ë‹ˆë‹¤.
- "í…Œë„ŒíŠ¸ ë‹¨ìœ„ ê´€ë¦¬ì(admin)"ì™€ëŠ” ë‹¤ë¦…ë‹ˆë‹¤.
- Super Adminì€ ëª¨ë“  í…Œë„ŒíŠ¸ì™€ ì—…ì¢…ì˜ ìŠ¤í‚¤ë§ˆë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ğŸ” RBAC êµ¬ì¡° ë¶„ë¦¬:
- Platform RBAC: user_platform_roles (super_admin ë“±)
- Tenant RBAC: user_tenant_roles (owner/admin/teacher ë“±)

ì˜ˆì‹œ (Platform ê´€ë¦¬ì ì „ìš© ì ‘ê·¼):
```sql
ALTER TABLE meta.schema_registry ENABLE ROW LEVEL SECURITY;

CREATE POLICY schema_registry_read ON meta.schema_registry
FOR SELECT TO authenticated
USING (
  -- âš ï¸ ì¤‘ìš”: Schema RegistryëŠ” í”Œë«í¼ ì „ì²´ ìŠ¤í‚¤ë§ˆ ì •ë³´ë¥¼ í¬í•¨í•˜ë¯€ë¡œ,
  -- super_admin ë˜ëŠ” developer ì—­í• ë§Œ ì¡°íšŒ ê°€ëŠ¥í•´ì•¼ í•©ë‹ˆë‹¤.
  -- ëª¨ë“  authenticated ì‚¬ìš©ìê°€ ì¡°íšŒ ê°€ëŠ¥í•˜ë©´ ë³´ì•ˆ ì‚¬ê³ ê°€ ë°œìƒí•©ë‹ˆë‹¤.
  EXISTS (
    SELECT 1 FROM user_platform_roles
    WHERE user_id = auth.uid()
      AND role IN ('super_admin', 'developer')
  )
);

-- âš ï¸ ì¤‘ìš”: UI/í´ë¼ì´ì–¸íŠ¸ëŠ” ì§ì ‘ meta.schema_registryë¥¼ ì¡°íšŒí•˜ì§€ ì•Šê³ ,
-- @api-sdk/coreì˜ ì„œë²„ì‚¬ì´ë“œ APIë¥¼ í†µí•´ì„œë§Œ ì ‘ê·¼í•©ë‹ˆë‹¤.
-- í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ìŠ¤í‚¤ë§ˆë¥¼ ì½ì„ ë•ŒëŠ” useSchema Hookì„ ì‚¬ìš©í•˜ë©°,
-- ì´ Hookì€ ë‚´ë¶€ì ìœ¼ë¡œ ì„œë²„ APIë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.

CREATE POLICY schema_registry_write ON meta.schema_registry
FOR INSERT, UPDATE, DELETE TO authenticated
USING (
  -- âš ï¸ ì¤‘ìš”: Super Adminì€ SaaS í”Œë«í¼ ì „ì²´ ê´€ë¦¬ì ì—­í• ì…ë‹ˆë‹¤.
  -- ê¸°ìˆ ë¬¸ì„œ PART 1ì˜ RBAC ìš©ì–´ì— ë”°ë¥´ë©´, super_adminì€ í…Œë„ŒíŠ¸ ë ˆë²¨ì´ ì•„ë‹Œ
  -- SaaS í”Œë«í¼ ì „ì²´ë¥¼ ê´€ë¦¬í•˜ëŠ” ë³¸ì‚¬ ê´€ë¦¬ì ì—­í• ì…ë‹ˆë‹¤.
  --
  -- ğŸ” RBAC êµ¬ì¡° ë¶„ë¦¬ (í•„ìˆ˜):
  -- - Platform RBAC (SaaS ì „ì²´ ê´€ë¦¬ì): user_platform_roles í…Œì´ë¸” í•„ìˆ˜
  -- - Tenant RBAC (í•™ì›/ë§¤ì¥ ë‹¨ìœ„ ê´€ë¦¬ì): user_tenant_roles í…Œì´ë¸”
  --
  -- âš ï¸ ì¤‘ìš”: RLS ì •ì±…ì€ ë°˜ë“œì‹œ user_platform_roles ê¸°ë°˜ìœ¼ë¡œ ê²€ì‚¬í•´ì•¼ í•˜ë©°,
  -- user_tenant_rolesëŠ” í…Œë„ŒíŠ¸ ìš´ì˜ ê¶Œí•œì´ë¯€ë¡œ Platform Schema Registryë¥¼ ê´€ë¦¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
  --
  -- tenant ë ˆë²¨ ê´€ë¦¬ì(admin)ëŠ” í•œ í…Œë„ŒíŠ¸ì˜ ìŠ¤í‚¤ë§ˆì¡°ì°¨ ìˆ˜ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
  -- platform ê´€ë¦¬ì(super_admin)ëŠ” ëª¨ë“  í…Œë„ŒíŠ¸/ì—…ì¢…ì˜ ìŠ¤í‚¤ë§ˆë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  --
  -- ê³¼ê±° ì„¤ê³„ì—ì„œëŠ” user_tenant_rolesë¥¼ ì‚¬ìš©í–ˆìœ¼ë‚˜,
  -- í˜„ì¬ëŠ” user_platform_rolesë¥¼ ê¸°ì¤€ìœ¼ë¡œ Platform-level RBACë¥¼ ë¶„ë¦¬í•˜ì—¬ ì‚¬ìš©í•©ë‹ˆë‹¤.
  -- USING: SELECT/DELETEì— ëŒ€í•œ ì¡°ê±´
  EXISTS (
    SELECT 1 FROM user_platform_roles
    WHERE user_id = auth.uid() AND role = 'super_admin'
  )
  -- ì°¸ê³ : user_platform_roles í…Œì´ë¸”ì´ ì•„ì§ ì—†ëŠ” ê²½ìš° ì„ì‹œë¡œ user_tenant_rolesë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë‚˜,
  -- í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œëŠ” ë°˜ë“œì‹œ user_platform_rolesë¡œ ì „í™˜í•´ì•¼ í•©ë‹ˆë‹¤.
)
WITH CHECK (
  -- âš ï¸ ì¤‘ìš”: INSERT/UPDATEì— ëŒ€í•œ ì¡°ê±´ (PostgreSQL RLS í•„ìˆ˜)
  -- WITH CHECK: ì‚½ì…/ìˆ˜ì •í•˜ë ¤ëŠ” rowê°€ í—ˆìš©ë˜ëŠ” rowì¸ì§€ ê²€ì‚¬
  -- Supabase ê³µì‹ ì˜ˆì‹œì—ì„œë„ INSERT/UPDATEì—ëŠ” WITH CHECKë¥¼ í•¨ê»˜ ì‚¬ìš©í•˜ë„ë¡ ê¶Œì¥
  EXISTS (
    SELECT 1 FROM user_platform_roles
    WHERE user_id = auth.uid() AND role = 'super_admin'
  )
);
```

5. Schema Registry Service (ì™„ì „ ì—°ë™)

âš ï¸ ì¤‘ìš”: ê¸°ìˆ ë¬¸ì„œ PART 1ì˜ 5. Schema Registry ìš´ì˜ ë¬¸ì„œë¥¼ ì¤€ìˆ˜í•©ë‹ˆë‹¤.

5.1 ìŠ¤í‚¤ë§ˆ ì¡°íšŒ ìš°ì„ ìˆœìœ„

1. í…Œë„ŒíŠ¸ë³„ Version Pinning (meta.tenant_schema_pins í…Œì´ë¸”)
   - íŠ¹ì • í…Œë„ŒíŠ¸ê°€ íŠ¹ì • ìŠ¤í‚¤ë§ˆ ë²„ì „ì„ ê³ ì •í•œ ê²½ìš°
2. Industryë³„ í™œì„± ìŠ¤í‚¤ë§ˆ (status = 'active' + industry_type ë§¤ì¹­)
   - í˜„ì¬ í…Œë„ŒíŠ¸ì˜ industry_typeê³¼ ì¼ì¹˜í•˜ëŠ” í™œì„± ìŠ¤í‚¤ë§ˆ
3. ê³µí†µ í™œì„± ìŠ¤í‚¤ë§ˆ (status = 'active' + industry_type IS NULL)
   - ëª¨ë“  ì—…ì¢…ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ ê³µí†µ ìŠ¤í‚¤ë§ˆ
4. Fallback ìŠ¤í‚¤ë§ˆ (ê¸°ë³¸ ë²„ì „)
   - ìœ„ ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ìŠ¤í‚¤ë§ˆê°€ ì—†ì„ ê²½ìš° ì‚¬ìš©í•˜ëŠ” ê¸°ë³¸ ë²„ì „

5.2 Schema Registry Service ì‚¬ìš©ë²•

ì„œë²„ ì‚¬ì´ë“œ (API Route, Edge Function):
```typescript
import { SchemaRegistryService } from '@core/schema-registry';
import { getApiContext } from '@api-sdk/core';

// ìŠ¤í‚¤ë§ˆ ì¡°íšŒ
const schemaRegistryService = new SchemaRegistryService();
const context = getApiContext();

const schema = await schemaRegistryService.getSchema('student', {
  tenantId: context.tenantId,
  industryType: context.industryType,
  clientVersion: '1.0.0',
  fallbackSchema: studentFormSchema,  // ë¡œì»¬ fallback
});
```

í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ (React Hook):
```typescript
// packages/hooks/use-schema/src/useSchema.ts
import { useQuery } from '@tanstack/react-query';
import { apiClient, getApiContext } from '@api-sdk/core';

export function useSchema(entity: string, fallbackSchema?: FormSchema) {
  const context = getApiContext();

  return useQuery({
    queryKey: ['schema', entity, context.tenantId, context.industryType],
    queryFn: async () => {
      const response = await apiClient.get<FormSchema>(
        `schema-registry/${entity}`,
        {
          params: {
            tenant_id: context.tenantId,
            industry_type: context.industryType,
            client_version: '1.0.0',
          },
        }
      );

      if (response.error || !response.data) {
        // âš ï¸ ì¤‘ìš”: fallbackSchemaëŠ” íŠ¸ëŸ¬ë¸”ìŠˆíŒ…ìš©ì…ë‹ˆë‹¤.
        // ìŠ¤í‚¤ë§ˆ ë¶€ì¬ ì‹œ ì•±ì´ ì£½ì§€ ì•Šë„ë¡ fallbackì„ ìœ ì§€í•´ì•¼ í•©ë‹ˆë‹¤.
        //
        // âš ï¸ í•„ìˆ˜ ê·œì¹™: fallbackSchemaëŠ” entity + industry ì¡°í•©ìœ¼ë¡œ ê°œë³„ ì œê³µë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
        // - academy/studentFormSchema
        // - salon/customerFormSchema
        // - realestate/contractFormSchema
        // ê°ê° ë³„ë„ë¡œ ì¡´ì¬í•´ì•¼ í•˜ë©°, ì—…ì¢…ë³„ë¡œ êµ¬ë¶„ëœ fallback ìŠ¤í‚¤ë§ˆë¥¼ ì œê³µí•´ì•¼ í•©ë‹ˆë‹¤.
        return fallbackSchema || null;
      }

      return response.data;
    },
    // âš ï¸ ì¤‘ìš”: staleTime ìš´ì˜ ëª¨ë“œë³„ ì„¤ì •
    // - ìš´ì˜ ëª¨ë“œ(Production): staleTime=5ë¶„ ìœ ì§€ (ì„±ëŠ¥ ìµœì í™”)
    // - ê°œë°œ/ë¦´ë¦¬ìŠ¤ í™˜ê²½: staleTime=0 ì‚¬ìš© ê°€ëŠ¥ (ìŠ¤í‚¤ë§ˆ ë³€ê²½ì´ ì¦ì€ ê²½ìš°)
    staleTime: 5 * 60 * 1000, // 5ë¶„ (ìš´ì˜ ëª¨ë“œ ê¸°ì¤€)
  });
}
```

5.3 ìŠ¤í‚¤ë§ˆ ë“±ë¡ (Super Admin ì „ìš©)

```typescript
import { SchemaRegistryService } from '@core/schema-registry';

const schemaRegistryService = new SchemaRegistryService();

// ìŠ¤í‚¤ë§ˆ ë“±ë¡ (draft ìƒíƒœ)
const entry = await schemaRegistryService.registerSchema({
  entity: 'student',
  industry_type: 'academy',
  version: '2.0.0',
  minClient: '1.0.0',  // SDUI v1.1: minClientê°€ ìš°ì„ 
  // minSupportedClient: '1.0.0',  // í•˜ìœ„ í˜¸í™˜ì„± (ì„ íƒ)
  schema_json: studentFormSchema,
  status: 'draft',
});

// ìŠ¤í‚¤ë§ˆ í™œì„±í™”
await schemaRegistryService.activateSchema({
  entity: 'student',
  industry_type: 'academy',
  version: '2.0.0',
});

// í…Œë„ŒíŠ¸ë³„ Version Pinning
await schemaRegistryService.pinSchemaVersion({
  tenant_id: 'xxx',
  entity: 'student',
  industry_type: 'academy',
  pinned_version: '1.9.0',
  reason: 'ë§ˆì´ê·¸ë ˆì´ì…˜ ì „ ì•ˆì •ì„± í™•ë³´',
});
```

í™œì„± ìŠ¤í‚¤ë§ˆ ê²°ì •:
- `status = 'active'`ì¸ ìŠ¤í‚¤ë§ˆë§Œ ì‚¬ìš©
- `minClient` (ë˜ëŠ” `min_supported_client`) ë²„ì „ ì²´í¬ í•„ìˆ˜
- `minClient`ê°€ ìˆìœ¼ë©´ ìš°ì„  ì‚¬ìš©, ì—†ìœ¼ë©´ `min_supported_client` ì‚¬ìš© (í•˜ìœ„ í˜¸í™˜ì„±)
- í´ë¼ì´ì–¸íŠ¸ ë²„ì „ì´ `minClient` (ë˜ëŠ” `min_supported_client`) ë¯¸ë§Œì´ë©´ ì—…ë°ì´íŠ¸ ìœ ë„

Version Pinning:
- íŠ¹ì • í…Œë„ŒíŠ¸ê°€ íŠ¹ì • ìŠ¤í‚¤ë§ˆ ë²„ì „ì„ ê³ ì •í•´ì•¼ í•˜ëŠ” ê²½ìš°
- `meta.tenant_schema_pins` í…Œì´ë¸”ì— ê¸°ë¡
- Pinì´ ìˆìœ¼ë©´ í•´ë‹¹ ë²„ì „ ìš°ì„  ì‚¬ìš©

6. Meta-Schema Validation

âš ï¸ ì¤‘ìš”: ê¸°ìˆ ë¬¸ì„œ PART 1ì˜ 5-7 "Schema Registry ë“±ë¡ ì‹œì  Validation" ë° UI ë¬¸ì„œ 3.1 "Meta-Schema Validation"ì„ ì¤€ìˆ˜í•©ë‹ˆë‹¤.

ê²€ì¦ ë‹¨ê³„:
1. ê°œë°œ(local dev)
2. CI ë¹Œë“œ ë‹¨ê³„
3. í…Œë„ŒíŠ¸ ë°°í¬ ì‹œ
4. Schema Registryì— ë“±ë¡ ì‹œì 

ê²€ì¦ í•­ëª©:
- Semver ì •ê·œì‹ ì ìš© (version í•„ë“œ)
- Field kindë³„ options ê°•ì œ ê²€ì‚¬
  - select/multiselect/radioëŠ” options í•„ìˆ˜
  - options.value ì¤‘ë³µ ê¸ˆì§€
  - options.label ëˆ„ë½ ê¸ˆì§€
  - optionsê°€ ì¡´ì¬í•˜ëŠ”ë° kindê°€ select/multiselect/radioê°€ ì•„ë‹ˆë©´ ì˜¤ë¥˜
- íƒ€ì… ê¸°ë°˜ defaultValue ì œí•œ
- ConditionRule ë° MultiConditionRule êµ¬ì¡°ì  ê²€ì¦
  - valueê°€ undefinedì¸ ConditionRuleì€ Meta-Schema ë‹¨ê³„ì—ì„œ ê±°ë¶€ (ë‹¨, exists/not_exists ì—°ì‚°ìëŠ” ì˜ˆì™¸)
  - âš ï¸ ë°©ì–´ì  ì½”ë“œ: Meta-Schemaì—ì„œ ë§‰ì§€ë§Œ, í˜¹ì‹œ ì˜ëª» ë“¤ì–´ì™€ë„ runtime(evaluateConditionRule)ì—ì„œëŠ” falseë¡œë§Œ ì²˜ë¦¬
    - ì˜ˆ: eq/== ì¼€ì´ìŠ¤ì—ì„œ `if (expected === undefined) return false;`ë¡œ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬
  - in/not_in ì—°ì‚°ì:
    - SDUI v1.1: valueëŠ” ìŠ¤ì¹¼ë¼ ë˜ëŠ” ë°°ì—´ ëª¨ë‘ í—ˆìš©
    - ë°°ì—´ì¸ ê²½ìš°: fieldValueì™€ expected ë°°ì—´ ê°„ êµì§‘í•©/ì°¨ì§‘í•© íŒë‹¨
      - fieldValueê°€ ë°°ì—´: expected ë°°ì—´ì— í•˜ë‚˜ë¼ë„ í¬í•¨ë˜ë©´ true (êµì§‘í•©)
      - fieldValueê°€ ìŠ¤ì¹¼ë¼: expected ë°°ì—´ì— í¬í•¨ë˜ë©´ true
    - ìŠ¤ì¹¼ë¼ì¸ ê²½ìš°: ê¸°ì¡´ ë™ì‘ ìœ ì§€
      - fieldValueê°€ ë°°ì—´: ë°°ì—´ì— expectedê°€ í¬í•¨ë˜ë©´ true
      - fieldValueê°€ ìŠ¤ì¹¼ë¼: ë‹¨ìˆœ ë¹„êµ
    - (í–¥í›„ intersects/not_intersects ì—°ì‚°ìë¡œ ë” ëª…í™•í•˜ê²Œ ë¶„ë¦¬ ê°€ëŠ¥í•˜ë‚˜, í˜„ì¬ëŠ” ë°°ì—´ í—ˆìš©)
  - MultiConditionRule ë‚´ë¶€ì˜ conditionsì— í¬í•¨ëœ ConditionRuleë“¤ì€
    - field / op / valueë§Œ ì‚¬ìš©í•˜ë©°
    - action í•„ë“œëŠ” ë¬´ì‹œë©ë‹ˆë‹¤. (ì‹¤ì œ ì•¡ì…˜ì€ MultiConditionRule.action ê¸°ì¤€)
- **Tailwind í´ë˜ìŠ¤ ë¬¸ìì—´ ì‚¬ìš© ê¸ˆì§€ ê²€ì¦** (ì¤‘ìš”)
  - ìŠ¤í‚¤ë§ˆì—ì„œ Tailwind í´ë˜ìŠ¤ë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ë©´ ì•ˆ ë©ë‹ˆë‹¤.
  - ë ˆì´ì•„ì›ƒì€ props ê¸°ë°˜ìœ¼ë¡œ ì „ë‹¬: `{ columns: 2, columnGap: "md" }`
  - Schema Engineì´ ë‚´ë¶€ì ìœ¼ë¡œ `@ui-core/react` ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ë Œë”ë§í•©ë‹ˆë‹¤.
- **ConditionRule ìƒí˜¸ ì¶©ëŒ ê²€ì¦**
  - ë‹¨ì¼ ì¡°ê±´(condition) + ë³µìˆ˜ ì¡°ê±´(conditions) ë™ì‹œ ì¡´ì¬ â†’ ì˜¤ë¥˜
- **ì„ í–‰ í•„ë“œ ì¡´ì¬ì„± ê²€ì¦** (í•„ìˆ˜)
  - condition/conditionsì—ì„œ ì°¸ì¡°í•˜ëŠ” í•„ë“œê°€ ìŠ¤í‚¤ë§ˆì— ë°˜ë“œì‹œ ì¡´ì¬í•´ì•¼ í•¨
  - ì—†ìœ¼ë©´ runtime error ë°œìƒ ë°©ì§€ë¥¼ ìœ„í•´ ì‚¬ì „ ê²€ì¦
  - validateSchema() í•¨ìˆ˜ì—ì„œ ë°˜ë“œì‹œ ê²€ì¦í•˜ë©°, ì°¸ì¡° í•„ë“œê°€ ì—†ìœ¼ë©´ SchemaValidationError ë°œìƒ
  - âš ï¸ ì¤‘ìš”: í•„ë“œ ì°¸ì¡°ëŠ” ì„ ì–¸ ìˆœì„œì™€ ë¬´ê´€í•˜ë©°, ì´ë¦„ ê¸°ë°˜ìœ¼ë¡œ resolution í•©ë‹ˆë‹¤.
    - UI ìŠ¤í‚¤ë§ˆëŠ” ìˆœì„œ ê¸°ë°˜ì´ ì•„ë‹ˆë¼ key ê¸°ë°˜ì´ë¯€ë¡œ ì•„ë˜ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤:
    - `[{ "name": "b", ... }, { "name": "a", "condition": { "field": "b", ... } }]`
  - âš ï¸ ì¤‘ìš”: ì˜ëª»ëœ í•„ë“œ ì°¸ì¡° ì‹œ "ì¡°ìš©íˆ ì‹¤íŒ¨"í•˜ì§€ ì•Šê³  ëª…í™•í•œ ì˜¤ë¥˜ ë©”ì‹œì§€ ì œê³µ
- **setValue self-referential ê¸ˆì§€** (SDUI v1.1)
  - setValue ëŒ€ìƒ í•„ë“œê°€ conditionsì—ì„œ ì°¸ì¡°í•˜ëŠ” í•„ë“œì™€ ë™ì¼í•˜ë©´ ê²½ê³  ë˜ëŠ” ê±°ë¶€
  - ì˜ˆ: `{ "name": "field_a", "condition": { "field": "field_a", ... }, "then": { "setValue": "..." } }` â†’ ê¸ˆì§€
  - setValueëŠ” ë‹¤ë¥¸ í•„ë“œ ê°’ì„ ë°”ê¾¸ëŠ” ìš©ë„ë¡œë§Œ ì‚¬ìš© (self-loop ë°©ì§€ ê·œì¹™)
- **MultiConditionRule ë¹ˆ ë°°ì—´ ê¸ˆì§€**
  - conditions ë°°ì—´ì€ ìµœì†Œ 1ê°œ ì´ìƒì˜ ì¡°ê±´ì´ í•„ìš”

ì˜¤ë¥˜ ì²˜ë¦¬:
- ì˜¤ë¥˜ê°€ ë°œê²¬ë˜ë©´ UIëŠ” ëœ¨ê¸° ì „ì— Error Boundaryë¡œ ì•ˆì „ ì¤‘ë‹¨í•©ë‹ˆë‹¤.

â­ 7. Condition Rule â€” ì™„ì „ êµ¬í˜„ ê·œê²©

7.1 Condition Rule ì‘ë™ íë¦„

(FormSchema)
    â†’ SchemaField ë Œë”ë§ ì‹œì‘
        â†’ useWatch()ë¡œ ì¡°ê±´ í•„ë“œ ê°’ ê´€ì°° (ë³µìˆ˜ í•„ë“œ ë™ì‹œ ê°ì‹œ)
        â†’ evaluateConditionRule() ë˜ëŠ” evaluateMultiConditionRule()ë¡œ í‰ê°€
        â†’ getConditionalActions()ë¡œ ì•¡ì…˜ ì§‘ê³„
            - hidden?
            - disabled?
            - required?
            - actions? (setValue, setOptions, switchComponent)
        â†’ ë™ì  ì•¡ì…˜ ì²˜ë¦¬ (setValue, setOptions, switchComponent)
        â†’ UI ë Œë”ë§ or skip

7.2 Condition Rule í‰ê°€ í•¨ìˆ˜

ğŸ“Œ evaluateConditionRule() (ë‹¨ì¼ ë£° í‰ê°€)

// packages/schema-engine/core/src/conditionEvaluator.ts
import type { ConditionRule } from './types';

export function evaluateConditionRule(
  rule: ConditionRule,
  fieldValue: any
): boolean {
  const { op, value } = rule;

  // exists / not_exists ì—°ì‚°ì ì²˜ë¦¬
  if (op === 'exists' || op === 'not_exists') {
    const exists = Array.isArray(fieldValue)
      ? fieldValue.length > 0
      : fieldValue !== null && fieldValue !== undefined && fieldValue !== '';
    return op === 'exists' ? exists : !exists;
  }

  const expected = value;

  switch (op) {
    case '==':
    case 'eq':  // í•˜ìœ„ í˜¸í™˜ì„±
      // undefined ì•ˆì „ ì²˜ë¦¬: valueê°€ undefinedì¸ ê²½ìš° false ë°˜í™˜
      if (expected === undefined) return false;
      return fieldValue === expected;
    case '!=':
    case 'ne':  // í•˜ìœ„ í˜¸í™˜ì„±
      return fieldValue !== expected;
    case 'in':
      // SDUI v1.1: valueëŠ” ìŠ¤ì¹¼ë¼ ë˜ëŠ” ë°°ì—´ ëª¨ë‘ í—ˆìš©
      // ë°°ì—´ì¸ ê²½ìš°: fieldValueì™€ expected ë°°ì—´ ê°„ êµì§‘í•© íŒë‹¨
      if (Array.isArray(expected)) {
        // expectedê°€ ë°°ì—´ì¸ ê²½ìš°
      if (Array.isArray(fieldValue)) {
          // fieldValueë„ ë°°ì—´: êµì§‘í•© í™•ì¸ (í•˜ë‚˜ë¼ë„ í¬í•¨ë˜ë©´ true)
          return expected.some(val => fieldValue.includes(val));
        }
        // fieldValueê°€ ìŠ¤ì¹¼ë¼: expected ë°°ì—´ì— í¬í•¨ë˜ëŠ”ì§€ í™•ì¸
        return expected.includes(fieldValue);
      }
      // expectedê°€ ìŠ¤ì¹¼ë¼ì¸ ê²½ìš°
      if (Array.isArray(fieldValue)) {
        // fieldValueê°€ ë°°ì—´: ë°°ì—´ì— expectedê°€ í¬í•¨ë˜ëŠ”ì§€ í™•ì¸
        return fieldValue.includes(expected);
      }
      // ë‘˜ ë‹¤ ìŠ¤ì¹¼ë¼: ë‹¨ìˆœ ë¹„êµ
      return fieldValue === expected;
    case 'not_in':
      // SDUI v1.1: valueëŠ” ìŠ¤ì¹¼ë¼ ë˜ëŠ” ë°°ì—´ ëª¨ë‘ í—ˆìš©
      // ë°°ì—´ì¸ ê²½ìš°: fieldValueì™€ expected ë°°ì—´ ê°„ ì°¨ì§‘í•© íŒë‹¨
      if (Array.isArray(expected)) {
        // expectedê°€ ë°°ì—´ì¸ ê²½ìš°
      if (Array.isArray(fieldValue)) {
          // fieldValueë„ ë°°ì—´: êµì§‘í•©ì´ ì—†ìœ¼ë©´ true
          return !expected.some(val => fieldValue.includes(val));
        }
        // fieldValueê°€ ìŠ¤ì¹¼ë¼: expected ë°°ì—´ì— í¬í•¨ë˜ì§€ ì•Šìœ¼ë©´ true
        return !expected.includes(fieldValue);
      }
      // expectedê°€ ìŠ¤ì¹¼ë¼ì¸ ê²½ìš°
      if (Array.isArray(fieldValue)) {
        // fieldValueê°€ ë°°ì—´: ë°°ì—´ì— expectedê°€ í¬í•¨ë˜ì§€ ì•Šìœ¼ë©´ true
        return !fieldValue.includes(expected);
      }
      // ë‘˜ ë‹¤ ìŠ¤ì¹¼ë¼: ë‹¨ìˆœ ë¹„êµ
      return fieldValue !== expected;
    case '>':
    case 'gt':  // í•˜ìœ„ í˜¸í™˜ì„±
      return typeof fieldValue === 'number' && typeof expected === 'number' && fieldValue > expected;
    case '>=':
    case 'gte':  // í•˜ìœ„ í˜¸í™˜ì„±
      return typeof fieldValue === 'number' && typeof expected === 'number' && fieldValue >= expected;
    case '<':
    case 'lt':  // í•˜ìœ„ í˜¸í™˜ì„±
      return typeof fieldValue === 'number' && typeof expected === 'number' && fieldValue < expected;
    case '<=':
    case 'lte':  // í•˜ìœ„ í˜¸í™˜ì„±
      return typeof fieldValue === 'number' && typeof expected === 'number' && fieldValue <= expected;
    default:
      return false;
  }
}

ğŸ“Œ evaluateMultiConditionRule() (ë³µìˆ˜ ë£° í‰ê°€)

export function evaluateMultiConditionRule(
  multiRule: MultiConditionRule,
  watchedValues: Record<string, any>
): boolean {
  const { conditions, logic } = multiRule;

  if (conditions.length === 0) return false;

  const results = conditions.map((rule) => {
    const refValue = watchedValues[rule.field];
    return evaluateConditionRule(rule, refValue);
  });

  if (logic === 'and') {
    return results.every((result) => result === true);
  } else {
    // logic === 'or'
    return results.some((result) => result === true);
  }
}

7.3 Rule ì§‘ê³„ í•¨ìˆ˜

ğŸ“Œ getConditionalActions()

export function getConditionalActions(
  field: FormFieldSchema,
  watchedValues: Record<string, any>
): {
  isHidden: boolean;
  isDisabled: boolean;
  isRequired: boolean;
  actions?: {
    setValue?: any;
    setOptions?: {
      type: 'static' | 'api';
      options?: Array<{ value: string; labelKey?: string; label?: string }>;
      endpoint?: string;
    };
    switchComponent?: {
      to: string;
    };
  };
} {
  let isHidden = false;
  let isDisabled = false;
  let isRequired = false;
  let dynamicActions: {
    setValue?: any;
    setOptions?: { type: 'static' | 'api'; options?: any[]; endpoint?: string };
    switchComponent?: { to: string };
  } | undefined;

  // ë³µìˆ˜ ì¡°ê±´ ìš°ì„  ì²˜ë¦¬ (conditionsê°€ ìˆìœ¼ë©´ conditionë³´ë‹¤ ìš°ì„ )
  if (field.conditions) {
    const conditionMet = evaluateMultiConditionRule(field.conditions, watchedValues);

    // SDUI v1.1: then/else êµ¬ì¡° ì§€ì› (actionë³´ë‹¤ ìš°ì„ )
    if (field.conditions.then || field.conditions.else) {
      const actionsToApply = conditionMet ? field.conditions.then : field.conditions.else;
      if (actionsToApply) {
        if (actionsToApply.hide !== undefined) isHidden = actionsToApply.hide;
        if (actionsToApply.disable !== undefined) isDisabled = actionsToApply.disable;
        if (actionsToApply.require !== undefined) isRequired = actionsToApply.require;
        if (actionsToApply.setValue !== undefined) dynamicActions = { ...dynamicActions, setValue: actionsToApply.setValue };
        if (actionsToApply.setOptions) dynamicActions = { ...dynamicActions, setOptions: actionsToApply.setOptions };
        if (actionsToApply.switchComponent) dynamicActions = { ...dynamicActions, switchComponent: actionsToApply.switchComponent };
      }
    } else {
      // ê¸°ì¡´ action ë°©ì‹ (í•˜ìœ„ í˜¸í™˜ì„±)
      const { action } = field.conditions;
      if (action === 'hide' && conditionMet) isHidden = true;
      else if (action === 'show' && !conditionMet) isHidden = true;
      if (action === 'disable' && conditionMet) isDisabled = true;
      else if (action === 'enable' && !conditionMet) isDisabled = true;
      if (action === 'require' && conditionMet) isRequired = true;
    }

    return { isHidden, isDisabled, isRequired, actions: dynamicActions };
  }

  // ë‹¨ì¼ ì¡°ê±´ ì²˜ë¦¬
  const rule = field.condition;
  if (!rule) return { isHidden, isDisabled, isRequired, actions: dynamicActions };

  const refValue = watchedValues[rule.field];
  const conditionMet = evaluateConditionRule(rule, refValue);

  // SDUI v1.1: then/else êµ¬ì¡° ì§€ì› (actionë³´ë‹¤ ìš°ì„ )
  if (rule.then || rule.else) {
    const actionsToApply = conditionMet ? rule.then : rule.else;
    if (actionsToApply) {
      if (actionsToApply.hide !== undefined) isHidden = actionsToApply.hide;
      if (actionsToApply.disable !== undefined) isDisabled = actionsToApply.disable;
      if (actionsToApply.require !== undefined) isRequired = actionsToApply.require;
      if (actionsToApply.setValue !== undefined) dynamicActions = { ...dynamicActions, setValue: actionsToApply.setValue };
      if (actionsToApply.setOptions) dynamicActions = { ...dynamicActions, setOptions: actionsToApply.setOptions };
      if (actionsToApply.switchComponent) dynamicActions = { ...dynamicActions, switchComponent: actionsToApply.switchComponent };
    }
  } else {
    // ê¸°ì¡´ action ë°©ì‹ (í•˜ìœ„ í˜¸í™˜ì„±)
    if (rule.action === 'hide' && conditionMet) isHidden = true;
    else if (rule.action === 'show' && !conditionMet) isHidden = true;
    if (rule.action === 'disable' && conditionMet) isDisabled = true;
    else if (rule.action === 'enable' && !conditionMet) isDisabled = true;
    if (rule.action === 'require' && conditionMet) isRequired = true;
  }

  return { isHidden, isDisabled, isRequired, actions: dynamicActions };
}

â­ 8. Renderer í†µí•© (SchemaField) â€” ì™„ì „ êµ¬í˜„ë³¸

í•µì‹¬:

useWatch()ë¡œ ì¡°ê±´ë¶€ ì°¸ì¡° í•„ë“œ ê°ì‹œ (ë³µìˆ˜ í•„ë“œ ë™ì‹œ ê°ì‹œ)

ì¡°ê±´ ì¶©ì¡± ì‹œ ë Œë” skip

finalRules.required = true ì ìš©

ëª¨ë“  UIì— disabled={isDisabled} ì ìš©

Controller ì‚¬ìš© í•„ë“œëŠ” rules={finalRules}ë¡œ ì „ë‹¬

âš ï¸ ì„±ëŠ¥ ìµœì í™”: SchemaFieldëŠ” React.memoë¡œ ê°ì‹¸ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.
- useWatchëŠ” ê°ì‹œ í•„ë“œê°€ ë³€í•˜ë©´ í•´ë‹¹ SchemaField ì»´í¬ë„ŒíŠ¸ê°€ ë¦¬ë Œë”ë©ë‹ˆë‹¤.
- í•„ë“œê°€ 100ê°œ ì´ìƒì´ë©´ ì„±ëŠ¥ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- Schema Engine ë ˆë²¨ì—ì„œ memoization ì œê³µ ê°€ëŠ¥í•©ë‹ˆë‹¤.

// packages/schema-engine/src/react/SchemaField.tsx

import * as React from 'react';
import {
  useWatch,
  Controller,
  UseFormRegister,
  UseFormSetValue,
  Control,
  FieldErrors,
} from 'react-hook-form';
import { getConditionalActions } from '../core/conditionEvaluator';
import { buildValidationRules } from '../core/validation';
import type { FormFieldSchema } from '../types';
import { Input, Select, Checkbox, DatePicker, Textarea, RadioGroup, Card, Grid } from '@ui-core/react';
import { loadWidget } from '../widgets/registry';
// âš ï¸ ì¤‘ìš”: Schema Engineì€ `@ui-core/react`ë¥¼ importí•˜ì—¬ ì‚¬ìš©í•©ë‹ˆë‹¤.
// ì»´í¬ë„ŒíŠ¸ ë§¤í•‘ì€ field.kindì— ë”°ë¼ ìë™ìœ¼ë¡œ ìˆ˜í–‰ë©ë‹ˆë‹¤.

export interface SchemaFieldProps {
  field: FormFieldSchema;
  register: UseFormRegister<any>;
  errors: FieldErrors<any>;
  control: Control<any>;
  // SDUI v1.1: i18n ë²ˆì—­ (ì„ íƒì , Loader ë‹¨ê³„ì—ì„œ ë°”ì¸ë”©ë˜ì§€ ì•Šì€ ê²½ìš° ì‚¬ìš©)
  translations?: Record<string, string>;
  // SDUI v1.1: ë™ì  í•„ë“œ ê°’ ì„¤ì • (setValue ì•¡ì…˜ìš©)
  // âš ï¸ ì¤‘ìš”: react-hook-formì˜ UseFormSetValue íƒ€ì… ì‚¬ìš©
  setValue?: UseFormSetValue<any>;
}

// âš ï¸ ì„±ëŠ¥ ìµœì í™”: SchemaFieldComponentëŠ” ë‚´ë¶€ ì»´í¬ë„ŒíŠ¸ í•¨ìˆ˜ì…ë‹ˆë‹¤.
function SchemaFieldComponent({
  field,
  register,
  errors,
  control,
  translations = {},
  setValue: setFormValue,
}: SchemaFieldProps) {
  const { name, kind, ui, options } = field;

  // SDUI v1.1: i18n í‚¤ ì²˜ë¦¬ (Loader ë‹¨ê³„ì—ì„œ ë°”ì¸ë”©ë˜ì§€ ì•Šì€ ê²½ìš°)
  // labelKeyê°€ ìˆìœ¼ë©´ translationsì—ì„œ ì¡°íšŒ, ì—†ìœ¼ë©´ ê¸°ì¡´ label ì‚¬ìš©
  const label = ui?.labelKey ? (translations[ui.labelKey] || ui.labelKey) : ui?.label;
  const placeholder = ui?.placeholderKey ? (translations[ui.placeholderKey] || ui.placeholderKey) : ui?.placeholder;
  const description = ui?.descriptionKey ? (translations[ui.descriptionKey] || ui.descriptionKey) : ui?.description;
  const tooltip = ui?.tooltipKey ? (translations[ui.tooltipKey] || ui.tooltipKey) : ui?.tooltip;
  // âš ï¸ ì°¸ê³ : description/tooltipì€ ui-core ì»´í¬ë„ŒíŠ¸ì˜ í‘œì¤€ propìœ¼ë¡œ ì§€ì›ë©ë‹ˆë‹¤.

  // 1) ì¡°ê±´ë¶€ í•„ë“œ ê°ì‹œ
  // ë‹¨ì¼ ì¡°ê±´ ë˜ëŠ” ë³µìˆ˜ ì¡°ê±´ì—ì„œ ì°¸ì¡°í•˜ëŠ” ëª¨ë“  í•„ë“œë¥¼ ê°ì‹œ
  const fieldsToWatch = React.useMemo(() => {
    const fields = new Set<string>();
    if (field.condition) {
      fields.add(field.condition.field);
    }
    if (field.conditions) {
      field.conditions.conditions.forEach((rule) => {
        fields.add(rule.field);
      });
    }
    return Array.from(fields);
  }, [field.condition, field.conditions]);

  // ëª¨ë“  ì°¸ì¡° í•„ë“œ ê°’ ê´€ì°°
  // âš ï¸ ìµœì í™”: ì¡°ê±´ì´ ì—†ëŠ” í•„ë“œëŠ” useWatchë¥¼ í˜¸ì¶œí•˜ì§€ ì•ŠìŒ
  // fieldsToWatch.length === 0ì´ë©´ name: undefined â†’ RHFëŠ” í¼ ì „ì²´ë¥¼ êµ¬ë…í•˜ì—¬ ë¶ˆí•„ìš”í•œ ë¦¬ë Œë”ë§ ë°œìƒ
  const hasConditions = fieldsToWatch.length > 0;

  const watched = useWatch({
    control,
    name: hasConditions ? fieldsToWatch : [],  // ì¡°ê±´ì´ ì—†ìœ¼ë©´ ë¹ˆ ë°°ì—´ë¡œ ì „ë‹¬ (í¼ ì „ì²´ êµ¬ë… ë°©ì§€)
  });

  const watchedValues = React.useMemo(() => {
    if (!hasConditions) return {} as Record<string, any>;
    // watchedê°€ ë°°ì—´ì¸ ê²½ìš° í•„ë“œëª…ê³¼ ë§¤í•‘
    if (Array.isArray(watched)) {
      return fieldsToWatch.reduce((acc, key, idx) => {
        acc[key] = watched[idx];
        return acc;
      }, {} as Record<string, any>);
    }
    // watchedê°€ ê°ì²´ì¸ ê²½ìš° (ë‹¨ì¼ í•„ë“œ)
    return watched as Record<string, any>;
  }, [watched, hasConditions, fieldsToWatch]);

  // 2) ì¡°ê±´ í‰ê°€
  // SDUI v1.1: then/else êµ¬ì¡° ì§€ì›, ë™ì  ì•¡ì…˜(setValue, setOptions, switchComponent) ë°˜í™˜
  const { isHidden, isDisabled, isRequired, actions: conditionalActions } = getConditionalActions(field, watchedValues);

  // SDUI v1.1: ë™ì  ì»´í¬ë„ŒíŠ¸ ì „í™˜ ì²˜ë¦¬
  const effectiveComponentType = conditionalActions?.switchComponent?.to || field.customComponentType;

  // SDUI v1.1: ë™ì  í•„ë“œ ê°’ ì„¤ì • (setValue ì•¡ì…˜)
  // âš ï¸ ì¤‘ìš”: ë¬´í•œë£¨í”„ ë°©ì§€
  // - setValueëŠ” ë‹¤ë¥¸ í•„ë“œ ê°’ì„ ë°”ê¾¸ëŠ” ìš©ë„ë¡œë§Œ ì‚¬ìš© (self-referential setValue ê¸ˆì§€)
  // - Meta-Schema Validationì—ì„œ setValue ëŒ€ìƒ í•„ë“œê°€ conditionsì—ì„œ ì°¸ì¡°í•˜ëŠ” í•„ë“œì™€ ë™ì¼í•˜ë©´ ê²½ê³ 
  // - react-hook-formì˜ setValueëŠ” ë‚´ë¶€ì ìœ¼ë¡œ ì¤‘ë³µ ì—…ë°ì´íŠ¸ë¥¼ ë°©ì§€í•˜ì§€ë§Œ,
  //   self-referential ì¡°ê±´("ë‚´ ê°’ì´ Xë©´ ë‚´ ê°’ì„ Yë¡œ ë°”ê¿”ë¼")ì€ ìŠ¤í‚¤ë§ˆ ë ˆë²¨ì—ì„œ ê¸ˆì§€
  React.useEffect(() => {
    if (!setFormValue || conditionalActions?.setValue === undefined) return;

    // react-hook-formì˜ setValueëŠ” í˜„ì¬ ê°’ê³¼ ë¹„êµí•˜ì—¬ ë¶ˆí•„ìš”í•œ ì—…ë°ì´íŠ¸ ë°©ì§€
    setFormValue(name, conditionalActions.setValue, {
      shouldValidate: false,  // ì¡°ê±´ë¶€ setValueëŠ” validation íŠ¸ë¦¬ê±°í•˜ì§€ ì•ŠìŒ
      shouldDirty: false,      // ì‚¬ìš©ì ì…ë ¥ì´ ì•„ë‹ˆë¯€ë¡œ dirty ìƒíƒœ ë³€ê²½í•˜ì§€ ì•ŠìŒ
    });
  }, [conditionalActions?.setValue, name, setFormValue]);

  // SDUI v1.1: ë™ì  ì˜µì…˜ ì„¤ì • (setOptions ì•¡ì…˜)
  // âš ï¸ ì¤‘ìš”: options ìš°ì„ ìˆœìœ„
  // 1. conditionalActions.setOptions (ë™ì  ì˜µì…˜, ìµœìš°ì„ )
  // 2. field.options (ìŠ¤í‚¤ë§ˆì— ì •ì˜ëœ ì •ì  ì˜µì…˜)
  // âš ï¸ ì°¸ê³ : setOptionsëŠ” select/multiselect/radioì—ë§Œ ì ìš©ë˜ë©°, kind: 'custom' ìœ„ì ¯ì—ëŠ” ì ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
  const [dynamicOptions, setDynamicOptions] = React.useState<Array<{ value: string; labelKey?: string; label?: string }> | undefined>(options);

  React.useEffect(() => {
    if (conditionalActions?.setOptions) {
      const { type, options: staticOptions, endpoint } = conditionalActions.setOptions;

      if (type === 'static' && staticOptions) {
        setDynamicOptions(staticOptions);
      } else if (type === 'api' && endpoint) {
        // API í˜¸ì¶œë¡œ ì˜µì…˜ ë¡œë“œ
        (async () => {
          try {
            // âš ï¸ ì¤‘ìš”: Zero-Trust ì›ì¹™ - @api-sdk/coreì˜ apiClientë§Œ ì‚¬ìš©
            // setOptionsì˜ API í˜¸ì¶œì€ ê°œë°œ/ë””ë²„ê¹…ìš© ì˜ˆì™¸ë¡œ, í”„ë¡œë•ì…˜ì—ì„œëŠ” apiClient í•„ìˆ˜
            // apiClientê°€ ì—†ìœ¼ë©´ ì˜µì…˜ ë¡œë“œ ì‹¤íŒ¨ (fetch fallback ì œê±°)
            // âš ï¸ ì¤‘ìš”: apiClient.get()ì˜ ë°˜í™˜ í˜•íƒœëŠ” { data, error } ë˜ëŠ” ì§ì ‘ ë°ì´í„°ì¼ ìˆ˜ ìˆìŒ
            // ì‹¤ì œ êµ¬í˜„ì— ë§ê²Œ ì²˜ë¦¬ í•„ìš”
            const { apiClient } = await import('@api-sdk/core');
            const res = await apiClient.get(endpoint);
            // apiClient.get() ë°˜í™˜ í˜•íƒœ ì²˜ë¦¬: { data, error } ë˜ëŠ” ì§ì ‘ ë°ì´í„°
            const data = (res as any).data ?? res;

            // API ì‘ë‹µì„ options í˜•ì‹ìœ¼ë¡œ ë³€í™˜
            if (Array.isArray(data)) {
              setDynamicOptions(data.map((item: any) => ({
                value: item.value ?? item.id ?? String(item),
                label: item.label ?? item.name ?? String(item),
                labelKey: item.labelKey,
              })));
            }
          } catch (error) {
            // âš ï¸ ì¤‘ìš”: apiClientê°€ ì—†ìœ¼ë©´ ì˜µì…˜ ë¡œë“œ ì‹¤íŒ¨ (Zero-Trust ì›ì¹™)
            console.error(`[Schema Engine] Failed to load options from API: ${endpoint}. apiClient not available.`, error);
            // ì˜µì…˜ì€ ê¸°ì¡´ field.options ìœ ì§€
          }
        })();
      }
    } else {
      setDynamicOptions(options);
    }
  }, [conditionalActions?.setOptions, options]);

  // ë™ì  ì˜µì…˜ì´ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ ê¸°ë³¸ options ì‚¬ìš©
  const effectiveOptions = dynamicOptions || options;

  if (isHidden) return null;

  // 3) Validation rule ë™ì  ì ìš©
  // âš ï¸ ì¤‘ìš”: ë™ì  requiredëŠ” ì •ì  requiredë³´ë‹¤ ìš°ì„ í•©ë‹ˆë‹¤.
  // BaseRulesì— ì´ë¯¸ required ì˜µì…˜ì´ ìˆì–´ë„, Condition Ruleì— ì˜í•œ ë™ì  requiredê°€ ë®ì–´ì”ë‹ˆë‹¤.
  const baseRules = buildValidationRules(field);
  const finalRules = isRequired
    ? { ...baseRules, required: 'í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.' }
    : baseRules;

  const error = errors[name]?.message as string | undefined;

  // âš ï¸ ì¤‘ìš”: Tailwind í´ë˜ìŠ¤ ë¬¸ìì—´ì„ ì§ì ‘ ì‚¬ìš©í•˜ì§€ ì•Šê³ , props ê¸°ë°˜ìœ¼ë¡œ ui-core ì»´í¬ë„ŒíŠ¸ì— ì „ë‹¬
  // ìŠ¤í‚¤ë§ˆëŠ” ë…¼ë¦¬ì  êµ¬ì¡°ë§Œ ì •ì˜í•˜ê³ , ì»´í¬ë„ŒíŠ¸ ì„ íƒê³¼ ìŠ¤íƒ€ì¼ì€ Schema Engineì´ ë‹´ë‹¹í•©ë‹ˆë‹¤.
  // ê¸°ìˆ ë¬¸ì„œ UI ë¬¸ì„œ 2.3 "schema-engine â†” ui-core í†µì‹  ë°©ì‹" ì°¸ì¡°
  // RendererëŠ” layoutì˜ êµ¬ì¡°ì  ì „ë‹¬ë§Œ ìˆ˜í–‰í•˜ê³  ìŠ¤íƒ€ì¼ì„ ì§ì ‘ ë‹¤ë£¨ì§€ ì•Šì•„ì•¼ í•©ë‹ˆë‹¤.
  // âš ï¸ ë³´ì™„: RendererëŠ” ìŠ¤íƒ€ì¼ ë¡œì§ì„ ê°€ì ¸ì„œëŠ” ì•ˆ ë©ë‹ˆë‹¤.
  // â†’ ui-coreì˜ Grid/Card ë“±ì„ ì‚¬ìš©í•˜ì—¬ ë ˆì´ì•„ì›ƒ êµ¬ì„±
  const colSpan = ui?.colSpan ?? 12;

  // ğŸ€ 4) ê° í•„ë“œ ë Œë”ë§ì— isDisabled ì ìš©

  // text/email/phone/password â†’ register
  if (['text', 'email', 'phone', 'password'].includes(kind)) {
    // âš ï¸ ì¤‘ìš”: password íƒ€ì…ë„ ì˜¬ë°”ë¥´ê²Œ ì²˜ë¦¬
    const inputType =
      kind === 'email'
        ? 'email'
        : kind === 'phone'
        ? 'tel'
        : kind === 'password'
        ? 'password'
        : 'text';

    return (
      <FormFieldLayout colSpan={colSpan}>
        <Input
          type={inputType}
          label={label}
          placeholder={placeholder}
          error={error}
          disabled={isDisabled}
          {...register(name, finalRules)}
        />
      </FormFieldLayout>
    );
  }

  // number
  if (kind === 'number') {
    return (
      <FormFieldLayout colSpan={colSpan}>
        <Input
          type="number"
          label={label}
          placeholder={placeholder}
          error={error}
          disabled={isDisabled}
          {...register(name, finalRules)}
        />
      </FormFieldLayout>
    );
  }

  // textarea
  if (kind === 'textarea') {
    return (
      <FormFieldLayout colSpan={colSpan}>
        <Textarea
          label={label}
          placeholder={placeholder}
          error={error}
          disabled={isDisabled}
          {...register(name, finalRules)}
        />
      </FormFieldLayout>
    );
  }

  // select / multiselect â†’ Controller
  // âš ï¸ ì¤‘ìš”: multiselectì˜ valueëŠ” ë°˜ë“œì‹œ string[]ì´ë©°, single selectì˜ valueëŠ” stringì´ì–´ì•¼ í•©ë‹ˆë‹¤.
  if (kind === 'select' || kind === 'multiselect') {
    return (
      <FormFieldLayout colSpan={colSpan}>
        <Controller
          name={name}
          control={control}
          rules={finalRules}
          render={({ field: f }) => (
            <Select
              label={label}
              options={effectiveOptions?.map(opt => ({
                ...opt,
                label: opt.labelKey ? (translations[opt.labelKey] || opt.labelKey) : opt.label,
              })) ?? []}
              value={f.value ?? (kind === 'multiselect' ? [] : '')}  // âš ï¸ ì¤‘ìš”: undefined ì²˜ë¦¬
              multiple={kind === 'multiselect'}
              onChange={f.onChange}
              error={error}
              disabled={isDisabled}
            />
          )}
        />
      </FormFieldLayout>
    );
  }

  // radio â†’ Controller
  // âš ï¸ ë³´ì™„: Radio êµ¬ì¡°ëŠ” í–¥í›„ choice-group í˜•íƒœë¡œ í™•ì¥ ê°€ëŠ¥
  // schema-engineì€ choice-group êµ¬ì¡°ë¥¼ "kind: 'radio'"ë¡œë§Œ ì²˜ë¦¬í•˜ë„ë¡ ëª…ì‹œ
  if (kind === 'radio') {
    return (
      <FormFieldLayout colSpan={colSpan}>
        <Controller
          name={name}
          control={control}
          rules={finalRules}
          render={({ field: f }) => (
            <div>
              {effectiveOptions?.map((option) => {
                const translatedLabel = option.labelKey ? (translations[option.labelKey] || option.labelKey) : option.label;
                return (
                  <Radio
                    key={option.value}
                    label={translatedLabel}
                    checked={f.value === option.value}
                    onChange={() => f.onChange(option.value)}
                    disabled={isDisabled}
                  />
                );
              })}
            </div>
          )}
        />
      </FormFieldLayout>
    );
  }

  // checkbox
  if (kind === 'checkbox') {
    return (
      <FormFieldLayout colSpan={colSpan}>
        <Controller
          name={name}
          control={control}
          rules={finalRules}
          render={({ field: f }) => (
            <Checkbox
              label={label}
              checked={!!f.value}
              onChange={f.onChange}
              disabled={isDisabled}
            />
          )}
        />
      </FormFieldLayout>
    );
  }

  // date
  if (kind === 'date') {
    return (
      <FormFieldLayout colSpan={colSpan}>
        <Controller
          name={name}
          control={control}
          rules={finalRules}
          render={({ field: f }) => (
            <DatePicker
              label={label}
              value={f.value}
              onChange={f.onChange}
              disabled={isDisabled}
              error={error}
              fullWidth
            />
          )}
        />
      </FormFieldLayout>
    );
  }

  // datetime
  if (kind === 'datetime') {
    return (
      <FormFieldLayout colSpan={colSpan}>
        <Controller
          name={name}
          control={control}
          rules={finalRules}
          render={({ field: f }) => (
            <DatePicker
              label={label}
              value={f.value}
              onChange={f.onChange}
              disabled={isDisabled}
              error={error}
              fullWidth
              dateTime={true}
            />
          )}
        />
      </FormFieldLayout>
    );
  }

  // SDUI v1.1: Custom Widget ì§€ì› (ë™ì  ë¡œë”©)
  // âš ï¸ ì¤‘ìš”: setOptionsëŠ” select/multiselect/radioì—ë§Œ ì ìš©ë˜ë©°,
  // kind: 'custom' ìœ„ì ¯ì—ëŠ” ì ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤ (í–¥í›„ ë²„ì „ì—ì„œ í™•ì¥ ê°€ëŠ¥).
  // CustomWidgetFieldì—ì„œëŠ” field.optionsë§Œ ì „ë‹¬ë˜ë©°, conditionalActions.setOptionsëŠ” ë¬´ì‹œë©ë‹ˆë‹¤.
  if (kind === 'custom' && effectiveComponentType) {
    return (
      <CustomWidgetField
        componentType={effectiveComponentType}
        field={field}
        colSpan={colSpan}
        control={control}
        errors={errors}
        isDisabled={isDisabled}
        finalRules={finalRules}
        translations={translations}
        // âš ï¸ ì°¸ê³ : conditionalActionsëŠ” CustomWidgetFieldì— ì „ë‹¬í•˜ì§€ ì•ŠìŒ
        // setOptionsëŠ” custom ìœ„ì ¯ì—ì„œ ì§€ì›ë˜ì§€ ì•Šìœ¼ë¯€ë¡œ ë³„ë„ ì²˜ë¦¬ ë¶ˆí•„ìš”
      />
    );
  }

  return null;
}

// âš ï¸ ì„±ëŠ¥ ìµœì í™”: React.memoë¡œ ê°ì‹¸ì„œ ë¶ˆí•„ìš”í•œ ë¦¬ë Œë”ë§ ë°©ì§€
export const SchemaField = React.memo(SchemaFieldComponent);

/**
 * Custom Widget Field Component
 *
 * SDUI v1.1: Custom Widgetì„ ë™ì ìœ¼ë¡œ ë¡œë“œí•˜ì—¬ ë Œë”ë§í•©ë‹ˆë‹¤.
 */
const CustomWidgetField: React.FC<{
  componentType: string;
  field: FormFieldSchema;
  colSpan: number;
  control: Control<any>;
  errors: FieldErrors<any>;
  isDisabled: boolean;
  finalRules: any;
  translations?: Record<string, string>;
}> = ({ componentType, field, colSpan, control, errors, isDisabled, finalRules, translations = {} }) => {
  const [CustomComponent, setCustomComponent] = React.useState<React.ComponentType<any> | null>(null);
  const [loading, setLoading] = React.useState(true);
  const [error, setError] = React.useState<Error | null>(null);

  React.useEffect(() => {
    let mounted = true;

    async function loadComponent() {
      try {
        setLoading(true);
        setError(null);

        // SDUI v1.1: Widget Not Found ì²˜ë¦¬ ê°•í™”
        const Component = await loadWidget(componentType);

        if (mounted) {
          if (!Component) {
            setError(new Error(`Widget "${componentType}" not found in registry.`));
            setCustomComponent(null);
          } else {
            setCustomComponent(() => Component);
            setError(null);
          }
        }
      } catch (err) {
        if (mounted) {
          setError(err instanceof Error ? err : new Error(String(err)));
          setCustomComponent(null);
        }
      } finally {
        if (mounted) {
          setLoading(false);
        }
      }
    }

    loadComponent();

    return () => {
      mounted = false;
    };
  }, [componentType]);

  if (loading) {
    return (
      <FormFieldLayout colSpan={colSpan}>
        <div>ìœ„ì ¯ ë¡œë”© ì¤‘: {componentType}...</div>
      </FormFieldLayout>
    );
  }

  if (error || !CustomComponent) {
    return (
      <FormFieldLayout colSpan={colSpan}>
        <Card variant="outlined" padding="md">
          <div>
            <strong>ìœ„ì ¯ ë¡œë“œ ì‹¤íŒ¨: {componentType}</strong>
            {error && <div>{error.message}</div>}
            <div>ì´ í•„ë“œëŠ” ë Œë”ë§ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ìŠ¤í‚¤ë§ˆì˜ customComponentTypeì„ í™•ì¸í•˜ê±°ë‚˜ ìœ„ì ¯ì„ ë“±ë¡í•´ì£¼ì„¸ìš”.</div>
          </div>
        </Card>
      </FormFieldLayout>
    );
  }

  return (
    <FormFieldLayout colSpan={colSpan}>
      <Controller
        name={field.name}
        control={control}
        rules={finalRules}
        render={({ field: f }) => (
          <CustomComponent
            name={field.name}
            label={field.ui?.labelKey ? (translations[field.ui.labelKey] || field.ui.labelKey) : field.ui?.label}
            placeholder={field.ui?.placeholderKey ? (translations[field.ui.placeholderKey] || field.ui.placeholderKey) : field.ui?.placeholder}
            disabled={isDisabled}
            error={errors[field.name]?.message as string | undefined}
            value={f.value}
            onChange={f.onChange}
            onBlur={f.onBlur}
            defaultValue={field.defaultValue}
            // âš ï¸ ì¤‘ìš”: options ìš°ì„ ìˆœìœ„
            // 1. conditionalActions.setOptions (ë™ì  ì˜µì…˜, ìµœìš°ì„ ) - CustomWidgetFieldì—ì„œëŠ” ë³„ë„ ì²˜ë¦¬ í•„ìš”
            // 2. field.options (ìŠ¤í‚¤ë§ˆì— ì •ì˜ëœ ì •ì  ì˜µì…˜)
            // CustomWidgetFieldì—ì„œëŠ” effectiveOptionsë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ,
            // setOptions ì•¡ì…˜ì´ ìˆìœ¼ë©´ CustomWidgetField ë‚´ë¶€ì—ì„œ ë³„ë„ë¡œ ì²˜ë¦¬í•´ì•¼ í•©ë‹ˆë‹¤.
            options={field.options}
          />
        )}
      />
    </FormFieldLayout>
  );
};

9. í•µì‹¬ ë™ì‘ ìš”ì•½ (ì¡°ê±´ë¶€ UI)

âœ” show/hide

â†’ ì¡°ê±´ ì¶©ì¡± ì‹œ ìˆ¨ê¹€ ë˜ëŠ” ë³´ì„
â†’ êµ¬í˜„: return null;

âœ” enable/disable

â†’ ëª¨ë“  ì»´í¬ë„ŒíŠ¸ì— disabled={isDisabled} ì „ë‹¬

âœ” require (ë™ì  í•„ìˆ˜í™”)

â†’ rules.required = true ë™ì  ì£¼ì…
â†’ register/Controller ëª¨ë‘ finalRules ì‚¬ìš©

âœ” useWatch

â†’ ì¡°ê±´ í•„ë“œë§Œ ê´€ì°°í•˜ì—¬ ì„±ëŠ¥ ìµœì í™” (ë³µìˆ˜ í•„ë“œ ë™ì‹œ ê°ì‹œ ì§€ì›)

âœ” SDUI v1.1: ë™ì  ì•¡ì…˜ (setValue, setOptions, switchComponent)

â†’ getConditionalActions()ê°€ actions ê°ì²´ë¥¼ ë°˜í™˜
â†’ setValue: í•„ë“œ ê°’ ë™ì  ì„¤ì • (self-referential ê¸ˆì§€: ë‹¤ë¥¸ í•„ë“œ ê°’ë§Œ ë³€ê²½ ê°€ëŠ¥)
â†’ setOptions: ì˜µì…˜ ë™ì  ë³€ê²½ (static ë˜ëŠ” api ê¸°ë°˜, select/multiselect/radioì—ë§Œ ì ìš©, apiClient í•„ìˆ˜)
â†’ switchComponent: ì»´í¬ë„ŒíŠ¸ íƒ€ì… ë™ì  ì „í™˜
â†’ then/else êµ¬ì¡°ì—ì„œ ì¡°ê±´ ë§Œì¡± ì—¬ë¶€ì— ë”°ë¼ ì•¡ì…˜ ì ìš©
â†’ âš ï¸ ì°¸ê³ : setOptionsëŠ” kind: 'custom' ìœ„ì ¯ì—ëŠ” ì ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤ (í–¥í›„ ë²„ì „ì—ì„œ í™•ì¥ ê°€ëŠ¥)

10. Condition Rule ì˜ˆì‹œ

10.1 ë‹¨ì¼ ì¡°ê±´ ì˜ˆì‹œ

ìŠ¤í‚¤ë§ˆ ì˜ˆì‹œ:
{
  "name": "parent_phone",
  "kind": "phone",
  "ui": { "label": "í•™ë¶€ëª¨ ì—°ë½ì²˜" },
  "condition": {
    "field": "is_minor",
    "op": "eq",
    "value": true,
    "action": "show"
  }
}

ë™ì‘:
- is_minor === true â†’ parent_phone í‘œì‹œ
- is_minor === false â†’ parent_phone ìˆ¨ê¹€

10.2 ë³µìˆ˜ ì¡°ê±´ ì˜ˆì‹œ (AND)

ìŠ¤í‚¤ë§ˆ ì˜ˆì‹œ:
{
  "name": "parent_phone",
  "kind": "phone",
  "ui": { "label": "í•™ë¶€ëª¨ ì—°ë½ì²˜" },
  "conditions": {
    "conditions": [
      { "field": "is_minor", "op": "eq", "value": true },
      { "field": "parent_required", "op": "eq", "value": true }
    ],
    "logic": "and",
    "action": "show"
  }
}

ë™ì‘:
- is_minor === true AND parent_required === true â†’ parent_phone í‘œì‹œ
- ê·¸ ì™¸ â†’ parent_phone ìˆ¨ê¹€

10.3 ë³µìˆ˜ ì¡°ê±´ ì˜ˆì‹œ (OR)

ìŠ¤í‚¤ë§ˆ ì˜ˆì‹œ:
{
  "name": "discount_code",
  "kind": "text",
  "ui": { "label": "í• ì¸ ì½”ë“œ" },
  "conditions": {
    "conditions": [
      { "field": "payment_method", "op": "eq", "value": "card" },
      { "field": "auto_payment", "op": "eq", "value": false }
    ],
    "logic": "or",
    "action": "show"
  }
}

ë™ì‘:
- payment_method === 'card' OR auto_payment === false â†’ discount_code í‘œì‹œ
- ê·¸ ì™¸ â†’ discount_code ìˆ¨ê¹€

10.4 ìˆ«ì ë¹„êµ ì—°ì‚°ì ì˜ˆì‹œ

ìŠ¤í‚¤ë§ˆ ì˜ˆì‹œ:
{
  "name": "discount_amount",
  "kind": "number",
  "ui": { "label": "í• ì¸ ê¸ˆì•¡" },
  "condition": {
    "field": "total_amount",
    "op": "gte",
    "value": 100000,
    "action": "show"
  }
}

ë™ì‘:
- total_amount >= 100000 â†’ discount_amount í‘œì‹œ
- total_amount < 100000 â†’ discount_amount ìˆ¨ê¹€

11. Schema Registry ì™„ì „ ì—°ë™ ê°€ì´ë“œ

11.1 í´ë¼ì´ì–¸íŠ¸ì—ì„œ Schema Registry ì‚¬ìš©

í˜„ì¬ëŠ” ë¡œì»¬ ìŠ¤í‚¤ë§ˆ íŒŒì¼ì„ ì‚¬ìš©í•˜ì§€ë§Œ, Schema Registryë¥¼ í†µí•œ ë™ì  ë¡œë“œë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤.

// apps/academy-admin/src/pages/StudentsPage.tsx
import { useSchema } from '@hooks/use-schema';
import { studentFormSchema } from '../schemas/student.schema'; // Fallback

export function StudentsPage() {
  // Schema Registryì—ì„œ ìŠ¤í‚¤ë§ˆ ì¡°íšŒ (Fallback: ë¡œì»¬ ìŠ¤í‚¤ë§ˆ)
  const { data: schema, isLoading: schemaLoading } = useSchema('student', studentFormSchema);

  // schemaê°€ ì—†ìœ¼ë©´ fallback ì‚¬ìš©
  const formSchema = schema || studentFormSchema;

  // ... ë‚˜ë¨¸ì§€ ì½”ë“œ
}

11.2 ì—…ì¢…ë³„ ìŠ¤í‚¤ë§ˆ ë¶„ë¦¬

í•™ì› ì—…ì¢… (academy):
- entity: 'student', industry_type: 'academy'
- entity: 'class', industry_type: 'academy'
- entity: 'teacher', industry_type: 'academy'
- entity: 'attendance', industry_type: 'academy'

ë¯¸ìš©ì‹¤ ì—…ì¢… (salon):
- entity: 'customer', industry_type: 'salon'
- entity: 'appointment', industry_type: 'salon'
- entity: 'service', industry_type: 'salon'

ê³µí†µ ìŠ¤í‚¤ë§ˆ:
- entity: 'user', industry_type: null
- entity: 'tenant', industry_type: null

âš ï¸ ì¤‘ìš”: ì—…ì¢…ë³„ ìŠ¤í‚¤ë§ˆ ì¶©ëŒ ë°©ì§€ ê·œì¹™
- entityëŠ” ì—…ì¢… ë‚´ì—ì„œëŠ” ììœ ë¡­ê²Œ ì •ì˜ ê°€ëŠ¥í•˜ì§€ë§Œ,
- Registry ì „ì—­ì—ì„œëŠ” industry_type + entity ì¡°í•©ì´ ê³ ìœ í•´ì•¼ í•©ë‹ˆë‹¤.
- ì˜ˆ: academy/studentì™€ salon/studentëŠ” ì„œë¡œ ë‹¤ë¥¸ ìŠ¤í‚¤ë§ˆë¡œ ê´€ë¦¬ë©ë‹ˆë‹¤.
- UNIQUE(entity, industry_type, version) ì œì•½ì¡°ê±´ìœ¼ë¡œ ë³´ì¥ë©ë‹ˆë‹¤.

11.3 ìŠ¤í‚¤ë§ˆ ë²„ì „ ê´€ë¦¬

ë²„ì „ í˜•ì‹: Semver (ì˜ˆ: '1.0.0', '2.0.0', '2.1.0')

ë²„ì „ ì—…ê·¸ë ˆì´ë“œ:
1. ìƒˆ ë²„ì „ ìŠ¤í‚¤ë§ˆë¥¼ 'draft' ìƒíƒœë¡œ ë“±ë¡
2. í…ŒìŠ¤íŠ¸ ë° ê²€ì¦
3. 'active' ìƒíƒœë¡œ í™œì„±í™”
4. ê¸°ì¡´ ë²„ì „ì€ 'deprecated' ì²˜ë¦¬ (ì„ íƒ)

ë¡¤ë°±:
- í…Œë„ŒíŠ¸ë³„ Version Pinningì„ ì‚¬ìš©í•˜ì—¬ ì´ì „ ë²„ì „ìœ¼ë¡œ ê³ ì •
- ë˜ëŠ” ì´ì „ ë²„ì „ì„ ë‹¤ì‹œ 'active'ë¡œ ë³€ê²½

12. ë©€í‹° SaaS ìš´ì˜ ì²´í¬ë¦¬ìŠ¤íŠ¸

âœ… ì—…ì¢…ë³„ ìŠ¤í‚¤ë§ˆ ì™„ì „ ë¶„ë¦¬
- ê° ì—…ì¢…ì€ ë…ë¦½ì ì¸ ìŠ¤í‚¤ë§ˆ ë²„ì „ ê´€ë¦¬
- ê³µí†µ ìŠ¤í‚¤ë§ˆëŠ” industry_type = nullë¡œ ê´€ë¦¬

âœ… Schema Registry ì™„ì „ ì—°ë™
- ëª¨ë“  ìŠ¤í‚¤ë§ˆëŠ” Registryì— ë“±ë¡
- ë™ì  ìŠ¤í‚¤ë§ˆ ë¡œë“œ ì§€ì›

âœ… Condition Rule ì™„ì „ ì§€ì›
- í•„ë“œ ë ˆë²¨ ConditionRule/MultiConditionRuleì€ v2.1ì—ì„œ ì™„ì „ ì§€ì›
  - ë‹¨ì¼ ì¡°ê±´ ì§€ì›
  - ë³µìˆ˜ ì¡°ê±´ (AND/OR) ì§€ì›
  - ìˆ«ì ë¹„êµ ì—°ì‚°ì (gt, gte, lt, lte) ì§€ì›
  - then/else êµ¬ì¡° ë° ë™ì  ì•¡ì…˜ (setValue, setOptions, switchComponent) ì§€ì›
- BaseSchema.conditions(ê¸€ë¡œë²Œ ì¡°ê±´)ëŠ” v2.1ì—ì„œ íƒ€ì…ë§Œ ì •ì˜, v2.2+ì—ì„œ í‰ê°€ ë¡œì§ ì˜ˆì •

âœ… Version Pinning ì§€ì›
- í…Œë„ŒíŠ¸ë³„ ìŠ¤í‚¤ë§ˆ ë²„ì „ ê³ ì • ê°€ëŠ¥
- ë§ˆì´ê·¸ë ˆì´ì…˜ ì „ ì•ˆì •ì„± í™•ë³´

âœ… Fallback ìŠ¤í‚¤ë§ˆ ì§€ì›
- Registry ì¡°íšŒ ì‹¤íŒ¨ ì‹œ ë¡œì»¬ ìŠ¤í‚¤ë§ˆ ì‚¬ìš©
- ì ì§„ì  ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ëŠ¥
- âš ï¸ ì¤‘ìš”: fallbackSchemaëŠ” íŠ¸ëŸ¬ë¸”ìŠˆíŒ…ìš©ì…ë‹ˆë‹¤.
  - ìŠ¤í‚¤ë§ˆ ë¶€ì¬ ì‹œ ì•±ì´ ì£½ì§€ ì•Šë„ë¡ fallbackì„ ìœ ì§€í•´ì•¼ í•©ë‹ˆë‹¤.

âœ… Zero-Trust UI ì¤€ìˆ˜
- schema-engineì€ tenant_id / industry_typeì„ ëª¨ë¦„
- API SDKê°€ ìë™ ì£¼ì…
- RendererëŠ” ì˜¤ì§ ìŠ¤í‚¤ë§ˆë§Œ í•´ì„

âœ… ë™ì  Required ì§€ì›
- finalRules injection
- Condition Rule ê¸°ë°˜ ë™ì  í•„ìˆ˜í™”

âœ… ë ˆì´ì•„ì›ƒ props ê¸°ë°˜
- Tailwind í´ë˜ìŠ¤ ì§ì ‘ ì‚¬ìš© ê¸ˆì§€
- ui-coreì˜ Grid, Card ë“± ë ˆì´ì•„ì›ƒ ì»´í¬ë„ŒíŠ¸ ì‚¬ìš©
- RendererëŠ” ìŠ¤íƒ€ì¼ ë¡œì§ì„ ê°€ì ¸ì„œëŠ” ì•ˆ ë¨

13. ì„±ëŠ¥ ìµœì í™” (CTO ê´€ì )

âš ï¸ ì¤‘ìš”: ì‹¤ì œ ìš´ì˜ í™˜ê²½ì—ì„œ 300ê°œ ì´ìƒì˜ í•„ë“œë¥¼ ê°€ì§„ í¼ì´ ìˆì„ ìˆ˜ ìˆìœ¼ë©°,
ì´ ê²½ìš° ì„±ëŠ¥ ìµœì í™”ê°€ í•„ìˆ˜ì…ë‹ˆë‹¤.

13.1 Renderer ìµœì í™” (Rule-Heavy Forms)

ë¬¸ì œ:
- Condition Ruleì´ ë§ì€ í¼ì—ì„œ useWatchê°€ ëª¨ë“  ì°¸ì¡° í•„ë“œë¥¼ ê°ì‹œ
- í•„ë“œê°€ 300ê°œ ì´ìƒì´ë©´ ë¦¬ë Œë”ë§ ì„±ëŠ¥ ì €í•˜ ê°€ëŠ¥

í•´ê²°ì±…:

1. React.memo ì ìš© (í•„ìˆ˜)
```typescript
// packages/schema-engine/src/react/SchemaField.tsx
// âš ï¸ ê²½ë¡œ í†µì¼: ëª¨ë“  ì˜ˆì‹œì—ì„œ packages/schema-engine/src/react/SchemaField.tsx ì‚¬ìš©
// SchemaFieldComponentëŠ” ë‚´ë¶€ ì»´í¬ë„ŒíŠ¸ í•¨ìˆ˜ì…ë‹ˆë‹¤.
function SchemaFieldComponent({ field, register, errors, control, translations, setValue }: SchemaFieldProps) {
  // ... êµ¬í˜„ ë‚´ìš©
}

// âš ï¸ ì„±ëŠ¥ ìµœì í™”: React.memoë¡œ ê°ì‹¸ì„œ ë¶ˆí•„ìš”í•œ ë¦¬ë Œë”ë§ ë°©ì§€
export const SchemaField = React.memo(SchemaFieldComponent);
```
- ì´ë¯¸ êµ¬í˜„ë¨
- propsê°€ ë³€ê²½ë˜ì§€ ì•Šìœ¼ë©´ ë¦¬ë Œë”ë§ ë°©ì§€

2. useWatch ìµœì í™”
```typescript
// í˜„ì¬ êµ¬í˜„: "ì¡°ê±´ì´ ìˆëŠ” í•„ë“œ"ì— ëŒ€í•´ì„œëŠ” ì°¸ì¡° í•„ë“œë§Œ ê°ì‹œ
const fieldsToWatch = React.useMemo(() => {
  const fields = new Set<string>();
  if (field.condition) fields.add(field.condition.field);
  if (field.conditions) {
    field.conditions.conditions.forEach((rule) => {
      fields.add(rule.field);
    });
  }
  return Array.from(fields);
}, [field.condition, field.conditions]);

const watched = useWatch({
  control,
  name: fieldsToWatch.length > 0 ? fieldsToWatch : undefined,
});
```
- âœ… ì´ë¯¸ ìµœì í™”ë¨: ì¡°ê±´ì´ ìˆëŠ” í•„ë“œì— ëŒ€í•´ì„œëŠ” ì°¸ì¡° í•„ë“œë§Œ ê°ì‹œ
- âš ï¸ ì°¸ê³ : fieldsToWatch.length === 0ì¸ ê²½ìš°, useWatch(name: undefined)ëŠ”
  í¼ ì „ì²´ë¥¼ êµ¬ë…í•˜ê²Œ ë˜ì–´ ë¶ˆí•„ìš”í•œ ë¦¬ë Œë”ë§ì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ì¡°ê±´ì´ ì—†ëŠ” í•„ë“œëŠ” useWatchë¥¼ í˜¸ì¶œí•˜ì§€ ì•ŠëŠ” ë³€í˜• ì»´í¬ë„ŒíŠ¸ë¡œ ë¶„ë¦¬í•˜ê±°ë‚˜,
  ë”ë¯¸ í•„ë“œë¥¼ watch í•˜ëŠ” ë°©ì‹ ë“±ìœ¼ë¡œ ìµœì í™”í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.

3. í•„ë“œ ê·¸ë£¹í™” (300ê°œ ì´ìƒ í•„ë“œ)
- í¼ì„ ë…¼ë¦¬ì  ì„¹ì…˜ìœ¼ë¡œ ë¶„ë¦¬
- ê° ì„¹ì…˜ì„ ë³„ë„ SchemaFormìœ¼ë¡œ êµ¬ì„±
- React.lazyë¡œ ì„¹ì…˜ë³„ ì½”ë“œ ìŠ¤í”Œë¦¬íŒ…

ì˜ˆì‹œ:
```typescript
const BasicInfoSection = React.lazy(() => import('./sections/BasicInfoSection'));
const ContactSection = React.lazy(() => import('./sections/ContactSection'));

function LargeForm() {
  return (
    <Suspense fallback={<Loading />}>
      <BasicInfoSection />
      <ContactSection />
    </Suspense>
  );
}
```

13.2 300í•„ë“œ ì´ìƒ ì›Œì¹˜ ì „ëµ

ë¬¸ì œ:
- 300ê°œ í•„ë“œê°€ ì„œë¡œ ì°¸ì¡°í•˜ëŠ” ê²½ìš° useWatch í˜¸ì¶œì´ ë§ì•„ì§

í•´ê²°ì±…:

1. í•„ë“œ ê·¸ë£¹í™” ë° ì„¹ì…˜ ë¶„ë¦¬
- ê´€ë ¨ í•„ë“œë¥¼ ë…¼ë¦¬ì  ê·¸ë£¹ìœ¼ë¡œ ë¶„ë¦¬
- ê° ê·¸ë£¹ì€ ë…ë¦½ì ì¸ SchemaFormìœ¼ë¡œ êµ¬ì„±
- ê·¸ë£¹ ê°„ ì°¸ì¡°ëŠ” ìµœì†Œí™”

2. Debounce ì ìš© (ì„ íƒ)
- Condition Rule í‰ê°€ë¥¼ debounceí•˜ì—¬ ë¶ˆí•„ìš”í•œ ë¦¬ë Œë”ë§ ë°©ì§€
- âš ï¸ ì£¼ì˜: ì‚¬ìš©ì ê²½í—˜ ì €í•˜ ê°€ëŠ¥ì„± ìˆìŒ

3. Virtual Scrolling (ë§¤ìš° í° í¼)
- 300ê°œ ì´ìƒ í•„ë“œê°€ ëª¨ë‘ ë³´ì´ëŠ” ê²½ìš°
- react-window ë˜ëŠ” react-virtualized ì‚¬ìš©
- âš ï¸ ì£¼ì˜: Condition Ruleê³¼ì˜ í˜¸í™˜ì„± ê²€ì¦ í•„ìš”

13.3 Memoization ì „ëµ

1. SchemaField ì»´í¬ë„ŒíŠ¸
- âœ… React.memo ì ìš© (ì´ë¯¸ êµ¬í˜„ë¨)
- props ë¹„êµ í•¨ìˆ˜ ì»¤ìŠ¤í„°ë§ˆì´ì§• ê°€ëŠ¥

2. SchemaForm ì»´í¬ë„ŒíŠ¸
- defaultValuesë¥¼ useMemoë¡œ ë©”ëª¨ì´ì œì´ì…˜
- schema ê°ì²´ë¥¼ useMemoë¡œ ë©”ëª¨ì´ì œì´ì…˜

ì˜ˆì‹œ:
```typescript
function MyForm() {
  const schema = useMemo(() => studentFormSchema, []);
  const defaultValues = useMemo(() => ({ name: '', email: '' }), []);

  return <SchemaForm schema={schema} defaultValues={defaultValues} />;
}
```

**SchemaForm Props (v1.1 ì¶”ê°€)**:
- `cardTitle?: React.ReactNode`: ì¹´ë“œ ë‚´ë¶€ íƒ€ì´í‹€ (íƒ€ì´í‹€ í•˜ë‹¨ì— êµ¬ë¶„ì„  ìë™ ì¶”ê°€)
- `cardTitlePosition?: 'top-left' | 'top-right' | 'top-center'`: íƒ€ì´í‹€ ìœ„ì¹˜ (ê¸°ë³¸ê°’: 'top-left')
- `cardTitleIcon?: React.ReactNode`: íƒ€ì´í‹€ ì™¼ìª½ì— í‘œì‹œí•  ì•„ì´ì½˜ (ë£¨ì‹œë“œ ì•„ì´ì½˜)
- `onCancel?: () => void`: ì·¨ì†Œ ë²„íŠ¼ í´ë¦­ í•¸ë“¤ëŸ¬ (ì·¨ì†Œ ë²„íŠ¼ í‘œì‹œ ì—¬ë¶€ ê²°ì •)
- `cancelLabel?: string`: ì·¨ì†Œ ë²„íŠ¼ í…ìŠ¤íŠ¸ (ê¸°ë³¸ê°’: 'ì·¨ì†Œ')

**ì‚¬ìš© ì˜ˆì‹œ**:
```typescript
<SchemaForm
  schema={formSchema}
  defaultValues={defaultValues}
  cardTitle="ìƒë‹´ì¼ì§€ ë“±ë¡"
  cardTitlePosition="top-left"
  cardTitleIcon={<FileText size={16} strokeWidth={1.5} />}
  onCancel={() => setIsOpen(false)}
  cancelLabel="ì·¨ì†Œ"
/>
```

**ì£¼ì˜ì‚¬í•­**:
- `cardTitle`ì´ ìˆìœ¼ë©´ ìë™ìœ¼ë¡œ íƒ€ì´í‹€ ì˜ì—­ ë°°ê²½ìƒ‰(`var(--color-gray-50)`)ê³¼ êµ¬ë¶„ì„ ì´ ì¶”ê°€ë©ë‹ˆë‹¤.
- `onCancel`ì´ ìˆìœ¼ë©´ ì·¨ì†Œ ë²„íŠ¼ì´ ì €ì¥ ë²„íŠ¼ ì™¼ìª½ì— í‘œì‹œë©ë‹ˆë‹¤.
- íƒ€ì´í‹€ ì•„ì´ì½˜ì€ CSS ë³€ìˆ˜(`--size-icon-base`, `--stroke-width-icon`)ë¥¼ ì‚¬ìš©í•˜ì—¬ í¬ê¸°ì™€ ì„  ë‘ê»˜ë¥¼ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤.

3. Condition Rule í‰ê°€ ê²°ê³¼ ìºì‹±
- ë™ì¼í•œ watchedValuesì— ëŒ€í•œ í‰ê°€ ê²°ê³¼ ìºì‹±
- âš ï¸ ì£¼ì˜: ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì¦ê°€ ê°€ëŠ¥ì„±

14. Schema Registry ë§ˆì´ê·¸ë ˆì´ì…˜ ì •ì±…

âš ï¸ ì¤‘ìš”: ì‹¤ì œ ìš´ì˜ í™˜ê²½ì—ì„œ ìŠ¤í‚¤ë§ˆ ë²„ì „ ì—…ê·¸ë ˆì´ë“œ ì‹œ
ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆì™€ UI ìŠ¤í‚¤ë§ˆì˜ ë™ê¸°í™”ê°€ í•„ìˆ˜ì…ë‹ˆë‹¤.

14.1 migration_script ì‹¤í–‰ ê·œì¹™

migration_script í•„ë“œ:
- `meta.schema_registry.migration_script` (text, nullable)
- ìŠ¤í‚¤ë§ˆ ë²„ì „ ì—…ê·¸ë ˆì´ë“œ ì‹œ ì‹¤í–‰í•  SQL ìŠ¤í¬ë¦½íŠ¸ ë˜ëŠ” ë§ˆì´ê·¸ë ˆì´ì…˜ ë¡œì§

ì‹¤í–‰ ì‹œì :
1. Schema Registryì— ìŠ¤í‚¤ë§ˆ ë“±ë¡ ì‹œì  (draft â†’ active ì „í™˜ ì‹œ)
2. ë˜ëŠ” ë³„ë„ì˜ ë§ˆì´ê·¸ë ˆì´ì…˜ ë°°ì¹˜ ì‘ì—…ìœ¼ë¡œ ì‹¤í–‰

âš ï¸ ì¤‘ìš”: migration_scriptëŠ” ìˆ˜ë™ ì‹¤í–‰ì„ ì „ì œë¡œ í•©ë‹ˆë‹¤.
- ìë™ ì‹¤í–‰ì€ ìœ„í—˜í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ Super Adminì´ ìˆ˜ë™ìœ¼ë¡œ ê²€í†  í›„ ì‹¤í–‰
- ë˜ëŠ” CI/CD íŒŒì´í”„ë¼ì¸ì—ì„œ ê²€ì¦ í›„ ì‹¤í–‰

14.2 DB Column ì¶”ê°€/ì‚­ì œ ë™ê¸°í™” ê·œì¹™

ê·œì¹™:
1. **Column ì¶”ê°€**: Backward Compatible
   - ìƒˆ ì»¬ëŸ¼ì€ NULL í—ˆìš© ë˜ëŠ” ê¸°ë³¸ê°’ ì„¤ì •
   - ê¸°ì¡´ ë°ì´í„°ì— ì˜í–¥ ì—†ìŒ
   - UI ìŠ¤í‚¤ë§ˆì— ìƒˆ í•„ë“œ ì¶”ê°€ ê°€ëŠ¥

2. **Column ì‚­ì œ**: Breaking Change
   - ê¸°ì¡´ ë°ì´í„° ì†ì‹¤ ê°€ëŠ¥
   - Major ë²„ì „ ì—…ê·¸ë ˆì´ë“œ í•„ìš”
   - ë§ˆì´ê·¸ë ˆì´ì…˜ ì „ ë°ì´í„° ë°±ì—… í•„ìˆ˜

3. **Column íƒ€ì… ë³€ê²½**: Breaking Change
   - ë°ì´í„° ë³€í™˜ ë¡œì§ í•„ìš”
   - Major ë²„ì „ ì—…ê·¸ë ˆì´ë“œ í•„ìš”
   - ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ì— ë³€í™˜ ë¡œì§ í¬í•¨

ì˜ˆì‹œ:
```sql
-- migration_script ì˜ˆì‹œ
-- Schema Version: 2.0.0
-- Entity: student
-- Industry: academy

-- 1. ìƒˆ ì»¬ëŸ¼ ì¶”ê°€ (Backward Compatible)
ALTER TABLE students
ADD COLUMN IF NOT EXISTS middle_name text;

-- 2. ê¸°ì¡´ ì»¬ëŸ¼ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜
UPDATE students
SET middle_name = split_part(full_name, ' ', 2)
WHERE full_name IS NOT NULL AND middle_name IS NULL;

-- 3. (ì„ íƒ) ê¸°ì¡´ ì»¬ëŸ¼ ì‚­ì œ (Breaking Change)
-- ALTER TABLE students DROP COLUMN full_name;
```

14.3 Field Rename ì „ëµ

ë¬¸ì œ:
- UI ìŠ¤í‚¤ë§ˆì˜ field name ë³€ê²½ ì‹œ ê¸°ì¡´ ë°ì´í„°ì™€ì˜ ë§¤í•‘ ë¬¸ì œ

ì „ëµ:

1. **Alias ì§€ì› (ê¶Œì¥)**
   - ìŠ¤í‚¤ë§ˆì— `fieldAliases` ì¶”ê°€
   - ê¸°ì¡´ í•„ë“œëª…ì„ ìƒˆ í•„ë“œëª…ìœ¼ë¡œ ë§¤í•‘

ì˜ˆì‹œ:
```typescript
{
  "version": "2.0.0",
  "entity": "student",
  "form": {
    "fieldAliases": {
      "full_name": "name",  // ê¸°ì¡´ full_name â†’ ìƒˆ name
      "phone_num": "phone"  // ê¸°ì¡´ phone_num â†’ ìƒˆ phone
    },
    "fields": [
      { "name": "name", ... },
      { "name": "phone", ... }
    ]
  }
}
```

2. **ì ì§„ì  ë§ˆì´ê·¸ë ˆì´ì…˜**
   - ê¸°ì¡´ í•„ë“œëª…ê³¼ ìƒˆ í•„ë“œëª…ì„ ë™ì‹œì— ì§€ì›
   - ë°ì´í„°ë² ì´ìŠ¤ ì»¬ëŸ¼ì€ ìœ ì§€, UI ìŠ¤í‚¤ë§ˆë§Œ ë³€ê²½
   - ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ í›„ ê¸°ì¡´ í•„ë“œëª… ì œê±°

3. **Major ë²„ì „ ì—…ê·¸ë ˆì´ë“œ**
   - Field renameì€ Breaking Change
   - Major ë²„ì „ ì—…ê·¸ë ˆì´ë“œ í•„ìš”
   - ëª¨ë“  í…Œë„ŒíŠ¸ê°€ ìƒˆ ë²„ì „ìœ¼ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ í›„ ê¸°ì¡´ ë²„ì „ deprecated

14.4 Version Upgrade ì‹œ Backward Compatibility ìœ ì§€ ì •ì±…

ê·œì¹™:

1. **Minor ë²„ì „ ì—…ê·¸ë ˆì´ë“œ (1.0.0 â†’ 1.1.0)**
   - ìƒˆ í•„ë“œ ì¶”ê°€ ê°€ëŠ¥ (Backward Compatible)
   - ê¸°ì¡´ í•„ë“œ ìˆ˜ì • ë¶ˆê°€
   - ê¸°ì¡´ í•„ë“œ ì‚­ì œ ë¶ˆê°€

2. **Major ë²„ì „ ì—…ê·¸ë ˆì´ë“œ (1.0.0 â†’ 2.0.0)**
   - ëª¨ë“  ë³€ê²½ ê°€ëŠ¥ (Breaking Change)
   - ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ í•„ìˆ˜
   - ì ì§„ì  ë¡¤ì•„ì›ƒ ê¶Œì¥

3. **Patch ë²„ì „ ì—…ê·¸ë ˆì´ë“œ (1.0.0 â†’ 1.0.1)**
   - ë²„ê·¸ ìˆ˜ì •ë§Œ ê°€ëŠ¥
   - ìŠ¤í‚¤ë§ˆ êµ¬ì¡° ë³€ê²½ ë¶ˆê°€

ì ì§„ì  ë¡¤ì•„ì›ƒ ì „ëµ:
1. ìƒˆ ë²„ì „ì„ 'draft' ìƒíƒœë¡œ ë“±ë¡
2. í…ŒìŠ¤íŠ¸ í…Œë„ŒíŠ¸ì— Version Pinningìœ¼ë¡œ ì ìš©
3. ê²€ì¦ ì™„ë£Œ í›„ 'active' ìƒíƒœë¡œ ì „í™˜
4. ëª¨ë“  í…Œë„ŒíŠ¸ê°€ ì ì§„ì ìœ¼ë¡œ ìƒˆ ë²„ì „ ì‚¬ìš©
5. ê¸°ì¡´ ë²„ì „ì€ 'deprecated' ì²˜ë¦¬ (ì„ íƒ)

14.5 ë§ˆì´ê·¸ë ˆì´ì…˜ ì²´í¬ë¦¬ìŠ¤íŠ¸

ìŠ¤í‚¤ë§ˆ ë²„ì „ ì—…ê·¸ë ˆì´ë“œ ì „ í™•ì¸ ì‚¬í•­:
- [ ] DB ìŠ¤í‚¤ë§ˆ ë³€ê²½ ì‚¬í•­ í™•ì¸
- [ ] migration_script ì‘ì„± ë° ê²€ì¦
- [ ] Backward Compatibility í™•ì¸
- [ ] í…ŒìŠ¤íŠ¸ í…Œë„ŒíŠ¸ì—ì„œ ê²€ì¦
- [ ] ë°ì´í„° ë°±ì—… ì™„ë£Œ
- [ ] ë¡¤ë°± ê³„íš ìˆ˜ë¦½
- [ ] ì ì§„ì  ë¡¤ì•„ì›ƒ ê³„íš ìˆ˜ë¦½

15. Action Engine (SDUI v1.1)

âš ï¸ ì¤‘ìš”: Action Engineì€ ìŠ¤í‚¤ë§ˆì—ì„œ ì •ì˜í•œ ì•¡ì…˜ì„ ì‹¤í–‰í•˜ëŠ” ì—”ì§„ì…ë‹ˆë‹¤.

15.1 ActionDefinition íƒ€ì…

```typescript
export interface ActionDefinition {
  event: string;  // 'onSubmit', 'onSubmitSuccess', 'onSubmitError', 'onRowClick' ë“±
  type: 'api.call' | 'navigate' | 'openDrawer' | 'openModal' | 'setValue' | 'reset' | 'reloadSchema' | 'toast' | 'confirm' | 'sequence';
  // api.call
  endpoint?: string;
  method?: 'GET' | 'POST' | 'PUT' | 'DELETE' | 'PATCH';
  body?: 'form' | 'selectedRows' | Record<string, any>;
  // navigate
  to?: string;
  // openDrawer / openModal
  schemaKey?: string;  // ì—´ ìŠ¤í‚¤ë§ˆ í‚¤
  // setValue
  field?: string;
  value?: any;
  // toast
  messageKey?: string;  // SDUI v1.1: i18n í‚¤
  message?: string;  // í•˜ìœ„ í˜¸í™˜ì„±
  variant?: 'success' | 'error' | 'warning' | 'info';
  // confirm
  titleKey?: string;  // SDUI v1.1: i18n í‚¤
  title?: string;  // í•˜ìœ„ í˜¸í™˜ì„±
  confirmMessageKey?: string;  // SDUI v1.1: i18n í‚¤ (messageKeyì™€ êµ¬ë¶„)
  confirmMessage?: string;  // í•˜ìœ„ í˜¸í™˜ì„± (messageì™€ êµ¬ë¶„)
  // sequence
  actions?: ActionDefinition[];
}
```

15.2 ActionContext

```typescript
export interface ActionContext {
  formData?: Record<string, any>;  // í˜„ì¬ í¼ ë°ì´í„°
  selectedRows?: any[];  // ì„ íƒëœ í–‰ (Tableìš©)
  navigate?: (path: string) => void;  // ë„¤ë¹„ê²Œì´ì…˜ í•¨ìˆ˜
  openDrawer?: (schemaKey: string) => void;  // Drawer ì—´ê¸°
  openModal?: (schemaKey: string) => void;  // Modal ì—´ê¸°
  setFormValue?: (field: string, value: any) => void;  // í•„ë“œ ê°’ ì„¤ì •
  resetForm?: () => void;  // í¼ ë¦¬ì…‹
  reloadSchema?: () => Promise<void>;  // ìŠ¤í‚¤ë§ˆ ì¬ë¡œë“œ
  showToast?: (message: string, variant?: string) => void;  // í† ìŠ¤íŠ¸ í‘œì‹œ
  showConfirm?: (title: string, message: string) => Promise<boolean>;  // í™•ì¸ ëŒ€í™”ìƒì
  apiCall?: (endpoint: string, method: string, body?: any) => Promise<any>;  // API í˜¸ì¶œ
  translations?: Record<string, string>;  // SDUI v1.1: i18n ë²ˆì—­
}
```

15.3 Action Engine ì‚¬ìš© ì˜ˆì‹œ

```typescript
// FormSchemaì— actions ì •ì˜
{
  "version": "2.1.0",
  "type": "form",
  "entity": "student",
  "form": {
    "fields": [...],
    "submit": {
      "labelKey": "FORM.SUBMIT"
    },
    "actions": [
      {
        "event": "onSubmit",
        "type": "api.call",
        "endpoint": "/api/students",
        "method": "POST",
        "body": "form"
      },
      {
        "event": "onSubmitSuccess",
        "type": "navigate",
        "to": "/students/list"
      },
      {
        "event": "onSubmitSuccess",
        "type": "toast",
        "messageKey": "STUDENT.CREATE.SUCCESS",
        "variant": "success"
      },
      {
        "event": "onSubmitError",
        "type": "toast",
        "messageKey": "STUDENT.CREATE.ERROR",
        "variant": "error"
      }
    ]
  }
}

// SchemaFormì—ì„œ Action Engine í†µí•©
import { executeActionsForEvent } from '@schema-engine/core';

function SchemaForm({ schema, actionContext, ... }) {
  const handleSubmit = async (data) => {
    // onSubmit ì´ë²¤íŠ¸ ì•¡ì…˜ ì‹¤í–‰
    // âš ï¸ ì¤‘ìš”: FormSchemaì˜ ê²½ìš° schema.form.actionsë¥¼ ì‚¬ìš©
    // BaseSchema.actionsëŠ” ê³µí†µìš©ì´ë©°, Form ì „ìš© ì•¡ì…˜ì€ form.actionsì— ì •ì˜
    await executeActionsForEvent('onSubmit', schema.form.actions || schema.actions, {
      ...actionContext,
      formData: data,
    });
  };

  // onSubmitSuccess/onSubmitErrorëŠ” Action Engine ë‚´ë¶€ì—ì„œ ì²˜ë¦¬
}
```

15.4 API í˜¸ì¶œ ë³´ì•ˆ

âš ï¸ ì¤‘ìš”: Action Engineì˜ API í˜¸ì¶œì€ ë°˜ë“œì‹œ `@api-sdk/core`ë¥¼ í†µí•´ ìˆ˜í–‰í•´ì•¼ í•©ë‹ˆë‹¤.

- UIëŠ” ì ˆëŒ€ ì§ì ‘ `fetch` í˜¸ì¶œí•˜ì§€ ì•ŠìŒ
- `@api-sdk/core`ì˜ `apiClient`ê°€ Supabase ì„¸ì…˜/í† í°ì„ í¬í•¨í•˜ì—¬ RLS ì •ì±… ì•„ë˜ì—ì„œ ë™ì‘
- Zero-Trust ì›ì¹™ ì¤€ìˆ˜
- âš ï¸ ì°¸ê³ : setOptionsì˜ API í˜¸ì¶œë„ ë™ì¼í•œ ì›ì¹™ì„ ë”°ë¥´ë©°, apiClientê°€ ì—†ìœ¼ë©´ ì˜µì…˜ ë¡œë“œ ì‹¤íŒ¨
  (ê°œë°œ/ë””ë²„ê¹…ìš© fetch fallbackì€ ì œê±°ë¨)

15.5 Action Engine vs Condition Engine ê²½ê³„ ì •ì˜

âš ï¸ ì¤‘ìš”: Action Engineê³¼ Condition Engine ëª¨ë‘ setValueë¥¼ ì§€ì›í•˜ì§€ë§Œ, ì ìš© ì‹œì ê³¼ ìš°ì„ ìˆœìœ„ê°€ ë‹¤ë¦…ë‹ˆë‹¤.

**ìš°ì„ ìˆœìœ„ ê·œì¹™:**

1. **í¼ ì œì¶œ ì „/ì‚¬ìš©ì ì…ë ¥ ì¤‘ ë™ì  ê°’ ë³€ê²½**: Condition Ruleì˜ setValue ìš°ì„ 
   - ì‚¬ìš©ìê°€ ì…ë ¥í•˜ëŠ” ë™ì•ˆ ì¡°ê±´ì´ ë³€ê²½ë˜ë©´ ì¦‰ì‹œ ë°˜ì˜
   - ì˜ˆ: payment_typeì´ 'card'ë¡œ ë³€ê²½ë˜ë©´ payment_detail í•„ë“œì— 'card_number' ìë™ ì„¤ì •

2. **í¼ ì œì¶œ ì‹œ/ì´ë²¤íŠ¸ í›„ ì²˜ë¦¬**: Action Engineì˜ setValue ìš°ì„ 
   - onSubmit, onSubmitSuccess, onSubmitError ë“±ì˜ ì´ë²¤íŠ¸ì—ì„œ ì‹¤í–‰
   - ì˜ˆ: ì œì¶œ ì„±ê³µ í›„ í¼ ë¦¬ì…‹ ë˜ëŠ” íŠ¹ì • í•„ë“œ ì´ˆê¸°í™”

**ì¶©ëŒ ë°©ì§€:**
- Condition Ruleì˜ setValueëŠ” ì‚¬ìš©ì ì…ë ¥ ì¤‘ì—ë§Œ ì ìš©ë˜ë©°, í¼ ì œì¶œ í›„ì—ëŠ” Action Engineì´ ì œì–´í•©ë‹ˆë‹¤.
- ë™ì¼í•œ í•„ë“œì— ëŒ€í•´ Condition Ruleê³¼ Action Engineì´ ëª¨ë‘ setValueë¥¼ ì •ì˜í•œ ê²½ìš°, Action Engineì´ ìµœì¢…ì ìœ¼ë¡œ ìš°ì„ í•©ë‹ˆë‹¤.

16. Table/Detail/Filter/Widget Schema (SDUI v1.1)

âš ï¸ ì¤‘ìš”: Form ì™¸ì—ë„ Table, Detail, Filter, Widgetì„ ìŠ¤í‚¤ë§ˆë¡œ ì •ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

16.1 BaseSchema íƒ€ì…

```typescript
export type SchemaType = 'form' | 'table' | 'detail' | 'filter' | 'widget';

export interface BaseSchema {
  version: string;  // "2.1.0"
  minClient?: string;  // "1.10.0" ì´í•˜ í´ë¼ì´ì–¸íŠ¸ëŠ” ì°¨ë‹¨ (SDUI v1.1)
  minSupportedClient?: string;  // í•˜ìœ„ í˜¸í™˜ì„±
  type: SchemaType;
  entity: string;  // "student" | "class" | "teacher" ...
  tenantScoped?: boolean;  // ê¸°ë³¸ true, falseì¸ ê²½ìš° system-global
  layout?: LayoutSchema;
  actions?: ActionDefinition[];  // SDUI v1.1: Action Engine ì§€ì›
  conditions?: ConditionRule[];  // ê¸€ë¡œë²Œ ì¡°ê±´ ê·œì¹™ (ì„ íƒ, Reserved)
  // âš ï¸ ì¤‘ìš”: BaseSchema.conditionsëŠ” í–¥í›„ SDUI v2.0ì—ì„œ ì‚¬ìš© ì˜ˆì •ì´ë©°,
  // v2.1ì—ì„œëŠ” ì‹¤ì œ í‰ê°€ ë¡œì§ì´ êµ¬í˜„ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
  // í˜„ì¬ëŠ” íƒ€ì… ì •ì˜ë§Œ ì¡´ì¬í•˜ë©°, í¼ ì „ì²´/ìœ„ì ¯ ì „ì²´ì— ê³µí†µ ì¡°ê±´ì„ ê±¸ ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì€
  // í–¥í›„ ë²„ì „ì—ì„œ ì œê³µë  ì˜ˆì •ì…ë‹ˆë‹¤.
  // âš ï¸ í˜„ì¬ ì‚¬ìš© ê¸ˆì§€(Reserved): v2.1ì—ì„œëŠ” ì´ í•„ë“œë¥¼ ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”.
  meta?: Record<string, any>;
}
```

16.2 TableSchema

```typescript
export interface TableSchema extends BaseSchema {
  type: 'table';
  table: {
    dataSource: {
      type: 'api';
      endpoint: string;
      method?: 'GET' | 'POST';
    };
    columns: Array<{
      key: string;
      labelKey?: string;  // SDUI v1.1: i18n í‚¤
      label?: string;  // í•˜ìœ„ í˜¸í™˜ì„±
      width?: number | string;  // SDUI v1.1: number ì§€ì›
      sortable?: boolean;
      filterable?: boolean;  // SDUI v1.1
      type?: 'text' | 'number' | 'date' | 'tag' | 'badge' | 'custom';  // SDUI v1.1
    }>;
    rowActions?: string[];  // 'edit', 'delete', 'view' ë“± (í•˜ìœ„ í˜¸í™˜ì„±)
    rowActionHandlers?: {  // SDUI v1.2: Action Engine ì—°ê²° (ê¶Œì¥)
      edit?: ActionDefinition;
      delete?: ActionDefinition;
      view?: ActionDefinition;
      [key: string]: ActionDefinition | undefined;
    };
    bulkActions?: string[];  // 'delete', 'export' ë“±
    pagination?: {
      pageSizeOptions?: number[];  // SDUI v1.1
      defaultPageSize?: number;  // SDUI v1.1
      pageSize?: number;  // í•˜ìœ„ í˜¸í™˜ì„±
    };
    selection?: 'none' | 'single' | 'multiple';  // SDUI v1.1
    virtualization?: boolean;
  };
}
```

âš ï¸ ì¤‘ìš”: SchemaTable `filters` prop ì „ë‹¬ ê·œì¹™ (í˜ì´ì§€ë„¤ì´ì…˜ ë¦¬ì…‹ ë²„ê·¸ ë°©ì§€)

- SchemaTableì€ ë‚´ë¶€ì ìœ¼ë¡œ "filtersê°€ ë³€ê²½ë˜ë©´ 1í˜ì´ì§€ë¡œ ë¦¬ì…‹"ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
- ì´ ë™ì‘ì€ `filters` ê°ì²´ì˜ **ì°¸ì¡°(Referential Equality)** ì— ì˜ì¡´í•˜ë¯€ë¡œ,
  ë Œë”ë§ˆë‹¤ ìƒˆ ê°ì²´ ë¦¬í„°ëŸ´ì„ ìƒì„±í•˜ì—¬ ì „ë‹¬í•˜ë©´ í˜ì´ì§€ê°€ ë§¤ë²ˆ 1ë¡œ ë¦¬ì…‹ë˜ì–´ **2í˜ì´ì§€ë¡œ ì „í™˜ì´ ë¶ˆê°€ëŠ¥**í•´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

âœ… ê¶Œì¥ íŒ¨í„´:
- `filters`ëŠ” `useMemo`ë¡œ ì•ˆì •í™”í•´ì„œ ì „ë‹¬í•©ë‹ˆë‹¤. (ê°’ì´ ì‹¤ì œë¡œ ë°”ë€” ë•Œë§Œ ê°ì²´ê°€ ë°”ë€Œë„ë¡)

ì˜ˆ:
```tsx
const tableFilters = useMemo(() => ({
  ...(filter.status && { status: filter.status }),
  ...(filter.grade && { grade: filter.grade }),
  ...(filter.search && { search: filter.search }),
}), [filter.status, filter.grade, filter.search]);

<SchemaTable filters={tableFilters} ... />
```

âš ï¸ ì¤‘ìš”: rowActionHandlers ì‚¬ìš© ì˜ˆì‹œ (SDUI v1.2)

TableSchemaì—ì„œ rowActionsì˜ 'edit' í´ë¦­ ì‹œ Action Engineìœ¼ë¡œ ì—°ê²°í•˜ëŠ” ë°©ë²•:

```typescript
{
  "type": "table",
  "table": {
    "rowActions": ["edit", "delete"],  // í•˜ìœ„ í˜¸í™˜ì„± ìœ ì§€
    "rowActionHandlers": {
      "edit": {
        "event": "onRowAction",
        "type": "openModal",
        "schemaKey": "teacher.edit"  // ìŠ¤í‚¤ë§ˆ í‚¤ë¡œ ëª¨ë‹¬ í¼ ë¡œë“œ
      },
      "delete": {
        "event": "onRowAction",
        "type": "confirm",
        "titleKey": "DELETE.CONFIRM.TITLE",
        "confirmMessageKey": "DELETE.CONFIRM.MESSAGE",
        "actions": [
          {
            "event": "onConfirm",
            "type": "api.call",
            "endpoint": "/api/teachers/{rowId}",
            "method": "DELETE"
          },
          {
            "event": "onConfirmSuccess",
            "type": "toast",
            "messageKey": "DELETE.SUCCESS",
            "variant": "success"
          }
        ]
      }
    }
  }
}
```

â†’ ìƒì„¸ ê°€ì´ë“œë¼ì¸ì€ `docu/UI_ê°€ì´ë“œë¼ì¸_ëª¨ë‹¬_í˜ì´ì§€_ì„ íƒ.md` ì°¸ì¡°

16.3 DetailSchema

```typescript
export interface DetailSchema extends BaseSchema {
  type: 'detail';
  detail: {
    fields: FormFieldSchema[];  // ì½ê¸° ì „ìš© í•„ë“œ
    layout?: LayoutSchema;
  };
}
```

16.4 FilterSchema

```typescript
export interface FilterSchema extends BaseSchema {
  type: 'filter';
  filter: {
    fields: FormFieldSchema[];  // í•„í„° ì…ë ¥ í•„ë“œ
    layout?: LayoutSchema;
  };
}
```

16.4-1. SchemaFilter ì„±ëŠ¥ ìµœì í™” (ê²€ìƒ‰ í•„ë“œ ë””ë°”ìš´ì‹±)

[ë¶ˆë³€ ê·œì¹™] SchemaFilter ì»´í¬ë„ŒíŠ¸ëŠ” ê²€ìƒ‰ í•„ë“œì— ìë™ìœ¼ë¡œ ë””ë°”ìš´ì‹±ì„ ì ìš©í•©ë‹ˆë‹¤.

ê²€ìƒ‰ í•„ë“œ ìë™ ê°ì§€:
- í•„ë“œ ì´ë¦„ì´ 'search', 'query', 'keyword', 'q', 'term'ì¸ ê²½ìš°
- ë˜ëŠ” kindê°€ 'text'ì´ê³  ì´ë¦„ì— 'search'ê°€ í¬í•¨ëœ ê²½ìš°

ë””ë°”ìš´ì‹± ë™ì‘:
- ê²€ìƒ‰ í•„ë“œ: 300ms ë””ë°”ìš´ì‹± ì ìš© (ê¸°ë³¸ê°’, searchDebounceDelay propìœ¼ë¡œ ë³€ê²½ ê°€ëŠ¥)
- ì¼ë°˜ í•„í„°(select, date ë“±): ì¦‰ì‹œ ì ìš©

ì‚¬ìš© ì˜ˆì‹œ:
```typescript
<SchemaFilter
  schema={filterSchema}
  onFilterChange={handleFilterChange}
  searchDebounceDelay={300}  // ì„ íƒì : ë””ë°”ìš´ìŠ¤ ì§€ì—° ì‹œê°„ (ê¸°ë³¸ê°’: 300ms)
/>
```

ì„±ëŠ¥ íš¨ê³¼:
- íƒ€ì´í•‘ ì¤‘ ë¶ˆí•„ìš”í•œ API í˜¸ì¶œ ë°©ì§€
- ì‚¬ìš©ìê°€ ì…ë ¥ì„ ë©ˆì¶˜ í›„ì—ë§Œ ê²€ìƒ‰ ì‹¤í–‰
- React Query ìºì‹œì™€ í•¨ê»˜ ì‚¬ìš© ì‹œ ìµœì ì˜ ì„±ëŠ¥ ì œê³µ

16.5 WidgetSchema

```typescript
export interface WidgetSchema extends BaseSchema {
  type: 'widget';
  widget: {
    componentType?: string;  // Custom Widget íƒ€ì…
    dataSource?: {
      type: 'api';
      endpoint: string;
    };
    refreshInterval?: number;  // ìë™ ìƒˆë¡œê³ ì¹¨ ê°„ê²© (ms)
  };
}
```

16.6 Renderer Factory

```typescript
// packages/schema-engine/src/renderer/factory.tsx
import { SchemaForm } from './react/SchemaForm';
import { SchemaTable } from './react/SchemaTable';
import { SchemaDetail } from './react/SchemaDetail';
import { SchemaFilter } from './react/SchemaFilter';
import { SchemaWidget } from './react/SchemaWidget';

export function SchemaRenderer({ schema, ...props }) {
  switch (schema.type) {
    case 'form':
      return <SchemaForm schema={schema as FormSchema} {...props} />;
    case 'table':
      return <SchemaTable schema={schema as TableSchema} {...props} />;
    case 'detail':
      return <SchemaDetail schema={schema as DetailSchema} {...props} />;
    case 'filter':
      return <SchemaFilter schema={schema as FilterSchema} {...props} />;
    case 'widget':
      return <SchemaWidget schema={schema as WidgetSchema} {...props} />;
    default:
      throw new Error(`Unsupported schema type: ${schema.type}`);
  }
}
```

17. Custom Widget ë™ì  ë¡œë”© ë° ìœ íš¨ì„± ê²€ì¦

17.1 Widget Not Found ì²˜ë¦¬

ìŠ¤í‚¤ë§ˆì—ì„œ customComponentTypeì„ ì˜ëª» ì…ë ¥í•˜ë©´ ì•±ì´ ì£½ì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ,
ë°˜ë“œì‹œ "Widget Not Found" ì²˜ë¦¬ê°€ í•„ìš”í•©ë‹ˆë‹¤.

êµ¬í˜„:
- loadWidget()ì´ nullì„ ë°˜í™˜í•˜ë©´ ì—ëŸ¬ UI í‘œì‹œ
- ë“±ë¡ëœ ìœ„ì ¯ ëª©ë¡ì„ ì—ëŸ¬ ë©”ì‹œì§€ì— í¬í•¨
- ì‚¬ìš©ìì—ê²Œ ëª…í™•í•œ ì•ˆë‚´ ë©”ì‹œì§€ ì œê³µ

17.2 ìœ„ì ¯ ë“±ë¡ ê·œì•½

```typescript
// ì•± ì´ˆê¸°í™” ì‹œ ìœ„ì ¯ ë“±ë¡
import { registerWidget } from '@schema-engine/widgets';

registerWidget('CreditCardInput', () => import('@widgets-academy/CreditCardInput'));
registerWidget('BankTransferInput', () => import('@widgets-academy/BankTransferInput'));
```

17.3 ìœ„ì ¯ ë¡œë”© ì‹¤íŒ¨ ì‹œ UX

- ë¡œë”© ì¤‘: "ìœ„ì ¯ ë¡œë”© ì¤‘: {componentType}..." ë©”ì‹œì§€ í‘œì‹œ
- ì‹¤íŒ¨ ì‹œ: ì—ëŸ¬ ë°•ìŠ¤ í‘œì‹œ (ë¹¨ê°„ìƒ‰ í…Œë‘ë¦¬, ëª…í™•í•œ ë©”ì‹œì§€)
- í•„ë“œëŠ” ë Œë”ë§ë˜ì§€ ì•ŠìŒ (ì•ˆì „í•œ ì‹¤íŒ¨ ì²˜ë¦¬)

18. MultiConditionRule ì¤‘ì²© ì¡°ê±´ (í–¥í›„ ê°œì„ )

í˜„ì¬ êµ¬ì¡°:
```typescript
{
  conditions: [ConditionRule],
  logic: 'and' | 'or'
}
```

ì œí•œì‚¬í•­:
- A AND (B OR C) ì™€ ê°™ì€ ì¤‘ì²© ì¡°ê±´ í‘œí˜„ ë¶ˆê°€
- í˜„ì¬ëŠ” ë‹¨ì¼ ë ˆë²¨ AND/ORë§Œ ì§€ì›

í–¥í›„ ê°œì„  (SDUI v2.0):
- ì¤‘ì²© ì¡°ê±´ êµ¬ì¡° ì§€ì›
- ì˜ˆ: { conditions: [{ conditions: [...], logic: 'or' }, ...], logic: 'and' }
