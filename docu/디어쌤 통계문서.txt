📘 지역 기반 통계 시스템(Regional Analytics System) — SRS + 기술문서 완전본

버전: v1.0
대상 시스템: 디어쌤 Multi-Tenant 학원관리 SaaS
목표: 학원 운영·매출·성장률·출결·마케팅 지표를 지역 단위로 비교/순위화하는 AI 기반 분석 시스템

⚠️ 중요: Phase별 구현 가이드라인
- 상용화 단계: 기본 지역 통계 기능과 고급 지역 통계 기능 모두 구현 예정 (지역순위, 지역 평균 대비 비교, 기본 히트맵, 기본 AI 인사이트, 고급 히트맵, 다중 지역 비교, AI 인사이트 고도화, 고급 지도 시각화) - 테이블 스키마 정의 완료, core_stores/core_regions 및 analytics.daily_store_metrics/daily_region_metrics 테이블 생성 마이그레이션 필요

0. 시스템 개요 (Overview)

지역 기반 통계 시스템은 학원 데이터를 기반으로
지역 단위(동/구/권역)의 운영 수준, 매출 수준, 성장률, 학생 수 변동, 출결 패턴, 과목별 성과를
실시간 또는 주기적으로 분석하여 랭킹/비교/리포트 형태로 제공하는 분석 모듈이다.

관리자(원장/본사)는 이 시스템을 통해 다음을 수행한다:

우리 학원이 **지역 상위 몇 %**인지 확인

지역 평균 대비 강점/약점 분석

어떤 과목/반/시간대가 경쟁력 있는지 분석

지역 학원 운영 패턴 기반 마케팅 전략 수립

서버가 월간 경영 리포트 생성 (AI 호출 포함)

이 기능은 출결버스·결제버스 등 기존 시스템에는 존재하지 않는 시장차별화 기능이다.

1. 요구사항 명세서 (SRS)
1.1 기능 요구사항 (Functional Requirements)
✔ FR-01. 지역 단위 기준 체계 구축

시스템은 테넌트(학원)의 주소를 기반으로 다음 레벨의 지역이 자동 매핑되어야 한다.

행정동

구

시/도

권역(커스텀 클러스터)

→ 지역 간 비교/랭킹의 최소 단위는 행정동, 최대 단위는 시/도/권역이다.

✔ FR-02. 학원 운영 지표 수집/산출

다음 운영 지표는 학원별로 일/월 단위로 집계한다.

지표	설명
학생 수	현재 재원생 수
신규 등록	이번 달 등록한 학생 수
퇴원/휴원	이탈 학생 수
출석률	전체 출석 기록 기반
지각률/결석률	출결 데이터 기반
반당 평균 인원	반-정원 대비 운영 효율
✔ FR-03. 매출 지표 수집/산출

알림뱅킹/카드/간편결제 기반 실제 매출 정보를 집계한다.

지표	설명
월 매출	실수납액 기준
예정 매출	청구액 기준
미납률	미납액 / 전체 청구액
ARPU	학생 1인당 평균 매출
✔ FR-04. 성장 지표 산출

월간 학생 성장률

월간 매출 성장률

신규 전환률(문의 → 등록)

재등록률(연속 등록)

✔ FR-05. 지역 기반 비교 / 랭킹 기능

아래 지표들은 지역 단위에서 비교되어 퍼센트 또는 순위로 제공된다.

학생 수 기준 지역순위

매출 기준 지역순위

성장률 기준 지역순위

출석률 기준 지역순위

과목별 매출 순위

연령/학년 구성 비교

예:

“대치동 학생 수 기준 상위 12%”
“강남구 국어 매출 상위 8%”

✔ FR-06. 지역 히트맵 시각화

학생 수, 매출, 성장률 등 지표를 Heatmap으로 표현

예:

“강남구 3개동에서 학생 성장률 급등”

“송파구 남부권 출결률 감소”

✔ FR-07. 시간대·요일별 출석 패턴 분석

지역 단위로:

출석 피크 시간대

지각/결석 패턴

요일별 출석률

토요/일요 운영 형태

✔ FR-08. AI 기반 운영 인사이트 제공

서버가 데이터 기반으로 학원 경영 인사이트를 생성 (AI 호출 포함):

예:

“학생 수는 지역 평균보다 상위 23%지만 신규 등록률은 하위 30%. 홍보 강화 필요.”
“월요일 4~7시 지역 피크 시간대 대비 우리 학원 반 배치 부족.”

✔ FR-09. 월간 경영 리포트 생성

PDF 또는 대시보드 형태로 서버가 생성 (AI 호출 포함):

핵심 지표 요약

지역 대비 평가

이번달 개선점

업종 특성 기반 추천 전략

✔ FR-10. Franchise 본사진 실시간 모니터링

지점별 지역 순위

권역별 성장 맵

브랜드 전체 평균과 비교

1.2 비기능 요구사항 (NFR)
✔ NFR-01. 멀티테넌트 구조

RLS 기반 데이터 분리 원칙 준수.

✔ NFR-02. 성능

집계 작업은 batch job / materialized view 기반

지역 랭킹 계산은 1초 이내 반환

✔ NFR-03. 확장성

10,000 학원 이상 동시 운영 가능

✔ NFR-04. 정확성

출결/매출/성장 데이터는 소스와 100% 일치해야 함

✔ NFR-05. 보안

학원 간 운영 데이터는 절대 공유 불가

지역 비교는 완전 비식별화된 통계 기반으로만 제공

2. 시스템 아키텍처 기술문서 (Technical Architecture Spec)
2.1 시스템 전체 구조
[Academy App] ──→ [Event/Data Collector] ──→ [Metrics Processor] ──→ [Regional Metrics Warehouse]
                                                       │
                                                       ↓
                                                  [Ranking Engine]
                                                       │
                                                       ↓
                                            [Regional Analytics API Layer]
                                                       │
                                    ┌──────────────────┴──────────────────┐
                                    │                                     │
                            [Regional Dashboard]                    [AI Insights Engine]

2.2 데이터 파이프라인 구성(ETL/ELT)
Step1. Raw Data 수집

출결, 수납, 반정보, 학생정보, 등록정보 →

Step2. Standardization

주소 → 행정동 코드

학생정보 → 연령/학년 분류

수납정보 → 과목/상품 그룹핑

Step3. 지표 계층화

운영지표

매출지표

성장지표

지역지표

Step4. 지역 단위 Aggregation

행정동별 지표 집계

구별 지표 집계

권역별 집계

Step5. Ranking Engine 실행

Percentile ranking 계산

(우리 학원 값 / 전체 분포)

“상위 X%” 형식 생성

Step6. Materialized Views 구성

빠른 조회를 위해 미리 계산된 테이블 생성

2.3 DB 스키마(High-level)

⚠️ 중요: 테이블 네이밍 정본 규칙
- `analytics.daily_store_metrics` (매장 단위 일별 KPI, 정본)
- `analytics.daily_region_metrics` (지역 단위 집계 KPI, 정본)
- ~~regional_metrics_daily~~, ~~academy_metrics_daily~~ (구버전, 사용 금지)

📌 analytics.daily_region_metrics (정본)
Column	Description
region_code	지역 코드 (⚠️ 중요: `region_level`에 따라 의미가 달라짐. `region_level='dong'`일 때는 `location_code`(행정동 코드)와 동일한 의미. `region_level='gu_gun'`, `'si'`, `'region_zone'` 등 확장 시 각 레벨별 코드 의미가 다름. 정본은 `location_code`이며, `region_code`는 `region_level`별 코드의 대표 표기로 사용됨. 아키텍처 문서 정본 참조)
industry_type	업종 타입 (academy, salon, real_estate 등)
tenant_count	학원 수 (store_count >= 3 조건 필요)
student_count	전체 학생 수
avg_arpu	지역 ARPU
avg_attendance_rate	출석률 평균
date_kst	KST 기준 날짜
...

📌 analytics.daily_store_metrics (정본)

| tenant_id | store_id | student_count | revenue | attendance_rate | new_enrollments | date_kst | … |

📌 ranking_snapshot

| region_code | tenant_id | metric | percentile | rank | date |
⚠️ 중요: 정본은 `location_code`이며, `region_code`는 `region_level`별 코드의 대표 표기입니다. `region_level='dong'`일 때는 `location_code`와 동일한 의미이며, 다른 레벨 확장 시 각 레벨별 코드 의미가 다릅니다. 가능하면 `location_code` 사용 권장 (아키텍처 문서 정본 참조).

📌 ai_insights

| tenant_id | insight_text | created_at | severity |

2.4 Ranking Engine 알고리즘
Percentile Rank
P = (number_of_values_below / total) * 100

Normalized Composite Score

학생수 + 매출 + 성장률 → 종합 점수 산출
각 항목별 가중치는 학원 차원에서 조정 가능.

3. 화면/UI 기술 문서 (UX Spec)
3.1 학원장 대시보드 위젯 구성
📌 운영 현황 카드 4개

학생 수 / 지역순위

매출 / 지역순위

출석률 / 지역순위

성장률 / 지역순위

📌 지역 비교 차트

우리 학원 vs 지역 평균

우리 학원 vs 상위 10% 평균

📌 지역 히트맵

지역별 성장률

지역별 신규등록

지역별 학생구성

📌 최근 인사이트 (AI)

“00과목 신규 등록률 개선 필요”

“출석률이 지역 중위권 대비 +4% 우수”

📌 학원 경영 리포트 (PDF/SDUI)

서버가 생성 (AI 호출 포함).

4. AI 분석/인사이트 엔진
✔ 데이터 기반 인사이트 유형

지표 이상 탐지(Anomaly Detection)

지역 평균 대비 차이 분석

과목별 강점 분석

요일/시간대 패턴 분석

학생 이탈 위험도 분석

신규 등록 가능 시간대 자동 추천

✔ 모델 구조

Rule-based + Statistical model 혼합

고급 버전에서는 ML 모델 적용 가능

5. 운영/보안 설계
✔ RLS 기반 지역 통계 접근 제한

개별 학원 데이터는 절대 노출되지 않음

지역 집계는 비식별 데이터만 포함

권한(Role)에 따라 접근 차등 제공

✔ 캐싱/성능

지역 통계 API는 1~3초 캐싱

Materialized View로 즉시 응답

6. 상용화 단계 범위 정의

⚠️ 중요: 상용화 단계에 포함되는 기본 기능입니다.

상용화 단계 기본 기능:
- 학생 수 / 매출 / 출석률 지역순위
- 지역 평균 대비 비교 차트
- 행정동 기준 기본 Heatmap
- AI 인사이트 3종 (기본형)
- 월간 리포트 초안

상용화 단계 고급 기능:
- 고급 히트맵 (다중 지표, 시계열)
- 다중 지역 비교
- AI 인사이트 고도화
- 고급 지도 시각화

이후 Phase별로 기능 추가로 확장.

🎯 결론

당신이 말한 “지역 기반 통계”는 단순 분석 기능이 아니라

학원 운영 + 경영 분석 + 지역 경쟁 분석 + AI 인사이트까지 통합한
학원 경영 전략 시스템 전체

이며,
위 문서는 그 전체를 구현하기 위한 완전한 SRS + Technical Spec 최종본이다.
