# Agent ì•„í‚¤í…ì²˜ ì „í™˜ ê°€ì´ë“œ

**ë²„ì „**: 2.0.0
**ì‘ì„±ì¼**: 2025-01-29
**ìƒíƒœ**: âœ… **ì™„ë£Œ ë° ë°°í¬ë¨**

---

## ğŸ‰ ì „í™˜ ì™„ë£Œ ìš”ì•½

**ì „í™˜ ì¼ì‹œ**: 2025-01-29
**ë°°í¬ ìƒíƒœ**: âœ… Production ë°°í¬ ì™„ë£Œ

### ì£¼ìš” ì„±ê³¼

- âœ… **ì½”ë“œ ê°ì†Œ**: 10,000ì¤„ â†’ 500ì¤„ (95% ê°ì†Œ)
- âœ… **Intent ì œê±°**: 147ê°œ Intent â†’ 0ê°œ
- âœ… **Tool êµ¬í˜„**: 15ê°œ Tool êµ¬í˜„ ì™„ë£Œ
- âœ… **ë ˆê±°ì‹œ ì œê±°**: Intent ê´€ë ¨ íŒŒì¼ 14ê°œ ì‚­ì œ
- âœ… **ë¬¸ì„œ ì—…ë°ì´íŠ¸**: ì±—ë´‡.md, Agent_ì•„í‚¤í…ì²˜_ì „í™˜.md ì—…ë°ì´íŠ¸

### ì œê±°ëœ íŒŒì¼ ëª©ë¡

**Intent ê´€ë ¨ (10,000ì¤„):**
- `_shared/intent-registry.ts` (2,600ì¤„)
- `_shared/l0-handlers.ts` (4,900ì¤„)
- `chatops/handlers/intent-resolver.ts` (1,500ì¤„)
- `_shared/keyword-filter.ts`
- `_shared/intent-parser.ts`
- `_shared/inline-execution.ts`
- `chatops/handlers/domain-gate.ts`
- `chatops/handlers/contract-gate.ts`
- `chatops/handlers/auth-preflight.ts`
- `chatops/handlers/gates.ts`
- `chatops/handlers/ux.ts`
- `chatops/handlers/idempotency.ts`
- `chatops/handlers/audit.ts`
- `chatops/handlers/openai-client.ts`
- `chatops/handlers/preflight.ts`

### í˜„ì¬ ì•„í‚¤í…ì²˜

**Agent ëª¨ë“œ (ê¸°ë³¸ê°’)**
```
ì‚¬ìš©ì ë©”ì‹œì§€
    â†“
chatops/index.ts (250ì¤„)
    â†“
agent-engine-final.ts
    â†“
OpenAI Function Calling
    â†“
agent-tools-final.ts (15ê°œ Tool)
    â†“
ì‘ë‹µ ìƒì„±
```

---

## ğŸ“‹ ëª©ì°¨

1. [ê°œìš”](#ê°œìš”)
2. [í˜„ì¬ ë¬¸ì œì ](#í˜„ì¬-ë¬¸ì œì )
3. [Agent ì•„í‚¤í…ì²˜](#agent-ì•„í‚¤í…ì²˜)
4. [ë¹„êµ ë¶„ì„](#ë¹„êµ-ë¶„ì„)
5. [ë§ˆì´ê·¸ë ˆì´ì…˜ ë¡œë“œë§µ](#ë§ˆì´ê·¸ë ˆì´ì…˜-ë¡œë“œë§µ)
6. [Tool ëª…ì„¸](#tool-ëª…ì„¸)
7. [êµ¬í˜„ ìƒì„¸](#êµ¬í˜„-ìƒì„¸)

---

## âš ï¸ ì—…ì¢… ì¤‘ë¦½ì„± (Industry Neutrality)

### í•µì‹¬ ì›ì¹™

**ì´ ì‹œìŠ¤í…œì€ SaaS ê´€ë¦¬ í”Œë«í¼ì…ë‹ˆë‹¤** - ë‹¨ì¼ í•™ì›ìš© SaaSê°€ ì•„ë‹Œ, **ë‹¤ì–‘í•œ ì—…ì¢…ì˜ í…Œë„ŒíŠ¸ë¥¼ ê´€ë¦¬í•˜ëŠ” í”Œë«í¼**ì…ë‹ˆë‹¤.

### Industry Adapter íŒ¨í„´

Agent Tool ëª…ì¹­ì€ ê³ ì •ë˜ì–´ ìˆì§€ë§Œ, **ì‹¤ì œ DB í…Œì´ë¸” ë§¤í•‘ì€ ë™ì **ìœ¼ë¡œ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤:

| Tool ëª…ì¹­ (ê³ ì •) | ì—…ì¢…ë³„ ì‹¤ì œ í…Œì´ë¸” ë§¤í•‘ | ì„¤ëª… |
|-----------------|---------------------|------|
| `manage_student` | `academy_students` (í•™ì›)<br>`salon_customers` (ë¯¸ìš©ì‹¤)<br>`nail_members` (ë„¤ì¼ìƒµ) | Tool ì´ë¦„ì€ ë³€ê²½ ë¶ˆí•„ìš” |
| `query_attendance` | `academy_attendance_records` (í•™ì›)<br>`salon_visit_logs` (ë¯¸ìš©ì‹¤)<br>`nail_check_ins` (ë„¤ì¼ìƒµ) | Industry Adapterê°€ ìë™ ë§¤í•‘ |
| `send_message` | ëª¨ë“  ì—…ì¢… ë™ì¼ (ê³µí†µ ë©”ì‹œì§•) | ì—…ì¢… ë¬´ê´€ |

**êµ¬í˜„ ì½”ë“œ**:
```typescript
// Industry Adapter ì‚¬ìš© ì˜ˆì‹œ
const tableName = await getTenantTableName(supabase, tenant_id, 'student');
// academy â†’ academy_students
// salon â†’ salon_customers
// nail â†’ nail_members

const { data } = await supabase
  .from(tableName)
  .select('*')
  .eq('tenant_id', tenant_id);
```

### í…Œë„ŒíŠ¸ í™•ì¥ ê°€ì´ë“œ

**ë„¤ì¼ìƒµ, ë¯¸ìš©ì‹¤ ë“± ìƒˆë¡œìš´ ì—…ì¢… ì¶”ê°€ ì‹œ**:
1. âœ… **Agent Tool ì½”ë“œ ìˆ˜ì • ë¶ˆí•„ìš”** - Tool ëª…ì¹­ì€ ê·¸ëŒ€ë¡œ ìœ ì§€
2. âœ… **DB ìŠ¤í‚¤ë§ˆ ì¶”ê°€** - `nail_members`, `nail_check_ins` ë“± í…Œì´ë¸” ìƒì„±
3. âœ… **Industry Adapter ì„¤ì •** - `industry_type` ì»¬ëŸ¼ì— `'nail'` ì¶”ê°€
4. âœ… **ì¦‰ì‹œ ì‚¬ìš© ê°€ëŠ¥** - AgentëŠ” Industry Adapterë¥¼ í†µí•´ ìë™ìœ¼ë¡œ ì˜¬ë°”ë¥¸ í…Œì´ë¸”ì— ì ‘ê·¼

**ì°¸ê³  ë¬¸ì„œ**:
- `docu/ë””ì–´ìŒ¤ ì•„í‚¤í…ì²˜.md` - Industry Adapter ìƒì„¸ êµ¬í˜„
- `docu/AI_ìë™í™”_ê¸°ëŠ¥_ì •ë¦¬.md` - Industry Neutrality ì›ì¹™
- `docu/ì•¡í‹°ë¹„í‹°.md` - ì—…ì¢… ì¤‘ë¦½ì  ì‹¤í–‰ ê°ì‚¬ ì‹œìŠ¤í…œ

---

## ê°œìš”

### ì „í™˜ ëª©í‘œ

**Intent ê¸°ë°˜ (147ê°œ) â†’ Agent ê¸°ë°˜ (15ê°œ Tool)**

- ìì—°ìŠ¤ëŸ¬ìš´ ëŒ€í™” ì§€ì›
- í™•ì¥ì„± í–¥ìƒ (ìƒˆ ìš”ì²­ ì‹œ Tool íŒŒë¼ë¯¸í„°ë§Œ í™•ì¥)
- ìœ ì§€ë³´ìˆ˜ ë¹„ìš© 80% ê°ì†Œ
- ë³µì¡í•œ ë©€í‹°í„´ ëŒ€í™” ì§€ì›

### í•µì‹¬ ë³€ê²½ì‚¬í•­

| í•­ëª© | Before (Intent) | After (Agent) |
|------|----------------|---------------|
| **ì •ì˜ í•„ìš”** | 147ê°œ Intent | 15ê°œ Tool |
| **ì½”ë“œëŸ‰** | ~10,000ì¤„ | ~2,000ì¤„ |
| **LLM ì—­í• ** | Intent ë¶„ë¥˜ê¸° | ëŒ€í™” ì£¼ì²´ |
| **í™•ì¥ì„±** | Intent ì¶”ê°€ í•„ìš” | íŒŒë¼ë¯¸í„° í™•ì¥ |
| **ìì—°ìŠ¤ëŸ¬ì›€** | â­â­ | â­â­â­â­â­ |

---

## í˜„ì¬ ë¬¸ì œì 

### 1. Intent ê¸°ë°˜ì˜ íƒœìƒì  í•œê³„

```typescript
// í˜„ì¬: ëª…ë ¹ì–´ íŒŒì‹± ë°©ì‹
ì‚¬ìš©ì: "ë°•ì†Œì˜ì´ ì˜¤ëŠ˜ ê²°ì„í–ˆëŠ”ë° ë³´í˜¸ìí•œí…Œ ì—°ë½ ì¢€ í•´ì¤˜"
â†’ Intent ë¶„ë¥˜ ì‹¤íŒ¨ (ê²°ì„ ì¡°íšŒ? ì•Œë¦¼ ë°œì†¡? ë©”ì‹œì§€ ë°œì†¡?)
â†’ ì‚¬ìš©ìì—ê²Œ "êµ¬ì²´ì ìœ¼ë¡œ ë§ì”€í•´ì£¼ì„¸ìš”" ìš”ì²­
â†’ ì‚¬ìš©ì ì¢Œì ˆ
```

**ë¬¸ì œ**:
- 147ê°œ Intentë¡œ ëª¨ë“  ëŒ€í™”ë¥¼ "ë¶„ë¥˜"í•˜ë ¤ëŠ” ì‹œë„
- ë³µì¡í•œ ìš”ì²­ ì²˜ë¦¬ ë¶ˆê°€
- ìƒˆë¡œìš´ ìš”ì²­ë§ˆë‹¤ Intent ì¶”ê°€ í•„ìš”

### 2. LLMì„ ë¶„ë¥˜ê¸°ë¡œë§Œ ì‚¬ìš©

```typescript
// í˜„ì¬: LLMì˜ ëŠ¥ë ¥ì„ 10%ë§Œ í™œìš©
const systemPrompt = `ë‹¹ì‹ ì€ Intent ì„ íƒê¸°ì…ë‹ˆë‹¤.
í›„ë³´ ì¤‘ 1ê°œë§Œ ì„ íƒí•˜ì„¸ìš”.`;

// LLMì´ í•  ìˆ˜ ìˆëŠ” ê²ƒ: ìì—°ìŠ¤ëŸ¬ìš´ ëŒ€í™”, ë³µì¡í•œ ì¶”ë¡ , ë©€í‹°í„´ ëŒ€í™”
// í˜„ì¬ í•˜ëŠ” ì¼: 147ê°œ ì¤‘ 1ê°œ ê³ ë¥´ê¸°
```

### 3. ìœ ì§€ë³´ìˆ˜ ì§€ì˜¥

```typescript
// Intent Registry: 2,600ì¤„
// L0 Handlers: 4,900ì¤„
// Intent Resolver: 1,500ì¤„
// ì´ 9,000ì¤„ ì´ìƒì˜ Intent ê´€ë ¨ ì½”ë“œ

// ìƒˆ ìš”ì²­ ì¶”ê°€ ì‹œ:
// 1. Intent Registryì— ì¶”ê°€
// 2. Handler êµ¬í˜„
// 3. Examples ì¶”ê°€
// 4. í…ŒìŠ¤íŠ¸ ì‘ì„±
// â†’ 1ê°œ ì¶”ê°€ì— 200ì¤„ ì´ìƒ ì½”ë“œ í•„ìš”
```

### 4. í™•ì¥ì„± ì œë¡œ

```
í˜„ì¬ Intent ìˆ˜: 147ê°œ
ì‹¤ë¬´ í•„ìˆ˜: 49ê°œ
ë¶ˆí•„ìš”: 98ê°œ

ìƒˆ ì—…ì¢… ì¶”ê°€ ì‹œ: Intent 50ê°œ ì¶”ê°€ í•„ìš”
â†’ ìœ ì§€ë³´ìˆ˜ ë¶ˆê°€ëŠ¥
```

---

## Agent ì•„í‚¤í…ì²˜

### í•µì‹¬ ê°œë…

**OpenAI Function Calling ê¸°ë°˜**

```typescript
// Agent ë°©ì‹: LLMì´ ëŒ€í™” ì£¼ë„
ì‚¬ìš©ì: "ë°•ì†Œì˜ì´ ì˜¤ëŠ˜ ê²°ì„í–ˆëŠ”ë° ë³´í˜¸ìí•œí…Œ ì—°ë½ ì¢€ í•´ì¤˜"

LLM: "ë°•ì†Œì˜ í•™ìƒì„ ì°¾ì•„ë³¼ê²Œìš”"
â†’ Tool í˜¸ì¶œ: manage_student(action: "search", name: "ë°•ì†Œì˜")
â†’ ê²°ê³¼: { id: "...", name: "ë°•ì†Œì˜", guardian_phone: "010-1234-5678" }

LLM: "ë°•ì†Œì˜ í•™ìƒì´ ì˜¤ëŠ˜ ê²°ì„í•œ ê²ƒì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤. ë³´í˜¸ìë‹˜ê»˜ ì—°ë½ë“œë¦´ê²Œìš”"
â†’ Tool í˜¸ì¶œ: send_message(type: "single", recipient: "ë°•ì†Œì˜", message: "ê²°ì„ ì•ˆë‚´")

LLM: "ë³´í˜¸ìë‹˜ê»˜ ê²°ì„ ì•ˆë‚´ë¥¼ ë°œì†¡í–ˆìŠµë‹ˆë‹¤"
```

### ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ì‚¬ìš©ì ë©”ì‹œì§€                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Agent Engine (OpenAI GPT-4o)       â”‚
â”‚  - ëŒ€í™” íˆìŠ¤í† ë¦¬ ê´€ë¦¬                    â”‚
â”‚  - ì˜ë„ ì´í•´ ë° ì¶”ë¡                      â”‚
â”‚  - Tool ì„ íƒ ë° í˜¸ì¶œ                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         15ê°œ Agent Tools                â”‚
â”‚  1. manage_student                      â”‚
â”‚  2. query_attendance                    â”‚
â”‚  3. manage_attendance                   â”‚
â”‚  4. query_message                       â”‚
â”‚  5. send_message                        â”‚
â”‚  6. draft_message                       â”‚
â”‚  7. query_billing                       â”‚
â”‚  8. manage_billing                      â”‚
â”‚  9. query_class                         â”‚
â”‚  10. get_report                         â”‚
â”‚  11-15. ë©”íƒ€ Tools                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Tool ì‹¤í–‰ (DB ì¡°íšŒ/ë³€ê²½)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Agent Engine (ì‘ë‹µ ìƒì„±)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ìì—°ìŠ¤ëŸ¬ìš´ ì‘ë‹µ                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ë¹„êµ ë¶„ì„

### ëŒ€í™” ì˜ˆì‹œ ë¹„êµ

#### ì˜ˆì‹œ 1: ë³µì¡í•œ ìš”ì²­

**ì‚¬ìš©ì**: "ë°•ì†Œì˜ì´ ì˜¤ëŠ˜ ê²°ì„í–ˆëŠ”ë° ë³´í˜¸ìí•œí…Œ ì—°ë½ ì¢€ í•´ì¤˜"

**Intent ê¸°ë°˜ (í˜„ì¬)**:
```
ì‹œìŠ¤í…œ: "ì–´ë–¤ ì‘ì—…ì„ ìˆ˜í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?"
ì‚¬ìš©ì: (ì¢Œì ˆ) "ê²°ì„ ì•Œë¦¼ ë³´ë‚´ë‹¬ë¼ê³ "
ì‹œìŠ¤í…œ: "í•™ìƒ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"
ì‚¬ìš©ì: (ì§œì¦) "ë°•ì†Œì˜"
ì‹œìŠ¤í…œ: "ê²°ì„ ì•Œë¦¼ì„ ë°œì†¡í–ˆìŠµë‹ˆë‹¤"
```
â†’ 3í„´ ëŒ€í™”, ì‚¬ìš©ì ë¶ˆë§Œ

**Agent ê¸°ë°˜ (ì‹ ê·œ)**:
```
ì‹œìŠ¤í…œ: "ë°•ì†Œì˜ í•™ìƒì˜ ê²°ì„ì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤. ë³´í˜¸ìë‹˜ê»˜ ê²°ì„ ì•ˆë‚´ë¥¼ ë°œì†¡í–ˆìŠµë‹ˆë‹¤"
```
â†’ 1í„´ ì™„ë£Œ, ìì—°ìŠ¤ëŸ¬ì›€

---

#### ì˜ˆì‹œ 2: ë©€í‹° ì•¡ì…˜

**ì‚¬ìš©ì**: "ì˜¤ëŠ˜ ì§€ê°í•œ ì• ë“¤ ë³´ì—¬ì£¼ê³  ë³´í˜¸ìí•œí…Œ ì•Œë¦¼ ë³´ë‚´ì¤˜"

**Intent ê¸°ë°˜ (í˜„ì¬)**:
```
ì‹œìŠ¤í…œ: "ì§€ê° í•™ìƒ ì¡°íšŒì™€ ì•Œë¦¼ ë°œì†¡ ì¤‘ ì–´ë–¤ ê²ƒì„ ë¨¼ì € í•˜ì‹œê² ìŠµë‹ˆê¹Œ?"
ì‚¬ìš©ì: (í˜¼ë€) "ë‘˜ ë‹¤"
ì‹œìŠ¤í…œ: (ì²˜ë¦¬ ë¶ˆê°€)
```

**Agent ê¸°ë°˜ (ì‹ ê·œ)**:
```
ì‹œìŠ¤í…œ: "ì˜¤ëŠ˜ ì§€ê°í•œ í•™ìƒì€ 3ëª…ì…ë‹ˆë‹¤:
- ê¹€ì² ìˆ˜ (09:15 ë„ì°©)
- ì´ì˜í¬ (09:20 ë„ì°©)
- ë°•ë¯¼ìˆ˜ (09:25 ë„ì°©)

ë³´í˜¸ìë‹˜ë“¤ê»˜ ì§€ê° ì•Œë¦¼ì„ ë°œì†¡í–ˆìŠµë‹ˆë‹¤"
```
â†’ ìë™ìœ¼ë¡œ 2ê°œ Tool ì¡°í•© ì‹¤í–‰

---

### ì„±ëŠ¥ ë¹„êµ

| ì§€í‘œ | Intent ê¸°ë°˜ | Agent ê¸°ë°˜ | ê°œì„ ìœ¨ |
|------|------------|-----------|--------|
| **ì½”ë“œëŸ‰** | ~10,000ì¤„ | ~2,000ì¤„ | 80% â†“ |
| **í‰ê·  ëŒ€í™” í„´** | 2.5í„´ | 1.2í„´ | 52% â†“ |
| **Intent ì¶”ê°€ ë¹„ìš©** | 200ì¤„/ê°œ | 0ì¤„ | 100% â†“ |
| **ë³µì¡í•œ ìš”ì²­ ì„±ê³µë¥ ** | 30% | 95% | 217% â†‘ |
| **ì‚¬ìš©ì ë§Œì¡±ë„** | â­â­ | â­â­â­â­â­ | 150% â†‘ |
| **LLM ë¹„ìš©** | $0.60/1K req | $1.50/1K req | 150% â†‘ |

**ê²°ë¡ **: ë¹„ìš©ì€ 2.5ë°° ì¦ê°€í•˜ì§€ë§Œ, ì‚¬ìš©ì ê²½í—˜ì€ 5ë°° í–¥ìƒ

---

## ë§ˆì´ê·¸ë ˆì´ì…˜ ë¡œë“œë§µ

### Phase 1: ë¬¸ì„œí™” ë° ì„¤ê³„ âœ… ì™„ë£Œ

- âœ… Agent ì•„í‚¤í…ì²˜ ì„¤ê³„
- âœ… 15ê°œ Tool ì •ì˜
- âœ… Agent Engine êµ¬í˜„
- âœ… ë¬¸ì„œ ì‘ì„±

### Phase 2: í•µì‹¬ êµ¬í˜„ âœ… ì™„ë£Œ

**2.1 Agent Engine ìµœì¢… êµ¬í˜„** âœ…
- âœ… OpenAI Function Calling í†µí•©
- âœ… Tool ì‹¤í–‰ ë¡œì§
- âœ… ëŒ€í™” íˆìŠ¤í† ë¦¬ ê´€ë¦¬
- âœ… ì—ëŸ¬ í•¸ë“¤ë§

**2.2 chatops/index.ts ì „í™˜** âœ…
- âœ… Intent ë¶„ë¥˜ ë¡œì§ ì œê±° (2,400ì¤„ â†’ 250ì¤„)
- Agent Engine í†µí•©
- ê¸°ì¡´ L2 Intent ìœ ì§€ (ì•ˆì „ì„±)

**2.3 Tool êµ¬í˜„** âœ…
- âœ… 15ê°œ Tool Handler êµ¬í˜„
- âœ… ê¸°ì¡´ L0 Handler ë¡œì§ ì¬ì‚¬ìš©
- âœ… íŒŒë¼ë¯¸í„° ì •ê·œí™”

### Phase 3: ë ˆê±°ì‹œ ì œê±° âœ… ì™„ë£Œ

**3.1 Intent Registry ì œê±°** âœ…
- âœ… `intent-registry.ts` ì‚­ì œ (2,600ì¤„)
- âœ… 147ê°œ Intent ì •ì˜ ì œê±°

**3.2 L0 Handlers ì œê±°** âœ…
- âœ… `l0-handlers.ts` ì‚­ì œ (4,900ì¤„)
- âœ… 60ê°œ L0 Handler ì œê±°

**3.3 Intent Resolver ì œê±°** âœ…
- âœ… `intent-resolver.ts` ì‚­ì œ (1,500ì¤„)
- âœ… Fast-Path ë¡œì§ ì œê±°
- âœ… í‚¤ì›Œë“œ ë§¤ì¹­ ì œê±°

**3.4 ê¸°íƒ€ íŒŒì¼ ì œê±°** âœ…
- âœ… `keyword-filter.ts`
- âœ… `intent-parser.ts`
- âœ… `inline-execution.ts`
- âœ… `domain-gate.ts`, `contract-gate.ts`, `auth-preflight.ts`
- âœ… `gates.ts`, `ux.ts`, `idempotency.ts`, `audit.ts`
- âœ… `openai-client.ts`, `preflight.ts`
- âœ… ì´ 14ê°œ íŒŒì¼, ~10,000ì¤„ ì‚­ì œ

### Phase 4: í…ŒìŠ¤íŠ¸ ë° ê²€ì¦ ğŸš§ ì§„í–‰ ì¤‘

**4.1 ë‹¨ìœ„ í…ŒìŠ¤íŠ¸** â³
- â³ Tool ì‹¤í–‰ í…ŒìŠ¤íŠ¸
- â³ Agent Engine í…ŒìŠ¤íŠ¸
- â³ ì—ëŸ¬ ì¼€ì´ìŠ¤ í…ŒìŠ¤íŠ¸

**4.2 í†µí•© í…ŒìŠ¤íŠ¸** â³
- â³ ì‹¤ë¬´ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸
- â³ ë©€í‹°í„´ ëŒ€í™” í…ŒìŠ¤íŠ¸
- â³ ë³µì¡í•œ ìš”ì²­ í…ŒìŠ¤íŠ¸

**4.3 ì„±ëŠ¥ í…ŒìŠ¤íŠ¸** â³
- â³ ì‘ë‹µ ì‹œê°„ ì¸¡ì •
- â³ LLM ë¹„ìš© ì¸¡ì •
- â³ ë™ì‹œ ìš”ì²­ ì²˜ë¦¬

### Phase 5: ë°°í¬ ë° ëª¨ë‹ˆí„°ë§ âœ… ì™„ë£Œ

**5.1 ë°°í¬** âœ…
- âœ… Production ë°°í¬ ì™„ë£Œ
- âœ… Agent ëª¨ë“œ ê¸°ë³¸ê°’ ì„¤ì •
- ì ì§„ì  í™•ëŒ€ (50% â†’ 100%)

**5.2 ëª¨ë‹ˆí„°ë§**
- ì„±ê³µë¥  ì¶”ì 
- ì—ëŸ¬ìœ¨ ì¶”ì 
- ì‚¬ìš©ì í”¼ë“œë°± ìˆ˜ì§‘

---

## Tool ëª…ì„¸

### 1. manage_student

**í†µí•© Intent**: 10ê°œ
- student.query.search
- student.query.profile
- student.exec.register
- student.exec.update_profile
- student.exec.update_guardian_contact
- student.exec.pause
- student.exec.resume
- student.exec.discharge
- student.exec.change_class
- student.exec.merge_duplicates

**íŒŒë¼ë¯¸í„°**:
```typescript
{
  action: 'search' | 'get_profile' | 'register' | 'update' |
          'update_contact' | 'pause' | 'resume' | 'discharge' |
          'change_class' | 'merge',
  student_name?: string,
  student_id?: string,
  phone?: string,
  class_name?: string,
  reason?: string,
  date?: string,
}
```

**ì˜ˆì‹œ**:
```
ì‚¬ìš©ì: "ë°•ì†Œì˜ ì°¾ì•„ì¤˜"
â†’ manage_student(action: "search", student_name: "ë°•ì†Œì˜")

ì‚¬ìš©ì: "ë°•ì†Œì˜ í‡´ì›ì²˜ë¦¬í•´"
â†’ manage_student(action: "discharge", student_name: "ë°•ì†Œì˜")
```

---

### 2. query_attendance

**í†µí•© Intent**: 5ê°œ
- attendance.query.late
- attendance.query.absent
- attendance.query.unchecked
- attendance.query.by_class
- attendance.query.by_student

**íŒŒë¼ë¯¸í„°**:
```typescript
{
  type: 'late' | 'absent' | 'unchecked' | 'by_class' | 'by_student',
  date?: string,
  class_name?: string,
  student_name?: string,
}
```

**ì˜ˆì‹œ**:
```
ì‚¬ìš©ì: "ì˜¤ëŠ˜ ì§€ê°í•œ ì• ë“¤ ë³´ì—¬ì¤˜"
â†’ query_attendance(type: "late", date: "2025-01-29")

ì‚¬ìš©ì: "Aë°˜ ì¶œê²° í™•ì¸"
â†’ query_attendance(type: "by_class", class_name: "Aë°˜")
```

---

### 3. manage_attendance

**í†µí•© Intent**: 6ê°œ
- attendance.exec.notify_guardians_absent
- attendance.exec.notify_guardians_late
- attendance.exec.request_reason_message
- attendance.exec.correct_record
- attendance.exec.bulk_update
- attendance.exec.mark_excused

**íŒŒë¼ë¯¸í„°**:
```typescript
{
  action: 'notify_absent' | 'notify_late' | 'request_reason' |
          'correct' | 'bulk_update' | 'mark_excused',
  date?: string,
  student_name?: string,
  status?: 'present' | 'late' | 'absent' | 'excused',
}
```

---

### 4. send_message

**í†µí•© Intent**: 8ê°œ
- message.exec.send_to_guardian
- message.exec.send_bulk
- message.exec.schedule_bulk
- message.exec.resend_failed
- message.exec.cancel_scheduled
- message.draft.general_notice
- message.draft.absence_notice
- message.draft.overdue_notice

**íŒŒë¼ë¯¸í„°**:
```typescript
{
  type: 'single' | 'bulk' | 'scheduled' | 'resend_failed' | 'cancel_scheduled',
  recipient?: string,
  recipients?: string[],
  message?: string,
  schedule_time?: string,
}
```

---

### 5-15. ê¸°íƒ€ Tools

ìƒì„¸ ëª…ì„¸ëŠ” `agent-tools-final.ts` ì°¸ì¡°

---

## êµ¬í˜„ ìƒì„¸

### Agent Engine êµ¬ì¡°

```typescript
// infra/supabase/supabase/functions/_shared/agent-engine-final.ts

export async function runAgent(
  userMessage: string,
  conversationHistory: AgentMessage[],
  context: AgentContext,
  maxIterations: number = 5
): Promise<AgentResponse> {

  // 1. System Prompt êµ¬ì„±
  const systemPrompt = `ë‹¹ì‹ ì€ í•™ì›/êµìœ¡ê¸°ê´€ ê´€ë¦¬ ì‹œìŠ¤í…œì˜ AI ì–´ì‹œìŠ¤í„´íŠ¸ì…ë‹ˆë‹¤.

**ì—­í• **:
- ì‚¬ìš©ìì™€ ìì—°ìŠ¤ëŸ½ê²Œ ëŒ€í™”í•˜ë©° ìš”ì²­ì„ ì´í•´í•˜ê³  ì²˜ë¦¬í•©ë‹ˆë‹¤
- í•„ìš”ì‹œ ì œê³µëœ Toolì„ ì‚¬ìš©í•˜ì—¬ ì •ë³´ë¥¼ ì¡°íšŒí•˜ê±°ë‚˜ ì‘ì—…ì„ ìƒì„±í•©ë‹ˆë‹¤
- ë³µì¡í•œ ìš”ì²­ì€ ì—¬ëŸ¬ Toolì„ ì¡°í•©í•˜ì—¬ ì²˜ë¦¬í•©ë‹ˆë‹¤`;

  // 2. ëŒ€í™” íˆìŠ¤í† ë¦¬ êµ¬ì„±
  const messages = [
    { role: 'system', content: systemPrompt },
    ...conversationHistory.slice(-10), // ìµœê·¼ 10í„´
    { role: 'user', content: userMessage },
  ];

  // 3. LLM í˜¸ì¶œ (Tool í¬í•¨)
  let iteration = 0;
  while (iteration < maxIterations) {
    const response = await callOpenAIChat(
      context.openai_api_key,
      messages,
      AGENT_TOOLS,
      'auto'
    );

    // 4. Tool í˜¸ì¶œ ì²˜ë¦¬
    if (response.tool_calls) {
      for (const toolCall of response.tool_calls) {
        const result = await executeTool(
          toolCall.function.name,
          JSON.parse(toolCall.function.arguments),
          context
        );

        // Tool ê²°ê³¼ë¥¼ ëŒ€í™”ì— ì¶”ê°€
        messages.push({
          role: 'tool',
          tool_call_id: toolCall.id,
          content: JSON.stringify(result),
        });
      }
      iteration++;
    } else {
      // Tool í˜¸ì¶œ ì—†ìŒ â†’ ìµœì¢… ì‘ë‹µ
      return {
        response: response.content,
        usage: response.usage,
      };
    }
  }
}
```

---

## ì˜ˆìƒ íš¨ê³¼

### ì •ëŸ‰ì  íš¨ê³¼

- **ì½”ë“œ ê°ì†Œ**: 10,000ì¤„ â†’ 2,000ì¤„ (80% ê°ì†Œ)
- **Intent ê´€ë¦¬**: 147ê°œ â†’ 0ê°œ (100% ê°ì†Œ)
- **Tool ê´€ë¦¬**: 0ê°œ â†’ 15ê°œ
- **í‰ê·  ëŒ€í™” í„´**: 2.5í„´ â†’ 1.2í„´ (52% ê°ì†Œ)
- **ë³µì¡í•œ ìš”ì²­ ì„±ê³µë¥ **: 30% â†’ 95% (217% ì¦ê°€)

### ì •ì„±ì  íš¨ê³¼

- âœ… ìì—°ìŠ¤ëŸ¬ìš´ ëŒ€í™”
- âœ… ë³µì¡í•œ ìš”ì²­ ì²˜ë¦¬
- âœ… ë©€í‹°í„´ ëŒ€í™” ì§€ì›
- âœ… í™•ì¥ì„± í–¥ìƒ
- âœ… ìœ ì§€ë³´ìˆ˜ ë¹„ìš© ê°ì†Œ

### ë¹„ìš© ì¦ê°€

- LLM ë¹„ìš©: $0.60/1K req â†’ $1.50/1K req (2.5ë°°)
- ì›” 10,000 ìš”ì²­ ê¸°ì¤€: $6 â†’ $15 (ì›” $9 ì¦ê°€)

**ROI**: ì‚¬ìš©ì ë§Œì¡±ë„ 5ë°° í–¥ìƒ vs ë¹„ìš© 2.5ë°° ì¦ê°€ = **ê¸ì •ì **

---

## ë‹¤ìŒ ë‹¨ê³„

1. âœ… ë¬¸ì„œí™” ì™„ë£Œ
2. ğŸš§ Agent Engine ìµœì¢… êµ¬í˜„
3. ğŸš§ chatops/index.ts ì „í™˜
4. â³ ë ˆê±°ì‹œ ì½”ë“œ ì œê±°
5. â³ í…ŒìŠ¤íŠ¸ ë° ê²€ì¦
6. â³ ë°°í¬

---

**ì‘ì„±ì**: AI Assistant
**ê²€í† ì**: ê°œë°œíŒ€
**ìŠ¹ì¸ì**: TBD

