# Classes Page - 최종 테스트 체크리스트

## ✅ 코드 품질 검증 완료

### TypeScript 타입 체크
```bash
✅ npx tsc --noEmit
   → 오류 없음 확인
```

### ESLint 검사
```bash
✅ npx eslint apps/academy-admin/src/pages/ClassesPage.tsx --max-warnings=0
   → 오류 없음 확인
```

### 타입 안전성
```typescript
✅ useCheckScheduleConflicts Hook 반환 타입 명시
   → ScheduleConflictResult 타입 정의
   → ConflictType, ScheduleConflict 인터페이스 추가
```

---

## 🧪 기능 테스트 시나리오

### Test 1: 일정 충돌 감지 - 강사 중복
**전제조건:** 강사 "김철수"가 존재

**Step 1:** 첫 번째 반 생성
- 이름: "수학 A반"
- 요일: 월요일
- 시간: 14:00 ~ 15:30
- 강사: 김철수
- 강의실: 301호

**Step 2:** 충돌 반 생성 시도
- 이름: "영어 B반"
- 요일: 월요일
- 시간: 14:30 ~ 16:00
- 강사: **김철수** (같은 강사)
- 강의실: 302호

**예상 결과:**
```
[충돌 감지 팝업]
다음 충돌이 발견되었습니다:

김철수 강사가 이미 수학 A반에 배정되어 있습니다 (14:00:00 ~ 15:30:00)

그래도 생성하시겠습니까?
[확인] [취소]
```

**검증:**
- [ ] 충돌 팝업 표시됨
- [ ] 취소 시 반 생성 중단
- [ ] 확인 시 반 생성 진행

---

### Test 2: 일정 충돌 감지 - 강의실 중복
**Step 1:** 첫 번째 반 생성
- 이름: "수학 C반"
- 요일: 화요일
- 시간: 16:00 ~ 17:30
- 강사: 이영희
- 강의실: **401호**

**Step 2:** 충돌 반 생성 시도
- 이름: "과학 D반"
- 요일: 화요일
- 시간: 16:30 ~ 18:00
- 강사: 박민수
- 강의실: **401호** (같은 강의실)

**예상 결과:**
```
[충돌 감지 팝업]
강의실 "401호"가 이미 수학 C반에 예약되어 있습니다 (16:00:00 ~ 17:30:00)
```

**검증:**
- [ ] 강의실 충돌 감지
- [ ] 시간대 겹침 정확히 감지 (16:30이 16:00~17:30 사이)

---

### Test 3: 일정 충돌 감지 - 다중 충돌
**Step:** 강사 + 강의실 동시 충돌
- 이름: "테스트 E반"
- 요일: 월요일
- 시간: 14:00 ~ 15:30
- 강사: **김철수** (Test 1의 강사)
- 강의실: **301호** (Test 1의 강의실)

**예상 결과:**
```
[충돌 감지 팝업]
다음 충돌이 발견되었습니다:

김철수 강사가 이미 수학 A반에 배정되어 있습니다 (14:00:00 ~ 15:30:00)
강의실 "301호"가 이미 수학 A반에 예약되어 있습니다 (14:00:00 ~ 15:30:00)
```

**검증:**
- [ ] 2개의 충돌 모두 표시
- [ ] conflict_count === 2

---

### Test 4: 자동 색상 할당
**Step 1:** 색상 지정 없이 반 생성 (3개)
- 반 1: "국어반" → 자동 색상
- 반 2: "영어반" → 자동 색상
- 반 3: "수학반" → 자동 색상

**예상 결과:**
- 각 반마다 다른 색상 자동 할당
- 빨강(#ef4444), 주황(#f97316), 노랑(#f59e0b) 계열

**검증:**
- [ ] 3개 반 모두 다른 색상
- [ ] 색상이 Material Design 팔레트에서 선택됨
- [ ] 반 카드에 색상 적용됨 (왼쪽 테두리)

**Step 2:** 색상 수동 지정
- 반 4: "과학반" → 색상: #3b82f6 (파란색 직접 입력)

**검증:**
- [ ] 지정한 파란색으로 생성됨
- [ ] 자동 할당 무시되고 수동 값 적용

---

### Test 5: 색상 수동 변경
**Step:** 기존 반 수정
- "국어반" 선택 → 수정
- 색상 변경: #8b5cf6 (보라색)
- 저장

**검증:**
- [ ] 색상 변경됨
- [ ] 반 목록에서 새 색상 확인
- [ ] 캘린더 뷰에서도 새 색상 확인

---

### Test 6: 시간 범위 검증
**Step:** 잘못된 시간 입력
- 이름: "오류 테스트반"
- 시작 시간: **18:00**
- 종료 시간: **14:00**

**예상 결과:**
```
[오류 알림]
시작 시간은 종료 시간보다 빨라야 합니다.
```

**검증:**
- [ ] 반 생성 차단됨
- [ ] 사용자 친화적 오류 메시지
- [ ] 폼이 닫히지 않음 (수정 가능)

---

### Test 7: 강사 배정 - 생성 시
**Step:** 반 생성 시 강사 2명 배정
- 이름: "고급 수학반"
- 강사: 김철수, 이영희 (다중 선택)

**검증:**
- [ ] 반 생성 성공
- [ ] class_teachers 테이블에 2개 레코드 생성
- [ ] 둘 다 role='teacher', is_active=true

**SQL 확인:**
```sql
SELECT ct.*, p.name as teacher_name
FROM class_teachers ct
JOIN persons p ON p.id = ct.teacher_id
WHERE ct.class_id = '<생성된 반 ID>'
  AND ct.is_active = true;

-- 예상: 2개 행 반환
```

---

### Test 8: 강사 배정 - 수정 시
**Step 1:** 기존 반 수정
- "고급 수학반" 선택 → 수정
- 강사: 김철수, 이영희 → **박민수** (변경)

**Step 2:** 저장 후 확인

**검증:**
- [ ] 김철수, 이영희 배정 비활성화 (is_active=false)
- [ ] 박민수 신규 배정 (is_active=true)
- [ ] unassigned_at 날짜 기록됨

**SQL 확인:**
```sql
-- 비활성화된 배정
SELECT * FROM class_teachers
WHERE class_id = '<반 ID>'
  AND is_active = false;
-- 예상: 2개 (김철수, 이영희)

-- 활성 배정
SELECT * FROM class_teachers
WHERE class_id = '<반 ID>'
  AND is_active = true;
-- 예상: 1개 (박민수)
```

---

### Test 9: 강사 배정 - 제거
**Step:** 반 수정 시 강사 모두 제거
- "고급 수학반" → 수정
- 강사: (아무도 선택 안 함)
- 저장

**검증:**
- [ ] 기존 배정 모두 비활성화
- [ ] 반은 강사 없이 존재 가능

---

### Test 10: 통계 표시
**Step 1:** 학생 없는 반
- capacity: 20
- current_count: 0

**예상 결과:**
- 정원률 표시 안 됨 (0%이므로 숨김)
- 출결률/지각률 표시 안 됨

**Step 2:** 학생 5명 있는 반
- capacity: 20
- current_count: 5

**예상 결과:**
- 정원률: 25.0% 표시
- 출결률/지각률 여전히 숨김 (데이터 없음)

**검증:**
- [ ] capacity_rate > 0일 때만 표시
- [ ] attendance_rate, late_rate는 항상 숨김
- [ ] 주석으로 "출결 데이터 구현 후 표시" 안내

---

### Test 11: 반 수정 시 충돌 감지
**Step 1:** 기존 반 수정
- "수학 A반" (월요일 14:00~15:30, 김철수)
- → 수정: 시간 변경 15:00~16:30

**Step 2:** 다른 반 존재
- "영어 F반" (월요일 15:30~17:00, 이영희)

**예상 결과:**
- 충돌 없음 (15:00~16:30과 15:30~17:00은 겹치지 않음)

**Step 3:** 시간 더 변경
- 수학 A반 → 15:00~17:00 (영어 F반과 겹침)

**예상 결과:**
- 충돌 없음 (다른 강사이고 강의실 다르면)
- 같은 강의실이면 충돌 감지

**검증:**
- [ ] 반 수정 시에도 충돌 감지 작동
- [ ] p_class_id로 자기 자신 제외됨

---

### Test 12: Calendar View 겹침 표시
**Step:** 같은 시간대 2개 반 생성
- "수학 G반": 월요일 10:00~11:30
- "영어 H반": 월요일 10:30~12:00

**예상 결과:**
- 캘린더 뷰에서 10:30~11:30 구간에 "+1 겹침" 표시
- 점선 테두리
- 경고색 하이라이트

**검증:**
- [ ] getClassesAtTime() 함수 작동
- [ ] 첫 번째 반 + 겹침 카운트 표시
- [ ] 시각적 구분 (점선, 색상)

---

## 🗂️ DB 검증

### Migration 적용 확인
```sql
-- 1. RPC 함수 확인
SELECT routine_name, routine_type
FROM information_schema.routines
WHERE routine_schema = 'public'
  AND routine_name IN (
    'check_schedule_conflicts',
    'get_next_class_color',
    'create_class_with_teachers'
  );

-- 예상: 3개 함수

-- 2. 트리거 확인
SELECT trigger_name, event_object_table
FROM information_schema.triggers
WHERE trigger_name = 'trigger_auto_assign_class_color';

-- 예상: 1개 트리거

-- 3. 색상 자동 할당 테스트
SELECT get_next_class_color('<tenant_id>');
-- 예상: #ef4444 또는 다른 팔레트 색상
```

---

## 📊 최종 체크리스트

### 코드 품질
- [x] TypeScript 타입 체크 통과
- [x] ESLint 검사 통과
- [x] 모든 타입 명시적 정의
- [x] import/export 일관성

### 데이터베이스
- [ ] Migration 160 적용 완료
- [ ] Migration 161 적용 완료
- [ ] Migration 162 적용 완료
- [ ] RPC 함수 3개 생성 확인
- [ ] 트리거 1개 생성 확인

### 기능 테스트
- [ ] Test 1: 강사 충돌 감지
- [ ] Test 2: 강의실 충돌 감지
- [ ] Test 3: 다중 충돌 감지
- [ ] Test 4: 자동 색상 할당
- [ ] Test 5: 색상 수동 변경
- [ ] Test 6: 시간 범위 검증
- [ ] Test 7: 강사 배정 (생성)
- [ ] Test 8: 강사 배정 (수정)
- [ ] Test 9: 강사 배정 (제거)
- [ ] Test 10: 통계 표시
- [ ] Test 11: 수정 시 충돌 감지
- [ ] Test 12: 캘린더 겹침 표시

### 문서화
- [x] 구현 완료 보고서 작성
- [x] 배포 가이드 작성
- [x] 테스트 체크리스트 작성

---

## 🐛 발견된 이슈 시 보고 양식

**이슈 제목:**
**재현 단계:**
1.
2.
3.

**예상 동작:**
**실제 동작:**
**스크린샷:**
**콘솔 오류:**

---

**테스트 완료일**: ___________
**테스터**: ___________
**전체 통과 여부**: [ ] 통과 / [ ] 실패 (___개 이슈)
